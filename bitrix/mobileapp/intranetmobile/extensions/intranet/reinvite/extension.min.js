jn.define("intranet/reinvite",((e,t,n)=>{const{Loc:i}=e("loc");const{Type:s}=e("type");const{qrauth:o}=e("qrauth/utils");const{Color:r,Indent:a,Component:u}=e("tokens");const{isPhoneNumber:l}=e("utils/phone");const{isValidEmail:d}=e("utils/email");const{BottomSheet:c}=e("bottom-sheet");const{showErrorToast:I}=e("toast");const{Icon:T}=e("ui-system/blocks/icon");const{Area:g}=e("ui-system/layout/area");const{Box:p}=e("ui-system/layout/box");const{BoxFooter:h}=e("ui-system/layout/dialog-footer");const{ButtonSize:E,ButtonDesign:N,Button:m}=e("ui-system/form/buttons/button");const{InputSize:_,InputDesign:b,InputMode:M,PhoneInput:R}=e("ui-system/form/inputs/phone");const{EmailInput:y,InputDomainIconPlace:f}=e("ui-system/form/inputs/email");const{ChipButton:v,ChipButtonDesign:B,ChipButtonMode:S}=e("ui-system/blocks/chips/chip-button");const{BBCodeText:x}=e("ui-system/typography/bbcodetext");const{Avatar:A}=e("ui-system/blocks/avatar");const{InviteStatusBox:L}=e("intranet/invite-status-box");const O=e("statemanager/redux/store");const{selectWholeUserById:C}=e("intranet/statemanager/redux/slices/employees/selector");const{RunActionExecutor:P}=e("rest/run-action-executor");const H=Application.getPlatform()==="android";const U="phone";const k="email";class D extends LayoutComponent{constructor(e){super(e);this.layoutWidget=null;this.canOpen=false;this.inviteStatusBoxIsOpened=false;this.user=C(O.getState(),Number(this.userId))??{};this.state={phone:this.user.personalMobile,email:this.user.email,inputError:null}}get userId(){return this.props.userId}isEmailInvite(){return s.isStringFilled(this.user.email)}isPhoneInvite(){return s.isStringFilled(this.user.personalMobile)}static async open(e){const t=e.parentWidget||PageManager;const n=new D(e);await n.fetchInviteSettings(t);if(!n.canOpen){return}const s=new c({component:n,titleParams:{type:"dialog",text:e.title??i.getMessage("M_INTRANET_REINVITE_TITLE"),largeMode:true}});s.setParentWidget(t).setBackgroundColor(r.bgSecondary.toHex()).setNavigationBarColor(r.bgSecondary.toHex()).disableShowOnTop().disableOnlyMediumPosition().setMediumPositionHeight(D.getStartingLayoutHeight()).enableBounce().enableSwipe().disableHorizontalSwipe().enableResizeContent().enableAdoptHeightByKeyboard().open().then((e=>{n.layoutWidget=e})).catch((e=>{console.error("Failed to open widget:",e)}))}static getStartingLayoutHeight(){const e=44;const t=u.areaPaddingTFirst.toNumber();const n=32+a.XL2.toNumber()+a.XS.toNumber();const i=42+a.M.toNumber()+a.XL2.toNumber();const s=42+a.XL2.toNumber()*2;const o=66+a.M.toNumber();return e+t+n+i+s+o}async fetchInviteSettings(e){new P("intranetmobile.invite.getInviteSettings").setCacheTtl(3600*24).setCacheId("inviteSettings").setHandler((t=>this.fetchInviteSettingsHandler(t,e))).setCacheHandler((t=>this.fetchInviteSettingsHandler(t,e))).call(true)}fetchInviteSettingsHandler=(e,t)=>{const n=e.errors&&e.errors.length>0;if(n){I(e.errors[0].message);this.canOpen=false;return}const{isBitrix24Included:i,adminInBoxRedirectLink:s}=e.data;if(!i){if(env.isAdmin){this.openBoxAdminCanInviteInWeb(s,t)}else{this.openBoxOnlyAdminCanInvite(t)}this.canOpen=false;return}this.canOpen=true};openBoxAdminCanInviteInWeb(e,t){if(this.inviteStatusBoxIsOpened){return}this.inviteStatusBoxIsOpened=true;L.open({backdropTitle:i.getMessage("M_INTRANET_REINVITE_TITLE"),testId:"status-box-reinvite-in-web",imageName:"user-locked.svg",description:i.getMessage("M_INTRANET_REINVITE_ADMIN_ONLY_IN_WEB_BOX_TEXT"),buttonText:i.getMessage("M_INTRANET_REINVITE_GO_TO_WEB_BUTTON_TEXT"),parentWidget:t,onButtonClick:()=>{setTimeout((()=>{o.open({redirectUrl:e,showHint:true,analyticsSection:"userList"})}),500)}})}openBoxOnlyAdminCanInvite(e){if(this.inviteStatusBoxIsOpened){return}this.inviteStatusBoxIsOpened=true;L.open({backdropTitle:i.getMessage("M_INTRANET_REINVITE_TITLE"),testId:"status-box-no-permission",imageName:"user-locked.svg",parentWidget:e,description:i.getMessage("M_INTRANET_REINVITE_ADMIN_ONLY_BOX_TEXT"),buttonText:i.getMessage("M_INTRANET_REINVITE_DISABLED_BOX_BUTTON_TEXT")})}componentDidMount(){super.componentDidMount();Keyboard.on(Keyboard.Event.WillHide,(()=>{this.layoutWidget.setBottomSheetHeight(D.getStartingLayoutHeight())}))}componentWillUnmount(){super.componentWillUnmount();Keyboard.on(Keyboard.Event.WillHide,(()=>{}))}render(){return p({resizableByKeyboard:true,safeArea:{bottom:true},footer:this.renderFooter()},g({isFirst:true,excludePaddingSide:{bottom:true},style:{flex:1,justifyContent:"space-between"}},View({style:{flexDirection:"row",flexWrap:"wrap",justifyContent:"center",paddingHorizontal:a.M.toNumber()}},this.renderUserChip(),this.renderInput(),this.renderDescription())))}renderDescription(){const e=this.isEmailInvite()?i.getMessage("M_INTRANET_REINVITE_DESCRIPTION_EMAIL_TEXT"):i.getMessage("M_INTRANET_REINVITE_DESCRIPTION_PHONE_TEXT");const t=i.getMessage("M_INTRANET_REINVITE_DESCRIPTION_BUTTON_TEXT");const n="17729332";const s=helpdesk.getArticleUrl(n);return View({style:{paddingTop:a.M.toNumber(),paddingHorizontal:a.XL2.toNumber()}},x({style:{textAlign:"center"},color:r.base2.toHex(),size:4,linksUnderline:false,onLinkClick:()=>{helpdesk.openHelpArticle(n,"helpdesk")},value:`${e} [COLOR=${r.accentMainLink.toHex()}][URL=${s}]${t}[/URL][/COLOR]`}))}renderFooter(){return h({safeArea:!H,keyboardButton:{text:i.getMessage("M_INTRANET_REINVITE_SEND_BUTTON"),loading:this.state.loading,onClick:this.save,testId:"reinvite-keyboard-send-button"}},m({design:N.FILLED,size:E.L,text:i.getMessage("M_INTRANET_REINVITE_SEND_BUTTON"),stretched:true,onClick:this.save,testId:"reinvite-send-button",disabled:this.state.inputError!==null}))}renderUserChip(){return v({rounded:false,style:{marginBottom:a.XL2.toNumber(),marginTop:a.XS.toNumber()},mode:S.OUTLINE,design:B.GREY,avatar:A({id:this.userId,size:20}),text:this.user.fullName})}renderInput(){const{phone:e,inputError:t,email:n}=this.state;if(this.isEmailInvite()){return y({value:n,style:{marginTop:a.M.toNumber(),marginBottom:a.XL2.toNumber()},label:i.getMessage("M_INTRANET_EMAIL_INPUT_TITLE"),size:_.L,design:b.GREY,mode:M.STROKE,align:"center",focus:true,error:t??null,errorText:t,domainIconPlace:f.LEFT,leftContent:T.MAIL,onChange:this.onChangeEmail,forwardRef:this.handleInputRef,testId:"reinvite-email-input"})}if(this.isPhoneInvite()){return R({value:e,style:{marginTop:a.M.toNumber(),marginBottom:a.XL2.toNumber()},label:i.getMessage("M_INTRANET_PHONE_INPUT_TITLE"),size:_.L,design:b.GREY,mode:M.STROKE,align:"center",focus:true,error:t??null,errorText:t,onChange:this.onChangePhone,forwardRef:this.handleInputRef,testId:"reinvite-phone-input"})}console.error("User must have either phone or email to reinvite");return null}onChangeEmail=e=>{this.setState({email:e,inputError:s.isStringFilled(e)?null:i.getMessage("M_INTRANET_REINVITE_EMAIL_INPUT_EMPTY_EMAIL")})};onChangePhone=e=>{this.setState({phone:e,inputError:s.isStringFilled(e)?null:i.getMessage("M_INTRANET_REINVITE_PHONE_INPUT_EMPTY_NUMBER")})};handleInputRef=e=>{this.inputRef=e;if(this.inputRef){this.inputRef.focus()}};save=()=>{const{phone:e,email:t,inputError:n}=this.state;if(n){return}if(e&&!l(e)){this.setState({inputError:i.getMessage("M_INTRANET_REINVITE_PHONE_INPUT_INCORRECT_NUMBER")});return}if(t&&!d(t)){this.setState({inputError:i.getMessage("M_INTRANET_REINVITE_EMAIL_INPUT_INCORRECT_EMAIL")});return}const s=e??t;const o=e?U:k;if(this.props.onSave){this.props.onSave(s,o)}this.layoutWidget.close()}}n.exports={Reinvite:D}}));
//# sourceMappingURL=extension.map.js