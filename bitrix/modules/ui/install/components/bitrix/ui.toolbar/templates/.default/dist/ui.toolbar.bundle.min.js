this.BX=this.BX||{};(function(e,t,i,a){"use strict";function r(e,t){l(e,t);t.add(e)}function s(e,t,i){l(e,t);t.set(e,i)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function n(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var o={beforeStartEditing:"beforeStartEditing",startEditing:"startEditing",finishEditing:"finishEditing"};var u=new WeakMap;var d=new WeakMap;var b=new WeakMap;var c=new WeakMap;var h=new WeakMap;var v=new WeakMap;var f=new WeakMap;var p=new WeakMap;var g=new WeakMap;var y=new WeakMap;var m=new WeakMap;var E=new WeakSet;var T=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));r(babelHelpers.assertThisInitialized(i),E);s(babelHelpers.assertThisInitialized(i),u,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),d,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),b,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),c,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),h,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),v,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),f,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),p,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),g,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),y,{writable:true,value:void 0});s(babelHelpers.assertThisInitialized(i),m,{writable:true,value:false});i.setEventNamespace("UI.Toolbar.TitleEditor");n(babelHelpers.assertThisInitialized(i),E,I).call(babelHelpers.assertThisInitialized(i),e);return i}babelHelpers.createClass(t,[{key:"enable",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!babelHelpers.classPrivateFieldGet(this,m)){return}this.changeDisplay(babelHelpers.classPrivateFieldGet(this,v),t===false);babelHelpers.classPrivateFieldGet(this,c).textContent=babelHelpers.classPrivateFieldGet(this,u)}},{key:"disable",value:function e(){this.enable(true)}},{key:"onKeyUp",value:function e(t){if(t.key==="Enter"){this.finishEdit();t.preventDefault();return false}return true}},{key:"startEdit",value:function e(){var t=new i.Event.BaseEvent;this.emit(o.beforeStartEditing,t);if(t.isDefaultPrevented()){return}babelHelpers.classPrivateFieldGet(this,h).value=babelHelpers.classPrivateFieldGet(this,c).textContent;this.changeDisplay(babelHelpers.classPrivateFieldGet(this,c),false);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,v),false);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,h),true);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,p),false);i.Dom.addClass(babelHelpers.classPrivateFieldGet(this,f),"--show");i.Dom.addClass(babelHelpers.classPrivateFieldGet(this,b),"--title-editing");babelHelpers.classPrivateFieldGet(this,h).focus();this.emit(o.startEditing)}},{key:"finishEdit",value:function e(){babelHelpers.classPrivateFieldGet(this,c).textContent=babelHelpers.classPrivateFieldGet(this,h).value;this.changeDisplay(babelHelpers.classPrivateFieldGet(this,h),false);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,v),true);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,c),true);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,p),true);i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,f),"--show");i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,b),"--title-editing");this.emit(o.finishEditing,{updatedTitle:babelHelpers.classPrivateFieldGet(this,h).value})}},{key:"cancelEdit",value:function e(){this.changeDisplay(babelHelpers.classPrivateFieldGet(this,h),false);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,v),true);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,c),true);this.changeDisplay(babelHelpers.classPrivateFieldGet(this,p),true);i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,f),"--show");i.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,b),"--title-editing")}},{key:"changeDisplay",value:function e(t,a){var r=a?"":"none";i.Dom.style(t,"display",r);return r}}]);return t}(i.Event.EventEmitter);function I(e){var t=this;babelHelpers.classPrivateFieldSet(this,b,document.getElementById("uiToolbarContainer"));babelHelpers.classPrivateFieldSet(this,c,document.querySelector(".ui-wrap-title-name"));babelHelpers.classPrivateFieldSet(this,h,document.querySelector(".ui-toolbar-edit-title-input"));babelHelpers.classPrivateFieldSet(this,v,document.querySelector(".ui-toolbar-edit-title-button"));babelHelpers.classPrivateFieldSet(this,f,document.getElementById("ui-toolbar-title-edit-result-buttons"));babelHelpers.classPrivateFieldSet(this,g,document.getElementById("ui-toolbar-save-title-button"));babelHelpers.classPrivateFieldSet(this,y,document.getElementById("ui-toolbar-cancel-title-edit-button"));babelHelpers.classPrivateFieldSet(this,p,document.getElementById("ui-toolbar-title-item-box-buttons"));babelHelpers.classPrivateFieldSet(this,u,babelHelpers.classPrivateFieldGet(this,c).textContent);babelHelpers.classPrivateFieldSet(this,d,e.defaultTitle);i.bind(babelHelpers.classPrivateFieldGet(this,v),"click",this.startEdit.bind(this));i.bind(babelHelpers.classPrivateFieldGet(this,h),"keyup",this.onKeyUp.bind(this));i.bind(babelHelpers.classPrivateFieldGet(this,h),"blur",(function(e){if(e.relatedTarget===babelHelpers.classPrivateFieldGet(t,y)){t.cancelEdit();return}t.finishEdit()}));i.bind(babelHelpers.classPrivateFieldGet(this,g),"click",this.finishEdit.bind(this));i.bind(babelHelpers.classPrivateFieldGet(this,y),"click",this.cancelEdit.bind(this));babelHelpers.classPrivateFieldSet(this,m,true);if(!e.disabled){this.enable()}}var H=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.initialized=false;this.currentPageInMenu=false;this.starContNode=null;i.ready((function(){return t.init()}));i.Event.EventEmitter.subscribe("onFrameDataProcessed",(function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;this.starContNode=document.getElementById("uiToolbarStar");if(!this.starContNode||this.initialized){return false}this.initialized=true;var a=i.Dom.attr(this.starContNode,"data-bx-url");if(!i.Type.isStringFilled(a)){a=document.location.pathname+document.location.search}a=i.Uri.removeParam(a,["IFRAME","IFRAME_TYPE"]);top.BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",(function(e){t.processMenuItemData(e)}));top.BX.addCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",(function(e){t.onStandardItemChangedSuccess(e)}));top.BX.onCustomEvent("UI.Toolbar:onRequestMenuItemData",[{currentFullPath:a,context:window}]);return true}},{key:"processMenuItemData",value:function e(t){var a=this;if(t.context&&t.context!==window){return}this.currentPageInMenu=t.currentPageInMenu;if(i.Type.isObjectLike(t.currentPageInMenu)){i.Dom.addClass(this.starContNode,"ui-toolbar-star-active")}this.starContNode.title=i.Loc.getMessage(i.Dom.hasClass(this.starContNode,"ui-toolbar-star-active")?"UI_TOOLBAR_DELETE_PAGE_FROM_LEFT_MENU":"UI_TOOLBAR_ADD_PAGE_TO_LEFT_MENU");if(i.Type.isDomNode(this.currentPageInMenu)&&i.Dom.attr(this.currentPageInMenu,"data-type")!=="standard"){this.starContNode.title=i.Loc.getMessage("UI_TOOLBAR_STAR_TITLE_DEFAULT_PAGE");i.bind(this.starContNode,"click",(function(){a.showMessage(i.Loc.getMessage("UI_TOOLBAR_STAR_TITLE_DEFAULT_PAGE_DELETE_ERROR"))}));return true}i.bind(this.starContNode,"click",(function(){var e;var t=((e=document.getElementById("pagetitle"))===null||e===void 0?void 0:e.innerText)||"";var r=a.starContNode.getAttribute("data-bx-title-template");if(i.Type.isStringFilled(r)){t=r.replace(/#page_title#/i,t)}var s=a.starContNode.getAttribute("data-bx-url");if(!i.Type.isStringFilled(s)){s=document.location.pathname+document.location.search}s=i.Uri.removeParam(s,["IFRAME","IFRAME_TYPE"]);top.BX.onCustomEvent("UI.Toolbar:onStarClick",[{isActive:i.Dom.hasClass(a.starContNode,"ui-toolbar-star-active"),context:window,pageTitle:t,pageLink:s}])}))}},{key:"onStandardItemChangedSuccess",value:function e(t){if(!i.Type.isBoolean(t.isActive)||!this.starContNode||t.context&&t.context!==window){return}if(t.isActive){this.showMessage(i.Loc.getMessage("UI_TOOLBAR_ITEM_WAS_ADDED_TO_LEFT"));this.starContNode.title=i.Loc.getMessage("UI_TOOLBAR_DELETE_PAGE_FROM_LEFT_MENU");i.Dom.addClass(this.starContNode,"ui-toolbar-star-active")}else{this.showMessage(i.Loc.getMessage("UI_TOOLBAR_ITEM_WAS_DELETED_FROM_LEFT"));this.starContNode.title=i.Loc.getMessage("UI_TOOLBAR_ADD_PAGE_TO_LEFT_MENU");i.Dom.removeClass(this.starContNode,"ui-toolbar-star-active")}}},{key:"showMessage",value:function e(t){var i=a.PopupWindowManager.create("left-menu-message",this.starContNode,{content:t,darkMode:true,offsetTop:2,offsetLeft:0,angle:true,autoHide:true,events:{onPopupClose:function e(){if(i){i.destroy();i=null}}}});i.show();setTimeout((function(){if(i){i.destroy();i=null}}),3e3)}}]);return e}();function C(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function w(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?C(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function P(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=F(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function F(e,t){if(!e)return;if(typeof e==="string")return M(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return M(e,t)}function M(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function S(e,t){k(e,t);t.add(e)}function D(e,t,i){k(e,t);t.set(e,i)}function k(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function W(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var B={beforeStartEditing:"beforeStartEditing",startEditing:"startEditing",finishEditing:"finishEditing"};var _=new WeakMap;var O=new WeakMap;var G=new WeakSet;var A=new WeakSet;var z=function(e){babelHelpers.inherits(a,e);function a(){var e;var r;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,a);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,s));S(babelHelpers.assertThisInitialized(r),A);S(babelHelpers.assertThisInitialized(r),G);D(babelHelpers.assertThisInitialized(r),_,{writable:true,value:void 0});D(babelHelpers.assertThisInitialized(r),O,{writable:true,value:void 0});r.setEventNamespace("BX.UI.Toolbar");r.titleMinWidth=i.Type.isNumber(s.titleMinWidth)?s.titleMinWidth:158;r.titleMaxWidth=i.Type.isNumber(s.titleMaxWidth)?s.titleMaxWidth:"";r.filterMinWidth=i.Type.isNumber(s.filterMinWidth)?s.filterMinWidth:300;r.filterMaxWidth=i.Type.isNumber(s.filterMaxWidth)?s.filterMaxWidth:748;r.id=i.Type.isStringFilled(s.id)?s.id:i.Text.getRandom();r.toolbarContainer=s.target;if(!i.Type.isDomNode(r.toolbarContainer)){throw new Error('BX.UI.Toolbar: "target" parameter is required.')}r.titleContainer=r.toolbarContainer.querySelector(".ui-toolbar-title-box");r.filterContainer=r.toolbarContainer.querySelector(".ui-toolbar-filter-box");r.filterButtons=r.toolbarContainer.querySelector(".ui-toolbar-filter-buttons");r.rightButtons=r.toolbarContainer.querySelector(".ui-toolbar-right-buttons");r.afterTitleButtons=r.toolbarContainer.querySelector(".ui-toolbar-after-title-buttons");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(r),_,r.toolbarContainer.querySelector("#ui-toolbar-copy-link-button"));if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(r),_)){i.Event.bind(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(r),_),"click",W(babelHelpers.assertThisInitialized(r),G,L).call(babelHelpers.assertThisInitialized(r)))}if(!r.filterContainer){r.filterMinWidth=0;r.filterMaxWidth=0}r.buttons=Object.create(null);r.buttonIds=i.Type.isArray(s.buttonIds)?s.buttonIds:[];if(r.buttonIds.length>0){r.buttonIds.forEach((function(e){var a=t.ButtonManager.createByUniqId(e);if(a){var s=a.getContainer();s.originalWidth=s.offsetWidth;if(!a.getIcon()&&!i.Type.isStringFilled(a.getDataSet().toolbarCollapsedIcon)){if(a.getColor()===t.ButtonColor.PRIMARY){a.setDataSet({toolbarCollapsedIcon:t.ButtonIcon.ADD})}else{console.warn('BX.UI.Toolbar: the button "'.concat(a.getText(),"\" doesn't have an icon for collapsed mode. ")+'Use the "data-toolbar-collapsed-icon" attribute.')}}r.buttons[e]=a}else{console.warn('BX.UI.Toolbar: the button "'.concat(e,"\" wasn't initialized."))}}))}r.windowWidth=document.body.offsetWidth;r.reduceItemsWidth();i.bind(window,"resize",(function(){if(r.isWindowIncreased()){r.increaseItemsWidth()}else{r.reduceItemsWidth()}}));if(((e=s.titleEditor)===null||e===void 0?void 0:e.active)===true){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(r),O,W(babelHelpers.assertThisInitialized(r),A,U).call(babelHelpers.assertThisInitialized(r),s.titleEditor))}return r}babelHelpers.createClass(a,[{key:"getButtons",value:function e(){return this.buttons}},{key:"getButton",value:function e(t){return t in this.buttons?this.buttons[t]:null}},{key:"getId",value:function e(){return this.id}},{key:"isWindowIncreased",value:function e(){var t=this.windowWidth;var i=document.body.offsetWidth;this.windowWidth=i;return i>t}},{key:"getContainerSize",value:function e(){return this.toolbarContainer.offsetWidth}},{key:"getInnerTotalWidth",value:function e(){return this.toolbarContainer.scrollWidth}},{key:"reduceItemsWidth",value:function e(){if(this.getInnerTotalWidth()<=this.getContainerSize()){return}var t=Object.values(this.getButtons()).reverse();var a=P(t),r;try{for(a.s();!(r=a.n()).done;){var s;var l=r.value;if(!l.getIcon()&&!i.Type.isStringFilled((s=l.getDataSet())===null||s===void 0?void 0:s.toolbarCollapsedIcon)){continue}if(l.isCollapsed()){continue}l.setCollapsed(true);if(!l.getIcon()){l.setIcon(l.getDataSet().toolbarCollapsedIcon)}if(this.getInnerTotalWidth()<=this.getContainerSize()){return}}}catch(e){a.e(e)}finally{a.f()}}},{key:"increaseItemsWidth",value:function e(){var t=Object.values(this.getButtons());for(var a=0,r=t;a<r.length;a++){var s,l,n;var o=r[a];var u=o.getContainer();if(!o.isCollapsed()){continue}var d=this.titleMinWidth+this.filterMinWidth+(((s=this.afterTitleButtons)===null||s===void 0?void 0:s.offsetWidth)||0)+(((l=this.filterButtons)===null||l===void 0?void 0:l.offsetWidth)||0)+(((n=this.rightButtons)===null||n===void 0?void 0:n.offsetWidth)||0)+(u.originalWidth-u.offsetWidth);if(d>this.getContainerSize()){break}o.setCollapsed(false);if(o.getIcon()===o.getDataSet().toolbarCollapsedIcon){var b=i.Type.isStringFilled(o.options.icon)?o.options.icon:null;o.setIcon(b)}}}},{key:"setTitle",value:function e(t){if(!this.titleContainer){return}var i=this.titleContainer.querySelector("#pagetitle");if(i){i.textContent=t}}},{key:"getContainer",value:function e(){return this.toolbarContainer}},{key:"getRightButtonsContainer",value:function e(){return this.rightButtons}},{key:"getTitleEditor",value:function e(){return babelHelpers.classPrivateFieldGet(this,O)}}]);return a}(i.Event.EventEmitter);function L(){var e=this;var t=null;return function(){if(t!==null){return}var r=i.Dom.attr(babelHelpers.classPrivateFieldGet(e,_),"data-link");var s=window.location.href;var l=i.Type.isStringFilled(r)?r:s;l=i.Uri.removeParam(l,["IFRAME","IFRAME_TYPE"]);var n=i.Dom.attr(babelHelpers.classPrivateFieldGet(e,_),"data-message");t=new a.Popup({bindElement:babelHelpers.classPrivateFieldGet(e,_),angle:true,darkMode:true,content:n,autoHide:true,cacheable:false});t.setOffset({offsetLeft:i.Dom.getPosition(babelHelpers.classPrivateFieldGet(e,_)).width/2});t.show();BX.clipboard.copy(l);setTimeout((function(){t=null}),1e3)}}function U(e){var t=this;var a=i.Type.isPlainObject(e)?e:{};var r=new T(w({},a));r.subscribe(o.beforeStartEditing,(function(e){var a=new i.Event.BaseEvent;t.emit(o.beforeStartEditing,a);if(a.isDefaultPrevented()){e.preventDefault()}}));r.subscribe(o.startEditing,(function(){t.emit(o.startEditing)}));r.subscribe(o.finishEditing,(function(e){var i=e.getData().updatedTitle;t.emit(o.finishEditing,{updatedTitle:i})}));return r}babelHelpers.defineProperty(z,"TitleEditor",T);babelHelpers.defineProperty(z,"Star",H);var x=function(){function e(){babelHelpers.classCallCheck(this,e);this.toolbars={}}babelHelpers.createClass(e,[{key:"create",value:function e(t){var i=new z(t);if(this.get(i.getId())){throw new Error("The toolbar instance with the same 'id' already exists.")}this.toolbars[i.getId()]=i;return i}},{key:"getDefaultToolbar",value:function e(){return this.get("default-toolbar")}},{key:"get",value:function e(t){return t in this.toolbars?this.toolbars[t]:null}}]);return e}();var N=new x;e.ToolbarManager=N;e.ToolbarEvents=B;e.Toolbar=z;e.ToolbarStar=H})(this.BX.UI=this.BX.UI||{},BX.UI,BX,BX.Main);
//# sourceMappingURL=ui.toolbar.bundle.map.js