this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i){"use strict";var a=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"userBoxNode",null);babelHelpers.defineProperty(this,"isChangedRights",false);babelHelpers.defineProperty(this,"storageNewRights",{});babelHelpers.defineProperty(this,"originalRights",{});babelHelpers.defineProperty(this,"detachedRights",{});babelHelpers.defineProperty(this,"moduleTasks",{});babelHelpers.defineProperty(this,"entityToNewShared",{});babelHelpers.defineProperty(this,"loadedReadOnlyEntityToNewShared",{});babelHelpers.defineProperty(this,"entityToNewSharedMaxTaskName","");babelHelpers.defineProperty(this,"ajaxUrl","/bitrix/components/bitrix/disk.folder.list/ajax.php");babelHelpers.defineProperty(this,"destFormName","folder-list-destFormName")}babelHelpers.createClass(e,[{key:"showSharingDetailWithChangeRights",value:function e(a){var n=this;this.entityToNewShared={};this.loadedReadOnlyEntityToNewShared={};a=a||{};var o=a.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailChangeRights"),{id:"folder_list_sharing_detail_object_"+o,responseType:"json",postData:{objectId:o},afterSuccessLoad:function e(s){if(s.status!=="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}var d={name:s.owner.name,avatar:s.owner.avatar,link:s.owner.link};BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("JS_DISK_SHARING_LEGACY_POPUP_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:function e(){BX.addCustomEvent("onChangeRightOfSharing",n.onChangeRightOfSharing.bind(n));for(var t in s.members){if(!s.members.hasOwnProperty(t)){continue}n.entityToNewShared[s.members[t].entityId]={item:{id:s.members[t].entityId,name:s.members[t].name,avatar:s.members[t].avatar},type:s.members[t].type,right:s.members[t].right}}BX.SocNetLogDestination.init({name:n.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:n.onSelectDestination.bind(n),unSelect:n.onUnSelectDestination.bind(n),openDialog:n.onOpenDialogDestination.bind(n),closeDialog:n.onCloseDialogDestination.bind(n),openSearch:n.onOpenSearchDestination.bind(n),closeSearch:n.onCloseSearchDestination.bind(n)},items:s.destination.items,itemsLast:s.destination.itemsLast,itemsSelected:s.destination.itemsSelected});var i=n.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(function(e){BX.SocNetLogDestination.openDialog(i);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",n.onKeyUpDestination.bind(n));BX.bind(BX("feed-add-post-destination-input"),"keydown",n.onKeyDownDestination.bind(n))},onPopupClose:function e(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",n.onChangeRightOfSharing.bind(n))}},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+d.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url(\''+encodeURI(d.avatar)+"');\"></span>"+t.Text.encode(d.name)+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:function e(){}}})]})]})],buttons:[new i.SaveButton({events:{click:function e(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(n.ajaxUrl,"action","changeSharingAndRights"),data:{objectId:o,entityToNewShared:n.entityToNewShared},onsuccess:function e(t){if(!t){return}var i=a.object.name.split(".");var n=i.pop().toLowerCase();i=i.join(".");if(i&&n==="board"){t.message=BX.message("JS_DISK_SHARING_LEGACY_POPUP_OK_BOARD_SHARE_MODIFIED").replace("#FILE#",i)}else{t.message=BX.message("JS_DISK_SHARING_LEGACY_POPUP_OK_FILE_SHARE_MODIFIED").replace("#FILE#",a.object.name)}BX.Disk.showModalWithStatusAction(t)}});BX.PopupWindowManager.getCurrentPopup().close()}}}),new BX.UI.CloseButton({events:{click:function e(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})}},{key:"showSharingDetailWithSharing",value:function e(a){var n=this;this.entityToNewShared={};this.loadedReadOnlyEntityToNewShared={};a=a||{};var o=a.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailAppendSharing"),{id:"folder_list_sharing_detail_object_"+o,responseType:"json",postData:{objectId:o},afterSuccessLoad:function e(a){if(a.status!=="success"){a.errors=a.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:a.errors.pop().message})}var s={name:a.owner.name,avatar:a.owner.avatar,link:a.owner.link};n.entityToNewSharedMaxTaskName=a.owner.maxTaskName;BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("JS_DISK_SHARING_LEGACY_POPUP_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:function e(){BX.addCustomEvent("onChangeRightOfSharing",n.onChangeRightOfSharing.bind(n));for(var t in a.members){if(!a.members.hasOwnProperty(t)){continue}n.entityToNewShared[a.members[t].entityId]={item:{id:a.members[t].entityId,name:a.members[t].name,avatar:a.members[t].avatar},type:a.members[t].type,right:a.members[t].right}}n.loadedReadOnlyEntityToNewShared=BX.clone(n.entityToNewShared,true);BX.SocNetLogDestination.init({name:n.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:n.onSelectDestination.bind(n),unSelect:n.onUnSelectDestination.bind(n),openDialog:n.onOpenDialogDestination.bind(n),closeDialog:n.onCloseDialogDestination.bind(n),openSearch:n.onOpenSearchDestination.bind(n),closeSearch:n.onCloseSearchDestination.bind(n)},items:a.destination.items,itemsLast:a.destination.itemsLast,itemsSelected:a.destination.itemsSelected});var i=n.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(function(e){BX.SocNetLogDestination.openDialog(i);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",n.onKeyUpDestination.bind(n));BX.bind(BX("feed-add-post-destination-input"),"keydown",n.onKeyDownDestination.bind(n))},onPopupClose:function e(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",n.onChangeRightOfSharing.bind(n))}},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_OWNER")+"</td>"+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'+s.link+'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url(\''+encodeURI(s.avatar)+"');\"></span>"+t.Text.encode(s.name)+"</a></td>"+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS_USER")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col2">'+BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS")+"</td>"+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:function e(){}}})]})]})],buttons:[new i.SaveButton({events:{click:function e(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(n.ajaxUrl,"action","appendSharing"),data:{objectId:o,entityToNewShared:n.entityToNewShared},onsuccess:function e(t){if(!t){return}BX.Disk.showModalWithStatusAction(t)}});BX.PopupWindowManager.getCurrentPopup().close()}}}),new BX.UI.CloseButton({events:{click:function e(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})}},{key:"showSharingDetailWithoutEdit",value:function e(t){t=t||{};BX.Disk.showSharingDetailWithoutEdit({ajaxUrl:"/bitrix/components/bitrix/disk.folder.list/ajax.php",object:t.object})}},{key:"onSelectDestination",value:function e(t,i,a){this.entityToNewShared[t.id]=this.entityToNewShared[t.id]||{};BX.Disk.appendNewShared({maxTaskName:this.entityToNewSharedMaxTaskName,readOnly:!!this.loadedReadOnlyEntityToNewShared[t.id],destFormName:this.destFormName,item:t,type:i,right:this.entityToNewShared[t.id].right||"disk_access_edit"});this.entityToNewShared[t.id]={item:t,type:i,right:this.entityToNewShared[t.id].right||"disk_access_edit"}}},{key:"onUnSelectDestination",value:function e(t,i,a){var n=t.id;if(!!this.loadedReadOnlyEntityToNewShared[n]){return false}delete this.entityToNewShared[n];var o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":""+n+""}},true);if(o){BX.remove(o)}}},{key:"onChangeRightOfSharing",value:function e(t,i){if(this.entityToNewShared[t]){this.entityToNewShared[t].right=i}}},{key:"onOpenDialogDestination",value:function e(){BX.style(BX("feed-add-post-destination-input-box"),"display","inline-block");BX.style(BX("bx-destination-tag"),"display","none");BX.focus(BX("feed-add-post-destination-input"));if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.adjustPosition({forceTop:true})}}},{key:"onCloseDialogDestination",value:function e(){var t=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&t&&t.value.length<=0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block")}}},{key:"onOpenSearchDestination",value:function e(){if(BX.SocNetLogDestination.popupSearchWindow){BX.SocNetLogDestination.popupSearchWindow.adjustPosition({forceTop:true})}}},{key:"onCloseSearchDestination",value:function e(){var t=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&t&&t.value.length>0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block");BX("feed-add-post-destination-input").value=""}}},{key:"onKeyDownDestination",value:function e(t){var i=this.destFormName;if(t.keyCode==8&&BX("feed-add-post-destination-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(i)}return true}},{key:"onKeyUpDestination",value:function e(t){var i=this.destFormName;if(t.keyCode==16||t.keyCode==17||t.keyCode==18||t.keyCode==20||t.keyCode==244||t.keyCode==224||t.keyCode==91){return false}if(t.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(i);return BX.PreventDefault(t)}if(t.keyCode==27){BX("feed-add-post-destination-input").value=""}else{BX.SocNetLogDestination.search(BX("feed-add-post-destination-input").value,true,i)}if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(t.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return BX.PreventDefault(t)}}]);return e}();var n=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(n,"WITHOUT_EDIT","without-edit");babelHelpers.defineProperty(n,"WITH_CHANGE_RIGHTS","with-change-rights");babelHelpers.defineProperty(n,"WITH_SHARING","with-sharing");babelHelpers.defineProperty(n,"BLOCKED_BY_FEATURE","blocked-by-feature");e.LegacyPopup=a;e.SharingControlType=n})(this.BX.Disk.Sharing=this.BX.Disk.Sharing||{},BX,BX.UI);
//# sourceMappingURL=disk.sharing-legacy-popup.bundle.map.js