this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(exports,ui_buttons,main_popup,disk_externalLink,disk_sharingLegacyPopup){"use strict";var InvalidTokenError=function(e){babelHelpers.inherits(n,e);function n(){babelHelpers.classCallCheck(this,n);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(n).apply(this,arguments))}return n}(babelHelpers.wrapNativeSuper(Error));InvalidTokenError.prototype.name="InvalidTokenError";function b64DecodeUnicode(e){return decodeURIComponent(atob(e).replace(/(.)/g,(function(e,n){var a=n.charCodeAt(0).toString(16).toUpperCase();if(a.length<2){a="0"+a}return"%"+a})))}function base64UrlDecode(e){var n=e.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return b64DecodeUnicode(n)}catch(e){return atob(n)}}function jwtDecode(e,n){if(typeof e!=="string"){throw new InvalidTokenError("Invalid token specified: must be a string")}n||(n={});var a=n.header===true?0:1;var i=e.split(".")[a];if(typeof i!=="string"){throw new InvalidTokenError("Invalid token specified: missing part #".concat(a+1))}var t;try{t=base64UrlDecode(i)}catch(e){throw new InvalidTokenError("Invalid token specified: invalid base64 for part #".concat(a+1," (").concat(e.message,")"))}try{return JSON.parse(t)}catch(e){throw new InvalidTokenError("Invalid token specified: invalid json for part #".concat(a+1," (").concat(e.message,")"))}}var AccessLevel;(function(e){e["private"]="private";e["readonly"]="readonly";e["editable"]="editable"})(AccessLevel||(AccessLevel={}));var DashboardFlow;(function(e){e["short"]="short"})(DashboardFlow||(DashboardFlow={}));var SDKEvents;(function(e){e["waitParams"]="waitSDKParams";e["setParams"]="setParams";e["boardChanged"]="boardChanged";e["tryToCloseApp"]="tryToCloseApp";e["successCloseApp"]="successCloseApp";e["errorCloseApp"]="errorCloseApp";e["renameBoard"]="renameBoard";e["successBoardRenamed"]="successBoardRenamed";e["errorBoardRenamed"]="errorBoardRenamed";e["userIsKicked"]="userIsKicked";e["userConfirmKickFromBoard"]="userConfirmKickFromBoard"})(SDKEvents||(SDKEvents={}));var WebSDK=function(){function e(n){babelHelpers.classCallCheck(this,e);var a,i,t,r,o,s,d,l,c;this.params=n;var v;var u;var h={};var p={user_id:"",username:"",avatar_url:"",access_level:"read",can_edit_board:false,webhook_url:"",document_id:"",download_link:"",session_id:"",file_name:""};if(n.token){try{p=jwtDecode(n.token);v=p.access_level==="read"?AccessLevel.readonly:AccessLevel.editable;u=p.can_edit_board;h.documentId=p.document_id;h.fileUrl=p.download_link;h.sessionId=p.session_id;h.fileName=p.file_name}catch(e){console.error("invalid token")}}this.boardParams={appUrl:encodeURIComponent(n.appUrl),accessLevel:v,canEditBoard:u,token:n.token,lang:n.lang||"ru",partnerId:n.partnerId||"0",ui:{colorTheme:((a=n.ui)===null||a===void 0?void 0:a.colorTheme)||"flipOriginLight",openTemplatesModal:!!((i=n.ui)===null||i===void 0?void 0:i.openTemplatesModal),compactHeader:!!((t=n.ui)===null||t===void 0?void 0:t.compactHeader),showCloseButton:!!((r=n.ui)===null||r===void 0?void 0:r.showCloseButton),dashboardFlow:((o=n.ui)===null||o===void 0?void 0:o.dashboardFlow)||undefined,exportAsFile:((s=n.ui)===null||s===void 0?void 0:s.exportAsFile)!==false,spinner:(d=n.ui)===null||d===void 0?void 0:d.spinner,userKickable:(l=n.ui)===null||l===void 0?void 0:l.userKickable,confirmUserKick:(c=n.ui)===null||c===void 0?void 0:c.confirmUserKick},appContainerDomain:window.location.origin,boardData:h};this.iframeEl=document.createElement("iframe");this.iframeEl.allow="clipboard-read; clipboard-write";window.addEventListener("beforeunload",this.destroy.bind(this))}babelHelpers.createClass(e,[{key:"init",value:function e(){var n=document.getElementById(this.params.containerId);if(!n){console.error('\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u0441 id "'.concat(this.params.containerId,'" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d.'));return}this.iframeEl.src=this.createUrl();this.iframeEl.style.width="100%";this.iframeEl.style.height="100%";this.iframeEl.style.border="none";n.appendChild(this.iframeEl);this.addEventListener();window.FlipBoard=this.getBoardMethods()}},{key:"getBoardMethods",value:function e(){var n=this;return{tryToCloseBoard:function e(){return new Promise((function(e,a){var i;window.addEventListener("message",(function(n){var i,t;if(((i=n.data)===null||i===void 0?void 0:i.event)===SDKEvents.successCloseApp){e()}if(((t=n.data)===null||t===void 0?void 0:t.event)===SDKEvents.errorCloseApp){a()}}));(i=n.iframeEl.contentWindow)===null||i===void 0?void 0:i.postMessage({event:SDKEvents.tryToCloseApp},"*")}))},renameBoard:function e(a){return new Promise((function(e,i){var t;window.addEventListener("message",(function(n){var a,t;if(((a=n.data)===null||a===void 0?void 0:a.event)===SDKEvents.successBoardRenamed){e()}if(((t=n.data)===null||t===void 0?void 0:t.event)===SDKEvents.errorBoardRenamed){i()}}));(t=n.iframeEl.contentWindow)===null||t===void 0?void 0:t.postMessage({event:SDKEvents.renameBoard,data:{name:a}},"*")}))}}}},{key:"createUrl",value:function e(){var n=new URL("".concat(this.params.appUrl).concat(this.boardParams.partnerId==="0"?"/sdkBoard":""));n.searchParams.set("fromSDK","true");if(this.boardParams.ui.openTemplatesModal)n.searchParams.set("openTemplates","true");if(this.boardParams.ui.spinner&&this.boardParams.ui.spinner!=="default")n.searchParams.set("spinner",this.boardParams.ui.spinner);n.searchParams.set("dt",Date.now().toString());return n.toString()}},{key:"addEventListener",value:function e(){window.addEventListener("message",this.listenBoardEvents.bind(this))}},{key:"listenBoardEvents",value:function e(n){var a,i,t,r,o,s,d,l,c,v,u,h,p,m,f,k,b,g,B,w;if(((a=n.data)===null||a===void 0?void 0:a.event)===SDKEvents.waitParams){(i=this.iframeEl.contentWindow)===null||i===void 0?void 0:i.postMessage({event:SDKEvents.setParams,data:this.boardParams},"*")}if(((t=n.data)===null||t===void 0?void 0:t.event)===SDKEvents.boardChanged){if((o=(r=this.params)===null||r===void 0?void 0:r.events)===null||o===void 0?void 0:o.onBoardChanged){this.params.events.onBoardChanged()}}if(((s=n.data)===null||s===void 0?void 0:s.event)===SDKEvents.successBoardRenamed){if((l=(d=this.params)===null||d===void 0?void 0:d.events)===null||l===void 0?void 0:l.onBoardRenamed){this.params.events.onBoardRenamed(((v=(c=n.data)===null||c===void 0?void 0:c.data)===null||v===void 0?void 0:v.name)||"")}}if(((u=n.data)===null||u===void 0?void 0:u.event)===SDKEvents.userIsKicked){if((p=(h=this.params)===null||h===void 0?void 0:h.events)===null||p===void 0?void 0:p.onUserKicked){(f=(m=this.params)===null||m===void 0?void 0:m.events)===null||f===void 0?void 0:f.onUserKicked()}}if(((k=n.data)===null||k===void 0?void 0:k.event)===SDKEvents.userConfirmKickFromBoard){if((g=(b=this.params)===null||b===void 0?void 0:b.events)===null||g===void 0?void 0:g.onUserKickConfirmed){(w=(B=this.params)===null||B===void 0?void 0:B.events)===null||w===void 0?void 0:w.onUserKickConfirmed()}}}},{key:"destroy",value:function e(){window.removeEventListener("message",this.listenBoardEvents)}}]);return e}();var Board=function(){function Board(e){babelHelpers.classCallCheck(this,Board);babelHelpers.defineProperty(this,"setupSharingButton",null);babelHelpers.defineProperty(this,"data",null);this.setupSharingButton=ui_buttons.ButtonManager.createByUniqId(e.panelButtonUniqIds.setupSharing);this.data=e.boardData;this.bindEvents()}babelHelpers.createClass(Board,[{key:"bindEvents",value:function e(){if(this.setupSharingButton){var n=this.setupSharingButton.getMenuWindow();var a=n.getMenuItem("ext-link").options;a.onclick=this.handleClickSharingByExternalLink.bind(this);n.removeMenuItem("ext-link");n.addMenuItem(a);var i=n.getMenuItem("sharing").options;i.onclick=this.handleClickSharing.bind(this);n.removeMenuItem("sharing");n.addMenuItem(i)}}},{key:"handleClickSharingByExternalLink",value:function handleClickSharingByExternalLink(event,menuItem){this.setupSharingButton.getMenuWindow().close();if(menuItem.dataset.shouldBlockExternalLinkFeature){eval(menuItem.dataset.blockerExternalLinkFeature);return}disk_externalLink.ExternalLink.showPopup(this.data.id)}},{key:"handleClickSharing",value:function e(){this.setupSharingButton.getMenuWindow().close();(new disk_sharingLegacyPopup.LegacyPopup).showSharingDetailWithChangeRights({object:{id:this.data.id,name:this.data.name}})}}]);return Board}();var SDK=WebSDK;exports.Board=Board;exports.SDK=SDK})(this.BX.Disk.Flipchart=this.BX.Disk.Flipchart||{},BX.UI,BX.Main,BX.Disk,BX.Disk.Sharing);
//# sourceMappingURL=script.map.js