this.BX=this.BX||{};(function(e,t,s,i,n,a,o,r,l,c,d){"use strict";class u{static eventName(e){return["BX.Intranet.LeftMenu:",...l.Type.isStringFilled(e)?[e]:e].join(":")}}u.version="2021.10";u.eventNameSpace="BX.Intranet.LeftMenu:";u.isExtranet=false;u.isAdmin=false;u.isCustomPresetRestricted=false;u.settingsPath=null;u.isMainPageEnabled=false;u.availablePresetTools=null;u.inviteDialogLink=null;u.showMarta=null;u.showSitemapMenuItem=null;var m=babelHelpers.classPrivateFieldLooseKey("popup");class h{constructor(e,{events:t}){Object.defineProperty(this,m,{writable:true,value:null});this.container=e;if(t){Array.from(Object.keys(t)).forEach((e=>{n.EventEmitter.subscribe(this,u.eventName(e),t[e])}))}}getContainer(){return this.container}createPopup(){}getPopup(){return babelHelpers.classPrivateFieldLooseBase(this,m)[m]}show(){if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]===null){babelHelpers.classPrivateFieldLooseBase(this,m)[m]=this.createPopup(...arguments);n.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,m)[m],"onClose",(()=>{n.EventEmitter.emit(this,u.eventName("onClose"))}));n.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,m)[m],"onShow",(()=>{n.EventEmitter.emit(this,u.eventName("onShow"))}));n.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,m)[m],"onDestroy",(()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]=null}))}babelHelpers.classPrivateFieldLooseBase(this,m)[m].show()}hide(){if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]){babelHelpers.classPrivateFieldLooseBase(this,m)[m].close()}}}let p=e=>e,g;class f extends h{constructor(...e){super(...e);this.isReady=true}createPopup(){const e=l.Tag.render(g||(g=p`
			<form id="customPresetForm" style="min-width: 350px;">
				<div style="margin: 15px 0 15px 9px;">
					<input type="radio" name="userScope" id="customPresetCurrentUser" value="currentUser">
					<label for="customPresetCurrentUser">${0}</label>
				</div>
				<div style="margin: 0 0 38px 9px;">
					<input type="radio" name="userScope" id="customPresetNewUser" value="newUser" checked>
					<label for="customPresetNewUser">${0}</label>
				</div>
				<hr style="background-color: #edeef0; border: none; color:  #edeef0; height: 1px;">
			</form>
		`),l.Loc.getMessage("MENU_CUSTOM_PRESET_CURRENT_USER"),l.Loc.getMessage("MENU_CUSTOM_PRESET_NEW_USER"));return i.PopupManager.create("custom-preset-form-popup",null,{overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,titleBar:l.Loc.getMessage("MENU_CUSTOM_PRESET_POPUP_TITLE"),offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,content:e,buttons:[new t.SaveButton({onclick:t=>{if(this.isReady===false){return}t.setWaiting(true);this.isReady=false;n.EventEmitter.emit(this,u.eventName("onPresetIsSet"),e.elements.userScope.value==="newUser").forEach((e=>{e.then((()=>{t.setWaiting(false);this.hide();i.PopupManager.create("menu-custom-preset-success-popup",null,{closeIcon:true,contentColor:"white",titleBar:l.Loc.getMessage("MENU_CUSTOM_PRESET_POPUP_TITLE"),content:l.Loc.getMessage("MENU_CUSTOM_PRESET_SUCCESS")}).show()})).catch((()=>{console.log("Error!!")}))}));this.isReady=true}}),new t.CancelButton({onclick:()=>{this.hide()}})]})}}var b=babelHelpers.classPrivateFieldLooseKey("curPage");var v=babelHelpers.classPrivateFieldLooseKey("curUri");class y{static getCurPage(){if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]===null){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=document.location.pathname+document.location.search}return babelHelpers.classPrivateFieldLooseBase(this,b)[b]===""?null:babelHelpers.classPrivateFieldLooseBase(this,b)[b]}static getCurUri(){if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]===null){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=new l.Uri(document.location.href)}return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}static catchError(e){l.Runtime.loadExtension("ui.notification").then((()=>{const t=l.Reflection.getClass("BX.UI.Notification.Center");t.notify({content:[l.Loc.getMessage("MENU_ERROR_OCCURRED"),e.errors?`: ${e.errors[0].message}`:""].join(" "),position:"bottom-left",category:"menu-self-item-popup",autoHideDelay:3e3})})).catch((()=>{console.log("LeftMenu: cannot load ui.notification.")}))}static refineUrl(e){let t=String(e).trim();if(t!==""){if(!/^https?:\/\//i.test(t)&&!/^\//i.test(t)){t=`https://${t}`}else{const e=document.createElement("a");e.href=t;if(document.location.host===e.host){t=e.pathname+e.search+e.hash}}}return t}}Object.defineProperty(y,b,{writable:true,value:null});Object.defineProperty(y,v,{writable:true,value:null});var E=babelHelpers.classPrivateFieldLooseKey("unavailableToolPopup");var L=babelHelpers.classPrivateFieldLooseKey("mode");class M extends h{constructor(...e){super(...e);this.isReady=true;Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0})}createPopup(e){let s;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e;const a=document.querySelector("#left-menu-preset-popup").cloneNode(true);return i.PopupManager.create(this.constructor.name.toString(),null,{overlay:true,contentColor:"white",contentNoPaddings:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,content:a,events:{onFirstShow:()=>{[...a.querySelectorAll(".js-left-menu-preset-item")].forEach((e=>{e.addEventListener("click",(()=>{[...a.querySelectorAll(".js-left-menu-preset-item")].forEach((t=>{t.classList[t===e?"add":"remove"]("left-menu-popup-selected")}))}))}))}},buttons:[s=new t.CreateButton({text:l.Loc.getMessage("MENU_CONFIRM_BUTTON"),onclick:()=>{if(s.isWaiting()){return}s.setWaiting(true);const t=this.getSelectedPreset();if(!u.isAdmin&&u.availablePresetTools&&u.availablePresetTools[t]===false){s.setWaiting(false);this.showUnavailableToolPopup();return}n.EventEmitter.emit(this,u.eventName("onPresetIsSet"),{presetId:t,mode:e}).forEach((e=>{e.then((e=>{s.setWaiting(false);this.hide();if(e.data.hasOwnProperty("url")){document.location.href=e.data.url}else{document.location.reload()}})).catch(y.catchError)}))}}),new t.CancelButton({text:l.Loc.getMessage("MENU_DELAY_BUTTON"),onclick:()=>{n.EventEmitter.emit(this,u.eventName("onPresetIsPostponed"),{mode:e});this.hide()}})]})}getMode(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}getSelectedPreset(){let e="";if(document.forms["left-menu-preset-form"]){[...document.forms["left-menu-preset-form"].elements["presetType"]].forEach((t=>{if(t.checked){e=t.value}}))}return e}showUnavailableToolPopup(){if(!(babelHelpers.classPrivateFieldLooseBase(this,E)[E]instanceof a.MessageBox)){babelHelpers.classPrivateFieldLooseBase(this,E)[E]=a.MessageBox.create({message:l.Loc.getMessage("MENU_UNAVAILABLE_TOOL_POPUP_DESCRIPTION"),buttons:a.MessageBoxButtons.OK})}babelHelpers.classPrivateFieldLooseBase(this,E)[E].show()}}var I=babelHelpers.classPrivateFieldLooseKey("getMenuItems");var P=babelHelpers.classPrivateFieldLooseKey("getMenuItem");class C extends h{constructor(...e){super(...e);Object.defineProperty(this,P,{value:S});Object.defineProperty(this,I,{value:B});this.menuId="leftMenuSettingsPopup"}createPopup(){const e=new i.Menu({bindElement:this.container,targetContainer:document.querySelector(".js-app__left-menu"),items:this.getItems(),angle:true,offsetTop:0,offsetLeft:50});return e.getPopupWindow()}getItems(){const e=n.EventEmitter.emit(this,u.eventName("onGettingSettingMenuItems"));return babelHelpers.classPrivateFieldLooseBase(this,I)[I]([...e][0])}}function B(e){if(l.Type.isArray(e)===false){return[]}return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,P)[P](e)))}function S(e){if(!l.Type.isPlainObject(e)){return null}const{text:t,html:s,onclick:i,className:n,items:a=[],delimiter:o=false}=e;return{html:s,text:s?undefined:t,items:babelHelpers.classPrivateFieldLooseBase(this,I)[I](a),delimiter:o,className:`menu-popup-no-icon ${n}`,onclick:(e,t)=>{var s,n;if(!l.Type.isArrayFilled(a)){t.getMenuWindow().close()}(s=t.getMenuWindow().getParentMenuItem())==null?void 0:(n=s.getMenuWindow())==null?void 0:n.close();if(i){i(e,t)}}}}class T{static toggleMenu(e){if(l.Loc.getMessage("USER_ID")<=0){return}const t=l.Loc.getMessage("SITE_DIR")||"/";const s=window.location.pathname.toString().startsWith(`${t}online/`)?"online":"";return l.ajax.runAction(`intranet.leftmenu.${e?"collapseMenu":"expandMenu"}`,{data:{context:s},analyticsLabel:{leftmenu:{action:e?"collapseMenu":"expandMenu"}}})}static saveSelfItemMenu(e){const t=e.id>0?"update":"add";return l.ajax.runAction(`intranet.leftmenu.${t}SelfItem`,{data:{itemData:e},analyticsLabel:{leftmenu:{action:"selfItemAddOrUpdate"}}})}static deleteSelfITem(e){return l.ajax.runAction("intranet.leftmenu.deleteSelfItem",{data:{menuItemId:e},analyticsLabel:{leftmenu:{action:"selfItemDelete"}}})}static addFavoritesItemMenu(e){return l.ajax.runAction("intranet.leftmenu.addStandartItem",{data:{itemData:e},analyticsLabel:{leftmenu:{action:"standardItemAdd"}}})}static deleteFavoritesItemMenu(e){return l.ajax.runAction("intranet.leftmenu.deleteStandartItem",{data:{itemData:e},analyticsLabel:{leftmenu:{action:"standardItemDelete"}}})}static updateFavoritesItemMenu(e){return l.ajax.runAction("intranet.leftmenu.updateStandartItem",{data:{itemText:e.text,itemId:e.id},analyticsLabel:{leftmenu:{action:"standardItemUpdate"}}})}static addAdminSharedItemMenu(e){return l.ajax.runAction("intranet.leftmenu.addItemToAll",{data:{itemInfo:e},analyticsLabel:{leftmenu:{action:"adminItemAdd"}}})}static deleteAdminSharedItemMenu(e){return l.ajax.runAction("intranet.leftmenu.deleteItemFromAll",{data:{menu_item_id:e},analyticsLabel:{leftmenu:{action:"adminItemDelete"}}})}static saveItemsSort(e,t,s){return l.ajax.runAction("intranet.leftmenu.saveItemsSort",{data:{items:e,firstItemLink:t,version:u.version},analyticsLabel:{leftmenu:s}})}static setFirstPage(e){return l.ajax.runAction("intranet.leftmenu.setFirstPage",{data:{firstPageUrl:e},analyticsLabel:{leftmenu:{action:"mainPageIsSet"}}})}static setDefaultPreset(){return l.ajax.runAction("intranet.leftmenu.setDefaultMenu",{data:{},analyticsLabel:{leftmenu:{action:"defaultMenuIsSet"}}})}static setCustomPreset(e,t,s,i){return l.ajax.runAction("intranet.leftmenu.saveCustomPreset",{data:{userApply:e===true?"newUser":"currentUser",itemsSort:t,customItems:s,firstItemLink:i,version:u.version},analyticsLabel:{leftmenu:{action:"customPresetIsSet"}}})}static deleteCustomItem(e){return l.ajax.runAction("intranet.leftmenu.deleteCustomItemFromAll",{data:{menu_item_id:e},analyticsLabel:{leftmenu:{action:"customItemDelete"}}})}static setSystemPreset(e,t){return l.ajax.runAction("intranet.leftmenu.setPreset",{data:{preset:t,mode:e==="global"?"global":"personal"},analyticsLabel:{leftmenu:{action:"systemPresetIsSet",presetId:t,mode:e,analyticsFirst:e==="global"?"y":"n"}}})}static postponeSystemPreset(e){return l.ajax.runAction("intranet.leftmenu.delaySetPreset",{data:{},analyticsLabel:{leftmenu:{action:"systemPresetIsPostponed",mode:e,analyticsFirst:e==="global"?"y":"n"}}})}static clearCache(){return l.ajax.runAction("intranet.leftmenu.clearCache",{data:{},analyticsLabel:{leftmenu:{action:"clearCache"}}})}static expandGroup(e){if(l.Loc.getMessage("USER_ID")<=0){return}return l.ajax.runAction("intranet.leftmenu.expandMenuGroup",{data:{id:e},analyticsLabel:{leftmenu:{action:"expandMenuGroup"}}})}static collapseGroup(e){if(l.Loc.getMessage("USER_ID")<=0){return}return l.ajax.runAction("intranet.leftmenu.collapseMenuGroup",{data:{id:e},analyticsLabel:{leftmenu:{action:"collapseMenuGroup"}}})}}let x=e=>e,D,A,k,w;class F{constructor(e,t){this.links=[];this.isDraggable=true;this.storage=[];this.parentContainer=e;this.container=t;this.init();this.onDeleteAsFavorites=this.onDeleteAsFavorites.bind(this);setTimeout((()=>{n.EventEmitter.subscribe(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);n.EventEmitter.incrementMaxListeners(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"));n.EventEmitter.subscribe(this,u.eventName("onItemDelete"),this.destroy.bind(this))}),0);this.showError=this.showError.bind(this);this.showMessage=this.showMessage.bind(this)}getId(){return this.container.dataset.id}getCode(){return this.constructor.code}getName(){return this.container.querySelector("[data-role='item-text']").textContent}canDelete(){return false}delete(){}init(){this.links=[];if(this.container.hasAttribute("data-link")&&l.Type.isStringFilled(this.container.getAttribute("data-link"))){this.links.push(this.container.getAttribute("data-link"))}if(this.container.hasAttribute("data-all-links")){this.container.getAttribute("data-all-links").split(",").forEach((e=>{e=String(e).trim();if(l.Type.isStringFilled(e)){this.links.push(e)}}))}this.makeTextIcons();this.storage=this.container.dataset.storage.split(",")}update({link:e,openInNewPage:t,text:s}){t=t==="Y"?"Y":"N";if(this.container.hasAttribute("data-link")){this.container.setAttribute("data-link",l.Text.encode(e));this.container.setAttribute("data-new-page",t)}const i=this.container.querySelector("a");if(i){if(l.Type.isString(e)){i.setAttribute("href",l.Text.encode(e))}i.setAttribute("target",t==="Y"?"_blank":"_self")}this.container.querySelector("[data-role='item-text']").innerHTML=l.Text.encode(s);this.init()}destroy(){n.EventEmitter.unsubscribe(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);n.EventEmitter.decrementMaxListeners(n.EventEmitter.GLOBAL_TARGET,"onItemDeleteAsFavorites")}getSimilarToUrl(e){const t=[];this.links.forEach(((s,i)=>{if(_(s,e)){let e=0;if(i===0){e=this.getCode()==="default"?2:1}t.push({priority:e,url:s})}}));return t}makeTextIcons(){if(!this.container.classList.contains("menu-item-no-icon-state")){return}const e=this.container.querySelector(".menu-item-icon");const t=this.container.querySelector(".menu-item-link-text");if(e&&t){e.textContent=N(t.textContent)}}getCounterValue(){const e=this.container.querySelector('[data-role="counter"]');if(!e){return null}return parseInt(e.dataset.counterValue)}updateCounter(e){const t=this.container.querySelector('[data-role="counter"]');if(!t){return}const s=parseInt(t.dataset.counterValue)||0;t.dataset.counterValue=e;if(e>0){t.innerHTML=e>99?"99+":e;this.container.classList.add("menu-item-with-index")}else{t.innerHTML="";this.container.classList.remove("menu-item-with-index");if(e<0){const e=BX("menu-counter-warning-"+this.getId());if(e){e.style.display="inline-block"}}}return{oldValue:s,newValue:e}}markAsActive(){console.error("This action is only for the group")}showWarning(e,t){this.removeWarning();const s=this.container.querySelector("a.menu-item-link");if(!s){return}e=e?l.Text.encode(e):"";const i=l.Tag.render(D||(D=x`<a class="menu-post-warn-icon" title="${0}"></a>`),e);if(t){Object.keys(t).forEach((e=>{l.Event.bind(i,e,t[e])}))}this.container.classList.add("menu-item-warning-state");s.appendChild(i)}removeWarning(){if(!this.container.classList.contains("menu-item-warning-state")){return}this.container.classList.remove("menu-item-warning-state");let e;while(e=this.container.querySelector("a.menu-post-warn-icon")){e.parentNode.removeChild(e)}}showMessage(e){if(this.showMessagePopup){this.showMessagePopup.close()}this.showMessagePopup=i.PopupManager.create("left-menu-message",this.container,{content:'<div class="left-menu-message-popup">'+e+"</div>",darkMode:true,offsetTop:2,offsetLeft:0,angle:true,events:{onClose:()=>{this.showMessagePopup=null}},autoHide:true});this.showMessagePopup.show();setTimeout((()=>{if(this.showMessagePopup){this.showMessagePopup.close()}}),3e3)}showError(e){const t=[];if(e.errors){t.push(e.errors[0].message)}else if(e instanceof TypeError){t.push(e.message)}const s=[l.Loc.getMessage("MENU_ERROR_OCCURRED"),...t].join(" ");this.showMessage(s)}getDropDownActions(){return[]}getEditFields(){return{id:this.getId(),text:this.getName()}}onDeleteAsFavorites({data:e}){if(String(e.id)===String(this.getId())){if(this.getCode()==="standard"){n.EventEmitter.emit(this,u.eventName("onItemDelete"),{item:this,animate:true})}else{this.storage=[...this.storage].filter((e=>e!=="standard"));this.container.dataset.storage=this.storage.join(",")}n.EventEmitter.unsubscribe(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),this.onDeleteAsFavorites);n.EventEmitter.decrementMaxListeners(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"))}}static detect(e){return e.getAttribute("data-role")!=="group"&&e.getAttribute("data-type")===this.code}static createNode({id:e,text:t,link:s,openInNewPage:i,counterId:n,counterValue:a,topMenuId:o}){e=l.Text.encode(e);t=l.Text.encode(t);s=l.Text.encode(s);n=n?l.Text.encode(n):"";a=a?parseInt(a):0;i=i==="Y"?"Y":"N";return l.Tag.render(A||(A=x`<li 
			id="bx_left_menu_${0}" 
			data-status="show" 
			data-id="${0}" 
			data-role="item"
			data-storage="" 
			data-counter-id="${0}" 
			data-link="${0}" 
			data-all-links="" 
			data-type="${0}" 
			data-delete-perm="Y" 
			${0}
			data-new-page="${0}" 
			class="menu-item-block menu-item-no-icon-state">
				<span class="menu-favorites-btn menu-favorites-draggable">
					<span class="menu-fav-draggable-icon"></span>
				</span>
				<a class="menu-item-link" data-slider-ignore-autobinding="true" href="${0}" target="${0}">
					<span class="menu-item-icon-box">
						<span class="menu-item-icon">W</span>
					</span>
					<span class="menu-item-link-text " data-role="item-text">${0}</span>
					${0}
				</a>
				<span data-role="item-edit-control" class="menu-fav-editable-btn menu-favorites-btn">
					<span class="menu-favorites-btn-icon"></span>
				</span>
			</li>`),e,e,n,s,this.code,o?`data-top-menu-id="${l.Text.encode(o)}"`:"",i,s,i==="Y"?"_blank":"_self",t,n?`<span class="menu-item-index-wrap">\n\t\t\t\t\t\t<span data-role="counter"\n\t\t\t\t\t\t\tdata-counter-value="${a}" class="menu-item-index" id="menu-counter-${n}">${a}</span>\n\t\t\t\t\t</span>`:"")}static backendSaveItem(e){throw"Function backendSaveItem must be replaced"}static showUpdate(e){return new Promise(((t,s)=>{this.showForm(e.container,e.getEditFields(),t,s)}))}static checkForm(e){if(String(e.elements["text"].value).trim().length<=0){e.elements["text"].classList.add("menu-form-input-error");e.elements["text"].focus();return false}if(e.elements["link"]){if(String(e.elements["link"].value).trim().length<=0||y.refineUrl(e.elements["link"].value).length<=0){e.elements["link"].classList.add("menu-form-input-error");e.elements["link"].focus();return false}else{e.elements["link"].value=y.refineUrl(e.elements["link"].value)}}return true}static showForm(e,s,n,a){if(this.popup){this.popup.close()}const o=s.id!=="";const r=l.Tag.render(k||(k=x`
<form name="menuAddToFavoriteForm">
	<input type="hidden" name="id" value="${0}">
	<label for="menuPageToFavoriteName" class="menu-form-label">${0}</label>
	<input name="text" type="text" id="menuPageToFavoriteName" class="menu-form-input" value="${0}" >
	${0}
	${0}
</form>`),l.Text.encode(s.id||""),l.Loc.getMessage("MENU_ITEM_NAME"),l.Text.encode(s.text||""),s["link"]!==undefined?`<br><br>\n\t<label for="menuPageToFavoriteLink" class="menu-form-label">${l.Loc.getMessage("MENU_ITEM_LINK")}</label>\n\t<input name="link" id="menuPageToFavoriteLink" type="text" class="menu-form-input" value="${l.Text.encode(s.link)}" >`:"",s["openInNewPage"]!==undefined?`<br><br>\n\t<input name="openInNewPage" id="menuOpenInNewPage" type="checkbox" value="Y" ${s.openInNewPage==="Y"?"checked":""} >\n\t<label for="menuOpenInNewPage" class="menu-form-label">${l.Loc.getMessage("MENU_OPEN_IN_NEW_PAGE")}</label>`:"");Object.keys(s).forEach((e=>{if(["id","text","link","openInNewPage"].indexOf(e)<0){const t=l.Text.encode(e);const i=l.Text.encode(s[e]);r.appendChild(l.Tag.render(w||(w=x`<input type="hidden" name="${0}" value="${0}">`),t,i))}}));this.popup=i.PopupManager.create("menu-self-item-popup",e,{className:"menu-self-item-popup",titleBar:s["link"]===undefined?l.Loc.getMessage("MENU_RENAME_ITEM"):o?l.Loc.getMessage("MENU_EDIT_SELF_PAGE"):l.Loc.getMessage("MENU_ADD_SELF_PAGE"),offsetTop:1,offsetLeft:20,cacheable:false,closeIcon:true,lightShadow:true,draggable:{restrict:true},closeByEsc:true,content:r,buttons:[new t.SaveButton({onclick:()=>{if(this.checkForm(r)){const e={};[...r.elements].forEach((t=>{e[t.name]=t.value}));if(r.elements["openInNewPage"]){e["openInNewPage"]=r.elements["openInNewPage"].checked?"Y":"N"}this.backendSaveItem(e).then((()=>{n(e);this.popup.close()})).catch(y.catchError)}}}),new t.CancelButton({onclick:()=>{this.popup.close()}})]});this.popup.show()}}F.code="abstract";function _(e,t){const s=new l.Uri(e);const i=s.getPath().replace("/index.php","").replace("/index.html","");const n=t.getPath().replace("/index.php","").replace("/index.html","");if(s.getHost()!==""&&s.getHost()!==t.getHost()){return false}if(n.indexOf(i)!==0){return false}return true}function N(e){if(!l.Type.isStringFilled(e)){return"..."}e=e.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(e.length<=0){return"..."}let t;let s=e.split(/[\s,]+/);if(s.length<=1){t=e.substring(0,1)}else if(s.length===2){t=s[0].substring(0,1)+s[1].substring(0,1)}else{let e=s[0];let i=s[1];for(let e=1;e<s.length;e++){if(s[e].length>3){i=s[e];break}}t=e.substring(0,1)+i.substring(0,1)}return t.toUpperCase()}var H=babelHelpers.classPrivateFieldLooseKey("currentPageInTopMenu");class O extends F{canDelete(){return true}delete(){T.deleteFavoritesItemMenu({id:this.getId(),storage:this.storage}).then((()=>{this.destroy();n.EventEmitter.emit(this,u.eventName("onItemDelete"),{animate:true});const e=this.getSimilarToUrl(y.getCurUri()).length>0?window:{doesnotmatter:""};BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[{id:this.getId()},this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false,context:e}])}))}getDropDownActions(){const e=[];e.push({text:l.Loc.getMessage("MENU_RENAME_ITEM"),onclick:()=>{this.constructor.showUpdate(this).then(this.update.bind(this)).catch(this.showError)}});e.push({text:l.Loc.getMessage("MENU_REMOVE_STANDARD_ITEM"),onclick:()=>{this.delete()}});if(u.isAdmin){e.push({text:l.Loc.getMessage("MENU_ADD_ITEM_TO_ALL"),onclick:()=>{const e=this.container.querySelector("a");T.addAdminSharedItemMenu({id:this.getId(),link:this.links[0],text:this.getName(),counterId:this.container.dataset.counterId,openInNewPage:e&&e.getAttribute("target")==="_blank"?"Y":"N"}).then((()=>{this.showMessage(l.Loc.getMessage("MENU_ITEM_WAS_ADDED_TO_ALL"));this.container.dataset.type=X.code;this.storage.push(O.code);this.container.dataset.storage=this.storage.join(",");n.EventEmitter.emit(this,u.eventName("onItemConvert"),this)})).catch(this.showError)}})}return e}static backendSaveItem(e){return T.updateFavoritesItemMenu(e)}static getActiveTopMenuItem(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}if(!BX.Main||!BX.Main.interfaceButtonsManager){return null}const e=Array.from(Object.values(BX.Main.interfaceButtonsManager.getObjects())).shift();if(e){const t=e.getActive();if(t&&typeof t==="object"){const e=document.createElement("a");e.href=t["URL"];const s=e.pathname[0]!=="/"?"/"+e.pathname:e.pathname;babelHelpers.classPrivateFieldLooseBase(this,H)[H]={ID:t["ID"]||null,NODE:t["NODE"]||null,URL:s+e.search,TEXT:t["TEXT"],DATA_ID:t["DATA_ID"],COUNTER_ID:t["COUNTER_ID"],COUNTER:t["COUNTER"],SUB_LINK:t["SUB_LINK"]}}}return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}static isCurrentPageStandard(e){if(e&&e["URL"]){const t=document.location.pathname+document.location.search;return e.URL===t&&e.URL.indexOf("workgroups")<0}return false}static saveCurrentPage({pageTitle:e,pageLink:t}){const s=this.getActiveTopMenuItem();let i,n,a;if(s&&s.NODE&&this.isCurrentPageStandard(s)&&(t===y.getCurPage()||t===s.URL||!t)){const t=s.NODE.getBoundingClientRect();n=t.left;a=t.top;i={id:s.DATA_ID,text:e||s.TEXT,link:y.getCurPage()||s.URL,counterId:s.COUNTER_ID,counterValue:s.COUNTER,isStandardItem:true,subLink:s.SUB_LINK}}else{i={text:e||document.getElementById("pagetitle").innerText,link:t||y.getCurPage(),isStandardItem:t===y.getCurPage()};const s=BX("pagetitle").getBoundingClientRect();n=s.left;a=s.top}return T.addFavoritesItemMenu(i).then((({data:{itemId:e}})=>{i.id=e;i.topMenuId=i.id;return{node:this.createNode(i),animateFromPoint:{startX:n,startY:a},itemInfo:i}}))}static deleteCurrentPage({pageLink:e}){const t=this.getActiveTopMenuItem();var s={},i,a;if(t&&this.isCurrentPageStandard(t)){s["id"]=t.DATA_ID;const e=t.NODE.getBoundingClientRect();i=e.left;a=e.top}else{s["link"]=e||y.getCurPage();const t=BX("pagetitle").getBoundingClientRect();i=t.left;a=t.top}return T.deleteFavoritesItemMenu(s).then((({data:e})=>{if(!s.id&&e&&e["itemId"]){s.id=e["itemId"]}n.EventEmitter.emit(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),{id:s.id});return{itemInfo:s,animateToPoint:{startX:i,startY:a}}}))}static saveStandardPage({DATA_ID:e,TEXT:t,SUB_LINK:s,COUNTER_ID:i,COUNTER:n,NODE:a,URL:o}){const r={id:e,text:t,link:o,subLink:s,counterId:i,counterValue:n};const l=a.getBoundingClientRect();const c=l.left;const d=l.top;return T.addFavoritesItemMenu(r).then((({data:{itemId:t}})=>{r.id=t;r.topMenuId=r.id;const s=this.getActiveTopMenuItem();BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[r,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:true,context:s&&s.DATA_ID===e?window:null}]);return{node:this.createNode(r),animateFromPoint:{startX:c,startY:d}}}))}static deleteStandardPage({DATA_ID:e}){const t={id:e};return T.deleteFavoritesItemMenu(t).then((()=>{n.EventEmitter.emit(n.EventEmitter.GLOBAL_TARGET,u.eventName("onItemDeleteAsFavorites"),{id:t.id});BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[t,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false}]);return{itemInfo:t}}))}}O.code="standard";Object.defineProperty(O,H,{writable:true,value:null});class U extends F{canDelete(){return true}delete(){return T.deleteSelfITem(this.getId()).then((()=>{if(this.storage.indexOf(O.code)>=0){T.deleteFavoritesItemMenu({id:this.getId()})}n.EventEmitter.emit(this,u.eventName("onItemDelete"),{animate:true})})).catch(this.showError)}getDropDownActions(){const e=[];e.push({text:l.Loc.getMessage("MENU_EDIT_ITEM"),onclick:()=>{this.constructor.showUpdate(this).then(this.update.bind(this)).catch(this.showError)}});e.push({text:l.Loc.getMessage("MENU_DELETE_SELF_ITEM"),onclick:()=>{a.MessageBox.confirm(l.Loc.getMessage("MENU_DELETE_SELF_ITEM_CONFIRM"),l.Loc.getMessage("MENU_DELETE_SELF_ITEM"),(e=>{this.delete();e.close()}),l.Loc.getMessage("MENU_DELETE"))}});if(u.isAdmin){e.push({text:l.Loc.getMessage("MENU_ADD_ITEM_TO_ALL"),onclick:()=>{const e=this.container.querySelector("a");T.addAdminSharedItemMenu({id:this.getId(),link:this.links[0],text:this.getName(),counterId:this.container.dataset.counterId,openInNewPage:e&&e.getAttribute("target")==="_blank"?"Y":"N"}).then((()=>{this.showMessage(l.Loc.getMessage("MENU_ITEM_WAS_ADDED_TO_ALL"));this.container.dataset.type=X.code;this.storage.push(U.code);this.container.dataset.storage=this.storage.join(",");n.EventEmitter.emit(this,u.eventName("onItemConvert"),this)})).catch(this.showError)}})}return e}getEditFields(){return{id:this.getId(),text:this.getName(),link:this.links[0],openInNewPage:this.container.getAttribute("data-new-page")}}static backendSaveItem(e){return T.saveSelfItemMenu(e).then((({data:t})=>{if(t&&t["itemId"]){e.id=t["itemId"]}return e}))}static showAdd(e){return new Promise(((t,s)=>{this.showForm(e,{id:0,name:"",link:"",openInNewPage:"Y"},t,s)})).then((e=>({node:this.createNode(e)})))}}U.code="self";class X extends F{canDelete(){return this.container.dataset.deletePerm==="Y"}delete(){T.deleteAdminSharedItemMenu(this.getId()).then((()=>{if(this.storage.indexOf(O.code)>=0){T.deleteFavoritesItemMenu({id:this.getId()})}if(this.storage.indexOf(U.code)>=0){T.deleteSelfITem(this.getId())}n.EventEmitter.emit(this,u.eventName("onItemDelete"),{animate:true})})).catch(this.showError)}getDropDownActions(){if(!this.canDelete()){return[]}const e=[];if(this.storage.filter((e=>e===O.code||e===U.code)).length>0){e.push({text:l.Loc.getMessage("MENU_REMOVE_STANDARD_ITEM"),onclick:this.delete.bind(this)});e.push({text:l.Loc.getMessage("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),onclick:()=>{T.deleteAdminSharedItemMenu(this.getId()).then((()=>{this.showMessage(l.Loc.getMessage("MENU_ITEM_WAS_DELETED_FROM_ALL"));const e=this.storage.indexOf(U.code)>=0?U.code:O.code;this.container.dataset.type=e;this.container.dataset.storage=this.storage.filter((t=>t!==e)).join(",");n.EventEmitter.emit(this,u.eventName("onItemConvert"),this)})).catch(this.showError)}})}else{e.push({text:l.Loc.getMessage("MENU_DELETE_CUSTOM_ITEM_FROM_ALL"),onclick:this.delete.bind(this)})}return e}}X.code="admin";class R extends F{canDelete(){return this.container.dataset.deletePerm==="Y"}delete(){if(this.canDelete()){T.deleteCustomItem(this.getId()).then((()=>{if(this.storage.indexOf(O.code)>=0){T.deleteFavoritesItemMenu({id:this.getId()})}n.EventEmitter.emit(this,u.eventName("onItemDelete"),{animate:true})})).catch(this.showError)}}getDropDownActions(){const e=[];if(this.canDelete()){e.push({text:l.Loc.getMessage("MENU_DELETE_ITEM_FROM_ALL"),onclick:this.delete.bind(this)})}return e}}R.code="custom";class q extends F{canDelete(){return false}openSettings(){const e=`${l.Loc.getMessage("mainpage_settings_path")}&analyticContext=left_menu`;BX.SidePanel.Instance.open(e)}}q.code="main";class j extends F{canDelete(){return false}}j.code="default";var $=babelHelpers.classPrivateFieldLooseKey("collapsingAnimation");class G extends F{constructor(){super(...arguments);Object.defineProperty(this,$,{writable:true,value:void 0});this.container.addEventListener("click",this.toggleAndSave.bind(this),true);this.container.addEventListener("mouseleave",(()=>{l.Dom.removeClass(this.container,"menu-item-group-actioned")}));this.groupContainer=this.container.parentNode.querySelector(`[data-group-id="${this.getId()}"]`);if(this.container.getAttribute("data-collapse-mode")==="collapsed"){this.groupContainer.style.display="none"}setTimeout((()=>{this.updateCounter()}),0)}toggleAndSave(e){e.preventDefault();e.stopPropagation();if(this.container.getAttribute("data-collapse-mode")==="collapsed"){T.expandGroup(this.getId());this.expand().then((()=>{this.container.setAttribute("data-collapse-mode","expanded")}))}else{T.collapseGroup(this.getId());this.collapse().then((()=>{this.container.setAttribute("data-collapse-mode","collapsed")}))}return false}checkAndCorrect(){const e=this.groupContainer;if(e.parentNode===this.container){l.Dom.insertAfter(e,this.container)}[...e.querySelectorAll(`.menu-item-block`)].forEach((e=>{e.setAttribute("data-status",this.container.getAttribute("data-status"))}));return this}collapse(e){return new Promise((t=>{const s=this.groupContainer;if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]){babelHelpers.classPrivateFieldLooseBase(this,$)[$].stop()}s.style.overflow="hidden";l.Dom.addClass(this.container,"menu-item-group-collapsing");l.Dom.addClass(this.container,"menu-item-group-actioned");l.Dom.addClass(s,"menu-item-group-collapsing");const i={height:s.offsetHeight,display:s.style.display};babelHelpers.classPrivateFieldLooseBase(this,$)[$]=new BX.easing({duration:500,start:{height:i.height,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){s.style.height=e.height+"px";s.style.opacity=e.opacity/100},complete:()=>{s.style.display="none";s.style.opacity="auto";s.style.height="auto";l.Dom.style(s,"overflow",null);if(this.container.getAttribute("data-contains-active-item")==="Y"){l.Dom.addClass(this.container,"menu-item-active")}l.Dom.removeClass(this.container,"menu-item-group-collapsing");l.Dom.removeClass(s,"menu-item-group-collapsing");babelHelpers.classPrivateFieldLooseBase(this,$)[$]=null;if(e===true){this.container.appendChild(s)}t()}});babelHelpers.classPrivateFieldLooseBase(this,$)[$].animate()}))}expand(e){return new Promise((t=>{const s=this.container;const i=this.groupContainer;if(e===true&&s.getAttribute("data-collapse-mode")==="collapsed"){return t()}const n=i.querySelectorAll("li").length*(s.offsetHeight+4);l.Dom.addClass(s,"menu-item-group-expanding");l.Dom.addClass(s,"menu-item-group-actioned");l.Dom.addClass(i,"menu-item-group-expanding");if(i.parentNode===this.container){l.Dom.insertAfter(i,this.container)}i.style.display="block";babelHelpers.classPrivateFieldLooseBase(this,$)[$]=new BX.easing({duration:500,start:{height:0,opacity:0},finish:{height:n,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.height=e.height+"px";i.style.opacity=e.opacity/100},complete:function(){l.Dom.removeClass(s,"menu-item-group-expanding menu-item-active");l.Dom.removeClass(i,"menu-item-group-expanding");i.style.height="auto";i.style.opacity="auto";t()}});babelHelpers.classPrivateFieldLooseBase(this,$)[$].animate()}))}canDelete(){return false}updateCounter(){let e=0;[...this.container.parentNode.querySelector(`[data-group-id="${this.getId()}"]`).querySelectorAll('[data-role="counter"]')].forEach((t=>{e+=l.Text.toNumber(t.dataset.counterValue)}));const t=this.container.querySelector('[data-role="counter"]');if(e>0){t.innerHTML=e>99?"99+":e;this.container.classList.add("menu-item-with-index")}else{t.innerHTML="";this.container.classList.remove("menu-item-with-index")}}markAsActive(){this.container.setAttribute("data-contains-active-item","Y");if(this.container.getAttribute("data-collapse-mode")==="collapsed")l.Dom.addClass(this.container,"menu-item-active")}markAsInactive(){this.container.removeAttribute("data-contains-active-item");l.Dom.removeClass(this.container,"menu-item-active")}isActive(){return this.container.getAttribute("data-contains-active-item")==="Y"}static detect(e){return e.getAttribute("data-role")==="group"&&e.getAttribute("data-type")===this.code}}G.code="group";class K extends G{constructor(){super(...arguments);this.container.querySelector('[data-role="item-edit-control"]').style.display="none"}}K.code="system_group";const V=[F,X,O,R,U,j,G,K,q];function W(e){let t=F;V.forEach((s=>{if(s.detect(e)){t=s}}));return t}var Y=babelHelpers.classPrivateFieldLooseKey("link");var Q=babelHelpers.classPrivateFieldLooseKey("actualLink");class z{constructor(){Object.defineProperty(this,Y,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=new l.Uri(window.location.href)}checkAndSet(e,t){if(e===this.item){return false}let s=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y];t.forEach((e=>{const t=new l.Uri(e.url);let i=false;if(!s||s.uri.getPath().length<t.getPath().length){i=true}else if(s.uri.getPath().length===t.getPath().length){const n=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getQueryParams();const a={params:s.uri.getQueryParams(),matches:0};const o={params:t.getQueryParams(),matches:0};for(const e of Object.keys(n)){if(e in n&&e in a.params&&String(n[e])===String(a.params[e])){a.matches++}if(e in n&&e in o.params&&String(n[e])===String(o.params[e])){o.matches++}}if(o.matches>a.matches||o.matches===a.matches&&Object.keys(o.params).length<Object.keys(a.params).length||s.priority<e.priority){i=true}}if(i){s={priority:e.priority,url:e.url,uri:t}}}));if(s!==babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]){if(this.item){this.unhighlight(this.item)}babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=s;this.item=e;this.highlight();return true}return false}checkAndUnset(e){if(e instanceof F&&e===this.item){this.unhighlight(this.item);this.item=null;babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=null}}highlight(){if(this.item){this.item.container.classList.add("menu-item-active");let e=this.item.container.closest('[data-role="group-content"]');let t;while(e){t=e.parentNode.querySelector(`[data-id="${e.getAttribute("data-group-id")}"]`);if(t){t.setAttribute("data-contains-active-item","Y");if(t.getAttribute("data-collapse-mode")==="collapsed"){t.classList.add("menu-item-active")}}e=e.closest('[data-relo="group-content"]')}}}unhighlight(e){if(!(e instanceof F)){e=this.item}if(e instanceof F){e.container.classList.remove("menu-item-active");let t=e.container.closest('[data-role="group-content"]');let s;while(t){s=t.parentNode.querySelector(`[data-id="${t.getAttribute("data-group-id")}"]`);if(s){s.removeAttribute("data-contains-active-item");s.classList.remove("menu-item-active")}t=t.closest('[data-relo="group-content"]')}return e}return null}}var J=babelHelpers.classPrivateFieldLooseKey("activeItem");var Z=babelHelpers.classPrivateFieldLooseKey("isEditMode");var ee=babelHelpers.classPrivateFieldLooseKey("showHiddenContainer");var te=babelHelpers.classPrivateFieldLooseKey("hideHiddenContainer");var se=babelHelpers.classPrivateFieldLooseKey("animation");var ie=babelHelpers.classPrivateFieldLooseKey("recalculateCounters");var ne=babelHelpers.classPrivateFieldLooseKey("refreshActivity");var ae=babelHelpers.classPrivateFieldLooseKey("updateCountersLastValue");var oe=babelHelpers.classPrivateFieldLooseKey("getItemsByCounterId");var re=babelHelpers.classPrivateFieldLooseKey("getItemsToSave");var le=babelHelpers.classPrivateFieldLooseKey("saveItemsSort");var ce=babelHelpers.classPrivateFieldLooseKey("getParentItemFor");var de=babelHelpers.classPrivateFieldLooseKey("canChangePaternity");var ue=babelHelpers.classPrivateFieldLooseKey("openItemMenuPopup");var me=babelHelpers.classPrivateFieldLooseKey("animateTopItemToLeft");var he=babelHelpers.classPrivateFieldLooseKey("animateTopItemFromLeft");var pe=babelHelpers.classPrivateFieldLooseKey("registerDND");var ge=babelHelpers.classPrivateFieldLooseKey("menuItemDragStart");var fe=babelHelpers.classPrivateFieldLooseKey("menuItemDragMove");var be=babelHelpers.classPrivateFieldLooseKey("menuItemDragHover");var ve=babelHelpers.classPrivateFieldLooseKey("menuItemDragStop");class ye extends h{constructor(e,{events:t}){super(e,{events:t});Object.defineProperty(this,ve,{value:Ne});Object.defineProperty(this,be,{value:_e});Object.defineProperty(this,fe,{value:Fe});Object.defineProperty(this,ge,{value:we});Object.defineProperty(this,pe,{value:ke});Object.defineProperty(this,he,{value:Ae});Object.defineProperty(this,me,{value:De});Object.defineProperty(this,de,{value:xe});Object.defineProperty(this,ce,{value:Te});Object.defineProperty(this,le,{value:Se});Object.defineProperty(this,re,{value:Be});Object.defineProperty(this,oe,{value:Ce});Object.defineProperty(this,ne,{value:Pe});Object.defineProperty(this,ie,{value:Ie});Object.defineProperty(this,se,{value:Me});Object.defineProperty(this,te,{value:Le});Object.defineProperty(this,ee,{value:Ee});this.items=new Map;Object.defineProperty(this,J,{writable:true,value:new z});Object.defineProperty(this,Z,{writable:true,value:false});Object.defineProperty(this,ae,{writable:true,value:null});Object.defineProperty(this,ue,{writable:true,value:void 0});this.parentContainer=e;this.container=e.querySelector(".menu-items");this.hiddenContainer=e.querySelector("#left-menu-hidden-items-block");e.querySelectorAll("li.menu-item-block").forEach(this.registerItem.bind(this));e.querySelector("#left-menu-hidden-separator").addEventListener("click",this.toggleHiddenContainer.bind(this));if(this.getActiveItem()&&this.getActiveItem().container.getAttribute("data-status")==="hide"){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](false)}}registerItem(e){var t;const s=W(e);const i=new s(this.container,e);this.items.set(i.getId(),i);if(!(i instanceof q)){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](i)}if(babelHelpers.classPrivateFieldLooseBase(this,J)[J].checkAndSet(i,i.getSimilarToUrl(y.getCurUri()))===true){let e=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](i);while(e){e.markAsActive();e=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e)}}n.EventEmitter.subscribe(i,u.eventName("onItemDelete"),(({data:e})=>{this.deleteItem(i,e)}));n.EventEmitter.subscribe(i,u.eventName("onItemConvert"),(({data:e})=>{this.convertItem(i,e)}));[...i.container.querySelectorAll("a")].forEach((e=>{e.addEventListener("click",(e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]===true){e.preventDefault();e.stopPropagation();return false}}),true)}));(t=i.container.querySelector('[data-role="item-edit-control"]'))==null?void 0:t.addEventListener("click",(e=>{this.openItemMenu(i,e.target,e.currentTarget)}));return i}unregisterItem(e){if(!this.items.has(e.getId())){return}this.items.delete(e.getId());babelHelpers.classPrivateFieldLooseBase(this,J)[J].checkAndUnset(e,e.getSimilarToUrl(y.getCurUri()));n.EventEmitter.unsubscribeAll(e,u.eventName("onItemDelete"));n.EventEmitter.unsubscribeAll(e,u.eventName("onItemConvert"));e.container.parentNode.replaceChild(e.container.cloneNode(true),e.container)}get isEditMode(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]}switchToEditMode(){if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=true;n.EventEmitter.emit(this,u.eventName("EditMode"))}switchToViewMode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=false;n.EventEmitter.emit(this,u.eventName("ViewMode"))}isHiddenContainerVisible(){return this.hiddenContainer.classList.contains("menu-item-favorites-more-open")}toggleHiddenContainer(e){if(this.hiddenContainer.classList.contains("menu-item-favorites-more-open")){babelHelpers.classPrivateFieldLooseBase(this,te)[te](e)}else{babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e)}}setItemAsAMainPage(e){const t=e.container;t.setAttribute("data-status","show");const s=t.offsetTop;const i=l.Dom.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:s}});const n=t.nextElementSibling;if(n){t.parentNode.insertBefore(i,n)}else{t.parentNode.appendChild(i)}i.appendChild(t);l.Dom.addClass(t,"menu-item-draggable");new BX.easing({duration:500,start:{top:s},finish:{top:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){i.style.top=e.top+"px"},complete:()=>{this.container.insertBefore(t,BX("left-menu-empty-item").nextSibling);l.Dom.removeClass(t,"menu-item-draggable");l.Dom.remove(i);babelHelpers.classPrivateFieldLooseBase(this,le)[le]({action:"mainPageIsSet",itemId:e.getId()})}}).animate()}showItem(e){const t=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e);const s=this.container;e.container.setAttribute("data-status","show");if(babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)){s.appendChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e,t)}else if(t){s.appendChild(t.container);t.container.setAttribute("data-status","show");s.appendChild(t.groupContainer)}if(this.hiddenContainer.querySelector(".menu-item-block")===null){n.EventEmitter.emit(this,u.eventName("onHiddenBlockIsEmpty"));babelHelpers.classPrivateFieldLooseBase(this,te)[te](false)}babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e);babelHelpers.classPrivateFieldLooseBase(this,le)[le]({action:"showItem",itemId:e.getId()})}hideItem(e){const t=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e);const s=this.hiddenContainer.querySelector("#left-menu-hidden-items-list");const i=s.querySelector(".menu-item-block")===null;e.container.setAttribute("data-status","hide");if(babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)){s.appendChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e,t)}else if(t){s.appendChild(t.container);t.container.setAttribute("data-status","hide");s.appendChild(t.groupContainer)}if(i){n.EventEmitter.emit(this,u.eventName("onHiddenBlockIsNotEmpty"))}babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e);babelHelpers.classPrivateFieldLooseBase(this,le)[le]({action:"hideItem",itemId:e.getId()})}updateCounters(e,t){const s={};t=t!==false;[...Object.entries(e)].forEach((([e,i])=>{[...babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](e)].forEach((t=>{const{oldValue:n,newValue:a}=t.updateCounter(i);const o=t.container.getAttribute("data-status");if((e.indexOf("crm_")<0||e.indexOf("crm_all")>=0)&&(e.indexOf("tasks_")<0||e.indexOf("tasks_total")>=0)){s[o]=s[o]||0;s[o]+=a-n}let r=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](t);while(r){r.updateCounter();r=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](r)}}));if(t){BX.localStorage.set("lmc-"+e,i,5)}}));if(s["hide"]!==undefined&&s["hide"]!==0){const e=this.parentContainer.querySelector("#menu-hidden-counter");e.dataset.counterValue=Math.max(0,Number(e.dataset.counterValue)+Number(s["hide"]));if(e.dataset.counterValue>0){e.classList.remove("menu-hidden-counter");e.innerHTML=e.dataset.counterValue>99?"99+":e.dataset.counterValue}else{e.classList.add("menu-hidden-counter");e.innerHTML=""}}if(typeof BXIM!=="undefined"){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]===null){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=0;[...this.items.entries()].forEach((([e,t])=>{if(t instanceof G){return}const s=t.getCounterValue();if(s>0){let i="doesNotMatter";if(e.indexOf("menu_crm")>=0||e.indexOf("menu_tasks")>=0){const e=t.container.querySelector('[data-role="counter"]');if(e){i=e.id}}if(i==="doesNotMatter"||i.indexOf("crm_all")>=0||i.indexOf("tasks_total")>=0){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]+=s}}}))}else{babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]+=s["show"]!==undefined?s["show"]:0;babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]+=s["hide"]!==undefined?s["hide"]:0}const e=babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]>99?"99+":babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]<0?"0":babelHelpers.classPrivateFieldLooseBase(this,ae)[ae];const t=l.Reflection.getClass("BX.Messenger.v2.Lib.DesktopApi");if(t&&t.isDesktop()){t.setBrowserIconBadge(e)}}[...this.items.entries()].forEach((([e,t])=>{if(t instanceof G){t.updateCounter()}}))}decrementCounter(e){[...Object.entries(e)].forEach((([t,s])=>{const i=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](t).shift();if(i){const n=i.getCounterValue();e[t]=n>s?n-s:0}else{delete e[t]}}));this.updateCounters(e,false)}addItem({node:e,animateFromPoint:t}){if(!(e instanceof Element)){return}const s=e.style.display;if(t){e.dataset.styleDisplay=e.style.display;e.style.display="none"}if(this.items.has(e.dataset.id)&&e.dataset.type===O.code){const t=this.items.get(e.dataset.id);t.storage.push(O.code);t.container.dataset.storage=t.storage.join(",");e=t.container}else{this.container.appendChild(e);this.registerItem(e);babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}if(t){babelHelpers.classPrivateFieldLooseBase(this,me)[me](e,t).then((()=>{e.style.display=e.dataset.styleDisplay}))}}updateItem(e){let{id:t}=e;if(this.items.has(t)){this.items.get(t).update(e)}}deleteItem(e,{animate:t}){this.items.delete(e.getId());babelHelpers.classPrivateFieldLooseBase(this,J)[J].checkAndUnset(e);if(e instanceof O||t){babelHelpers.classPrivateFieldLooseBase(this,he)[he](e.container).then((()=>{e.container.parentNode.removeChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}))}else if(e.container){e.container.parentNode.removeChild(e.container);babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}}convertItem(e){this.unregisterItem(e);this.registerItem(this.parentContainer.querySelector(`li.menu-item-block[data-id="${e.getId()}"]`))}getActiveItem(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].item}export(){return babelHelpers.classPrivateFieldLooseBase(this,re)[re]()}openItemMenu(e,t,s){if(s){l.Dom.addClass(s,"--open")}else{l.Dom.addClass(t,"--open")}if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].close()}const a=[];if(e instanceof q){a.push({text:l.Loc.getMessage("MENU_OPEN_SETTINGS_MAIN_PAGE"),onclick:()=>{e.openSettings()}})}else if(e.container.getAttribute("data-status")==="show"){a.push({text:l.Loc.getMessage("hide_item"),onclick:()=>{this.hideItem(e)}})}else{a.push({text:l.Loc.getMessage("show_item"),onclick:(t,s)=>{this.showItem(e)}})}if(!u.isExtranet&&!u.isMainPageEnabled&&!(e instanceof U)&&!(e instanceof G)&&this.container.querySelector('li.menu-item-block[data-role="item"]')!==e.container){a.push({text:l.Loc.getMessage("MENU_SET_MAIN_PAGE"),onclick:()=>{this.setItemAsAMainPage(e)}})}e.getDropDownActions().forEach((e=>{a.push(e)}));if(!(e instanceof q)){a.push({text:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]?l.Loc.getMessage("MENU_EDIT_READY_FULL"):l.Loc.getMessage("MENU_SETTINGS_MODE"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]?this.switchToViewMode():this.switchToEditMode()}})}a.forEach((e=>{var t;e["className"]=["menu-popup-no-icon",(t=e["className"])!=null?t:""].join(" ");const{onclick:s}=e;e["onclick"]=(e,t)=>{t.getMenuWindow().close();s.call(e,t)}}));const o=l.Dom.getPosition(t);babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=new i.Menu({bindElement:{top:o.top-o.height,left:o.right},items:a,offsetTop:0,offsetLeft:l.Dom.getPosition(t).width/2,events:{onClose:()=>{n.EventEmitter.emit(this,u.eventName("onClose"));e.container.classList.remove("menu-item-block-hover");babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=null;if(s){l.Dom.removeClass(s,"--open")}else{l.Dom.removeClass(t,"--open")}},onShow:()=>{e.container.classList.add("menu-item-block-hover");n.EventEmitter.emit(this,u.eventName("onShow"))}}});babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].show()}}function Ee(e){n.EventEmitter.emit(this,u.eventName("onHiddenBlockIsVisible"));if(e===false){return this.hiddenContainer.classList.add("menu-item-favorites-more-open")}this.hiddenContainer.style.height="0px";this.hiddenContainer.style.opacity=0;babelHelpers.classPrivateFieldLooseBase(this,se)[se](true,this.hiddenContainer,this.hiddenContainer.scrollHeight)}function Le(e){n.EventEmitter.emit(this,u.eventName("onHiddenBlockIsHidden"));if(e===false){return this.hiddenContainer.classList.remove("menu-item-favorites-more-open")}babelHelpers.classPrivateFieldLooseBase(this,se)[se](false,this.hiddenContainer,this.hiddenContainer.offsetHeight)}function Me(e,t,s){t.style.overflow="hidden";new BX.easing({duration:200,start:{opacity:e?0:100,height:e?0:s},finish:{opacity:e?100:0,height:e?s:0},transition:BX.easing.transitions.linear,step:function(e){t.style.opacity=e.opacity/100;t.style.height=e.height+"px"},complete:function(){if(e){t.classList.add("menu-item-favorites-more-open")}else{t.classList.remove("menu-item-favorites-more-open")}t.style.opacity="";t.style.overflow="";t.style.height=""}}).animate()}function Ie(e){let t=0;if(e.container.querySelector('[data-role="counter"]')){t=e.container.querySelector('[data-role="counter"]').dataset.counterValue}if(t<=0){return}[...this.items.entries()].forEach((([e,t])=>{if(t instanceof G){t.updateCounter()}}));let s=0;[...this.parentContainer.querySelectorAll(`.menu-item-block[data-status="hide"][data-role='item']`)].forEach((e=>{const t=e.querySelector('[data-role="counter"]');if(t){s+=parseInt(t.dataset.counterValue)}}));const i=this.parentContainer.querySelector("#menu-hidden-counter");i.dataset.counterValue=Math.max(0,s);if(i.dataset.counterValue>0){i.classList.remove("menu-hidden-counter");i.innerHTML=i.dataset.counterValue>99?"99+":i.dataset.counterValue}else{i.classList.add("menu-hidden-counter");i.innerHTML=""}}function Pe(e,t){if(this.getActiveItem()!==e){return}const s=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e);if(t!==s){if(t instanceof G){t.markAsInactive()}if(s instanceof G){s.markAsActive()}}}function Ce(e){const t=[];[...this.items.values()].forEach((s=>{const i=s.container.querySelector('[data-role="counter"]');if(i&&i.id.indexOf(e)>=0){t.push(s)}}));return t}function Be(){const e={show:[],hide:[]};const t=[];let s=null;["show","hide"].forEach((i=>{let n=e[i];let a=null;const o=[];Array.from(this.parentContainer.querySelectorAll(`.menu-item-block[data-status="${i}"]`)).forEach((r=>{if(r.dataset.role==="group"){const t=r.parentNode.hasAttribute("data-group-id")?r.parentNode.getAttribute("data-group-id"):null;n=e[i];let s;while(s=o.pop()){if(s["group_id"]===t){o.push(s);n=s.items;break}}const l={group_id:r.dataset.id,items:[]};n.push(l);o.push(l);n=l.items;a=r.dataset.id}else{if([R.code,U.code,O.code].indexOf(r.getAttribute("data-type"))>=0){const e={ID:r.getAttribute("data-id"),LINK:r.getAttribute("data-link"),TEXT:l.Text.decode(r.querySelector("[data-role='item-text']").innerHTML)};if(r.getAttribute("data-new-page")==="Y"){e.NEW_PAGE="Y"}t.push(e)}if(s===null&&l.Type.isStringFilled(r.getAttribute("data-link"))){s=r.getAttribute("data-link")}if(r.closest(`[data-group-id="${a}"][data-role="group-content"]`)){n.push(r.dataset.id)}else{const t=r.parentNode.hasAttribute("data-group-id")?r.parentNode.getAttribute("data-group-id"):null;n=e[i];let s;while(s=o.pop()){if(s["group_id"]===t){o.push(s);n=s.items;break}}n.push(r.dataset.id)}}}))}));return{saveSortItems:e,firstItemLink:s,customItems:t}}function Se(e){const{saveSortItems:t,firstItemLink:s}=babelHelpers.classPrivateFieldLooseBase(this,re)[re]();T.saveItemsSort(t,s,e||{action:"sortItem"})}function Te(e){if(!(e instanceof F)){return null}const t=e.container.closest('[data-role="group-content"]');if(t&&this.items.has(t.getAttribute("data-group-id"))){return this.items.get(t.getAttribute("data-group-id"))}return null}function xe(e){if(e instanceof G){return false}const t=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e);if(t instanceof G&&e.container.parentNode.querySelectorAll("li.menu-item-block").length<=1){return false}return true}function De(e,t){return new Promise((s=>{let{startX:i,startY:n}=t;const a=document.createElement("DIV");a.style=`position: absolute; z-index: 1000; top: ${n+25}px;`;const o=e.cloneNode(true);o.style.display=e.dataset.styleDisplay;document.body.appendChild(a);a.appendChild(o);let r=this.hiddenContainer.getBoundingClientRect().top;new BX.easing({duration:500,start:{left:i},finish:{left:30},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){a.style.left=e.left+"px"},complete:()=>{new BX.easing({duration:500,start:{top:n+25},finish:{top:r},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){a.style.top=e.top+"px"},complete:()=>{l.Dom.remove(a);s()}}).animate()}}).animate()}))}function Ae(e){return new Promise((t=>{new BX.easing({duration:700,start:{left:e.offsetLeft,opacity:1},finish:{left:400,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){e.style.paddingLeft=t.left+"px";e.style.opacity=t.opacity},complete:function(){t()}}).animate()}))}function ke(e){jsDD.Enable();e.container.onbxdragstart=babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this,e);e.container.onbxdrag=(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e,t)};e.container.onbxdraghover=(e,t,s)=>{babelHelpers.classPrivateFieldLooseBase(this,be)[be](e,t,s)};e.container.onbxdragstop=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this,e);jsDD.registerObject(e.container)}function we(e){n.EventEmitter.emit(n.EventEmitter.GLOBAL_TARGET,"BX.Bitrix24.LeftMenuClass:onDragStart");if(!(e instanceof G)&&e.container.parentNode.querySelectorAll("li.menu-item-block").length<=1&&babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e)!==null){e=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e)}n.EventEmitter.emit(this,u.eventName("onDragModeOn"));this.dnd={container:this.container.parentNode,itemDomBlank:l.Dom.create("div",{style:{display:"none"}}),itemMoveBlank:l.Dom.create("div",{style:{height:e.container.offsetHeight+"px"}}),draggableBlock:l.Dom.create("div",{attrs:{className:"menu-draggable-wrap"},style:{top:[e.container.offsetTop-e.container.offsetHeight,"px"].join("")}}),item:e,oldParent:babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e),isHiddenContainerVisible:this.isHiddenContainerVisible()};babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](false);const t=()=>{[...this.parentContainer.querySelectorAll("li.menu-item-block")].forEach((t=>{if(e instanceof G&&babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](this.items.get(t.getAttribute("data-id")))!==null){return}jsDD.registerDest(t,100)}));const t=this.parentContainer.querySelector("#left-menu-empty-item");if(e instanceof U){jsDD.unregisterDest(t)}else{jsDD.registerDest(t,100)}jsDD.registerDest(this.parentContainer.querySelector("#left-menu-hidden-empty-item"),100);jsDD.registerDest(this.parentContainer.querySelector("#left-menu-hidden-separator"),100)};if(e instanceof G){e.collapse(true).then((()=>{if(this.dnd){this.dnd.pos=BX.pos(this.container.parentNode);t()}}))}else{t()}const s=e.container;l.Dom.addClass(this.dnd.container,"menu-drag-mode");l.Dom.addClass(s,"menu-item-draggable");s.parentNode.insertBefore(this.dnd.itemDomBlank,s);s.parentNode.insertBefore(this.dnd.itemMoveBlank,s);this.dnd.draggableBlock.appendChild(e.container);this.dnd.container.style.position="relative";this.dnd.container.appendChild(this.dnd.draggableBlock);this.dnd.pos=BX.pos(this.container.parentNode)}function Fe(e,t){const s=this.dnd.item;var i=this.dnd.pos.height;t=Math.max(0,t-this.dnd.pos.top);this.dnd.draggableBlock.style.top=[Math.min(i-s.container.offsetHeight,t)-5,"px"].join("")}function _e(e,t,s){const i=this.dnd.item;const n=i.container;if(e===n){this.dnd.itemDomBlank.parentNode.insertBefore(this.dnd.itemMoveBlank,this.dnd.itemDomBlank);return}if(e.id==="left-menu-empty-item"&&(n.getAttribute("data-type")==="self"||n.getAttribute("data-disable-first-item")==="Y")){return}if(e.getAttribute("data-role")==="group"){const t=e.parentNode.querySelector(`[data-group-id="${e.getAttribute("data-id")}"]`);if(e.getAttribute("data-collapse-mode")==="collapsed"){l.Dom.insertAfter(this.dnd.itemMoveBlank,t)}else if(i instanceof G){l.Dom.insertBefore(this.dnd.itemMoveBlank,e)}else{l.Dom.prepend(this.dnd.itemMoveBlank,t.querySelector("ul"))}}else if(this.dnd.container.contains(e)){let t=e;if(i instanceof G&&e.closest('[data-role="group-content"]')){t=e.closest('[data-role="group-content"]')}l.Dom.insertAfter(this.dnd.itemMoveBlank,t)}}function Ne(){const e=this.dnd.item;const t=this.dnd.oldParent;const s=e.container;l.Dom.removeClass(this.dnd.container,"menu-drag-mode");l.Dom.removeClass(s,"menu-item-draggable");this.dnd.container.style.position="";let i=null;let a=false;if(this.parentContainer.querySelector(".menu-item-block")===e.container){if(e instanceof U){i=l.Loc.getMessage("MENU_SELF_ITEM_FIRST_ERROR")}else if(e.container.getAttribute("data-disable-first-item")==="Y"){i=l.Loc.getMessage("MENU_FIRST_ITEM_ERROR")}}if(i!==null){this.dnd.itemDomBlank.parentNode.replaceChild(s,this.dnd.itemDomBlank);e.showMessage(i)}else if(!this.dnd.container.contains(this.dnd.itemMoveBlank)){this.dnd.itemDomBlank.parentNode.replaceChild(s,this.dnd.itemDomBlank)}else{try{this.dnd.itemMoveBlank.parentNode.replaceChild(s,this.dnd.itemMoveBlank);if(this.hiddenContainer.contains(s)){e.container.setAttribute("data-status","hide");if(this.dnd.itemDomBlank.closest("#left-menu-hidden-items-block")===null&&this.hiddenContainer.querySelectorAll(".menu-item-block").length===1){n.EventEmitter.emit(this,u.eventName("onHiddenBlockIsNotEmpty"))}}else{e.container.setAttribute("data-status","show");if(this.hiddenContainer.querySelectorAll(".menu-item-block").length<=0){a=true;n.EventEmitter.emit(this,u.eventName("onHiddenBlockIsEmpty"))}}if(e instanceof G){e.checkAndCorrect().expand(true)}babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](e,t);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e);const i={action:"sortItem"};if(this.parentContainer.querySelector(".menu-item-block")===e.container&&!this.isExtranet){e.showMessage(l.Loc.getMessage("MENU_ITEM_MAIN_PAGE"));i.action="mainPage";i.itemId=e.getId()}babelHelpers.classPrivateFieldLooseBase(this,le)[le](i)}catch(e){this.dnd.itemDomBlank.parentNode.replaceChild(s,this.dnd.itemDomBlank)}}l.Dom.remove(this.dnd.draggableBlock);l.Dom.remove(this.dnd.itemDomBlank);l.Dom.remove(this.dnd.itemMoveBlank);jsDD.enableDest(s);this.container.style.position="static";if(!this.dnd.isHiddenContainerVisible||a===true){babelHelpers.classPrivateFieldLooseBase(this,te)[te](false)}delete this.dnd;[...this.parentContainer.querySelectorAll("li.menu-item-block")].forEach((e=>{jsDD.registerDest(e)}));const o=this.parentContainer.querySelector("#left-menu-empty-item");jsDD.unregisterDest(o);jsDD.unregisterDest(this.parentContainer.querySelector("#left-menu-hidden-empty-item"));jsDD.unregisterDest(this.parentContainer.querySelector("#left-menu-hidden-separator"));jsDD.refreshDestArea();n.EventEmitter.emit(this,u.eventName("onDragModeOff"))}class He extends h{constructor(e,t){super(e,t)}saveCurrentPage(e){return O.saveCurrentPage(e).then((e=>{n.EventEmitter.emit(this,u.eventName("onItemHasBeenAdded"),e);return e})).catch(y.catchError)}saveStandardPage(e){return O.saveStandardPage(e).then((e=>{n.EventEmitter.emit(this,u.eventName("onItemHasBeenAdded"),e);return e})).catch(y.catchError)}deleteCurrentPage({pageLink:e}){return O.deleteCurrentPage({pageLink:e}).then((e=>{n.EventEmitter.emit(this,u.eventName("onItemHasBeenDeleted"),e);return e})).catch(y.catchError)}deleteStandardPage(e){return O.deleteStandardPage(e).then((e=>{n.EventEmitter.emit(this,u.eventName("onItemHasBeenDeleted"),e);return e})).catch(y.catchError)}showAddToSelf(e){U.showAdd(e).then((e=>{n.EventEmitter.emit(this,u.eventName("onItemHasBeenAdded"),e)})).catch(y.catchError)}}var Oe=babelHelpers.classPrivateFieldLooseKey("isAdmin");class Ue{constructor(e){Object.defineProperty(this,Oe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=e?qe.ADMIN:qe.NOT_ADMIN}sendSetCustomPreset(){r.sendData({tool:Ge,category:Xe.MENU,event:Re.SET,type:"custom",c_section:je.MENU,p1:babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]})}sendSetPreset(e,t,s){r.sendData({type:e,event:t?Re.CHANGE:Re.SELECT,tool:Ge,category:t?Xe.MENU:Xe.TOOL,c_section:t?je.MENU:je.POPUP,c_element:s,p1:babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]})}sendClose(){r.sendData({event:Re.SHOW,tool:Ge,category:Xe.TOOL,c_section:je.POPUP})}}const Xe={TOOL:"main_tool",MENU:"main_menu"};const Re={SHOW:"window_show",SELECT:"select",CHANGE:"change",SET:"menu_set"};const qe={ADMIN:"isAdmin_Y",NOT_ADMIN:"isAdmin_N"};const je={POPUP:"menu_popup",PRESET:"preset",QUALIFICATION:"qualification",SETTINGS:"settings",MENU:"main_menu"};const $e={CONFIRM:"confirm",LATER:"later",CLOSE:"close",SAVE:"save",SKIP:"skip"};const Ge="intranet";let Ke=e=>e,Ve,We,Ye,Qe,ze,Je,Ze,et;var tt=babelHelpers.classPrivateFieldLooseKey("refs");var st=babelHelpers.classPrivateFieldLooseKey("status");var it=babelHelpers.classPrivateFieldLooseKey("xhr");var nt=babelHelpers.classPrivateFieldLooseKey("isExtranetInstalled");var at=babelHelpers.classPrivateFieldLooseKey("handleGroupsLinkClick");var ot=babelHelpers.classPrivateFieldLooseKey("loadContent");var rt=babelHelpers.classPrivateFieldLooseKey("handleFilterClick");var lt=babelHelpers.classPrivateFieldLooseKey("handleItemsClick");var ct=babelHelpers.classPrivateFieldLooseKey("animateStart");var dt=babelHelpers.classPrivateFieldLooseKey("animateCounter");class ut{constructor(e){Object.defineProperty(this,dt,{value:bt});Object.defineProperty(this,ct,{value:ft});Object.defineProperty(this,lt,{value:gt});Object.defineProperty(this,rt,{value:pt});Object.defineProperty(this,ot,{value:ht});Object.defineProperty(this,at,{value:mt});Object.defineProperty(this,tt,{writable:true,value:new c.MemoryCache});Object.defineProperty(this,st,{writable:true,value:"initial"});Object.defineProperty(this,it,{writable:true,value:null});Object.defineProperty(this,nt,{writable:true,value:true});const t=document.getElementById("menu-all-groups-link");l.Event.bind(t,"click",babelHelpers.classPrivateFieldLooseBase(this,at)[at].bind(this));babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=l.Type.isBoolean(e.isExtranetInstalled)?e.isExtranetInstalled:babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].remember("container",(()=>l.Tag.render(Ve||(Ve=Ke`
				<div class="group-panel-content">
					<div class="group-panel-header">
						${0}
					</div>
					${0}
				</div>
			`),this.getFilterContainer(),this.getItemsContainer())))}getItemsContainer(){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].remember("items-container",(()=>l.Tag.render(We||(We=Ke`
				<div class="group-panel-items" onclick="${0}"></div>
			`),babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].bind(this))))}getFilterContainer(){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].remember("filter-container",(()=>l.Tag.render(Ye||(Ye=Ke`
				<span class="group-panel-header-filters">${0}
				</span>
			`),[l.Tag.render(Qe||(Qe=Ke`
						<span
							class="group-panel-header-filter group-panel-header-filter-all"
							data-filter="all"
							onclick="${0}"
						>${0}</span>
					`),babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].bind(this),l.Loc.getMessage("MENU_MY_WORKGROUPS")),babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]?l.Tag.render(ze||(ze=Ke`
								<span
									class="group-panel-header-filter group-panel-header-filter-extranet"
									data-filter="extranet"
									onclick="${0}"
								>${0}</span>
							`),babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].bind(this),l.Loc.getMessage("MENU_MY_WORKGROUPS_EXTRANET")):null,l.Tag.render(Je||(Je=Ke`
						<span
							class="group-panel-header-filter group-panel-header-filter-favorites"
							data-filter="favorites"
							onclick="${0}"
						>${0}${0}</span>
					`),babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].bind(this),l.Loc.getMessage("MENU_MY_WORKGROUPS_FAVORITES"),this.getCounterContainer())])))}getCounterContainer(){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].remember("counter-container",(()=>l.Tag.render(Ze||(Ze=Ke`<span class="group-panel-header-filter-counter"></span>`))))}saveFilter(e){void l.ajax.runAction("intranet.leftmenu.setGroupFilter",{data:{filter:e}})}}function mt(e){d.SidePanel.Instance.open("my-groups",{cacheable:false,contentCallback:()=>l.Runtime.loadExtension("ui.sidepanel.layout").then((e=>{const{Layout:t}=e;return t.createContent({title:l.Loc.getMessage("MENU_MY_WORKGROUPS"),design:{section:true,margin:true},buttons:()=>[],content:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]==="loaded"){return this.getContainer()}return babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]()}})})),events:{onClose:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,it)[it]&&babelHelpers.classPrivateFieldLooseBase(this,st)[st]!=="loaded"){babelHelpers.classPrivateFieldLooseBase(this,st)[st]="initial";babelHelpers.classPrivateFieldLooseBase(this,it)[it].abort()}}}})}async function ht(){babelHelpers.classPrivateFieldLooseBase(this,st)[st]="loading";const e=await l.ajax.runAction("intranet.leftmenu.getGroups",{onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,it)[it]=e}});const{groups:t,filter:s}=e.data;for(const e of t){const t=["group-panel-item"];t.push(e.extranet?"group-panel-item-extranet":"group-panel-item-intranet");if(e.favorite){t.push("group-panel-item-favorite")}const s=l.Tag.render(et||(et=Ke`
				<a href="${0}" 
					class="${0}" 
					data-id="${0}" 
					data-slider-ignore-autobinding="true"
				>
					<span class="group-panel-item-text" title="${0}">${0}</span>
					<span class="group-panel-item-star"></span>
				</a>
			`),encodeURI(e.url),t.join(" "),e.id,l.Text.encode(e.title),l.Text.encode(e.title));l.Dom.append(s,this.getItemsContainer())}l.Dom.addClass(this.getContainer(),`group-panel-content-${s}`);l.Dom.attr(this.getContainer(),{"data-filter":s});babelHelpers.classPrivateFieldLooseBase(this,st)[st]="loaded";return this.getContainer()}function pt(e){const t=e.target;const s=this.getContainer().dataset.filter||"all";const i=t.dataset.filter||"all";if(s!==i){this.getContainer().dataset.filter=i;this.saveFilter(i);new BX.easing({duration:50,start:{opacity:1},finish:{opacity:0},transition:BX.easing.transitions.linear,step:e=>{l.Dom.style(this.getItemsContainer(),"opacity",e.opacity/100)},complete:()=>{l.Dom.removeClass(this.getContainer(),`group-panel-content-${s}`);l.Dom.addClass(this.getContainer(),`group-panel-content-${i}`);new BX.easing({duration:50,start:{opacity:0},finish:{opacity:1},transition:BX.easing.transitions.linear,step:e=>{l.Dom.style(this.getItemsContainer(),"opacity",e.opacity/100)},complete:()=>{l.Dom.style(this.getItemsContainer(),"opacity",null)}}).animate()}}).animate()}e.stopPropagation()}function gt(e){if(!l.Dom.hasClass(e.target,"group-panel-item-star")){return}const t=e.target;const s=t.parentNode;const i=s.dataset.id;const n=l.Dom.hasClass(s,"group-panel-item-favorite")?"removeFromFavorites":"addToFavorites";l.Dom.toggleClass(s,"group-panel-item-favorite");babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](t);babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](n==="addToFavorites");void l.ajax.runAction(`intranet.leftmenu.${n}`,{data:{groupId:i}});e.preventDefault()}function ft(e){const t=e.cloneNode();l.Dom.style(t,"margin-left",`-${e.offsetWidth}px`);l.Dom.append(t,e.parentNode);new BX.easing({duration:200,start:{opacity:100,scale:100},finish:{opacity:0,scale:300},step:e=>{l.Dom.style(t,"transform",`scale(${e.scale/100})`);l.Dom.style(t,"opacity",e.opacity/100)},complete:()=>{t.parentNode.removeChild(t)}}).animate()}function bt(e){this.getCounterContainer().innerHTML=e===false?"-1":"+1";new BX.easing({duration:400,start:{opacity:100,top:0},finish:{opacity:0,top:-20},transition:BX.easing.transitions.linear,step:e=>{l.Dom.style(this.getCounterContainer(),"top",`${e.top}px`);l.Dom.style(this.getCounterContainer(),"opacity",e.opacity/100)},complete:()=>{l.Dom.style(this.getCounterContainer(),"top",null);l.Dom.style(this.getCounterContainer(),"opacity",null)}}).animate()}var vt=babelHelpers.classPrivateFieldLooseKey("getLeftMenuItemByTopMenuItem");var yt=babelHelpers.classPrivateFieldLooseKey("specialLiveFeedDecrement");class Et{constructor(e){Object.defineProperty(this,vt,{value:Lt});this.cache=new l.Cache.MemoryCache;this.scrollModeThreshold=20;this.lastScrollOffset=0;this.slidingModeTimeoutId=0;this.isMenuMouseEnterBlocked=false;this.isMenuMouseLeaveBlocked=[];this.isCollapsedMode=false;Object.defineProperty(this,yt,{writable:true,value:0});this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return}e=typeof e==="object"?e:{};u.isExtranet=e.isExtranet==="Y";u.isMainPageEnabled=e.isMainPageEnabled==="Y";u.isAdmin=e.isAdmin;u.isCustomPresetRestricted=e.isCustomPresetAvailable!=="Y";u.availablePresetTools=e.availablePresetTools;u.settingsPath=e.settingsPath;u.inviteDialogLink=e.inviteDialogLink;u.showMarta=e.showMarta;u.showSitemapMenuItem=e.showSitemapMenuItem;this.isCollapsedMode=e.isCollapsedMode;this.analytics=new Ue(e.isAdmin);this.initAndBindNodes();this.bindEvents();this.getItemsController();this.groupPanel=new ut({isExtranetInstalled:e.isExtranetInstalled!=="N"})}initAndBindNodes(){var e;this.menuContainer.addEventListener("dblclick",this.handleMenuDoubleClick.bind(this));this.menuContainer.addEventListener("mouseenter",this.handleMenuMouseEnter.bind(this));this.menuContainer.addEventListener("mouseleave",this.handleMenuMouseLeave.bind(this));this.menuContainer.addEventListener("transitionend",this.handleSlidingTransitionEnd.bind(this));this.menuHeader=this.menuContainer.querySelector(".menu-items-header");this.menuBody=this.menuContainer.querySelector(".menu-items-body");this.menuItemsBlock=this.menuContainer.querySelector(".menu-items");this.mainTable=document.querySelector(".js-app");this.menuHeaderBurger=this.menuHeader.querySelector(".menu-switcher");this.menuHeaderBurger.addEventListener("click",this.handleBurgerClick.bind(this));this.menuHeader.querySelector(".menu-items-header-title").addEventListener("click",this.handleBurgerClick.bind(this,true));this.menuMoreButton=this.menuContainer.querySelector(".menu-item-block.menu-expand");this.menuMoreButton=this.menuContainer.querySelector('[data-role="expand-menu-item"]');this.menuMoreButton.addEventListener("click",this.handleShowHiddenClick.bind(this));const t=this.menuContainer.querySelector(".menu-sitemap-btn");if(t){t.addEventListener("click",this.handleSiteMapClick.bind(this))}const s=this.menuContainer.querySelector(".menu-settings-save-btn");if(s){s.addEventListener("click",this.handleViewMode.bind(this))}(e=this.menuContainer.querySelector('[data-role="menu-settings-item"]'))==null?void 0:e.addEventListener("click",(()=>{this.getSettingsController().show()}))}getItemsController(){return this.cache.remember("itemsController",(()=>new ye(this.menuContainer,{events:{EditMode:()=>{this.toggle(true);this.menuContainer.classList.add("menu-items-edit-mode");this.menuContainer.classList.remove("menu-items-view-mode")},ViewMode:()=>{this.toggle(true);this.menuContainer.classList.add("menu-items-view-mode");this.menuContainer.classList.remove("menu-items-edit-mode")},onDragModeOn:({target:e})=>{this.switchToSlidingMode(true);this.isMenuMouseLeaveBlocked.push("drag")},onDragModeOff:({target:e})=>{this.isMenuMouseLeaveBlocked.pop()},onHiddenBlockIsVisible:this.onHiddenBlockIsVisible.bind(this),onHiddenBlockIsHidden:this.onHiddenBlockIsHidden.bind(this),onHiddenBlockIsEmpty:this.onHiddenBlockIsEmpty.bind(this),onHiddenBlockIsNotEmpty:this.onHiddenBlockIsNotEmpty.bind(this),onShow:()=>{this.isMenuMouseLeaveBlocked.push("items")},onClose:()=>{this.isMenuMouseLeaveBlocked.pop()}}})))}getItemDirector(){return this.cache.remember("itemsCreator",(()=>new He(this.menuContainer,{events:{onItemHasBeenAdded:({data:e})=>{this.getItemsController().addItem(e)}}})))}getSettingsController(){return this.cache.remember("presetController",(()=>{const e=this.menuContainer.querySelector('[data-role="menu-settings-item"]');if(!e){return null}return new C(e,{events:{onGettingSettingMenuItems:this.onGettingSettingMenuItems.bind(this),onShow:()=>{this.isMenuMouseLeaveBlocked.push("settings")},onClose:()=>{this.isMenuMouseLeaveBlocked.pop()}}})}))}getCustomPresetController(){return this.cache.remember("customPresetController",(()=>new f(this.menuContainer,{events:{onPresetIsSet:({data:e})=>{const{saveSortItems:t,firstItemLink:s,customItems:i}=this.getItemsController().export();if(!e){this.analytics.sendSetCustomPreset()}return T.setCustomPreset(e,t,i,s)},onShow:()=>{this.isMenuMouseLeaveBlocked.push("presets")},onClose:()=>{this.isMenuMouseLeaveBlocked.pop()}}})))}getDefaultPresetController(){let e=false;const t=e=>{const t=T.postponeSystemPreset(e);n.EventEmitter.emit(this,u.eventName("onPresetIsPostponed"));return t};return this.cache.remember("defaultPresetController",(()=>{const s=new M(this.menuContainer,{events:{onPresetIsSet:({data:{mode:t,presetId:s}})=>{this.analytics.sendSetPreset(s,t==="personal",$e.CONFIRM);e=true;return T.setSystemPreset(t,s)},onPresetIsPostponed:({data:{mode:i}})=>{this.analytics.sendSetPreset(s.getSelectedPreset(),i==="personal",$e.LATER);e=true;return t(i)},onShow:()=>{this.analytics.sendClose()},onClose:()=>{if(e!==true){this.analytics.sendSetPreset(s.getSelectedPreset(),s.getMode()==="personal",$e.CLOSE);t(s.getMode())}e=false}}});return s}))}bindEvents(){n.EventEmitter.subscribe("onImUpdateCounter",(e=>{const[t]=e.getCompatData();this.updateCounters(t,false)}));n.EventEmitter.subscribe("onImUpdateCounterMessage",(e=>{const[t]=e.getCompatData();this.updateCounters({"im-message":t},false)}));n.EventEmitter.subscribe("onCounterDecrement",(e=>{const[t]=e.getCompatData();this.decrementCounter(document.getElementById("menu-counter-live-feed"),t)}));n.EventEmitter.subscribe("onPullEvent-main",(e=>{const[t,s]=e.getCompatData();if(t==="user_counter"&&s[l.Loc.getMessage("SITE_ID")]){const e={...s[l.Loc.getMessage("SITE_ID")]};this.updateCounters(e,false)}}));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onOpen",this.handleGroupPanelOpen.bind(this));BX.addCustomEvent("BX.Bitrix24.GroupPanel:onClose",this.handleGroupPanelClose.bind(this));BX.addCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",((e,t)=>{if(!e||!l.Type.isDomNode(t)){return}const s=t.getAttribute("data-top-menu-id");const i=this.menuBody.querySelector(`[data-top-menu-id="${s}"]`);if(i){i.setAttribute("data-link",e);const t=i.querySelector("a.menu-item-link");if(t){t.setAttribute("href",e)}if(i.previousElementSibling===this.menuContainer.querySelector("#left-menu-empty-item")){T.setFirstPage(e)}else{T.clearCache()}}this.showMessage(t,l.Loc.getMessage("MENU_ITEM_MAIN_SECTION_PAGE"))}));BX.addCustomEvent("BX.Main.InterfaceButtons:onHideLastVisibleItem",(e=>{this.showMessage(e,l.Loc.getMessage("MENU_TOP_ITEM_LAST_HIDDEN"))}));BX.addCustomEvent("BX.Main.InterfaceButtons:onBeforeCreateEditMenu",((e,t,s)=>{let i=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt](t);if(!i&&t&&l.Type.isStringFilled(t.URL)&&!t.URL.match(/javascript:/)){e.addMenuItem({text:l.Loc.getMessage("MENU_ADD_TO_LEFT_MENU"),onclick:(e,s)=>{this.getItemDirector().saveStandardPage(t);s.getMenuWindow().close()}})}else if(i instanceof O){e.addMenuItem({text:l.Loc.getMessage("MENU_DELETE_FROM_LEFT_MENU"),onclick:(e,s)=>{this.getItemDirector().deleteStandardPage(t);s.getMenuWindow().close()}})}}));top.BX.addCustomEvent("UI.Toolbar:onRequestMenuItemData",(({currentFullPath:e,context:t})=>{if(l.Type.isStringFilled(e)){BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onSendMenuItemData",[{currentPageInMenu:this.menuContainer.querySelector(`.menu-item-block[data-link="${e}"]`),context:t}])}}));n.EventEmitter.subscribe("UI.Toolbar:onStarClick",(({compatData:[e]})=>{if(e.isActive){this.getItemDirector().deleteCurrentPage({context:e.context,pageLink:e.pageLink}).then((({itemInfo:t})=>{BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemDeleted",[t,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:false,context:e.context}])}))}else{this.getItemDirector().saveCurrentPage({pageTitle:e.pageTitle,pageLink:e.pageLink}).then((({itemInfo:t})=>{BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuItemAdded",[t,this]);BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onStandardItemChangedSuccess",[{isActive:true,context:e.context}])}))}}));n.EventEmitter.subscribe("BX.Main.InterfaceButtons:onBeforeResetMenu",(({compatData:[e]})=>{e.push((()=>{const e=new BX.Promise;T.clearCache().then((()=>{e.fulfill()}),(t=>{e.reject(`Error: ${t.errors[0].message}`)}));return e}))}))}isEditMode(){return this.getItemsController().isEditMode}isCollapsed(){return this.isCollapsedMode}showMessage(e,t,s){var n=i.PopupManager.create("left-menu-message",e,{content:'<div class="left-menu-message-popup">'+t+"</div>",darkMode:true,offsetTop:s==="right"?-45:2,offsetLeft:s==="right"?215:0,angle:s==="right"?{position:"left"}:true,cacheable:false,autoHide:true,events:{onDestroy:function(){n=null}}});n.show();setTimeout((function(){if(n){n.close();n=null}}),3e3)}showError(e){this.showMessage(e,l.Loc.getMessage("edit_error"))}showGlobalPreset(){o.BannerDispatcher.high.toQueue((e=>{const t=this.getDefaultPresetController();t.show("global");t.getPopup().subscribe("onAfterClose",(t=>{e()}))}))}handleShowHiddenClick(){this.getItemsController().toggleHiddenContainer(true)}onHiddenBlockIsVisible(){l.Dom.addClass(this.menuMoreButton,"menu-favorites-more-btn-open");this.menuMoreButton.querySelector("#menu-more-btn-text").innerHTML=l.Loc.getMessage("more_items_hide")}onHiddenBlockIsHidden(){l.Dom.removeClass(this.menuMoreButton,"menu-favorites-more-btn-open");this.menuMoreButton.querySelector("#menu-more-btn-text").innerHTML=l.Loc.getMessage("more_items_show")}onHiddenBlockIsEmpty(){l.Dom.addClass(this.menuMoreButton,"menu-favorites-more-btn-hidden")}onHiddenBlockIsNotEmpty(){l.Dom.removeClass(this.menuMoreButton,"menu-favorites-more-btn-hidden")}setDefaultMenu(){a.MessageBox.show({message:l.Loc.getMessage("MENU_SET_DEFAULT_CONFIRM"),onYes:(e,t)=>{t.setWaiting();T.setDefaultPreset().then((()=>{t.setWaiting(false);e.close();document.location.reload()}))},buttons:a.MessageBoxButtons.YES_CANCEL})}clearCompositeCache(){l.ajax.runAction("intranet.leftmenu.clearCache",{data:{}})}onGettingSettingMenuItems(){const e=O.getActiveTopMenuItem();let t=null;if(e){const s=this.menuContainer.querySelector(`.menu-item-block[data-link="${e["URL"]}"]`);if(!s){t={text:l.Loc.getMessage("MENU_ADD_TO_LEFT_MENU"),onclick:(t,s)=>{this.getItemDirector().saveStandardPage(e);s.getMenuWindow().destroy()}}}else if(s.getAttribute("data-type")===O.code){t={text:l.Loc.getMessage("MENU_DELETE_FROM_LEFT_MENU"),onclick:(t,s)=>{this.getItemDirector().deleteStandardPage(e);s.getMenuWindow().destroy()}}}else{t={text:l.Loc.getMessage("MENU_DELETE_PAGE_FROM_LEFT_MENU"),className:"menu-popup-disable-text",onclick:()=>{}}}}const s=[{text:l.Loc.getMessage("SORT_ITEMS"),onclick:()=>{this.getItemsController().switchToEditMode()}},{text:this.isCollapsed()?l.Loc.getMessage("MENU_EXPAND"):l.Loc.getMessage("MENU_COLLAPSE"),onclick:(e,t)=>{this.toggle();t.getMenuWindow().destroy()}},t,{text:l.Loc.getMessage("MENU_ADD_SELF_PAGE"),onclick:(e,t)=>{this.getItemDirector().showAddToSelf(this.getSettingsController().getContainer())}}];if(u.isAdmin){let e=l.Loc.getMessage("MENU_SAVE_CUSTOM_PRESET");if(u.isCustomPresetRestricted){e+="<span class='menu-lock-icon'></span>"}s.push({html:e,className:u.isCustomPresetRestricted?" menu-popup-disable-text":"",onclick:(e,t)=>{if(u.isCustomPresetRestricted){BX.UI.InfoHelper.show("limit_office_menu_to_all")}else{this.getCustomPresetController().show()}}})}if(!u.isExtranet){s.push({text:l.Loc.getMessage("MENU_SET_DEFAULT"),onclick:this.setDefaultMenu.bind(this)})}const i=l.Reflection.getClass("BX.Messenger.v2.Lib.Messenger");const n=[!u.isAdmin?null:{text:l.Loc.getMessage("LEFT_MENU_SETTINGS_ITEM_B24_SETTINGS"),onclick:()=>{BX.SidePanel.Instance.open(`${u.settingsPath}?analyticContext=left_menu`,{allowChangeHistory:false,width:1034})}},i?{text:l.Loc.getMessage("LEFT_MENU_SETTINGS_ITEM_MESSENGER_SETTINGS"),onclick:()=>{i.openSettings()}}:null,u.isExtranet?null:{text:l.Loc.getMessage("MENU_SET_DEFAULT2"),onclick:()=>{this.getDefaultPresetController().show("personal")}},!u.inviteDialogLink?null:{text:l.Loc.getMessage("MENU_INVITE_USERS"),onclick:()=>{BX.SidePanel.Instance.open(u.inviteDialogLink,{cacheable:false,allowChangeHistory:false,width:1100})}},!u.isAdmin&&u.isExtranet?null:{delimiter:true},{text:l.Loc.getMessage("LEFT_MENU_SETTINGS_ITEM_MENU_SETTINGS"),items:s},{delimiter:true},!u.showSitemapMenuItem?null:{text:l.Loc.getMessage("MENU_SITE_MAP"),onclick:()=>{this.handleSiteMapClick()}},{text:l.Loc.getMessage("MENU_HELP"),onclick:()=>{this.handleHelperClick()}}];return n.filter((e=>e!==null))}handleSiteMapClick(){this.switchToSlidingMode(false);BX.SidePanel.Instance.open((l.Loc.getMessage("SITE_DIR")||"/")+"sitemap/",{allowChangeHistory:false,customLeftBoundary:0})}handleHelperClick(){this.switchToSlidingMode(false);BX.Helper.show()}blockSliding(){this.stopSliding();this.isMenuMouseEnterBlocked=true}releaseSliding(){this.isMenuMouseEnterBlocked=false}stopSliding(){clearTimeout(this.slidingModeTimeoutId);this.slidingModeTimeoutId=0}startSliding(){this.stopSliding();if(this.isMenuMouseEnterBlocked===true){return}this.slidingModeTimeoutId=setTimeout(function(){this.slidingModeTimeoutId=0;this.switchToSlidingMode(true)}.bind(this),400)}handleBurgerClick(e){this.getItemsController().switchToViewMode();this.menuHeaderBurger.classList.add("menu-switcher-hover");this.toggle(e,function(){this.blockSliding();setTimeout(function(){this.menuHeaderBurger.classList.remove("menu-switcher-hover");this.releaseSliding()}.bind(this),100)}.bind(this))}handleMenuMouseEnter(e){if(!this.isCollapsed()){return}this.startSliding()}handleMenuMouseLeave(e){this.stopSliding();if(this.isMenuMouseLeaveBlocked.length<=0){this.switchToSlidingMode(false)}}handleMenuDoubleClick(e){if(e.target===this.menuBody){this.toggle()}}handleUpButtonClick(){this.blockSliding();if(this.isUpButtonReversed()){window.scrollTo(0,this.lastScrollOffset);this.lastScrollOffset=0;this.unreverseUpButton()}else{this.lastScrollOffset=window.pageYOffset;window.scrollTo(0,0);this.reverseUpButton()}setTimeout(this.releaseSliding.bind(this),100)}handleUpButtonMouseLeave(){this.releaseSliding()}handleDocumentScroll(){if(window.pageYOffset>document.documentElement.clientHeight){this.showUpButton();if(this.isUpButtonReversed()){this.unreverseUpButton();this.lastScrollOffset=0}}else if(!this.isUpButtonReversed()){this.hideUpButton()}if(window.pageXOffset>0){this.menuContainer.style.left=-window.pageXOffset+"px";this.upButton.style.left=-window.pageXOffset+(this.isCollapsed()?0:172)+"px"}else{this.menuContainer.style.removeProperty("left");this.upButton.style.removeProperty("left")}}switchToSlidingMode(e,t){if(e===false){this.stopSliding();if(BX.hasClass(this.mainTable,"menu-sliding-mode")){if(t!==true){BX.addClass(this.mainTable,"menu-sliding-closing-mode")}BX.removeClass(this.mainTable,"menu-sliding-mode menu-sliding-opening-mode");l.Dom.removeClass(this.menuContainer,"--ui-context-edge-dark")}}else if(this.isCollapsedMode&&!BX.hasClass(this.mainTable,"menu-sliding-mode")){BX.removeClass(this.mainTable,"menu-sliding-closing-mode");l.Dom.removeClass(this.menuContainer,"--ui-context-edge-dark");if(t!==true){BX.addClass(this.mainTable,"menu-sliding-opening-mode")}BX.addClass(this.mainTable,"menu-sliding-mode");l.Dom.addClass(this.menuContainer,"--ui-context-edge-dark")}}handleSlidingTransitionEnd(e){if(e.target===this.menuContainer){BX.removeClass(this.mainTable,"menu-sliding-opening-mode menu-sliding-closing-mode")}}switchToScrollMode(e){if(e===false){l.Dom.removeClass(this.mainTable,"menu-scroll-mode")}else if(!l.Dom.hasClass(this.mainTable,"menu-scroll-mode")){l.Dom.addClass(this.mainTable,"menu-scroll-mode")}}toggle(e,t){let s=document.querySelector(".js-app");if(!s){return}const i=!this.mainTable.classList.contains("menu-collapsed-mode");if(e===i||this.mainTable.classList.contains("menu-animation-mode")){return}BX.onCustomEvent("BX.Bitrix24.LeftMenuClass:onMenuToggle",[e,this]);this.blockSliding();this.switchToSlidingMode(false,true);this.mainTable.classList.add("menu-animation-mode",i?"menu-animation-closing-mode":"menu-animation-opening-mode");var n=[].slice.call(s.querySelectorAll(".menu-item-link"));var a=s.querySelector(".menu-collapsed-more-btn");var o=s.querySelector(".menu-default-more-btn");var r=s.querySelector(".menu-sitemap-icon-box");var l=s.querySelector(".menu-sitemap-btn-text");var c=s.querySelector(".menu-invite-employees-text");var d=s.querySelector(".menu-invite-icon-box");var u=s.querySelector(".menu-license-all-container");var m=s.querySelector(".menu-license-all-default");var h=m?m.offsetHeight:0;var p=s.querySelector(".menu-license-all-collapsed");const g=this.menuContainer.querySelector(".menu-settings-icon-box");const f=this.menuContainer.querySelector(".menu-settings-btn-text");const b=this.menuContainer.querySelector(".menu-help-icon-box");const v=this.menuContainer.querySelector(".menu-help-btn-text");var y=s.querySelector(".menu-item-separator");var E=s.querySelector(".menu-item-index-more");var L=this.mainTable.querySelector(".air-header");var M=document.getElementById("bx-im-bar");var I=M?M.offsetWidth:0;const P=parseInt(getComputedStyle(this.menuContainer).getPropertyValue("--menu-width-expanded"),10);const C=parseInt(getComputedStyle(this.menuContainer).getPropertyValue("--menu-width-collapsed"),10);new BX.easing({duration:300,start:{sidebarWidth:i?P:C},finish:{sidebarWidth:i?C:P},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){this.menuContainer.style.width=e.sidebarWidth+"px";this.menuHeaderBurger.style.width=e.burgerMenuWidth+"px";if(L){L.style.maxWidth="calc(100vw - "+e.sidebarWidth+"px - "+I+"px)"}if(i){if(r){r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100}if(l){l.style.transform="translateX("+e.translateText+"px)";l.style.opacity=e.opacity/100}if(d){d.style.transform="translateX("+e.translateIcon+"px)";d.style.opacity=e.opacityRevert/100}if(c){c.style.transform="translateX("+e.translateText+"px)";c.style.opacity=e.opacity/100}if(g){g.style.transform="translateX("+e.translateIcon+"px)";g.style.opacity=e.opacityRevert/100}if(f){f.style.transform="translateX("+e.translateText+"px)";f.style.opacity=e.opacity/100}if(b){b.style.transform="translateX("+e.translateIcon+"px)";b.style.opacity=e.opacityRevert/100}if(v){v.style.transform="translateX("+e.translateText+"px)";v.style.opacity=e.opacity/100}if(a){a.style.transform="translateX("+e.translateIcon+"px)";a.style.opacity=e.opacityRevert/100}if(o){o.style.transform="translateX("+e.translateMoreBtn+"px)";o.style.opacity=e.opacity/100}if(E){E.style.transform="translateX("+e.translateIcon+"px)";E.style.opacity=e.opacityRevert/100}if(u){m.style.transform="translateX("+e.translateLicenseBtn+"px)";m.style.opacity=e.opacity/100;m.style.height=e.heightLicenseBtn+"px";p.style.transform="translateX("+e.translateIcon+"px)";p.style.opacity=e.opacityRevert/100}n.forEach((function(t){var s=t.querySelector(".menu-item-icon-box");var i=t.querySelector(".menu-item-link-text");var n=t.querySelector(".menu-item-index");var a=t.querySelector(".menu-item-link-arrow");i.style.transform="translateX("+e.translateText+"px)";i.style.opacity=e.opacity/100;s.style.transform="translateX("+e.translateIcon+"px)";s.style.opacity=e.opacityRevert/100;if(a){a.style.transform="translateX("+e.translateText+"px)";a.style.opacity=e.opacity/100}if(n){n.style.transform="translateX("+e.translateIcon+"px)";n.style.opacity=e.opacityRevert/100}}))}else{y.style.opacity=0;if(r){r.style.transform="translateX("+e.translateIcon+"px)";r.style.opacity=e.opacityRevert/100}if(l){l.style.transform="translateX("+e.translateText+"px)";l.style.opacity=e.opacity/100}if(d){d.style.transform="translateX("+e.translateIcon+"px)";d.style.opacity=e.opacityRevert/100}if(c){c.style.transform="translateX("+e.translateText+"px)";c.style.opacity=e.opacity/100}if(g){g.style.transform="translateX("+e.translateIcon+"px)";g.style.opacity=e.opacityRevert/100}if(f){f.style.transform="translateX("+e.translateText+"px)";f.style.opacity=e.opacity/100}if(b){b.style.transform="translateX("+e.translateIcon+"px)";b.style.opacity=e.opacityRevert/100}if(v){v.style.transform="translateX("+e.translateText+"px)";v.style.opacity=e.opacity/100}if(a){a.style.transform="translateX("+e.translateIcon+"px)";a.style.opacity=e.opacityRevert/100}if(o){o.style.transform="translateX("+e.translateMoreBtn+"px)";o.style.opacity=e.opacity/100}if(E){E.style.transform="translateX("+e.translateText+"px)"}if(u){m.style.transform="translateX("+e.translateLicenseBtn+"px)";m.style.opacity=e.opacity/100;m.style.height=e.heightLicenseBtn+"px";p.style.transform="translateX("+e.translateIcon+"px)";p.style.opacity=e.opacityRevert/100}n.forEach((function(t){var s=t.querySelector(".menu-item-icon-box");var i=t.querySelector(".menu-item-link-text");var n=t.querySelector(".menu-item-index");var a=t.querySelector(".menu-item-link-arrow");i.style.transform="translateX("+e.translateText+"px)";i.style.opacity=e.opacity/100;i.style.display="inline-block";s.style.transform="translateX("+e.translateIcon+"px)";s.style.opacity=e.opacityRevert/100;if(a){a.style.transform="translateX("+e.translateText+"px)"}if(n){n.style.transform="translateX("+e.translateText+"px)"}}))}var t=document.createEvent("Event");t.initEvent("resize",true,true);window.dispatchEvent(t)}.bind(this),complete:function(){if(i){this.isCollapsedMode=true;BX.addClass(this.mainTable,"menu-collapsed-mode")}else{this.isCollapsedMode=false;BX.removeClass(this.mainTable,"menu-collapsed-mode")}BX.removeClass(this.mainTable,"menu-animation-mode menu-animation-opening-mode menu-animation-closing-mode");var e=[s,y,this.menuHeaderBurger,this.headerBurger,g,f,b,v,o,a,r,l,d,c,E,m,p,this.menuContainer,L];e.forEach((function(e){if(e){e.style.cssText=""}}));n.forEach((function(e){var t=e.querySelector(".menu-item-icon-box");var s=e.querySelector(".menu-item-link-text");var i=e.querySelector(".menu-item-index");var n=e.querySelector(".menu-item-link-arrow");e.style.cssText="";s.style.cssText="";t.style.cssText="";if(n){n.style.cssText=""}if(i){i.style.cssText=""}}));this.releaseSliding();if(BX.type.isFunction(t)){t()}T.toggleMenu(i);var u=document.createEvent("Event");u.initEvent("resize",true,true);window.dispatchEvent(u)}.bind(this)}).animate()}handleViewMode(){this.getItemsController().switchToViewMode()}handleGroupPanelOpen(){this.isMenuMouseLeaveBlocked.push("group")}handleGroupPanelClose(){this.isMenuMouseLeaveBlocked.pop()}showUpButton(){this.menuContainer.classList.add("menu-up-button-active")}hideUpButton(){this.menuContainer.classList.remove("menu-up-button-active")}reverseUpButton(){this.menuContainer.classList.add("menu-up-button-reverse")}unreverseUpButton(){this.menuContainer.classList.remove("menu-up-button-reverse")}isUpButtonReversed(){return this.menuContainer.classList.contains("menu-up-button-reverse")}isDefaultTheme(){return document.body.classList.contains("bitrix24-default-theme")}getTopPadding(){return this.isDefaultTheme()?0:9}initPagetitleStar(){return O.isCurrentPageStandard(O.getActiveTopMenuItem())}getStructureForHelper(){const e={menu:{}};["show","hide"].forEach((t=>{Array.from(this.menuContainer.querySelectorAll(`[data-status="${t}"][data-type="${j.code}"]`)).forEach((s=>{e[t]=e[t]||[];e[t].push(s.getAttribute("data-id"))}))}));return e}showItemWarning({itemId:e,title:t,events:s}){if(this.getItemsController().items.has(e)){this.getItemsController().items.get(e).showWarning(t,s)}}removeItemWarning(e){if(this.getItemsController().items.has(e)){this.getItemsController().items.get(e).removeWarning()}}decrementCounter(e,t){if(!e||e.id!=="menu-counter-live-feed"){return}babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]+=parseInt(t);this.getItemsController().decrementCounter({"live-feed":parseInt(t)})}updateCounters(e,t){if(!e){return}if(e["**"]!==undefined){e["live-feed"]=e["**"];delete e["**"]}if(e["live-feed"]){if(e["live-feed"]<=0){babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]=0}else{e["live-feed"]-=babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]}}this.getItemsController().updateCounters(e,t)}}function Lt({DATA_ID:e,NODE:t}){var s;let i=this.getItemsController().items.get(e);if(!i){const e=t.getAttribute("data-top-menu-id");if(t===t.parentNode.querySelector("[data-top-menu-id]")){const t=this.menuItemsBlock.querySelector(`[data-top-menu-id="${e}"]`);if(t){i=this.getItemsController().items.get(t.getAttribute("data-id"))}}}return(s=i)!=null?s:null}e.Menu=Et})(this.BX.Intranet=this.BX.Intranet||{},BX.UI,BX,BX.Main,BX.Event,BX.UI.Dialogs,BX.UI,BX.UI.Analytics,BX,BX.Cache,BX.SidePanel);
//# sourceMappingURL=script.map.js