{"version":3,"file":"invitation-widget-counter.bundle.js","sources":["../src/invitation-widget-counter.js"],"sourcesContent":["import { Cache, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Counter } from 'ui.cnt';\n\nexport class InvitationWidgetCounter\n{\n\t#cache = new Cache.MemoryCache();\n\tstatic #instance: InvitationWidgetCounter;\n\n\tconstructor()\n\t{\n\t\tEventEmitter.subscribeOnce('HR.company-structure:first-popup-showed', this.#onFirstWatchNewStructure.bind(this));\n\t}\n\n\tstatic getInstance(): InvitationWidgetCounter\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tsetOptions(options: {}): InvitationWidgetCounter\n\t{\n\t\tthis.#cache.set('options', options);\n\n\t\treturn this;\n\t}\n\n\tgetOptions(): {}\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getCounter().renderTo(this.#getCounterWrapper());\n\t}\n\n\tonReceiveCounterValue(value): void\n\t{\n\t\tif (this.getOptions().shouldShowStructureCounter)\n\t\t{\n\t\t\tvalue++;\n\t\t}\n\n\t\tthis.#getCounter().update(value);\n\t\tthis.getOptions().invitationCounter = value;\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tthis.#getCounter().renderTo(this.#getCounterWrapper());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#getCounter().destroy();\n\t\t\tthis.#cache.delete('counter');\n\t\t}\n\t}\n\n\t#getCounterWrapper(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('counter-wrapper', () => {\n\t\t\treturn this.getOptions().button.querySelector('.invitation-widget-counter');\n\t\t});\n\t}\n\n\t#getCounter(): Counter\n\t{\n\t\treturn this.#cache.remember('counter', () => {\n\t\t\treturn new Counter({\n\t\t\t\tvalue: this.#getCounterValue(),\n\t\t\t\tcolor: Counter.Color.DANGER,\n\t\t\t});\n\t\t});\n\t}\n\n\t#getCounterValue(): number\n\t{\n\t\tlet counterValue = Number(this.getOptions().invitationCounter);\n\t\tif (this.getOptions().shouldShowStructureCounter ?? false)\n\t\t{\n\t\t\tcounterValue++;\n\t\t}\n\n\t\treturn counterValue;\n\t}\n\n\t#onFirstWatchNewStructure(): void\n\t{\n\t\tlet value = this.#getCounter().value;\n\n\t\tif (!Type.isNumber(value))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getOptions().shouldShowStructureCounter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvalue--;\n\t\tthis.getOptions().shouldShowStructureCounter = false;\n\t\tthis.#getCounter().update(value);\n\t\tthis.getOptions().invitationCounter = value;\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tthis.#getCounter().renderTo(this.#getCounterWrapper());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#getCounter().destroy();\n\t\t\tthis.#cache.delete('counter');\n\t\t}\n\t}\n}\n"],"names":["InvitationWidgetCounter","constructor","Object","value","writable","Cache","MemoryCache","EventEmitter","subscribeOnce","babelHelpers","bind","this","[object Object]","setOptions","options","set","getOptions","get","show","renderTo","onReceiveCounterValue","shouldShowStructureCounter","update","invitationCounter","destroy","delete","remember","button","querySelector","Counter","color","Color","DANGER","counterValue","Number","Type","isNumber"],"mappings":"mDAEiC,iWAE1B,MAAMA,EAKZC,cACAC,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAE,YAAAD,MAJS,IAAIE,QAAMC,cAKlBC,eAAaC,cAAc,0CAA2CC,mDAA+BC,KAAKC,OAG3GC,qBAOC,+CALKD,aAEJF,mDAAiB,IAAIE,8CAGfA,WAGRE,WAAWC,GAIV,OAFAL,mDAAYM,IAAI,UAAWD,GAEpBH,KAGRK,aAEC,OAAOP,mDAAYQ,IAAI,UAAW,IAGnCC,OAECT,qDAAmBU,iDAASR,cAG7BS,sBAAsBjB,GAEjBQ,KAAKK,aAAaK,4BAErBlB,IAGDM,qDAAmBa,OAAOnB,GAC1BQ,KAAKK,aAAaO,kBAAoBpB,EAElCA,EAAQ,EAEXM,qDAAmBU,iDAASR,eAI5BF,qDAAmBe,UACnBf,mDAAYgB,OAAO,aA6DrB,aAvDC,OAAOhB,mDAAYiB,SAAS,kBAAmB,IACvCf,KAAKK,aAAaW,OAAOC,cAAc,+BAE/C,aAIA,OAAOnB,mDAAYiB,SAAS,UAAW,IAC/B,IAAIG,UAAQ,CAClB1B,8CAAOQ,aACPmB,MAAOD,UAAQE,MAAMC,UAGvB,aAGD,MACC,IAAIC,EAAeC,OAAOvB,KAAKK,aAAaO,mBAM5C,gBALIZ,KAAKK,aAAaK,gCAErBY,IAGMA,EACP,aAIA,IAAI9B,EAAQM,qDAAmBN,MAE1BgC,OAAKC,SAASjC,IAKdQ,KAAKK,aAAaK,6BAKvBlB,IACAQ,KAAKK,aAAaK,4BAA6B,EAC/CZ,qDAAmBa,OAAOnB,GAC1BQ,KAAKK,aAAaO,kBAAoBpB,EAElCA,EAAQ,EAEXM,qDAAmBU,iDAASR,eAI5BF,qDAAmBe,UACnBf,mDAAYgB,OAAO,aAEpBvB,sBAlHWF,KAAuBI,YAAAD"}