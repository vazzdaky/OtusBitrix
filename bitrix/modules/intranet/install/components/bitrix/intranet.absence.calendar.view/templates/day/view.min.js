function JCCalendarViewDay(t){this.ID="day";this._parent=null;this.SETTINGS={};this.ENTRIES=[];if(!window._DAY_STYLE_LOADED){BX.loadCSS("/bitrix/components/bitrix/intranet.absence.calendar.view/templates/day/view.css");window._DAY_STYLE_LOADED=true}BX.bind(window,"resize",BX.proxy(this.__onresize,this))}JCCalendarViewDay.prototype.__onresize=function(){this.UnloadData(true);this.__drawData()};JCCalendarViewDay.prototype.Load=function(){this._parent.FILTER.SHORT_EVENTS="Y";if(null!=this.ENTRIES&&this.ENTRIES.length>0)this.UnloadData();this.__drawLayout();this.TYPE_BGCOLORS=this._parent.TYPE_BGCOLORS;this._parent.LoadData(this.SETTINGS.DATE_START,this.SETTINGS.DATE_FINISH)};JCCalendarViewDay.prototype.LoadData=function(t){this.ENTRIES=t;if(BX.browser.IsIE()){setTimeout(BX.proxy(this.__drawData,this),10)}else{this.__drawData()}};JCCalendarViewDay.prototype.UnloadData=function(t){if(null==this.ENTRIES)return;if(null==t)t=false;for(var e=0;e<this.ENTRIES.length;e++){if(null!=this.ENTRIES[e].DATA){for(var T=0;T<this.ENTRIES[e].DATA.length;T++){if(null==this.ENTRIES[e].DATA[T].VISUAL)continue;this._parent.UnRegisterEntry(this.ENTRIES[e].DATA[T]);BX.cleanNode(this.ENTRIES[e].DATA[T].VISUAL,true);this.ENTRIES[e].DATA[T].VISUAL=null}}var a=document.getElementById("bx_calendar_user_"+this.ENTRIES[e]["ID"]);if(null!=a)a.parentNode.removeChild(a)}if(!t)this.ENTRIES=null};JCCalendarViewDay.prototype.SetSettings=function(t){this.SETTINGS=t;var e=new Date;if(null==this.SETTINGS.DATE_START||e>=this.SETTINGS.DATE_START&&e<=this.SETTINGS.DATE_FINISH)this.SETTINGS.DATE_START=e;this.SETTINGS.DATE_START.setHours(this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START);this.SETTINGS.DATE_START.setMinutes(0);this.SETTINGS.DATE_START.setSeconds(0);this.SETTINGS.DATE_START.setMilliseconds(0);this.SETTINGS.DATE_FINISH=new Date(this.SETTINGS.DATE_START.valueOf());this.SETTINGS.DATE_FINISH.setHours(this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH)};JCCalendarViewDay.prototype.Unload=function(){BX.unbind(window,"resize",BX.proxy(this.__onresize,this));this.UnloadData()};JCCalendarViewDay.prototype.changeDay=function(t){if(t!=-1)t=1;this.SETTINGS.DATE_START.setDate(this.SETTINGS.DATE_START.getDate()+t);this.SETTINGS.DATE_FINISH.setDate(this.SETTINGS.DATE_FINISH.getDate()+t);this.Load()};JCCalendarViewDay.prototype.__drawLayout=function(){var t=this;var e=this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START;var T=this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH;this._parent.CONTROLS.CALENDAR.innerHTML="";this.obTable=document.createElement("TABLE");this.obTable.className="bx-calendar-day-main-table";this.obTable.setAttribute("cellSpacing","0");this._parent.CONTROLS.CALENDAR.appendChild(this.obTable);this.obTable.appendChild(document.createElement("TBODY"));var a=new Date(this.SETTINGS.DATE_FINISH.valueOf());a.setSeconds(a.getSeconds()-1);var i=this._parent.DAYS_FULL[this.SETTINGS.DATE_START.getDay()]+", "+this.SETTINGS.DATE_START.getDate()+" "+this._parent.MONTHS_R[this.SETTINGS.DATE_START.getMonth()]+" "+this.SETTINGS.DATE_START.getFullYear();this._parent.CONTROLS.DATEROW.innerHTML=this._parent.CONTROLS.DATEROW.innerHTML='<table class="bx-calendar-day-control-table" align="center"><tr>'+'<td><a href="javascript:void(0)" class="bx-calendar-day-icon bx-calendar-day-back"></a></td>'+"<td>"+i+"</td>"+'<td><a href="javascript:void(0)" class="bx-calendar-day-icon bx-calendar-day-fwd"></a></td>'+"</tr></table>";var s=this._parent.CONTROLS.DATEROW.getElementsByTagName("A");s[0].onclick=function(){t.changeDay(-1)};s[1].onclick=function(){t.changeDay(1)};this.obDelimRow=this.obTable.tBodies[0].insertRow(-1);this.obDelimRow.insertCell(-1);this.obDelimRow.cells[0].className="bx-calendar-day-empty";if(BX.browser.IsIE())this.obDelimRow.cells[0].innerHTML="&nbsp;";var E=new Date(this.SETTINGS.DATE_START.valueOf());var S=new Date;S.setMinutes(0);S.setSeconds(0);S.setMilliseconds(0);for(var n=e;n<T;n++){var r=this.obDelimRow.insertCell(-1);r.className="bx-calendar-day-hour"+(this.SETTINGS.DAY_SHOW_NONWORK?"":"-long");if(E.valueOf()==S.valueOf())r.className+=" bx-calendar-day-now";if(n<this.SETTINGS.DAY_START||n>=this.SETTINGS.DAY_FINISH)r.className+=" bx-calendar-day-hour-nonwork";var A=BX.isAmPmMode()?E.getHours()%12>0?E.getHours()%12:12:E.getHours();A+=BX.isAmPmMode()?E.getHours()<12?"am":"pm":"<sup>00</sup>";r.innerHTML=A;E.setHours(E.getHours()+1)}this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"));this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"));this.obPageBar=document.createElement("DIV");this.obPageBar.style.padding="10px 10px 3px";this.obPageBar.style.fontSize="0.95em";this._parent.CONTROLS.CALENDAR.appendChild(this.obPageBar);this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"));this._parent.CONTROLS.CALENDAR.appendChild(document.createElement("BR"))};JCCalendarViewDay.prototype.__drawData=function(){var t=this;var e=new Date;e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);var T=this.SETTINGS.DAY_SHOW_NONWORK?0:this.SETTINGS.DAY_START;var a=this.SETTINGS.DAY_SHOW_NONWORK?24:this.SETTINGS.DAY_FINISH;var i=this.SETTINGS.DATE_START;var s=new Date(this.SETTINGS.DATE_FINISH);s.setSeconds(s.getSeconds()-1);for(var E=0;E<(null==this.ENTRIES?0:this.ENTRIES.length);E++){for(var S=0;S<this.ENTRIES[E]["DATA"].length;S++){var n=this.ENTRIES[E]["DATA"][S]["DATE_ACTIVE_FROM"];var r=this.ENTRIES[E]["DATA"][S]["DATE_ACTIVE_TO"];if(i.valueOf()>r.valueOf()||s.valueOf()<n.valueOf()){this.ENTRIES[E]["DATA"].splice(S,1);S--}}if(this.ENTRIES[E]["DATA"].length==0&&this._parent.FILTER.USERS_ALL=="N"){continue}var A=-1;if(null!=this.ENTRIES[E]["DATA"]&&this.ENTRIES[E]["DATA"].length>0){for(var S=0;S<this.ENTRIES[E]["DATA"].length;S++){var n=this.ENTRIES[E]["DATA"][S]["DATE_ACTIVE_FROM"];var r=this.ENTRIES[E]["DATA"][S]["DATE_ACTIVE_TO"];if(this.SETTINGS.DATE_START.valueOf()>=n.valueOf()&&this.SETTINGS.DATE_FINISH.valueOf()<=r.valueOf()+1e3){A=this.obDelimRow.rowIndex;break}}}var h=this.obTable.tBodies[0].insertRow(A);h.insertCell(-1);h.cells[0].className="bx-calendar-day-first-col";h.id="bx_calendar_user_"+this.ENTRIES[E]["ID"];var l=h.cells[0].appendChild(document.createElement("DIV"));var N=this._parent.FormatName(this.SETTINGS.NAME_TEMPLATE,this.ENTRIES[E]);l.title=N;if(this.ENTRIES[E]["DETAIL_URL"]){var o=document.createElement("A");o.appendChild(document.createTextNode(N));o.href=this.ENTRIES[E]["DETAIL_URL"]}else{var o=document.createTextNode(N)}l.appendChild(o);var I=new Date(this.SETTINGS.DATE_START.valueOf());for(var S=T;S<a;S++){var D=h.insertCell(-1);D.className="bx-calendar-day-hour"+(this.SETTINGS.DAY_SHOW_NONWORK?"":"-long");if(I.valueOf()==e.valueOf())D.className+=" bx-calendar-day-now";if(S<this.SETTINGS.DAY_START||S>=this.SETTINGS.DAY_FINISH)D.className+=" bx-calendar-day-hour-nonwork";if(BX.browser.IsIE())D.innerHTML="&nbsp;";I.setHours(I.getHours()+1)}}var d=2;for(var E=0;E<(null==this.ENTRIES?0:this.ENTRIES.length);E++){var _=BX("bx_calendar_user_"+this.ENTRIES[E]["ID"]);if(_&&this.ENTRIES[E]["DATA"]){var R=BX.pos(_,true);for(var S=0;S<this.ENTRIES[E]["DATA"].length;S++){var n=this.ENTRIES[E]["DATA"][S]["DATE_ACTIVE_FROM"];var r=this.ENTRIES[E]["DATA"][S]["DATE_ACTIVE_TO"];this.ENTRIES[E]["DATA"][S].VISUAL=document.createElement("DIV");this.ENTRIES[E]["DATA"][S].VISUAL.bx_color_variant=this.ENTRIES[E]["DATA"][S]["TYPE"].length?this.ENTRIES[E]["DATA"][S]["TYPE"]:"OTHER";this.ENTRIES[E]["DATA"][S].VISUAL.className="bx-calendar-entry bx-calendar-color-"+this.ENTRIES[E]["DATA"][S].VISUAL.bx_color_variant;this.ENTRIES[E]["DATA"][S].VISUAL.style.background=this.TYPE_BGCOLORS[this.ENTRIES[E]["DATA"][S]["TYPE"].length?this.ENTRIES[E]["DATA"][S]["TYPE"]:"OTHER"];this.ENTRIES[E]["DATA"][S].VISUAL.style.top=R.top+d+"px";if(i.valueOf()>n.valueOf())n=i;if(s.valueOf()<r.valueOf())r=s;var c=n.getHours()+1-T,u=r.getHours()+1-T;if(u<c)u=c;var p=_.cells[c],f=_.cells[u];var O=BX.pos(p,true),v=O.left+d;if(n.getMinutes()>40)v+=O.right-O.left;else if(n.getMinutes()>20)v+=Math.round((O.right-O.left)/2);if(p!=f)O=BX.pos(f,true);var G=O.left;if(r.getMinutes()>40)G=O.right;else if(r.getMinutes()>20)G+=Math.round((O.right-O.left)/2);var b=Math.abs(parseInt(G-v-d*2));if(isNaN(b)||b<5)b=5;this.ENTRIES[E]["DATA"][S].VISUAL.dataset.dateFrom=this.ENTRIES[E]["DATA"][S]["DATE_FROM"];this.ENTRIES[E]["DATA"][S].VISUAL.style.left=parseInt(v)+"px";this.ENTRIES[E]["DATA"][S].VISUAL.style.width=b+"px";this.ENTRIES[E]["DATA"][S].VISUAL.style.height=parseInt(O.height-2*d)+"px";this.ENTRIES[E]["DATA"][S].VISUAL.innerHTML="<nobr>"+BX.util.htmlspecialchars(this.ENTRIES[E]["DATA"][S]["NAME"])+" ("+this.ENTRIES[E]["DATA"][S]["DATE_FROM"]+" - "+this.ENTRIES[E]["DATA"][S]["DATE_TO"]+")"+"</nobr>";this.ENTRIES[E]["DATA"][S].VISUAL.__bx_user_id=this.ENTRIES[E]["ID"];this._parent.MAIN_LAYOUT.appendChild(this.ENTRIES[E]["DATA"][S].VISUAL);this._parent.RegisterEntry(this.ENTRIES[E].DATA[S])}}}if(this.SETTINGS.PAGE_COUNT>1||this.SETTINGS.PAGE_NUMBER>0){this.obPageBar.innerHTML=this._parent.MESSAGES.INTR_ABSC_TPL_PAGE_BAR+": ";for(var E=0;E<=this.SETTINGS.PAGE_NUMBER;E++){if(E==this.SETTINGS.PAGE_NUMBER){var L=document.createTextNode(E+1)}else{var L=document.createElement("A");L.href="javascript:void(0);";L.innerHTML=E+1;L.onclick=function(e){return function(){t.SETTINGS.PAGE_NUMBER=e;t.Load()}}(E)}this.obPageBar.appendChild(L);this.obPageBar.appendChild(document.createTextNode(" "));if(E==0&&this.SETTINGS.PAGE_NUMBER>=6){var L=document.createTextNode("...");this.obPageBar.appendChild(L);this.obPageBar.appendChild(document.createTextNode(" "));E=this.SETTINGS.PAGE_NUMBER-4}}if(this.SETTINGS.PAGE_COUNT-1>this.SETTINGS.PAGE_NUMBER){var L=document.createElement("A");L.href="javascript:void(0);";L.innerHTML=this._parent.MESSAGES.INTR_ABSC_TPL_PAGE_NEXT;L.onclick=function(){t.SETTINGS.PAGE_NUMBER+=1;t.Load()};this.obPageBar.appendChild(L)}}};
//# sourceMappingURL=view.map.js