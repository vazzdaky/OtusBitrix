{"version":3,"file":"script.js","sources":["src/account/account.js","src/api/theme.js","src/api/counters.js","src/items/item.js","src/items/item-admin-shared.js","src/items/item-admin-custom.js","src/items/item-user-favorites.js","src/items/item-user-self.js","src/items/item-system.js","src/items/index.js","src/controllers/items-controller.js","src/history/browser-history.js","src/desktop-menu.js"],"sourcesContent":["import { Dom, Text, Event, Loc, Tag } from 'main.core';\nimport { DesktopApi, DesktopAccount } from 'im.v2.lib.desktop-api';\nimport { showDesktopDeleteConfirm } from 'im.v2.lib.confirm';\nimport {Menu, Popup} from 'main.popup';\nimport { PopupManager } from 'main.popup';\nimport { PopupType } from 'im.v2.const';\nexport class Account\n{\n\tstatic defaultAvatar = '/bitrix/js/im/images/blank.gif';\n\tstatic defaultAvatarDesctop = '/bitrix/js/ui/icons/b24/images/ui-user.svg?v2';\n\taccounts: DesktopAccount[] = [];\n\tcurrentUser: ?Object = null;\n\tcontextPopup: BX.Main.Popup[] = [];\n\tpopup: BX.Main.Popup = null;\n\tallCounters: Object = {};\n\twrapper: HTMLElement = null;\n\n\tconstructor(allCounters: Object)\n\t{\n\t\tthis.wrapper = document.getElementById(\"history-items\");\n\n\t\tthis.checkCounters(allCounters);\n\t\tthis.reload();\n\n\t\tthis.viewDesktopUser();\n\t\tthis.initPopup();\n\t}\n\n\tcheckCounters(allCounters: Object): void\n\t{\n\t\tfor (let counterId of Object.keys(allCounters))\n\t\t{\n\t\t\tlet key = counterId;\n\t\t\tif (counterId === '**') {\n\t\t\t\tkey = 'live-feed';\n\t\t\t}\n\t\t\tthis.allCounters[key] = allCounters[counterId];\n\t\t}\n\t}\n\n\tgetSumCounters(): number\n\t{\n\t\tlet sum = 0;\n\t\tfor (const counterId of Object.keys(this.allCounters))\n\t\t{\n\t\t\tif (counterId === 'tasks_effective' || counterId === 'invited_users')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst val = this.allCounters[counterId] ? parseInt(this.allCounters[counterId], 10) : 0;\n\t\t\tsum += val;\n\t\t}\n\n\t\treturn sum;\n\t}\n\n\treload(): void\n\t{\n\t\tconst currentUserId = Loc.getMessage('USER_ID');\n\t\tthis.accounts = ('undefined' !== typeof BXDesktopSystem) ? DesktopApi.getAccountList() : [];\n\t\tthis.currentUser = this.accounts.find((account) => account.id === currentUserId && account.portal === location.hostname);\n\n\t\tthis.viewPopupAccounts();\n\t}\n\n\tinitPopup(): void\n\t{\n\t\tconst userNode = document.querySelector('.intranet__desktop-menu_user-block');\n\t\tthis.popup = new Popup({\n\t\t\tcontent: document.querySelector('.intranet__desktop-menu_popup'),\n\t\t\tbindElement: userNode,\n\t\t\twidth: 320,\n\t\t\tbackground: '#282e39',\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t});\n\n\t\tEvent.bind(userNode, 'click', () => {\n\t\t\tif (this.popup.isShown())\n\t\t\t{\n\t\t\t\tthis.popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.popup.show();\n\t\t\t\tthis.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetCounters(counters: Object): void\n\t{\n\t\tlet newCounters = counters;\n\t\tif (counters['data'])\n\t\t{\n\t\t\tnewCounters = counters.data;\n\t\t\tif (newCounters[0] && typeof newCounters[0] === 'object')\n\t\t\t{\n\t\t\t\tnewCounters = newCounters[0];\n\t\t\t}\n\t\t}\n\n\t\tfor (let counterId of Object.keys(newCounters))\n\t\t{\n\t\t\tlet cId = counterId\n\t\t\tif (counterId === '**') {\n\t\t\t\tcId = 'live-feed';\n\t\t\t}\n\t\t\tthis.allCounters[cId] = newCounters[counterId];\n\t\t}\n\n\t\tconst sumCounters = this.getSumCounters();\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_user-block')[0];\n\t\tconst counterNode = block.querySelector('[data-role=\"counter\"]');\n\t\tif (sumCounters > 0)\n\t\t{\n\t\t\tcounterNode.innerHTML = sumCounters > 99 ? '99+' : sumCounters;\n\t\t\tif (!Dom.hasClass(block, 'intranet__desktop-menu_item_counters'))\n\t\t\t{\n\t\t\t\tDom.addClass(block, 'intranet__desktop-menu_item_counters');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcounterNode.innerHTML = '';\n\t\t\tDom.addClass(block, 'intranet__desktop-menu_item_counters');\n\t\t}\n\t}\n\n\tremoveElements(className: string): void\n\t{\n\t\tconst elements = document.getElementsByClassName(className);\n\n\t\t[...elements].forEach(element => {\n\t\t\telement.remove();\n\t\t});\n\t}\n\n\tviewDesktopUser(): void\n\t{\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_user')[0];\n\t\tconst counters = this.getSumCounters();\n\t\tconst countersView = counters > 99 ? '99+' : counters;\n\t\tthis.removeElements('intranet__desktop-menu_user-block');\n\n\t\tlet userData = Tag.render`<div class=\"intranet__desktop-menu_user-block ${ counters > 0 ? 'intranet__desktop-menu_item_counters' : ''}\">\n\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-desktop\">\n\t\t\t\t\t<i></i>\n\t\t\t\t\t<div class=\"intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger\">\n\t\t\t\t\t\t<div class=\"ui-counter-inner\" data-role=\"counter\">${countersView}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"intranet__desktop-menu_user-inner\">\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-name\">${this.currentUser.portal}</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-post\">${this.currentUser.work_position}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\n\t\tDom.append(userData, block);\n\n\t\tconst avatar = document.getElementsByClassName('ui-icon-common-user-desktop')[0];\n\t\tconst previewImage = this.getAvatarUrl(this.currentUser);\n\t\tDom.style(avatar, '--ui-icon-service-bg-image', previewImage);\n\t}\n\n\tgetAvatarUrl(account): string\n\t{\n\t\tlet avatarUrl = '';\n\t\tif (account.avatar.includes('http://') || account.avatar.includes('https://'))\n\t\t{\n\t\t\tavatarUrl = account.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarUrl = account.protocol + '://' + account.portal + account.avatar;\n\t\t}\n\n\t\treturn `url('${BX.util.htmlspecialchars(account.avatar === Account.defaultAvatar ? Account.defaultAvatarDesctop : BX.util.htmlspecialchars(avatarUrl))}')`;\n\t}\n\n\tviewPopupAccounts(): void\n\t{\n\t\tconst menuPopup = document.getElementsByClassName('intranet__desktop-menu_popup')[0];\n\t\tlet position = '';\n\t\tif (this.currentUser.work_position !== '')\n\t\t{\n\t\t\tposition = `<span class=\"intranet__desktop-menu_popup-post\">${this.currentUser.work_position}</span>`;\n\t\t}\n\n\t\tthis.removeElements('intranet__desktop-menu_popup-header');\n\n\t\tlet item = Tag.render`<div class=\"intranet__desktop-menu_popup-header\">\n\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-popup\">\n\t\t\t\t<i></i>\n\t\t\t</span>\n\t\t\t<span class=\"intranet__desktop-menu_popup-label\">${this.currentUser.portal}</span>\n\t\t\t<div class=\"intranet__desktop-menu_popup-header-user\">\n\t\t\t\t<span class=\"intranet__desktop-menu_popup-name\">${this.currentUser.first_name + ' ' + this.currentUser.last_name}</span>\n\t\t\t\t${position}\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tDom.insertBefore(item, menuPopup.firstElementChild);\n\n\t\tconst avatar = document.getElementsByClassName('ui-icon-common-user-popup')[0];\n\t\tconst previewImage = this.getAvatarUrl(this.currentUser);\n\t\tDom.style(avatar, '--ui-icon-service-bg-image', previewImage);\n\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_popup-list')[0];\n\n\t\tthis.removeElements('intranet__desktop-menu_popup-item-account');\n\n\t\tlet index = 0;\n\t\tfor (let account of this.accounts)\n\t\t{\n\t\t\tlet currentUserClass = '';\n\t\t\tlet counters = 0;\n\t\t\tif (account.id === this.currentUser.id && account.portal === this.currentUser.portal)\n\t\t\t{\n\t\t\t\tcounters = this.getSumCounters();\n\t\t\t\tcurrentUserClass = '--selected';\n\t\t\t}\n\t\t\tconst countersView = counters > 99 ? '99+' : counters;\n\n\t\t\tlet item = Tag.render`<li class=\"intranet__desktop-menu_popup-item intranet__desktop-menu_popup-item-account ${ counters > 0 ? 'intranet__desktop-menu_item_counters' : ''} ${currentUserClass}\">\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-${index}\">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t<div class=\"intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger\">\n\t\t\t\t\t\t\t<div class=\"ui-counter-inner\">${countersView}</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-user\">\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-name\">${account.portal}</span>\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-post\">${account.login}</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-btn ui-icon-set --more\" id=\"ui-icon-set-${index}\"></span>\n\t\t\t\t</li>`;\n\n\t\t\tDom.insertBefore(item, block.children[index]);\n\n\t\t\tthis.addContextMenu(account, index);\n\n\t\t\tlet userAvatar = document.getElementsByClassName('ui-icon-common-user-' + index)[0];\n\t\t\tlet previewUserImage = this.getAvatarUrl(account);\n\t\t\tDom.style(userAvatar, '--ui-icon-service-bg-image', previewUserImage);\n\n\t\t\tindex++;\n\t\t}\n\t}\n\n\taddContextMenu(account: DesktopAccount, index: number): void\n\t{\n\t\tconst button = document.getElementById(`ui-icon-set-${index}`);\n\t\tconst popup = this.popup;\n\t\tconst contextPopup = this.contextPopup;\n\t\tif (contextPopup[index])\n\t\t{\n\t\t\tcontextPopup[index].destroy();\n\t\t}\n\t\tcontextPopup[index] = new Menu({\n\t\t\tbindElement: button,\n\t\t\tclassName: 'intranet__desktop-menu_context',\n\t\t\titems: [\n\t\t\t\taccount.id === this.currentUser.id && account.portal === this.currentUser.portal ?\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_DISCONNECT'),\n\t\t\t\t\t\tonclick: function(event, item) {\n\t\t\t\t\t\t\tconst { host } = account;\n\t\t\t\t\t\t\tBXDesktopSystem?.AccountDisconnect(host);\n\t\t\t\t\t\t\tif (contextPopup[index])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcontextPopup[index].close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t\t:\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_CONNECT'),\n\t\t\t\t\t\tonclick: function(event, item) {\n\t\t\t\t\t\t\tconst { host, login, protocol } = account;\n\t\t\t\t\t\t\tconst userLang = navigator.language;\n\t\t\t\t\t\t\tDesktopApi.connectAccount(host, login, protocol, userLang);\n\t\t\t\t\t\t\tif (contextPopup[index])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcontextPopup[index].close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_REMOVE'),\n\t\t\t\t\tonclick: async function(event, item) {\n\t\t\t\t\t\tconst userChoice = await showDesktopDeleteConfirm();\n\t\t\t\t\t\tif (userChoice === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { host, login } = account;\n\t\t\t\t\t\t\tDesktopApi.deleteAccount(host, login);\n\n\t\t\t\t\t\t\tPopupManager.getPopupById(PopupType.userProfile)?.close();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (contextPopup[index])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontextPopup[index].close();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tEvent.bind(button, 'click', (event) => {\n\t\t\tconst index: number = parseInt(event.target.id.replace('ui-icon-set-', ''));\n\t\t\tif (contextPopup[index])\n\t\t\t{\n\t\t\t\tcontextPopup[index].show();\n\t\t\t}\n\t\t});\n\t}\n\n\topenLoginTab(): void\n\t{\n\t\tDesktopApi.openAddAccountTab();\n\t}\n}","import { Dom, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nexport default class Theme\n{\n\tbackgroundNode: Element = null;\n\n\tconstructor() {\n\t\tconst theme: any = this.#getThemePicker()?.getAppliedTheme();\n\t\tthis.backgroundNode = document.querySelector('body');\n\n\t\tif (theme)\n\t\t{\n\t\t\tthis.#applyTheme(theme);\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Intranet.Bitrix24:ThemePicker:onThemeApply',\n\t\t\t(event) => {\n\t\t\t\tthis.#applyTheme(event.data.theme);\n\t\t\t},\n\t\t);\n\t}\n\n\t#getThemePicker(): ?BX.Intranet.Bitrix24.ThemePicker\n\t{\n\t\treturn BX.Intranet?.Bitrix24?.ThemePicker.Singleton ?? top.BX.Intranet?.Bitrix24?.ThemePicker.Singleton;\n\t}\n\n\t#applyTheme(theme: any): void\n\t{\n\t\ttheme.video ? this.#applyVideoTheme(theme) : this.#applyPictureTheme(theme);\n\n\t\tDom.removeClass(this.backgroundNode, 'bitrix24-theme-default bitrix24-theme-dark bitrix24-theme-light');\n\t\tlet themeClass = 'bitrix24-theme-default';\n\n\t\tif (theme.id !== 'default' && String(theme.id).indexOf('default:') !== 0)\n\t\t{\n\t\t\tthemeClass = String(theme.id).indexOf('dark:') === 0 ? 'bitrix24-theme-dark' : 'bitrix24-theme-light';\n\t\t}\n\n\t\tDom.addClass(this.backgroundNode, themeClass);\n\t}\n\n\t#applyPictureTheme(theme: any): void\n\t{\n\t\tlet bgImage = theme.previewImage;\n\t\tif (Type.isArrayFilled(theme.prefetchImages))\n\t\t{\n\t\t\tbgImage = theme.prefetchImages[theme.prefetchImages.length - 1];\n\t\t}\n\t\tconst imageUrl = `url('${Text.encode(bgImage)}')`;\n\t\tDom.style(this.backgroundNode, 'backgroundImage', imageUrl);\n\t}\n\n\t#applyVideoTheme(theme: any): void\n\t{\n\t\tconst sources = [];\n\t\tfor (let type in theme.video.sources)\n\t\t{\n\t\t\tsources.push(BX.create('source', {\n\t\t\t\tattrs: {\n\t\t\t\t\ttype: `video/${type}`,\n\t\t\t\t\tsrc: theme.video.sources[type],\n\t\t\t\t},\n\t\t\t}));\n\t\t}\n\n\t\tconst video = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'theme-video-container',\n\t\t\t},\n\t\t\tdataset: {\n\t\t\t\tthemeId: theme.id,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('video', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'theme-video',\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tposter: theme.video.poster,\n\t\t\t\t\t\tautoplay: true,\n\t\t\t\t\t\tloop: true,\n\t\t\t\t\t\tmuted: true,\n\t\t\t\t\t\tplaysinline: true,\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tthemeId: theme.id,\n\t\t\t\t\t},\n\t\t\t\t\tchildren: sources,\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tDom.prepend(video, this.backgroundNode);\n\t}\n}","export default class Counters\n{\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-main\", (command,params) => {\n\t\t\tconst key = 'SITE_ID';\n\t\t\tconst siteId = BX.message(key);\n\t\t\tif (command === \"user_counter\" && params[siteId])\n\t\t\t{\n\t\t\t\tlet counters = BX.clone(params[siteId]);\n\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(\"onPullEvent-tasks\", (command, params) => {\n\t\t\tif (\n\t\t\t\tcommand === \"user_counter\"\n\t\t\t\t&& Number(params.userId) === Number(BX.Loc.getMessage('USER_ID'))\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet counters = {};\n\t\t\t\tif (!BX.Type.isUndefined(params.projects_major))\n\t\t\t\t{\n\t\t\t\t\tcounters.projects_major = params.projects_major;\n\t\t\t\t}\n\t\t\t\tif (!BX.Type.isUndefined(params.scrum_total_comments))\n\t\t\t\t{\n\t\t\t\t\tcounters.scrum_total_comments = params.scrum_total_comments;\n\t\t\t\t}\n\n\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(window, \"onImUpdateCounter\", (counters) => {\n\n\t\t\tif (!counters)\n\t\t\t\treturn;\n\n\t\t\tthis.updateCounters(BX.clone(counters), false);\n\t\t});\n\n\t\tBX.addCustomEvent(\"onImUpdateCounterMessage\",(counter) => {\n\t\t\tthis.updateCounters({'im-message': counter}, false);\n\t\t});\n\n\t\tif (BX.browser.SupportLocalStorage())\n\t\t{\n\t\t\tBX.addCustomEvent(window, 'onLocalStorageSet', (params) =>\n\t\t\t{\n\t\t\t\tif (params.key.substring(0, 4) === 'lmc-')\n\t\t\t\t{\n\t\t\t\t\tlet counters = {};\n\t\t\t\t\tcounters[params.key.substring(4)] = params.value;\n\t\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tBX.addCustomEvent(\"onCounterDecrement\", (iDecrement) => {\n\t\t\tthis.decrementCounter(BX(\"menu-counter-live-feed\"), iDecrement)\n\t\t});\n\t}\n\n\tupdateCounters(counters, send)\n\t{\n\t\tBX.ready(function ()\n\t\t{\n\t\t\tif (BX.getClass(\"BX.Intranet.DescktopLeftMenu\"))\n\t\t\t{\n\t\t\t\tBX.Intranet.DescktopLeftMenu.updateCounters(counters, send);\n\t\t\t}\n\t\t});\n\t}\n\n\tdecrementCounter(node, iDecrement)\n\t{\n\t\tBX.ready(function ()\n\t\t{\n\t\t\tif (BX.getClass(\"BX.Intranet.DescktopLeftMenu\"))\n\t\t\t{\n\t\t\t\tBX.Intranet.DescktopLeftMenu.decrementCounter(node, iDecrement);\n\t\t\t}\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\n\nexport default class Item\n{\n\tparentContainer: Element;\n\tcontainer: Element;\n\n\tconstructor(parentContainer, container)\n\t{\n\t\tthis.parentContainer = parentContainer;\n\t\tthis.container = container;\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.makeTextIcons();\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.container.dataset.id;\n\t}\n\n\tgetCode(): string\n\t{\n\t\treturn this.constructor.code;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.container.querySelector(\"[data-role='item-text']\").textContent;\n\t}\n\n\tstatic detect(node: Element)\n\t{\n\t\treturn node.getAttribute(\"data-role\") !== 'group' &&\n\t\t\tnode.getAttribute(\"data-type\") === this.code;\n\t}\n\n\tmakeTextIcons(): void\n\t{\n\t\tif (!this.container.classList.contains(\"menu-item-no-icon-state\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst icon = this.container.querySelector(\".menu-item-icon\");\n\t\tconst text = this.container.querySelector(\".menu-item-link-text\");\n\n\t\tif (icon && text)\n\t\t{\n\t\t\ticon.textContent = this.getShortName(text.textContent);\n\t\t}\n\t}\n\n\tgetCounterValue(): ?number\n\t{\n\t\tconst node = this.container.querySelector('[data-role=\"counter\"]');\n\t\tif (!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn parseInt(node.dataset.counterValue);\n\t}\n\n\tupdateCounter(counterValue): undefined|Object\n\t{\n\t\tconst node = this.container.querySelector('[data-role=\"counter\"]');\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst oldValue = parseInt(node.dataset.counterValue) || 0;\n\t\tnode.dataset.counterValue = counterValue;\n\n\t\tif (counterValue > 0)\n\t\t{\n\t\t\tnode.innerHTML = (counterValue > 99 ? '99+' : counterValue);\n\t\t\tthis.container.classList.add('intranet__desktop-menu_item_counters');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnode.innerHTML = '';\n\t\t\tthis.container.classList.remove('menu-item-with-index');\n\t\t}\n\n\t\treturn {oldValue, newValue: counterValue};\n\t}\n\n\tgetShortName(name): string\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\treturn \"...\";\n\t\t}\n\n\t\tname = name.replace(/['`\".,:;~|{}*^$#@&+\\-=?!()[\\]<>\\n\\r]+/g, \"\").trim();\n\t\tif (name.length <= 0)\n\t\t{\n\t\t\treturn '...';\n\t\t}\n\n\t\tlet shortName;\n\t\tlet words = name.split(/[\\s,]+/);\n\t\tif (words.length <= 1)\n\t\t{\n\t\t\tshortName = name.substring(0, 1);\n\t\t}\n\t\telse if (words.length === 2)\n\t\t{\n\t\t\tshortName = words[0].substring(0, 1) + words[1].substring(0, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet firstWord = words[0];\n\t\t\tlet secondWord = words[1];\n\n\t\t\tfor (let i = 1; i < words.length; i++)\n\t\t\t{\n\t\t\t\tif (words[i].length > 3)\n\t\t\t\t{\n\t\t\t\t\tsecondWord = words[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshortName = firstWord.substring(0, 1) + secondWord.substring(0, 1);\n\t\t}\n\n\t\treturn shortName.toUpperCase();\n\t}\n}","import Item from './item';\n\nexport default class ItemAdminShared extends Item\n{\n\tstatic code = 'admin';\n}","import Item from './item';\n\nexport default class ItemAdminShared extends Item\n{\n\tstatic code = 'custom';\n}","import Item from './item';\n\nexport default class ItemUserFavorites extends Item\n{\n\tstatic code = 'standard';\n}","import Item from './item';\n\nexport default class ItemUserSelf extends Item\n{\n\tstatic code = 'self';\n}","import Item from './item';\n\nexport default class ItemSystem extends Item\n{\n\tstatic code = 'default';\n}","import Item from './item';\nimport ItemAdminShared from './item-admin-shared';\nimport ItemAdminCustom from './item-admin-custom';\nimport ItemUserFavorites from './item-user-favorites';\nimport ItemUserSelf from './item-user-self';\nimport ItemSystem from './item-system';\n\nconst itemMappings = [\n\tItem,\n\tItemAdminShared,\n\tItemUserFavorites,\n\tItemAdminCustom,\n\tItemUserSelf,\n\tItemSystem,\n];\n\nexport default function getItem(itemData: Element): Item\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.detect(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn itemClassName;\n}","import getItem from '../items';\nimport Item from '../items/item';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport default class ItemsController\n{\n\tparentContainer: Element;\n\tcontainer: Element;\n\titems: Map = new Map();\n\t#updateCountersLastValue = null\n\n\tconstructor(container: Element)\n\t{\n\t\tthis.parentContainer = container;\n\t\tthis.container = container.querySelector(\".menu-items\");\n\n\t\tcontainer\n\t\t\t.querySelectorAll('li.menu-item-block')\n\t\t\t.forEach(this.registerItem.bind(this))\n\t\t;\n\t}\n\n\tregisterItem(node: Element): Item\n\t{\n\t\tconst itemClass = getItem(node);\n\t\tconst item = new itemClass(this.container, node);\n\t\tthis.items.set(item.getId(), item);\n\n\t\treturn item;\n\t}\n\n\tupdateCounters(counters: Object, send: boolean): void\n\t{\n\t\tlet countersDynamic = null;\n\t\tsend = send !== false;\n\t\t[...Object.entries(counters)]\n\t\t\t.forEach(([counterId, counterValue]) => {\n\t\t\t\t[...this.#getItemsByCounterId(counterId)]\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\tconst {oldValue, newValue} = item.updateCounter(counterValue);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(counterId.indexOf('crm_') < 0 || counterId.indexOf('crm_all') >= 0)\n\t\t\t\t\t\t\t&&\n\t\t\t\t\t\t\t(counterId.indexOf('tasks_') < 0 || counterId.indexOf('tasks_total') >= 0)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcountersDynamic = countersDynamic || 0;\n\t\t\t\t\t\t\tcountersDynamic+= (newValue - oldValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\tif (send)\n\t\t\t\t{\n\t\t\t\t\tBX.localStorage.set('lmc-' + counterId, counterValue, 5);\n\t\t\t\t}\n\n\t\t\t\tif (typeof BXIM !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (this.#updateCountersLastValue === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#updateCountersLastValue = 0;\n\t\t\t\t\t\t[...this.items.entries()]\n\t\t\t\t\t\t\t.forEach(([id, item]) => {\n\t\t\t\t\t\t\t\tconst res = item.getCounterValue();\n\n\t\t\t\t\t\t\t\tif (res > 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlet counterId = 'doesNotMatter';\n\t\t\t\t\t\t\t\t\tif (id.indexOf('menu_crm') >= 0 || id.indexOf('menu_tasks') >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst counterNode = item.container.querySelector('[data-role=\"counter\"]');\n\t\t\t\t\t\t\t\t\t\tif (counterNode)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tcounterId = counterNode.id;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tcounterId === 'doesNotMatter'\n\t\t\t\t\t\t\t\t\t\t|| counterId.indexOf('crm_all') >= 0\n\t\t\t\t\t\t\t\t\t\t|| counterId.indexOf('tasks_total') >= 0\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#updateCountersLastValue += res;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#updateCountersLastValue += (countersDynamic !== null ? countersDynamic : 0);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst visibleValue = (this.#updateCountersLastValue > 99 ? '99+' : (\n\t\t\t\t\t\tthis.#updateCountersLastValue < 0 ? '0' : this.#updateCountersLastValue\n\t\t\t\t\t));\n\n\t\t\t\t\tif (DesktopApi.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tDesktopApi.setBrowserIconBadge(visibleValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t}\n\n\t#getItemsByCounterId(counterId: string): []\n\t{\n\t\tconst result = [];\n\t\t[...this.items.values()]\n\t\t\t.forEach((item: Item) => {\n\t\t\t\tconst node = item.container.querySelector('[data-role=\"counter\"]');\n\t\t\t\tif (node && node.id.indexOf(counterId) >= 0)\n\t\t\t\t{\n\t\t\t\t\tresult.push(item);\n\t\t\t\t}\n\t\t\t});\n\t\treturn result;\n\t}\n\n\tdecrementCounter(counters: Object): void\n\t{\n\t\t[...Object.entries(counters)]\n\t\t\t.forEach(([counterId, counterValue]) => {\n\t\t\t\tconst item = this.#getItemsByCounterId(counterId).shift();\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\tconst value = item.getCounterValue();\n\t\t\t\t\tcounters[counterId] = value > counterValue ? (value - counterValue) : 0;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdelete counters[counterId];\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t\tthis.updateCounters(counters, false);\n\t}\n}","import {Tag, Type, Text } from 'main.core';\n\nexport class BrowserHistory\n{\n\twrapper: HTMLElement;\n\tisAir: boolean = false;\n\titems = [];\n\n\tconstructor(isAir: boolean)\n\t{\n\t\tthis.isAir = isAir;\n\t\tthis.wrapper = document.getElementById(\"history-items\");\n\t}\n\n\tinit(): void\n\t{\n\t\tif ('object' != typeof BXDesktopSystem)\n\t\t{\n\t\t\tconsole.log('BXDesktopSystem is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = BXDesktopSystem?.BrowserHistory();\n\n\t\tthis.showHistory();\n\t}\n\n\tshowHistory(): void\n\t{\n\t\tlet i = 0;\n\t\tthis.items.forEach((item) => {\n\t\t\tif (i > 15) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tlet icoName = '';\n\t\t\tlet title = '';\n\t\t\tif (Type.isStringFilled(item.title))\n\t\t\t{\n\t\t\t\ticoName = this.getShortName(Text.encode(item.title));\n\t\t\t\ttitle = Text.encode(item.title);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (item.url.includes('/desktop_app/'))\n\t\t\t\t{\n\t\t\t\t\ticoName = Loc.getMessage('MENU_HISTORY_ITEM_ICON');\n\t\t\t\t\ttitle = Loc.getMessage('MENU_HISTORY_ITEM_NAME');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.url.includes('/desktop/menu'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet url = Text.encode(item.url);\n\t\t\tif (!this.isAir && item.url.includes('/online/'))\n\t\t\t{\n\t\t\t\turl = 'bx://v2/' + location.hostname + '/chat/';\n\t\t\t}\n\n\t\t\tlet li = Tag.render`\n\t\t\t\t<li class=\"intranet__desktop-menu_item\">\n\t\t\t\t\t<a class=\"intranet__desktop-menu_item-link\" href=\"${url}\">\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_item-icon --custom\">${icoName}</span>\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_item-title\">${title}</span>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`;\n\n\t\t\tthis.wrapper.appendChild(li);\n\t\t\ti++;\n\t\t});\n\t}\n\n\tgetShortName(name): string\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\treturn \"...\";\n\t\t}\n\n\t\tname = name.replace(/['`\".,:;~|{}*^$#@&+\\-=?!()[\\]<>\\n\\r]+/g, \"\").trim();\n\t\tif (name.length <= 0)\n\t\t{\n\t\t\treturn '...';\n\t\t}\n\n\t\tlet shortName;\n\t\tlet words = name.split(/[\\s,]+/);\n\t\tif (words.length <= 1)\n\t\t{\n\t\t\tshortName = name.substring(0, 1);\n\t\t}\n\t\telse if (words.length === 2)\n\t\t{\n\t\t\tshortName = words[0].substring(0, 1) + words[1].substring(0, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet firstWord = words[0];\n\t\t\tlet secondWord = words[1];\n\n\t\t\tfor (let i = 1; i < words.length; i++)\n\t\t\t{\n\t\t\t\tif (words[i].length > 3)\n\t\t\t\t{\n\t\t\t\t\tsecondWord = words[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshortName = firstWord.substring(0, 1) + secondWord.substring(0, 1);\n\t\t}\n\n\t\treturn shortName.toUpperCase();\n\t}\n\n}\n","import {Cache, Type, Loc} from 'main.core';\nimport { Account } from './account/account';\nimport Theme from './api/theme';\nimport Counters from './api/counters';\nimport ItemsController from './controllers/items-controller'\nimport { BrowserHistory } from './history/browser-history';\n\nexport default class DesktopMenu\n{\n\tcache = new Cache.MemoryCache();\n\tbrowserHistory = null;\n\taccount = null;\n\ttheme = null;\n\t#specialLiveFeedDecrement = 0;\n\n\tconstructor(allCounters: Object, isAir: boolean)\n\t{\n\t\tthis.menuContainer = document.getElementById(\"menu-items-block\");\n\t\tif (!this.menuContainer)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initTheme();\n\t\tthis.getItemsController();\n\t\tthis.getHistoryItems(isAir);\n\t\tthis.showAccount(allCounters);\n\t\tthis.runAPICounters();\n\t}\n\n\tinitTheme(): void\n\t{\n\t\tthis.theme = new Theme();\n\t}\n\n\tgetItemsController(): ItemsController\n\t{\n\t\treturn this.cache.remember('itemsMenuController', () => {\n\t\t\treturn new ItemsController(this.menuContainer);\n\t\t});\n\t}\n\n\tgetHistoryItems(isAir: boolean): void\n\t{\n\t\tthis.browserHistory = new BrowserHistory(isAir);\n\t\tthis.browserHistory.init();\n\t}\n\n\tshowAccount(allCounters): void\n\t{\n\t\tthis.account = new Account(allCounters);\n\t\tBX.Intranet.Account = this.account;\n\t}\n\n\trunAPICounters(): void\n\t{\n\t\tBX.Intranet.Counters = new Counters();\n\t\tBX.Intranet.Counters.init();\n\t}\n\n\tdecrementCounter(node, iDecrement): void\n\t{\n\t\tif (!node || node.id !== 'menu-counter-live-feed')\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#specialLiveFeedDecrement += parseInt(iDecrement);\n\t\tthis.getItemsController().decrementCounter({\n\t\t\t'live-feed' : parseInt(iDecrement)\n\t\t});\n\t}\n\n\tupdateCounters(counters, send): void\n\t{\n\t\tif (!counters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (counters['**'] !== undefined)\n\t\t{\n\t\t\tcounters['live-feed'] = counters['**'];\n\t\t\tdelete counters['**'];\n\t\t}\n\t\tlet workgroupsCounterUpdated = false;\n\t\tif (!Type.isUndefined(counters['**SG0']))\n\t\t{\n\t\t\tthis.workgroupsCounterData['livefeed'] = counters['**SG0'];\n\t\t\tdelete counters['**SG0'];\n\t\t\tworkgroupsCounterUpdated = true;\n\t\t}\n\n\t\tif (!Type.isUndefined(counters[Loc.getMessage('COUNTER_PROJECTS_MAJOR')]))\n\t\t{\n\t\t\tthis.workgroupsCounterData[Loc.getMessage('COUNTER_PROJECTS_MAJOR')] = counters[Loc.getMessage('COUNTER_PROJECTS_MAJOR')];\n\t\t\tdelete counters[Loc.getMessage('COUNTER_PROJECTS_MAJOR')];\n\t\t\tworkgroupsCounterUpdated = true;\n\t\t}\n\n\t\tif (!Type.isUndefined(counters[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')]))\n\t\t{\n\t\t\tthis.workgroupsCounterData[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')] = counters[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')];\n\t\t\tdelete counters[Loc.getMessage('COUNTER_SCRUM_TOTAL_COMMENTS')];\n\t\t\tworkgroupsCounterUpdated = true;\n\t\t}\n\n\t\tif (workgroupsCounterUpdated)\n\t\t{\n\t\t\tcounters['workgroups'] = Object.entries(this.workgroupsCounterData).reduce((prevValue, [, curValue]) => {\n\t\t\t\treturn prevValue + Number(curValue);\n\t\t\t}, 0);\n\t\t}\n\n\t\tif (counters['live-feed'])\n\t\t{\n\t\t\tif (counters['live-feed'] <= 0)\n\t\t\t{\n\t\t\t\tthis.#specialLiveFeedDecrement = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcounters['live-feed'] -= this.#specialLiveFeedDecrement;\n\t\t\t}\n\t\t}\n\n\t\tthis.getItemsController().updateCounters(counters, send);\n\t\tBX.Intranet.Account.setCounters(counters);\n\t}\n}"],"names":["Account","constructor","allCounters","accounts","currentUser","contextPopup","popup","wrapper","document","getElementById","checkCounters","reload","viewDesktopUser","initPopup","counterId","Object","keys","key","getSumCounters","sum","val","parseInt","currentUserId","Loc","getMessage","BXDesktopSystem","DesktopApi","getAccountList","find","account","id","portal","location","hostname","viewPopupAccounts","userNode","querySelector","Popup","content","bindElement","width","background","closeIcon","closeByEsc","Event","bind","isShown","close","show","setCounters","counters","newCounters","data","cId","sumCounters","block","getElementsByClassName","counterNode","innerHTML","Dom","hasClass","addClass","removeElements","className","elements","forEach","element","remove","countersView","userData","Tag","render","work_position","append","avatar","previewImage","getAvatarUrl","style","avatarUrl","includes","protocol","BX","util","htmlspecialchars","defaultAvatar","defaultAvatarDesctop","menuPopup","position","item","first_name","last_name","insertBefore","firstElementChild","index","currentUserClass","login","children","addContextMenu","userAvatar","previewUserImage","button","destroy","Menu","items","text","onclick","event","host","AccountDisconnect","userLang","navigator","language","connectAccount","userChoice","showDesktopDeleteConfirm","deleteAccount","PopupManager","getPopupById","PopupType","userProfile","target","replace","openLoginTab","openAddAccountTab","Theme","backgroundNode","theme","getAppliedTheme","EventEmitter","subscribe","Intranet","Bitrix24","ThemePicker","Singleton","top","video","removeClass","themeClass","String","indexOf","bgImage","Type","isArrayFilled","prefetchImages","length","imageUrl","Text","encode","sources","type","push","create","attrs","src","props","dataset","themeId","poster","autoplay","loop","muted","playsinline","prepend","Counters","init","addCustomEvent","command","params","siteId","message","clone","updateCounters","Number","userId","isUndefined","projects_major","scrum_total_comments","window","counter","browser","SupportLocalStorage","substring","value","iDecrement","decrementCounter","send","ready","getClass","DescktopLeftMenu","node","Item","parentContainer","container","makeTextIcons","getId","getCode","code","getName","textContent","detect","getAttribute","classList","contains","icon","getShortName","getCounterValue","counterValue","updateCounter","oldValue","add","newValue","name","isStringFilled","trim","shortName","words","split","firstWord","secondWord","i","toUpperCase","ItemAdminShared","ItemUserFavorites","ItemUserSelf","ItemSystem","itemMappings","ItemAdminCustom","getItem","itemData","itemClassName","itemClass","ItemsController","Map","querySelectorAll","registerItem","set","countersDynamic","entries","localStorage","BXIM","res","visibleValue","isDesktop","setBrowserIconBadge","shift","result","values","BrowserHistory","isAir","console","log","showHistory","icoName","title","url","li","appendChild","DesktopMenu","cache","Cache","MemoryCache","browserHistory","menuContainer","initTheme","getItemsController","getHistoryItems","showAccount","runAPICounters","remember","undefined","workgroupsCounterUpdated","workgroupsCounterData","reduce","prevValue","curValue"],"mappings":"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"}