this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};this.BX.Intranet.Invitation=this.BX.Intranet.Invitation||{};(function(t,e,i){"use strict";let s=t=>t,n,a,o,r;class l{constructor(t){this.email=null;this.name=null;this.lastName=null;this.cache=new i.Cache.MemoryCache;const e=i.Type.isPlainObject(t)?t:{};if(i.Type.isStringFilled(e.email)){this.getEmailTextBox().value=e.email}if(i.Type.isStringFilled(e.name)){this.getNameTextBox().value=e.name}if(i.Type.isStringFilled(e.lastName)){this.getLastNameTextBox().value=e.lastName}}isEmpty(){const t=this.getEmailTextBox().value.trim();return!i.Type.isStringFilled(t)}validate(){const t=this.getEmail();const e=this.getName();const s=this.getLastName();if(i.Type.isStringFilled(t)){const e="=_0-9a-z+~'!$&*^`|\\#%/?{}-";const s=new RegExp("^["+e+"]+(\\.["+e+"]+)*@(([-0-9a-z]+\\.)+)([a-z0-9-]{2,20})$","i");if(!t.match(s)){i.Dom.addClass(this.getEmailTextBox().parentNode,"ui-ctl-danger");return false}}else if(i.Type.isStringFilled(e)||i.Type.isStringFilled(s)){i.Dom.addClass(this.getEmailTextBox().parentNode,"ui-ctl-danger");return false}i.Dom.removeClass(this.getEmailTextBox().parentNode,"ui-ctl-danger");return true}focus(){this.getEmailTextBox().focus()}getEmail(){return this.getEmailTextBox().value.trim()}getName(){return this.getNameTextBox().value.trim()}getLastName(){return this.getLastNameTextBox().value.trim()}getContainer(){return this.cache.remember("container",(()=>i.Tag.render(n||(n=s`
				<div class="invite-form-row">
					<div class="invite-form-col">
						<div class="ui-ctl-label-text">${0}</div>
						<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
							${0}
						</div>
					</div>
					<div class="invite-form-col">
						<div class="ui-ctl-label-text">${0}</div>
						<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
							${0}
						</div>
					</div>
					<div class="invite-form-col">
						<div class="ui-ctl-label-text">${0}</div>
						<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
							${0}
						</div>
					</div>
				</div>
			`),i.Loc.getMessage("INTRANET_INVITATION_GUEST_FIELD_EMAIL"),this.getEmailTextBox(),i.Loc.getMessage("INTRANET_INVITATION_GUEST_FIELD_NAME"),this.getNameTextBox(),i.Loc.getMessage("INTRANET_INVITATION_GUEST_FIELD_LAST_NAME"),this.getLastNameTextBox())))}getEmailTextBox(){return this.cache.remember("email",(()=>i.Tag.render(a||(a=s`
				<input 
					type="email"
					class="ui-ctl-element" 
					placeholder="${0}"
				>
			`),i.Loc.getMessage("INTRANET_INVITATION_GUEST_ENTER_EMAIL"))))}getNameTextBox(){return this.cache.remember("name",(()=>i.Tag.render(o||(o=s`
				<input 
					type="text"
					class="ui-ctl-element" 
				>
			`))))}getLastNameTextBox(){return this.cache.remember("last-name",(()=>i.Tag.render(r||(r=s`
				<input 
					type="text"
					class="ui-ctl-element"
				>
			`))))}}let c=t=>t,d,h,u;class m{constructor(t){this.targetNode=null;this.cache=new i.Cache.MemoryCache;this.saveButton=null;this.cancelButton=null;this.rows=[];this.error=null;this.userOptions={};const s=i.Type.isPlainObject(t)?t:{};this.targetNode=s.targetNode;this.userOptions=i.Type.isPlainObject(s.userOptions)?s.userOptions:{};i.Dom.append(this.getContainer(),this.targetNode);if(i.Type.isElementNode(s.saveButtonNode)){this.saveButton=e.ButtonManager.createFromNode(s.saveButtonNode);this.saveButton.bindEvent("click",this.handleSaveButtonClick.bind(this))}if(i.Type.isElementNode(s.cancelButtonNode)){this.cancelButton=e.ButtonManager.createFromNode(s.cancelButtonNode);this.cancelButton.bindEvent("click",this.handleCancelButtonClick.bind(this))}if(i.Type.isArrayFilled(s.rows)){s.rows.forEach((t=>{this.addRow(t)}));this.addRows(Math.max(2,5-s.rows.length));this.getRows()[0].focus()}else{this.addRows()}i.Runtime.loadExtension("ui.hint").then((()=>{const t=BX.UI.Hint.createInstance();const e=t.createNode(i.Loc.getMessage("INTRANET_INVITATION_GUEST_HINT"));const s=document.querySelector("#pagetitle")||this.getTitleContainer();i.Dom.append(e,s)}))}getRows(){return this.rows}lock(){i.Dom.style(this.getContainer(),"pointer-events","none")}unlock(){i.Dom.style(this.getContainer(),"pointer-events","none")}submit(){let t=true;const e=[];let s=null;this.getRows().forEach((i=>{if(!i.validate()){s=s||i;t=false}if(t&&!i.isEmpty()){e.push({email:i.getEmail(),name:i.getName(),lastName:i.getLastName()})}}));if(!t){return Promise.reject(new i.BaseError(i.Loc.getMessage("INTRANET_INVITATION_GUEST_WRONG_DATA"),"wrong_data",{invalidRow:s}))}else if(!i.Type.isArrayFilled(e)){return Promise.reject(new i.BaseError(i.Loc.getMessage("INTRANET_INVITATION_GUEST_EMPTY_DATA"),"empty_data",{invalidRow:this.getRows()[0]}))}return new Promise(((t,s)=>i.ajax.runComponentAction("bitrix:intranet.invitation.guest","addGuests",{mode:"class",json:{guests:e,userOptions:this.userOptions}}).then((e=>{t(e)}),(t=>{const e=t&&i.Type.isArrayFilled(t.errors)?t.errors.map((t=>i.Text.encode(t.message))).join("<br><br>"):"Server Response Error";s(new i.BaseError(e,"wrong_response"))}))))}getSaveButton(){return this.saveButton}getCancelButton(){return this.cancelButton}getContainer(){return this.cache.remember("container",(()=>i.Tag.render(d||(d=c`
				<div class="invite-wrap">
					${0}
					<div class="invite-content-container">
						${0}
					</div>
					<div class="invite-form-buttons">
						<button 
							class="ui-btn ui-btn-sm ui-btn-light-border ui-btn-icon-add ui-btn-round"
							onclick="${0}">${0}
						</button>
					</div>
				</div>
			`),this.getTitleContainer(),this.getRowsContainer(),this.handleAddMoreClick.bind(this),i.Loc.getMessage("INTRANET_INVITATION_GUEST_ADD_MORE"))))}getRowsContainer(){return this.cache.remember("rows-container",(()=>i.Tag.render(h||(h=c`
				<div class="invite-form-container"></div>
			`))))}getTitleContainer(){return this.cache.remember("title-container",(()=>i.Tag.render(u||(u=c`
				<div class="invite-title-container">
					<div class="invite-title-icon invite-title-icon-message"></div>
					<div class="invite-title-text">${0}</div>
				</div>
			`),i.Loc.getMessage("INTRANET_INVITATION_GUEST_TITLE"))))}addRow(t){const e=new l(t);this.rows.push(e);i.Dom.append(e.getContainer(),this.getRowsContainer());return e}addRows(t=5){Array(t).fill().forEach(((t,e)=>{const i=this.addRow();if(e===0){i.focus()}}))}removeRows(){this.getRows().forEach((t=>{i.Dom.remove(t.getContainer())}));this.rows=[]}showError(t){const e=this.error===null;this.hideError();this.error=new BX.UI.Alert({color:BX.UI.Alert.Color.DANGER,animated:e,text:t});i.Dom.prepend(this.error.getContainer(),this.getContainer())}hideError(){if(this.error!==null){i.Dom.remove(this.error.container);this.error=null}}handleSaveButtonClick(){if(this.getSaveButton().isWaiting()){return}this.getSaveButton().setWaiting();this.submit().then((t=>{this.getSaveButton().setWaiting(false);this.hideError();this.removeRows();this.addRows();BX.SidePanel.Instance.postMessageAll(window,"BX.Intranet.Invitation.Guest:onAdd",t.data);BX.SidePanel.Instance.close()})).catch((t=>{this.getSaveButton().setWaiting(false);this.showError(t.getMessage());if(t.getCustomData()&&t.getCustomData()["invalidRow"]){t.getCustomData()["invalidRow"].focus()}}))}handleCancelButtonClick(){BX.SidePanel.Instance.close()}handleAddMoreClick(){const t=this.addRow();t.focus()}}t.Form=m})(this.BX.Intranet.Invitation.Guest=this.BX.Intranet.Invitation.Guest||{},BX.UI,BX);
//# sourceMappingURL=script.map.js