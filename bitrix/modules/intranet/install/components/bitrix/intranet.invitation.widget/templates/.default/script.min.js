this.BX=this.BX||{};(function(e,t,i,s,n,a,r,o){"use strict";class l{static send(e){t.sendData({tool:l.TOOLS,category:l.CATEGORY_INVITATION,event:e,p1:l.isAdmin?"isAdmin_Y":"isAdmin_N"})}static sendCreateCollab(){t.sendData({tool:"im",category:"collab",event:"click_create_new",c_section:l.SECTION_POPUP,p2:"user_intranet"})}}l.TOOLS="headerPopup";l.TOOLS_LEGACY="Invitation";l.CATEGORY_INVITATION="invitation";l.CATEGORY_INVITATION_LEGACY="invitation";l.EVENT_NAME_LEGACY="drawer_open";l.SECTION_POPUP="headerPopup";l.EVENT_SHOW="show";l.EVENT_OPEN_SLIDER_INVITATION="drawer_open";l.EVENT_OPEN_STRUCTURE="vis_structure_open";l.EVENT_OPEN_USER_LIST="company_open";l.EVENT_OPEN_SLIDER_EXTRANET_INVITATION="extranetinvitation_open";l.isAdmin=false;class c extends a.EventEmitter{constructor(e){super();this.cache=new r.Cache.MemoryCache;this.setOptions(e);this.analytics=new l}setOptions(e){this.cache.set("options",{...e})}getOptions(){return this.cache.get("options",{})}getLayout(){throw new Error("Must be implemented in a child class")}showInfoHelper(e){BX.UI.InfoHelper.show(e);this.sendAnalytics(e)}sendAnalytics(e){r.ajax.runAction("intranet.invitationwidget.analyticsLabel",{data:{},analyticsLabel:{helperCode:e,headerPopup:"Y"}})}getHintPopup(e,t,i){return this.cache.remember(i,(()=>new n.Popup(`bx-hint-${r.Text.getRandom()}`,t,{content:e,className:"bx-invitation-warning",zIndex:15e3,angle:true,offsetTop:0,offsetLeft:40,closeIcon:false,autoHide:true,darkMode:true,overlay:false,maxWidth:300,events:{onShow:e=>{a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,"BX.Intranet.InvitationWidget.HintPopup:show",new a.BaseEvent({data:{popup:e.target}}));const t=setTimeout((()=>{e.target.close()}),4e3);a.EventEmitter.subscribeOnce(a.EventEmitter.GLOBAL_TARGET,"BX.Intranet.InvitationWidget.HintPopup:close",(()=>{clearTimeout(t)}))},onClose:()=>{a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,"BX.Intranet.InvitationWidget.HintPopup:close")}}})))}showHintPopup(e,t,i){this.getHintPopup(e,t,i).toggle()}showInvitationPlace(e,t,i){if(this.getOptions().isAdmin){this.showInvitationSlider(i)}else{if(this.getOptions().isInvitationAvailable){this.showInvitationSlider(i)}else{this.showHintPopup(e,t,"hint-"+i)}}}showInvitationSlider(e){let t=this.getOptions().invitationLink;if(e==="extranet"){t=`${t}&firstInvitationBlock=extranet`;l.send(l.EVENT_OPEN_SLIDER_EXTRANET_INVITATION)}else{l.send(l.EVENT_OPEN_SLIDER_INVITATION)}BX.SidePanel.Instance.open(t,{cacheable:false,allowChangeHistory:false,width:1100})}getConfig(){return{html:this.getLayout()}}}let d=e=>e,v;class u extends c{constructor(e){super(e);this.setEventNamespace("BX.Intranet.InvitationWidget.InvitationContent");this.setOptions(e)}getConfig(){return{html:this.getLayout(),backgroundColor:"#14bfd5"}}getLayout(){return this.cache.remember("layout",(()=>{const e=e=>{e.stopPropagation();this.showInvitationPlace(r.Loc.getMessage("INTRANET_INVITATION_WIDGET_DISABLED_TEXT"),e.target,"default-invitation")};const t=()=>{this.showInfoHelper("limit_why_team_invites")};return r.Tag.render(v||(v=d`
				<div class="intranet-invitation-widget-invite">
					<div class="intranet-invitation-widget-invite-main">
						<div class="intranet-invitation-widget-inner">
							<div class="intranet-invitation-widget-content">
								<div class="intranet-invitation-widget-item-icon intranet-invitation-widget-item-icon--invite"></div>
								<div class="intranet-invitation-widget-item-content">
									<div class="intranet-invitation-widget-item-name">
										<span>
											${0}
										</span>
									</div>
									<div class="intranet-invitation-widget-item-link">
										<span onclick="${0}" class="intranet-invitation-widget-item-link-text">
											${0}
										</span>
									</div>
								</div>
							</div>
							<a onclick="${0}" class="intranet-invitation-widget-item-btn intranet-invitation-widget-item-btn--invite"> 
								${0}
							</a>
						</div>
					</div>
				</div>
			`),r.Loc.getMessage("INTRANET_INVITATION_WIDGET_INVITE_EMPLOYEE"),t,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_DESC"),e,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_INVITE"))}))}}let p=e=>e,h;var g=babelHelpers.classPrivateFieldLooseKey("getCounterWrapper");var b=babelHelpers.classPrivateFieldLooseKey("showCounter");var m=babelHelpers.classPrivateFieldLooseKey("getCounter");var E=babelHelpers.classPrivateFieldLooseKey("getCounterValue");var L=babelHelpers.classPrivateFieldLooseKey("onFirstWatchNewStructure");class I extends c{constructor(e){super(e);Object.defineProperty(this,L,{value:N});Object.defineProperty(this,E,{value:w});Object.defineProperty(this,m,{value:O});Object.defineProperty(this,b,{value:P});Object.defineProperty(this,g,{value:T});this.setEventNamespace("BX.Intranet.InvitationWidget.StructureContent")}getConfig(){babelHelpers.classPrivateFieldLooseBase(this,b)[b]();if(this.getOptions().shouldShowStructureCounter){a.EventEmitter.subscribeOnce("HR.company-structure:first-popup-showed",babelHelpers.classPrivateFieldLooseBase(this,L)[L].bind(this))}return{html:this.getLayout(),flex:3}}getLayout(){return this.cache.remember("layout",(()=>{const e=()=>{l.send(l.EVENT_OPEN_STRUCTURE)};return r.Tag.render(h||(h=p`
				<div class="intranet-invitation-widget-item intranet-invitation-widget-item--company intranet-invitation-widget-item--active">
					<div class="intranet-invitation-widget-item-logo"></div>
					<div class="intranet-invitation-widget-item-content">
						<div class="intranet-invitation-widget-item-name">
							<span>
								${0}
							</span>
						</div>
						<a onclick="${0}" href="${0}" class="intranet-invitation-widget-item-btn"> 
							${0}
						</a>
					</div>
				</div>
			`),r.Loc.getMessage("INTRANET_INVITATION_WIDGET_STRUCTURE"),e,this.getOptions().link,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_EDIT"))}))}}function T(){return this.cache.remember("counter-wrapper",(()=>this.getLayout().querySelector(".intranet-invitation-widget-item-name")))}function P(){if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]()>0){r.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,m)[m]().getContainer(),"invitation-structure-counter");babelHelpers.classPrivateFieldLooseBase(this,m)[m]().renderTo(babelHelpers.classPrivateFieldLooseBase(this,g)[g]())}}function O(){return this.cache.remember("counter",(()=>new s.Counter({value:babelHelpers.classPrivateFieldLooseBase(this,E)[E](),color:s.Counter.Color.DANGER})))}function w(){return this.getOptions().shouldShowStructureCounter?1:0}function N(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]().value;if(!r.Type.isNumber(e)){return}if(!this.getOptions().shouldShowStructureCounter){return}this.getOptions().shouldShowStructureCounter=false;babelHelpers.classPrivateFieldLooseBase(this,m)[m]().destroy();this.cache.delete("counter")}let C=e=>e,B,_,y;var f=babelHelpers.classPrivateFieldLooseKey("rightType");var A=babelHelpers.classPrivateFieldLooseKey("showCounter");var H=babelHelpers.classPrivateFieldLooseKey("onReceiveCounterValue");var F=babelHelpers.classPrivateFieldLooseKey("getCounter");var S=babelHelpers.classPrivateFieldLooseKey("getCounterWrapper");class R extends c{constructor(e){super(e);Object.defineProperty(this,S,{value:M});Object.defineProperty(this,F,{value:x});Object.defineProperty(this,H,{value:G});Object.defineProperty(this,A,{value:D});Object.defineProperty(this,f,{writable:true,value:void 0});this.setEventNamespace("BX.Intranet.InvitationWidget.EmployeesContent")}getConfig(){return{html:this.getOptions().awaitData.then((e=>{this.setOptions({...e.data.users,...this.getOptions()});babelHelpers.classPrivateFieldLooseBase(this,A)[A]();return this.getLayout()})),flex:5,sizeLoader:55}}getLayout(){return this.cache.remember("layout",(()=>r.Tag.render(B||(B=C`
				<div class="intranet-invitation-widget-item intranet-invitation-widget-item--emp ${0}">
					<div class="intranet-invitation-widget-inner">
						<div class="intranet-invitation-widget-content">
							<div class="intranet-invitation-widget-item-content">
								<div onclick="${0}" class="intranet-invitation-widget-item-progress ${0}"/>
								<div class="intranet-invitation-widget-employees">
									<div onclick="${0}" class="intranet-invitation-widget-item-name">
										<span style="margin-right: 2px;">
											${0}
										</span>
									</div>
									<div onclick="${0}" class="intranet-invitation-widget-item-num">
										${0}
									</div>
								</div>
							</div>
							${0}
							${0}
						</div>
					</div>
				</div>
			`),this.getOptions().isLimit?"intranet-invitation-widget-item--emp-alert":null,this.showUserList(),this.getOptions().isLimit?"intranet-invitation-widget-item-progress--crit":"intranet-invitation-widget-item-progress--full",this.showUserList(),r.Loc.getMessage("INTRANET_INVITATION_WIDGET_EMPLOYEES"),this.showUserList(),this.getOptions().currentUserCountMessage,this.getDetail(),this.getOptions().isAdmin?this.getSelectorRights():null)))}getDetail(){return this.cache.remember("detail",(()=>{let e="";if(Number(this.getOptions().maxUserCount)===0){e=r.Loc.getMessage("INTRANET_INVITATION_WIDGET_EMPLOYEES_NO_LIMIT")}else if(this.getOptions().isLimit){e=r.Loc.getMessage("INTRANET_INVITATION_WIDGET_EMPLOYEES_LIMIT")}else{e=this.getOptions().leftCountMessage}return r.Tag.render(_||(_=C`
				<div onclick="${0}" class="intranet-invitation-widget-item-detail">
					<span class="intranet-invitation-widget-item-link-text">
						${0}
					</span>
				</div>
			`),this.showUserList(),e)}))}showUserList(){return this.cache.remember("showUserList",(()=>()=>{l.send(l.EVENT_OPEN_USER_LIST);document.location.href="/company/"}))}getSelectorRights(){return this.cache.remember("selector-rights",(()=>{const e=e=>{e.stopPropagation();this.getRightsMenu(e.target).toggle()};const t=r.Tag.render(y||(y=C`
				<div onclick="${0}" class="intranet-invitation-widget-item-menu"></div>
			`),e);this.subscribe("right-selected",(e=>{const i=this.getRightsMenu(t);i.close();i.destroy();if(e.data.type){this.cache.delete("menu-rights");babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e.data.type}}));return t}))}getRightsMenu(e){return this.cache.remember("menu-rights",(()=>new n.Menu(`menu-rights-${r.Text.getRandom()}`,e,this.getMenuRightsItems(),{autoHide:true,offsetLeft:10,offsetTop:0,angle:true,className:"license-right-popup-men",events:{onPopupShow:e=>{a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,this.getEventNamespace()+":showRightMenu",new a.BaseEvent({data:{popup:e}}))},onPopupClose:e=>{a.EventEmitter.emit(a.EventEmitter.GLOBAL_TARGET,this.getEventNamespace()+":closeRightMenu",new a.BaseEvent({data:{popup:e}}))},onPopupFirstShow:e=>{a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,"SidePanel.Slider:onOpenStart",(()=>{e.close()}))}}})))}getMenuRightsItems(){if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=this.getOptions().rightType}return[{text:r.Loc.getMessage("INTRANET_INVITATION_WIDGET_SETTING_ALL_INVITE"),className:babelHelpers.classPrivateFieldLooseBase(this,f)[f]==="all"?"menu-popup-item-accept":"",onclick:()=>{this.saveInvitationRightSetting("all").then((()=>{this.emit("right-selected",new a.BaseEvent({data:{type:"all"}}))}))}},{text:r.Loc.getMessage("INTRANET_INVITATION_WIDGET_SETTING_ADMIN_INVITE"),className:babelHelpers.classPrivateFieldLooseBase(this,f)[f]==="admin"?"menu-popup-item-accept":"",onclick:()=>{this.saveInvitationRightSetting("admin").then((()=>{this.emit("right-selected",new a.BaseEvent({data:{type:"admin"}}))}))}}]}saveInvitationRightSetting(e){return r.ajax.runAction("intranet.invitationwidget.saveInvitationRight",{data:{type:e}})}}function D(){if(this.getOptions().invitationCounter>0){babelHelpers.classPrivateFieldLooseBase(this,F)[F]().renderTo(babelHelpers.classPrivateFieldLooseBase(this,S)[S]())}BX.addCustomEvent("onPullEvent-main",babelHelpers.classPrivateFieldLooseBase(this,H)[H].bind(this))}function G(e,t){if(e==="user_counter"&&t[BX.message("SITE_ID")]){const e=BX.clone(t[BX.message("SITE_ID")]);const i=e[this.getOptions().counterId];if(!r.Type.isNumber(i)){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]().update(i);this.getOptions().invitationCounter=i;if(i>0){babelHelpers.classPrivateFieldLooseBase(this,F)[F]().renderTo(babelHelpers.classPrivateFieldLooseBase(this,S)[S]())}else{babelHelpers.classPrivateFieldLooseBase(this,F)[F]().destroy();this.cache.delete("counter")}}}function x(){return this.cache.remember("counter",(()=>new s.Counter({value:Number(this.getOptions().invitationCounter),color:s.Counter.Color.DANGER})))}function M(){return this.cache.remember("counter-wrapper",(()=>this.getLayout().querySelector(".intranet-invitation-widget-item-name")))}let V=e=>e,W,X;class $ extends c{constructor(e){super(e);this.articleCode="6770709";this.setEventNamespace("BX.Intranet.InvitationWidget.ExtranetContent")}getConfig(){return{html:this.getOptions().awaitData.then((e=>{this.setOptions({...e.data.users,...this.getOptions()});return this.getLayout()})),minHeight:"55px",sizeLoader:37,marginBottom:24,secondary:true}}getLayout(){return this.cache.remember("layout",(()=>{const e=e=>{e.stopPropagation();this.showInvitationPlace(r.Loc.getMessage("INTRANET_INVITATION_WIDGET_DISABLED_TEXT"),e.target,"extranet")};const t=()=>{BX.Helper.show(`redirect=detail&code=${this.articleCode}`);this.sendAnalytics(this.articleCode)};return r.Tag.render(W||(W=V`
				<div class="${0}">
					<div class="intranet-invitation-widget-content">
						<div class="intranet-invitation-widget-item-icon intranet-invitation-widget-item-icon--ext"></div>
						<div class="intranet-invitation-widget-item-content">
							<div class="intranet-invitation-widget-item-name">
								<span>
									${0}
								</span>
							</div>
							<div class="intranet-invitation-widget-item-link">
								<span onclick="${0}" class="intranet-invitation-widget-item-link-text">
									${0}
								</span>
							</div>
							${0}
						</div>
					</div>
					<button onclick="${0}" class="intranet-invitation-widget-item-btn">
						${0}
					</button>
				</div>
			`),this.getWrapperClass(),r.Loc.getMessage("INTRANET_INVITATION_WIDGET_EXTRANET"),t,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_EXTRANET_DESC"),this.getCountUserMessage(),e,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_INVITE"))}))}getWrapperClass(){return this.cache.remember("wrapper-class",(()=>{const e="intranet-invitation-widget-item intranet-invitation-widget-item--wide";if(this.getOptions().currentExtranetUserCount>0){return e+" intranet-invitation-widget-item--active"}return e}))}getCountUserMessage(){return this.cache.remember("count-user-message",(()=>{if(this.getOptions().currentExtranetUserCount>0){return r.Tag.render(X||(X=V`
					<div class="intranet-invitation-widget-item-ext-users">
						${0}
					</div>
				`),this.getOptions().currentExtranetUserCountMessage)}return null}))}}let k=e=>e,j;var U=babelHelpers.classPrivateFieldLooseKey("openChat");class K extends c{constructor(e){super(e);this.articleCode="22706764";Object.defineProperty(this,U,{writable:true,value:void 0});this.setEventNamespace("BX.Intranet.InvitationWidget.CollabContent")}getConfig(){return{html:this.getOptions().awaitData.then((e=>{const{Messenger:t,CreatableChat:i}=e;babelHelpers.classPrivateFieldLooseBase(this,U)[U]=()=>{t.openChatCreation(i.collab);l.sendCreateCollab()};return this.getLayout()})),minHeight:"55px",sizeLoader:37,marginBottom:24,secondary:true}}getLayout(){return this.cache.remember("layout",(()=>{const e=e=>{babelHelpers.classPrivateFieldLooseBase(this,U)[U]();e.stopPropagation()};const t=()=>{BX.Helper.show(`redirect=detail&code=${this.articleCode}`);this.sendAnalytics(this.articleCode)};return r.Tag.render(j||(j=k`
				<div class="${0}">
					<div class="intranet-invitation-widget-content">
						<div class="intranet-invitation-widget-item-icon intranet-invitation-widget-item-icon--collab">
							<div class="ui-icon-set --collab"></div>
						</div>
						<div class="intranet-invitation-widget-item-content">
							<div class="intranet-invitation-widget-item-name">
								<span>
									${0}
								</span>
							</div>
							<div class="intranet-invitation-widget-item-link">
								<span onclick="${0}" class="intranet-invitation-widget-item-link-text">
									${0}
								</span>
							</div>
						</div>
					</div>
					<button onclick="${0}" class="intranet-invitation-widget-item-btn intranet-invitation-widget-item-btn--collab">
						${0}
					</button>
				</div>
			`),this.getWrapperClass(),r.Loc.getMessage("INTRANET_INVITATION_WIDGET_COLLAB"),t,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_COLLAB_DESC"),e,r.Loc.getMessage("INTRANET_INVITATION_WIDGET_COLLAB_CREATE"))}))}getWrapperClass(){return this.cache.remember("wrapper-class",(()=>"intranet-invitation-widget-item intranet-invitation-widget-item--wide intranet-invitation-widget-item--collab"))}}let Y=e=>e,z,q;class J extends c{getLoader(){return this.cache.remember("loader",(()=>new o.Loader({size:45})))}getComponentContent(){return this.cache.remember("component-content",(()=>{const e=r.Tag.render(z||(z=Y`
				<div data-role="invitation-widget-ustat-online" class="invitation-widget-ustat-online"/>
			`));r.Dom.style(e,"min-height","70px");this.getLoader().show(e);r.ajax.runAction("intranet.invitationwidget.getUserOnlineComponent").then((t=>{this.getLoader().hide();const i=t.data.assets;BX.load([...i["css"],...i["js"]],(()=>{r.Runtime.html(null,[...i["string"]].join("\n"),{useAdjacentHTML:true}).then((()=>{r.Runtime.html(e,t.data.html).then((()=>{this.getLoader().destroy()}))}))}))}));return e}))}getLayout(){return this.cache.remember("layout",(()=>r.Tag.render(q||(q=Y`
				<div class="intranet-invitation-widget-item intranet-invitation-widget-item--wide intranet-invitation-widget-item--no-padding">
					${0}
				</div>
			`),this.getComponentContent())))}}var Q=babelHelpers.classPrivateFieldLooseKey("cache");var Z=babelHelpers.classPrivateFieldLooseKey("getAwaitData");var ee=babelHelpers.classPrivateFieldLooseKey("getContent");var te=babelHelpers.classPrivateFieldLooseKey("getInvitationContent");var ie=babelHelpers.classPrivateFieldLooseKey("getStructureContent");var se=babelHelpers.classPrivateFieldLooseKey("getEmployeesContent");var ne=babelHelpers.classPrivateFieldLooseKey("getExtranetContent");var ae=babelHelpers.classPrivateFieldLooseKey("getCollabContent");var re=babelHelpers.classPrivateFieldLooseKey("getUserOnlineContent");var oe=babelHelpers.classPrivateFieldLooseKey("getPopupContainer");var le=babelHelpers.classPrivateFieldLooseKey("setEventHandler");class ce extends a.EventEmitter{constructor(e){super();Object.defineProperty(this,le,{value:Le});Object.defineProperty(this,oe,{value:Ee});Object.defineProperty(this,re,{value:me});Object.defineProperty(this,ae,{value:be});Object.defineProperty(this,ne,{value:ge});Object.defineProperty(this,se,{value:he});Object.defineProperty(this,ie,{value:pe});Object.defineProperty(this,te,{value:ue});Object.defineProperty(this,ee,{value:ve});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,Q,{writable:true,value:new r.Cache.MemoryCache});this.setEventNamespace("BX.Intranet.InvitationWidget.Popup");this.setOptions(e);babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}setOptions(e){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].set("options",e)}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].get("options",{})}show(){this.getPopup().show()}close(){this.getPopup().close()}getPopup(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("popup",(()=>new i.PopupComponentsMaker({id:"invitation-popup",target:this.getOptions().target,width:350,content:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()})))}}function de(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("await-data",(()=>new Promise(((e,t)=>{r.ajax.runAction("intranet.invitationwidget.getData",{data:{},analyticsLabel:{headerPopup:"Y"}}).then(e).catch(t)}))))}function ve(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("content",(()=>[babelHelpers.classPrivateFieldLooseBase(this,te)[te]().getConfig(),{html:[babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]().getConfig(),babelHelpers.classPrivateFieldLooseBase(this,se)[se]().getConfig()],marginBottom:24},this.getOptions().isExtranetAvailable?babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]().getConfig():null,this.getOptions().isCollabAvailable?babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]().getConfig():null,babelHelpers.classPrivateFieldLooseBase(this,re)[re]().getConfig()]))}function ue(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("invitation-content",(()=>new u({isAdmin:this.getOptions().isAdmin,invitationLink:this.getOptions().params.invitationLink,isInvitationAvailable:this.getOptions().isInvitationAvailable})))}function pe(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("structure-content",(()=>new I({link:this.getOptions().params.structureLink,shouldShowStructureCounter:this.getOptions().params.shouldShowStructureCounter})))}function he(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("employees-content",(()=>new R({isAdmin:this.getOptions().isAdmin,awaitData:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](),invitationCounter:this.getOptions().params.invitationCounter,counterId:this.getOptions().params.counterId})))}function ge(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("extranet-content",(()=>new $({isAdmin:this.getOptions().isAdmin,awaitData:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](),invitationLink:this.getOptions().params.invitationLink,isInvitationAvailable:this.getOptions().isInvitationAvailable})))}function be(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("collab-content",(()=>new K({isAdmin:this.getOptions().isAdmin,awaitData:r.Runtime.loadExtension("im.public","im.v2.component.content.chat-forms.forms")})))}function me(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("user-online-content",(()=>new J))}function Ee(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("popup-container",(()=>this.getPopup().getPopup().getPopupContainer()))}function Le(){const e=e=>{if(e.data.popup){setTimeout((()=>{r.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](),"click",(()=>{e.data.popup.close()}))}),100)}};const t=()=>{this.close()};a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,"BX.Intranet.InvitationWidget.EmployeesContent:showRightMenu",e);a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,"BX.Intranet.InvitationWidget.HintPopup:show",e);a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,"BX.Intranet.UstatOnline:showPopup",e);a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,"SidePanel.Slider:onOpenStart",t)}var Ie=babelHelpers.classPrivateFieldLooseKey("cache");var Te=babelHelpers.classPrivateFieldLooseKey("showCounter");var Pe=babelHelpers.classPrivateFieldLooseKey("onReceiveCounterValue");var Oe=babelHelpers.classPrivateFieldLooseKey("getCounterWrapper");var we=babelHelpers.classPrivateFieldLooseKey("getCounter");var Ne=babelHelpers.classPrivateFieldLooseKey("getPopup");var Ce=babelHelpers.classPrivateFieldLooseKey("getCounterValue");var Be=babelHelpers.classPrivateFieldLooseKey("onFirstWatchNewStructure");class _e extends a.EventEmitter{constructor(e){super();Object.defineProperty(this,Be,{value:Re});Object.defineProperty(this,Ce,{value:Se});Object.defineProperty(this,Ne,{value:Fe});Object.defineProperty(this,we,{value:He});Object.defineProperty(this,Oe,{value:Ae});Object.defineProperty(this,Pe,{value:fe});Object.defineProperty(this,Te,{value:ye});Object.defineProperty(this,Ie,{writable:true,value:new r.Cache.MemoryCache});this.setEventNamespace("BX.Intranet.InvitationWidget");this.setOptions(e);l.isAdmin=this.getOptions().isCurrentUserAdmin;r.Event.bind(this.getOptions().button,"click",(()=>{l.send(l.EVENT_SHOW);babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]().show()}));a.EventEmitter.subscribe(a.EventEmitter.GLOBAL_TARGET,"BX.Bitrix24.NotifyPanel:showInvitationWidget",(()=>{babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]().show()}));babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]()}setOptions(e){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].set("options",e)}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].get("options",{})}}function ye(){if(this.getOptions().invitationCounter>0){babelHelpers.classPrivateFieldLooseBase(this,we)[we]().renderTo(babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]())}BX.addCustomEvent("onPullEvent-main",babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].bind(this));if(this.getOptions().shouldShowStructureCounter){a.EventEmitter.subscribeOnce("HR.company-structure:first-popup-showed",babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].bind(this))}}function fe(e,t){if(e==="user_counter"&&t[BX.message("SITE_ID")]){const e=BX.clone(t[BX.message("SITE_ID")]);let i=e[this.getOptions().counterId];if(!r.Type.isNumber(i)){return}if(this.getOptions().shouldShowStructureCounter){i++}babelHelpers.classPrivateFieldLooseBase(this,we)[we]().update(i);this.getOptions().invitationCounter=i;if(i>0){babelHelpers.classPrivateFieldLooseBase(this,we)[we]().renderTo(babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]())}else{babelHelpers.classPrivateFieldLooseBase(this,we)[we]().destroy();babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].delete("counter")}}}function Ae(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].remember("counter-wrapper",(()=>this.getOptions().button.querySelector(".invitation-widget-counter")))}function He(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].remember("counter",(()=>new s.Counter({value:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](),color:s.Counter.Color.DANGER})))}function Fe(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].remember("popup",(()=>new ce({isAdmin:this.getOptions().isCurrentUserAdmin,target:this.getOptions().button,isExtranetAvailable:this.getOptions().isExtranetAvailable,isCollabAvailable:this.getOptions().isCollabAvailable,isInvitationAvailable:this.getOptions().isInvitationAvailable,params:{structureLink:this.getOptions().structureLink,invitationLink:this.getOptions().invitationLink,invitationCounter:this.getOptions().invitationCounter,counterId:this.getOptions().counterId,shouldShowStructureCounter:this.getOptions().shouldShowStructureCounter}})))}function Se(){var e;let t=Number(this.getOptions().invitationCounter);if((e=this.getOptions().shouldShowStructureCounter)!=null?e:false){t++}return t}function Re(){let e=babelHelpers.classPrivateFieldLooseBase(this,we)[we]().value;if(!r.Type.isNumber(e)){return}if(!this.getOptions().shouldShowStructureCounter){return}e--;this.getOptions().shouldShowStructureCounter=false;babelHelpers.classPrivateFieldLooseBase(this,we)[we]().update(e);this.getOptions().invitationCounter=e;if(e>0){babelHelpers.classPrivateFieldLooseBase(this,we)[we]().renderTo(babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]())}else{babelHelpers.classPrivateFieldLooseBase(this,we)[we]().destroy();babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].delete("counter")}}e.InvitationWidget=_e})(this.BX.Intranet=this.BX.Intranet||{},BX.UI.Analytics,BX.UI,BX.UI,BX.Main,BX.Event,BX,BX);
//# sourceMappingURL=script.map.js