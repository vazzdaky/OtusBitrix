{"version":3,"file":"mobile.js","sources":["src/mobile.js"],"sourcesContent":["const\n\tBX = window.BX,\n\tBXMobileApp = window.BXMobileApp;\n\nconst nodeSelectUser = (function ()\n{\n\tconst nodeSelectUser = function (select, eventNode, useOnChangeEvent)\n\t{\n\t\tthis.click = BX.delegate(this.click, this);\n\t\tthis.callback = BX.delegate(this.callback, this);\n\t\tthis.drop = BX.delegate(this.drop, this);\n\t\tthis.select = BX(select);\n\t\tthis.container = this.select.nextElementSibling;\n\t\tthis.eventNode = BX(eventNode);\n\t\tthis.useOnChangeEvent = useOnChangeEvent || false;\n\t\tBX.bind(this.eventNode, \"click\", this.click);\n\t\tthis.multiple = select.hasAttribute(\"multiple\");\n\t\tthis.showDrop = (!(\n\t\t\tselect.hasAttribute(\"bx-can-drop\")\n\t\t\t&&\n\t\t\tselect.getAttribute(\"bx-can-drop\").toString() == \"false\"\n\t\t));\n\t\tthis.urls = {\n\t\t\t\"list\": BX.message('SITE_DIR') + 'mobile/index.php?mobile_action=get_user_list',\n\t\t\t\"profile\": BX.message(\"interface_form_user_url\")\n\t\t};\n\t\tthis.actualizeNodes();\n\t};\n\tnodeSelectUser.prototype = {\n\t\tclick: function (e)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn BX.PreventDefault(e);\n\t\t},\n\t\tshow: function ()\n\t\t{\n\t\t\t(new BXMobileApp.UI.Table({\n\t\t\t\turl: this.urls.list,\n\t\t\t\ttable_settings: {\n\t\t\t\t\tcallback: this.callback,\n\t\t\t\t\tmarkmode: true,\n\t\t\t\t\tmultiple: this.multiple,\n\t\t\t\t\treturn_full_mode: true,\n\t\t\t\t\tskipSpecialChars: true,\n\t\t\t\t\tmodal: true,\n\t\t\t\t\talphabet_index: true,\n\t\t\t\t\toutsection: false,\n\t\t\t\t\tokname: BX.message(\"interface_form_select\"),\n\t\t\t\t\tcancelname: BX.message(\"interface_form_cancel\")\n\t\t\t\t}\n\t\t\t}, \"users\")).show();\n\t\t},\n\t\tdrop: function ()\n\t\t{\n\t\t\tconst node = BX.proxy_context,\n\t\t\t\tid = node.id.replace(this.select.id + '_del_', '');\n\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tif (this.select.options[ii].value === id)\n\t\t\t\t{\n\t\t\t\t\tBX.remove(BX.findParent(node, {\n\t\t\t\t\t\t\"tagName\": \"DIV\",\n\t\t\t\t\t\t\"className\": \"mobile-grid-field-select-user-item-outer\"\n\t\t\t\t\t}));\n\t\t\t\t\tBX.remove(this.select.options[ii]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.select.options.length <= 0 && !this.multiple)\n\t\t\t{\n\t\t\t\tthis.eventNode.innerHTML = BX.message('interface_form_select');\n\t\t\t}\n\n\t\t\tif (this.useOnChangeEvent)\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(this, \"onChange\", [this, this.select]);\n\t\t\t}\n\t\t},\n\t\tactualizeNodes: function ()\n\t\t{\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\tif (BX(this.select.id + '_del_' + this.select.options[ii].value))\n\t\t\t\t{\n\t\t\t\t\tBX.bind(BX(this.select.id + '_del_' + this.select.options[ii].value), \"click\", this.drop);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tbuildNodes: function (items)\n\t\t{\n\t\t\tlet options = '',\n\t\t\t\thtml = '',\n\t\t\t\tii, c = 0,\n\t\t\t\tuser, existedUsers = [];\n\t\t\tfor (let ii = 0; ii < this.select.options.length; ii++)\n\t\t\t{\n\t\t\t\texistedUsers.push(this.select.options[ii].value.toString());\n\t\t\t\tc++;\n\t\t\t}\n\t\t\tfor (let ii = 0; ii < Math.min((this.multiple ? items.length : 1), items.length); ii++)\n\t\t\t{\n\t\t\t\tuser = items[ii];\n\t\t\t\tif (existedUsers.includes(user['ID']))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\toptions += '<option value=\"' + user['ID'] + '\" selected>' + user[\"NAME\"] + '</option>';\n\t\t\t\thtml += ([\n\t\t\t\t\t'<div class=\"mobile-grid-field-select-user-item-outer\">',\n\t\t\t\t\t'<div class=\"mobile-grid-field-select-user-item\">',\n\t\t\t\t\t(this.showDrop ? '<del id=\"' + this.select.id + '_del_' + user[\"ID\"] + '\"></del>' : ''),\n\t\t\t\t\t'<div class=\"avatar\"', (user[\"IMAGE\"] ? ' style=\"background-image:url(\\'' + user[\"IMAGE\"] + '\\')\"' : ''), '></div>',\n\t\t\t\t\t'<span onclick=\"BXMobileApp.Events.postToComponent(\\'onUserProfileOpen\\', '+[user['ID']]+', \\'communication\\');\">' + user[\"NAME\"] + '</span>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join('').replace(' style=\"background-image:url(\\'\\')\"', ''));\n\t\t\t\tc++;\n\t\t\t}\n\n\t\t\tif (html !== '')\n\t\t\t{\n\t\t\t\tthis.select.innerHTML = (this.multiple ? this.select.innerHTML : '') + options;\n\t\t\t\tthis.container.innerHTML = (this.multiple ? this.container.innerHTML : '') + html;\n\t\t\t\tif (this.select.innerHTML !== '' && !this.multiple)\n\t\t\t\t{\n\t\t\t\t\tthis.eventNode.innerHTML = BX.message('interface_form_change');\n\t\t\t\t}\n\n\t\t\t\tif (this.useOnChangeEvent)\n\t\t\t\t{\n\t\t\t\t\tBX.onCustomEvent(this, \"onChange\", [this, this.select]);\n\t\t\t\t}\n\n\t\t\t\tlet ij = 0,\n\t\t\t\t\tf = BX.proxy(function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (ij < 100)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.container.childNodes.length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.actualizeNodes();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (ij++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsetTimeout(f, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\tsetTimeout(f, 50);\n\t\t\t}\n\t\t},\n\t\tcallback: function (data)\n\t\t{\n\t\t\tif (data && data.a_users)\n\t\t\t{\n\t\t\t\tthis.buildNodes(data.a_users);\n\t\t\t}\n\t\t}\n\t};\n\treturn nodeSelectUser;\n})();\n\nwindow.app.exec('enableCaptureKeyboard', true);\n\nBX.Mobile.Field.SelectUser = function (params)\n{\n\tthis.useOnChangeEvent = params['useOnChangeEvent'] || false;\n\tthis.init(params);\n};\n\nBX.Mobile.Field.SelectUser.prototype = {\n\t__proto__: BX.Mobile.Field.prototype,\n\tbindElement: function (node)\n\t{\n\t\tlet result = null;\n\t\tif (BX(node))\n\t\t{\n\t\t\tresult = new nodeSelectUser(node, BX(`${node.id}_select`), this.useOnChangeEvent);\n\t\t}\n\t\treturn result;\n\t}\n};\n"],"names":["BX","window","BXMobileApp","nodeSelectUser","select","eventNode","useOnChangeEvent","click","delegate","callback","drop","container","nextElementSibling","bind","multiple","hasAttribute","showDrop","getAttribute","toString","urls","message","actualizeNodes","prototype","e","show","PreventDefault","UI","Table","url","list","table_settings","markmode","return_full_mode","skipSpecialChars","modal","alphabet_index","outsection","okname","cancelname","node","proxy_context","id","replace","ii","options","length","value","remove","findParent","innerHTML","onCustomEvent","buildNodes","items","html","user","existedUsers","push","Math","min","includes","join","ij","f","proxy","childNodes","setTimeout","data","a_users","app","exec","Mobile","Field","SelectUser","params","init","__proto__","bindElement","result"],"mappings":"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"}