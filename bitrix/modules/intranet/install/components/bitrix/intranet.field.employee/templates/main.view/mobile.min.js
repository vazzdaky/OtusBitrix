this.BX=this.BX||{};this.BX.Mobile=this.BX.Mobile||{};this.BX.Mobile.Field=this.BX.Mobile.Field||{};(function(e){"use strict";const t=window.BX,i=window.BXMobileApp;const s=function(){const e=function(e,i,s){this.click=t.delegate(this.click,this);this.callback=t.delegate(this.callback,this);this.drop=t.delegate(this.drop,this);this.select=t(e);this.container=this.select.nextElementSibling;this.eventNode=t(i);this.useOnChangeEvent=s||false;t.bind(this.eventNode,"click",this.click);this.multiple=e.hasAttribute("multiple");this.showDrop=!(e.hasAttribute("bx-can-drop")&&e.getAttribute("bx-can-drop").toString()=="false");this.urls={list:t.message("SITE_DIR")+"mobile/index.php?mobile_action=get_user_list",profile:t.message("interface_form_user_url")};this.actualizeNodes()};e.prototype={click:function(e){this.show();return t.PreventDefault(e)},show:function(){new i.UI.Table({url:this.urls.list,table_settings:{callback:this.callback,markmode:true,multiple:this.multiple,return_full_mode:true,skipSpecialChars:true,modal:true,alphabet_index:true,outsection:false,okname:t.message("interface_form_select"),cancelname:t.message("interface_form_cancel")}},"users").show()},drop:function(){const e=t.proxy_context,i=e.id.replace(this.select.id+"_del_","");for(let s=0;s<this.select.options.length;s++){if(this.select.options[s].value===i){t.remove(t.findParent(e,{tagName:"DIV",className:"mobile-grid-field-select-user-item-outer"}));t.remove(this.select.options[s])}}if(this.select.options.length<=0&&!this.multiple){this.eventNode.innerHTML=t.message("interface_form_select")}if(this.useOnChangeEvent){t.onCustomEvent(this,"onChange",[this,this.select])}},actualizeNodes:function(){for(let e=0;e<this.select.options.length;e++){if(t(this.select.id+"_del_"+this.select.options[e].value)){t.bind(t(this.select.id+"_del_"+this.select.options[e].value),"click",this.drop)}}},buildNodes:function(e){let i="",s="",l,n=[];for(let e=0;e<this.select.options.length;e++){n.push(this.select.options[e].value.toString())}for(let t=0;t<Math.min(this.multiple?e.length:1,e.length);t++){l=e[t];if(n.includes(l["ID"])){continue}i+='<option value="'+l["ID"]+'" selected>'+l["NAME"]+"</option>";s+=['<div class="mobile-grid-field-select-user-item-outer">','<div class="mobile-grid-field-select-user-item">',this.showDrop?'<del id="'+this.select.id+"_del_"+l["ID"]+'"></del>':"",'<div class="avatar"',l["IMAGE"]?" style=\"background-image:url('"+l["IMAGE"]+"')\"":"","></div>","<span onclick=\"BXMobileApp.Events.postToComponent('onUserProfileOpen', "+[l["ID"]]+", 'communication');\">"+l["NAME"]+"</span>","</div>","</div>"].join("").replace(" style=\"background-image:url('')\"","")}if(s!==""){this.select.innerHTML=(this.multiple?this.select.innerHTML:"")+i;this.container.innerHTML=(this.multiple?this.container.innerHTML:"")+s;if(this.select.innerHTML!==""&&!this.multiple){this.eventNode.innerHTML=t.message("interface_form_change")}if(this.useOnChangeEvent){t.onCustomEvent(this,"onChange",[this,this.select])}let e=0,l=t.proxy((function(){if(e<100){if(this.container.childNodes.length>0){this.actualizeNodes()}else if(e++){setTimeout(l,50)}}}),this);setTimeout(l,50)}},callback:function(e){if(e&&e.a_users){this.buildNodes(e.a_users)}}};return e}();window.app.exec("enableCaptureKeyboard",true);t.Mobile.Field.SelectUser=function(e){this.useOnChangeEvent=e["useOnChangeEvent"]||false;this.init(e)};t.Mobile.Field.SelectUser.prototype={__proto__:t.Mobile.Field.prototype,bindElement:function(e){let i=null;if(t(e)){i=new s(e,t(`${e.id}_select`),this.useOnChangeEvent)}return i}}})(this.BX.Mobile.Field.SelectUser=this.BX.Mobile.Field.SelectUser||{});
//# sourceMappingURL=mobile.map.js