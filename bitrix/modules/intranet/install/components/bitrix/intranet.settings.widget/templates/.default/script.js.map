{"version":3,"file":"script.js","sources":["settings-widget-loader.js"],"sourcesContent":["import { ajax, Runtime } from \"main.core\";\nimport { WidgetLoader } from 'intranet.widget-loader';\n\nexport class SettingsWidgetLoader\n{\n\tstatic #instance: SettingsWidgetLoader;\n\t#widgetLoader: WidgetLoader;\n\t#isBitrix24: boolean = false;\n\t#isAdmin: boolean = false;\n\t#isRequisite: boolean = false;\n\t#isMainPageAvailable: boolean = false;\n\t#node: ?HTMLElement = false;\n\n\tconstructor(params)\n\t{\n\t\tthis.#isBitrix24 = params['isBitrix24'];\n\t\tthis.#isAdmin = params['isAdmin'];\n\t\tthis.#isRequisite = params['isRequisite'];\n\t\tthis.#isMainPageAvailable = params['isMainPageAvailable'];\n\t}\n\n\tshowOnce(node)\n\t{\n\t\tthis.#node = node;\n\t\tconst popup = this.#getWidgetLoader().getPopup();\n\t\tpopup.show();\n\n\t\tconst popupContainer = popup.getPopupContainer();\n\t\tif (popupContainer.getBoundingClientRect().left < 30)\n\t\t{\n\t\t\tpopupContainer.style.left = '30px';\n\t\t}\n\n\t\t(typeof BX.Intranet.SettingsWidget !== 'undefined' ? Promise.resolve(): this.#load())\n\t\t\t.then(() => {\n\t\t\t\tif (typeof BX.Intranet.SettingsWidget !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tBX.Intranet.SettingsWidget.bindAndShow(node);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#getWidgetLoader(): WidgetLoader\n\t{\n\t\tif (this.#widgetLoader)\n\t\t{\n\t\t\treturn this.#widgetLoader;\n\t\t}\n\n\t\tconst widgetLoader = new WidgetLoader({\n\t\t\tbindElement: this.#node,\n\t\t\twidth: 374,\n\t\t});\n\n\t\twidgetLoader.addHeaderSkeleton();\n\n\t\tif (this.#isRequisite)\n\t\t{\n\t\t\twidgetLoader.addItemSkeleton(22);\n\t\t}\n\n\t\tif (this.#isMainPageAvailable)\n\t\t{\n\t\t\twidgetLoader.addItemSkeleton(22);\n\t\t}\n\n\t\tif (this.#isAdmin)\n\t\t{\n\t\t\twidgetLoader.addSplitItemSkeleton(22);\n\t\t}\n\n\t\tif (this.#isBitrix24)\n\t\t{\n\t\t\twidgetLoader.addItemSkeleton(22);\n\t\t}\n\n\t\twidgetLoader.addItemSkeleton(22);\n\t\twidgetLoader.addFooterSkeleton();\n\n\t\tthis.#widgetLoader = widgetLoader;\n\n\t\treturn this.#widgetLoader;\n\t}\n\n\t#load(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:intranet.settings.widget',\n\t\t\t\t'getWidgetComponent',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t},\n\t\t\t).then((response) => {\n\t\t\t\treturn (new Promise((resolve) => {\n\t\t\t\t\tconst loadCss = response.data.assets ? response.data.assets.css : [];\n\t\t\t\t\tconst loadJs = response.data.assets ? response.data.assets.js : [];\n\t\t\t\t\tBX.load(loadCss, () => {\n\t\t\t\t\t\tBX.loadScript(loadJs, () => {\n\t\t\t\t\t\t\tRuntime.html(null, response.data.html).then(resolve);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}).then(() => {\n\t\t\t\tif (typeof BX.Intranet.SettingsWidget !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tBX.Intranet.SettingsWidget.bindWidget(this.#getWidgetLoader());\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\t}\n\n\tstatic init(options): SettingsWidgetLoader\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this(options);\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n}"],"names":["SettingsWidgetLoader","constructor","params","showOnce","node","popup","getPopup","show","popupContainer","getPopupContainer","getBoundingClientRect","left","style","BX","Intranet","SettingsWidget","Promise","resolve","then","bindAndShow","init","options","widgetLoader","WidgetLoader","bindElement","width","addHeaderSkeleton","addItemSkeleton","addSplitItemSkeleton","addFooterSkeleton","ajax","runComponentAction","mode","response","loadCss","data","assets","css","loadJs","js","load","loadScript","Runtime","html","setTimeout","bindWidget"],"mappings":"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"}