{"version":3,"file":"manager.bundle.js","sources":["../src/manager.js"],"sourcesContent":["export class Manager\n{\n\t#tokens = {};\n\t#pendingTokens = {};\n\n\tconstructor(options)\n\t{\n\n\t}\n\n\tasync getToken(chatId): Promise<?string>\n\t{\n\t\tconst pendingToken = this.#pendingTokens[chatId];\n\t\tif (pendingToken)\n\t\t{\n\t\t\treturn pendingToken;\n\t\t}\n\n\t\tconst tokenPromise = new Promise((resolve) =>\n\t\t{\n\t\t\tthis.#pendingTokens[chatId] = tokenPromise;\n\n\t\t\tconst token = this.#tokens[chatId];\n\n\t\t\tif (token)\n\t\t\t{\n\t\t\t\treturn resolve(token);\n\t\t\t}\n\n\t\t\tthis.#loadToken(chatId).then((token) =>\n\t\t\t{\n\t\t\t\tresolve(token);\n\t\t\t});\n\t\t});\n\n\t\treturn tokenPromise;\n\t}\n\n\tsetToken(chatId, token): void\n\t{\n\t\tthis.#tokens[chatId] = token;\n\t}\n\n\tasync #loadToken(chatId): Promise<?string>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst response = await BX.rest.callMethod('call.Call.getCallToken', { chatId });\n\t\t\treturn response.data()?.token;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('Error during call token retrieving', error);\n\t\t}\n\t}\n}\n"],"names":["Manager","constructor","options","getToken","chatId","pendingToken","tokenPromise","Promise","resolve","token","then","setToken","response","BX","rest","callMethod","data","error","console"],"mappings":";;;;;;;;;AAAA,CAAO,MAAMA,OAAO,CACpB;GAICC,WAAW,CAACC,OAAO,EACnB;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJU;;KAAE;OAAA;OAAA,OACK;;;GAOjB,MAAMC,QAAQ,CAACC,MAAM,EACrB;KACC,MAAMC,YAAY,GAAG,4CAAI,kCAAgBD,MAAM,CAAC;KAChD,IAAIC,YAAY,EAChB;OACC,OAAOA,YAAY;;KAGpB,MAAMC,YAAY,GAAG,IAAIC,OAAO,CAAEC,OAAO,IACzC;OACC,4CAAI,kCAAgBJ,MAAM,CAAC,GAAGE,YAAY;OAE1C,MAAMG,KAAK,GAAG,4CAAI,oBAASL,MAAM,CAAC;OAElC,IAAIK,KAAK,EACT;SACC,OAAOD,OAAO,CAACC,KAAK,CAAC;;OAGtB,4CAAI,0BAAYL,MAAM,EAAEM,IAAI,CAAED,KAAK,IACnC;SACCD,OAAO,CAACC,KAAK,CAAC;QACd,CAAC;MACF,CAAC;KAEF,OAAOH,YAAY;;GAGpBK,QAAQ,CAACP,MAAM,EAAEK,KAAK,EACtB;KACC,4CAAI,oBAASL,MAAM,CAAC,GAAGK,KAAK;;CAe9B;CAAC,2BAZiBL,MAAM,EACvB;GACC,IACA;KAAA;KACC,MAAMQ,QAAQ,GAAG,MAAMC,EAAE,CAACC,IAAI,CAACC,UAAU,CAAC,wBAAwB,EAAE;OAAEX;MAAQ,CAAC;KAC/E,yBAAOQ,QAAQ,CAACI,IAAI,EAAE,qBAAf,eAAiBP,KAAK;IAC7B,CACD,OAAOQ,KAAK,EACZ;KACCC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;;CAE5D;;;;;;;;"}