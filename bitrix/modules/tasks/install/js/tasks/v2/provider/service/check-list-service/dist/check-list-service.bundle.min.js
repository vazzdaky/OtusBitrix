this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Provider=this.BX.Tasks.V2.Provider||{};(function(e,t,s,i,a,r){"use strict";function o(e){const t=new Map;e.forEach((e=>{t.set(e.id,e.nodeId)}));return e.map((e=>{const s=c(e);const i=e.parentId?t.get(e.parentId):0;return{...e,title:s,parentNodeId:i}}))}function n(e){return Object.fromEntries(e.map((e=>{var s,i,a,r,o;const n=(s=e.accomplices)==null?void 0:s.map((e=>({ID:e.id,TYPE:"A",NAME:e.name,IMAGE:e.image,IS_COLLABER:e.type===t.UserTypes.Collaber?1:""})));const l=(i=e.auditors)==null?void 0:i.map((e=>({ID:e.id,TYPE:"U",NAME:e.name,IMAGE:e.image,IS_COLLABER:e.type===t.UserTypes.Collaber?1:""})));const d=Object.fromEntries((a=e.attachments)==null?void 0:a.map((e=>[e,e])));const p=[...n,...l].reduce(((e,t)=>{e[t.ID]=t;return e}),{});const h=c(e);const u=Object.fromEntries(Object.entries({NODE_ID:e.nodeId,TITLE:h,CREATED_BY:(r=e.creator)==null?void 0:r.id,TOGGLED_BY:(o=e.toggledBy)==null?void 0:o.id,TOGGLED_DATE:e.toggledDate,MEMBERS:p,NEW_FILE_IDS:d,ATTACHMENTS:d,IS_COMPLETE:e.isComplete,IS_IMPORTANT:e.isImportant,PARENT_ID:e.parentId,SORT_INDEX:e.sortIndex,ACTIONS:{MODIFY:e.actions.modify,REMOVE:e.actions.remove,TOGGLE:e.actions.toggle}}).filter((([,e])=>e!==null&&e!==undefined)));return[e.nodeId,u]})))}function c(e){var t,s;const i=[...((t=e.accomplices)!=null?t:[]).map((e=>e.name)),...((s=e.auditors)!=null?s:[]).map((e=>e.name))].join(" ");if(i){return`${e.title} ${i}`}return e.title}var l=babelHelpers.classPrivateFieldLooseKey("getPromises");class d{constructor(){Object.defineProperty(this,l,{writable:true,value:{}})}async load(e){var t,s;(s=(t=babelHelpers.classPrivateFieldLooseBase(this,l)[l])[e])!=null?s:t[e]=new Promise((async(t,s)=>{try{const s=await(new r.ApiClient).post("CheckList.get",{task:{id:e}});await Promise.all([this.$store.dispatch(`${i.Model.CheckList}/upsertMany`,s),this.$store.dispatch(`${i.Model.Tasks}/update`,{id:e,fields:{containsChecklist:s.length>0,checklist:s.map((e=>e.id))}})]);t()}catch(e){s(e)}}));return babelHelpers.classPrivateFieldLooseBase(this,l)[l][e]}async save(e,t){return new Promise((async(s,a)=>{try{const a=await(new r.ApiClient).post("CheckList.save",{task:{id:e,checklist:o(t)}});const n=t.map((e=>e.id));await Promise.all([this.$store.dispatch(`${i.Model.CheckList}/deleteMany`,n),this.$store.dispatch(`${i.Model.CheckList}/upsertMany`,a),this.$store.dispatch(`${i.Model.Tasks}/update`,{id:e,fields:{containsChecklist:true,checklist:a.map((e=>e.id))}})]);s()}catch(e){a(e)}}))}get $store(){return a.Core.getStore()}}const p=new d;const h={mapModelToSliderData:n};e.CheckListMappers=h;e.checkListService=p})(this.BX.Tasks.V2.Provider.Service=this.BX.Tasks.V2.Provider.Service||{},BX.Tasks.V2.Model,BX.Vue3.Vuex,BX.Tasks.V2.Const,BX.Tasks.V2,BX.Tasks.V2.Lib);
//# sourceMappingURL=check-list-service.bundle.map.js