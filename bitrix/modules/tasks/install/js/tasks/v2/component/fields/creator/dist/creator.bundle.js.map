{"version":3,"file":"creator.bundle.js","sources":["../src/creator-meta.js","../src/creator.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { Core } from 'tasks.v2.core';\nimport { EntitySelectorEntity } from 'tasks.v2.const';\n\nexport const creatorMeta = Object.freeze({\n\tid: 'creatorId',\n\ttitle: Loc.getMessage('TASKS_V2_CREATOR_TITLE'),\n\tdialogOptions: (context: string = 'tasks-card-participant') => {\n\t\tconst limits = Core.getParams().limits;\n\n\t\treturn {\n\t\t\tcontext,\n\t\t\tmultiple: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: EntitySelectorEntity.User,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\temailUsers: true,\n\t\t\t\t\t\tinviteGuestLink: true,\n\t\t\t\t\t\tanalyticsSource: 'tasks',\n\t\t\t\t\t\tlockGuestLink: !limits.mailUserIntegration,\n\t\t\t\t\t\tlockGuestLinkFeatureId: limits.mailUserIntegrationFeatureId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t},\n});\n","import { mapGetters } from 'ui.vue3.vuex';\nimport type { DialogOptions } from 'ui.entity-selector';\n\nimport { Model } from 'tasks.v2.const';\nimport { Participant } from 'tasks.v2.component.elements.participant';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { creatorMeta } from './creator-meta';\n\n// @vue/component\nexport const Creator = {\n\tname: 'TaskCreator',\n\tcomponents: {\n\t\tParticipant,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tselectorWithActionMenu: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlocalContext: `${this.context}-${this.$options.name}`,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tdialogOptions(): DialogOptions\n\t\t{\n\t\t\treturn creatorMeta.dialogOptions(this.localContext);\n\t\t},\n\t\tpreselected(): [string, number][]\n\t\t{\n\t\t\treturn [['user', this.task.creatorId || this.currentUserId]];\n\t\t},\n\t\tcantChangeHint(): string\n\t\t{\n\t\t\tif (this.task.flowId > 0)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_CREATOR_CANT_CHANGE_FLOW');\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_CREATOR_CANT_CHANGE');\n\t\t},\n\t\tdataset(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'data-task-id': this.taskId,\n\t\t\t\t'data-task-field-id': creatorMeta.id,\n\t\t\t\t'data-task-field-value': this.task.creatorId,\n\t\t\t};\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleHintClick(): void\n\t\t{\n\t\t\tif (this.task.flowId > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tresponsibleId: this.currentUserId,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tupdateTask(user: UserModel): void\n\t\t{\n\t\t\tvoid this.$store.dispatch(`${Model.Users}/upsert`, user);\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tcreatorId: user.id,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Participant\n\t\t\t:taskId=\"taskId\"\n\t\t\t:dialogOptions=\"dialogOptions\"\n\t\t\t:preselected=\"preselected\"\n\t\t\t:canChange=\"() => task.responsibleId === currentUserId && (task.flowId ?? 0) <= 0\"\n\t\t\t:cantChangeHint=\"cantChangeHint\"\n\t\t\t:hintClickHandler=\"handleHintClick\"\n\t\t\t:selectorWithActionMenu=\"selectorWithActionMenu\"\n\t\t\t:dataset=\"dataset\"\n\t\t\t:readonly=\"readonly\"\n\t\t\t@update=\"updateTask\"\n\t\t/>\n\t`,\n};\n"],"names":["creatorMeta","Object","freeze","id","title","Loc","getMessage","dialogOptions","context","limits","Core","getParams","multiple","enableSearch","entities","EntitySelectorEntity","User","options","emailUsers","inviteGuestLink","analyticsSource","lockGuestLink","mailUserIntegration","lockGuestLinkFeatureId","mailUserIntegrationFeatureId","Creator","name","components","Participant","props","taskId","type","Number","String","required","selectorWithActionMenu","Boolean","default","data","localContext","$options","computed","mapGetters","currentUserId","Model","Interface","task","$store","getters","Tasks","preselected","creatorId","cantChangeHint","flowId","loc","dataset","readonly","rights","edit","methods","handleHintClick","taskService","update","responsibleId","updateTask","user","dispatch","Users","template"],"mappings":"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"}