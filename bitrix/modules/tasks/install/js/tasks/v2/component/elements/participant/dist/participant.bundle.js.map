{"version":3,"file":"participant.bundle.js","sources":["../src/participant.js"],"sourcesContent":["import { Popup } from 'ui.vue3.components.popup';\nimport { RichLoc } from 'ui.vue3.components.rich-loc';\n\nimport { Model } from 'tasks.v2.const';\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { UserCustomTagSelector, type ItemId } from 'tasks.v2.component.elements.user-custom-tag-selector';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport './participant.css';\n\n// @vue/component\nexport const Participant = {\n\tname: 'TaskParticipant',\n\tcomponents: {\n\t\tUserCustomTagSelector,\n\t\tPopup,\n\t\tRichLoc,\n\t\tHint,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tdialogOptions: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tpreselected: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanChange: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tcantChangeHint: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\thintClickHandler: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tselectorWithActionMenu: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdataset: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\treadonly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['update'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisPopupShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tuserInfo(): UserModel\n\t\t{\n\t\t\tconst [, userId]: ItemId = this.preselected[0] ?? [];\n\n\t\t\treturn this.$store.getters[`${Model.Users}/getById`](userId);\n\t\t},\n\t},\n\tmethods: {\n\t\thandleUserSelected(user: UserModel): void\n\t\t{\n\t\t\tthis.$emit('update', user);\n\t\t},\n\t\tasync onClick(): Promise<boolean>\n\t\t{\n\t\t\tif (this.canChange())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = true;\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.resolvePopupClosePromise = resolve;\n\t\t\t});\n\t\t},\n\t\thandleHintClick(): void\n\t\t{\n\t\t\tthis.hintClickHandler();\n\n\t\t\tthis.resolvePopupClosePromise(true);\n\n\t\t\tthis.isPopupShown = false;\n\t\t},\n\t\tcloseHint(): void\n\t\t{\n\t\t\tthis.resolvePopupClosePromise(false);\n\n\t\t\tthis.isPopupShown = false;\n\t\t},\n\t\thandleKeydown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (event.key === 'Enter' && !(event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tvoid this.$refs.selector.handleClick();\n\t\t\t}\n\t\t},\n\t\tfocus(): void\n\t\t{\n\t\t\tthis.$refs.container.focus();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-participant\" v-bind=\"dataset\" ref=\"container\" tabindex=\"0\" @keydown=\"handleKeydown\">\n\t\t\t<UserCustomTagSelector\n\t\t\t\t:dialogOptions=\"dialogOptions\"\n\t\t\t\t:items=\"preselected\"\n\t\t\t\t:userInfo=\"userInfo\"\n\t\t\t\t:withActionMenu=\"selectorWithActionMenu\"\n\t\t\t\t:clickHandler=\"onClick\"\n\t\t\t\t:readonly=\"readonly\"\n\t\t\t\tref=\"selector\"\n\t\t\t\t@select=\"handleUserSelected\"\n\t\t\t\t@unfreeze=\"focus\"\n\t\t\t/>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:bindElement=\"$refs.container\"\n\t\t\t@close=\"closeHint\"\n\t\t>\n\t\t\t<RichLoc :text=\"cantChangeHint\" placeholder=\"[action]\">\n\t\t\t\t<template #action=\"{ text }\">\n\t\t\t\t\t<span @click=\"handleHintClick\">{{ text }}</span>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t</Hint>\n\t`,\n};\n"],"names":["Participant","name","components","UserCustomTagSelector","Popup","RichLoc","Hint","props","taskId","type","Number","String","required","dialogOptions","Object","preselected","Array","canChange","Function","cantChangeHint","hintClickHandler","selectorWithActionMenu","Boolean","default","dataset","readonly","emits","data","isPopupShown","computed","task","$store","getters","Model","Tasks","userInfo","userId","Users","methods","handleUserSelected","user","$emit","onClick","Promise","resolve","resolvePopupClosePromise","handleHintClick","closeHint","handleKeydown","event","key","ctrlKey","metaKey","$refs","selector","handleClick","focus","container","template"],"mappings":";;;;;;;;CAWA;AACA,OAAaA,WAAW,GAAG;GAC1BC,IAAI,EAAE,iBAAiB;GACvBC,UAAU,EAAE;4BACXC,uEAAqB;YACrBC,8BAAK;cACLC,kCAAO;WACPC;IACA;GACDC,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDC,aAAa,EAAE;OACdJ,IAAI,EAAEK,MAAM;OACZF,QAAQ,EAAE;MACV;KACDG,WAAW,EAAE;OACZN,IAAI,EAAEO,KAAK;OACXJ,QAAQ,EAAE;MACV;KACDK,SAAS,EAAE;OACVR,IAAI,EAAES,QAAQ;OACdN,QAAQ,EAAE;MACV;KACDO,cAAc,EAAE;OACfV,IAAI,EAAEE,MAAM;OACZC,QAAQ,EAAE;MACV;KACDQ,gBAAgB,EAAE;OACjBX,IAAI,EAAES,QAAQ;OACdN,QAAQ,EAAE;MACV;KACDS,sBAAsB,EAAE;OACvBZ,IAAI,EAAEa,OAAO;OACbC,OAAO,EAAE;MACT;KACDC,OAAO,EAAE;OACRf,IAAI,EAAEK,MAAM;OACZS,OAAO,EAAE;MACT;KACDE,QAAQ,EAAE;OACThB,IAAI,EAAEa,OAAO;OACbC,OAAO,EAAE;;IAEV;GACDG,KAAK,EAAE,CAAC,QAAQ,CAAC;GACjBC,IAAI,GACJ;KACC,OAAO;OACNC,YAAY,EAAE;MACd;IACD;GACDC,QAAQ,EAAE;KACTC,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAC,IAAI,CAAC1B,MAAM,CAAC;MACjE;KACD2B,QAAQ,GACR;OAAA;OACC,MAAM,GAAGC,MAAM,CAAS,yBAAG,IAAI,CAACrB,WAAW,CAAC,CAAC,CAAC,iCAAI,EAAE;OAEpD,OAAO,IAAI,CAACgB,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACI,KAAM,UAAS,CAAC,CAACD,MAAM,CAAC;;IAE7D;GACDE,OAAO,EAAE;KACRC,kBAAkB,CAACC,IAAe,EAClC;OACC,IAAI,CAACC,KAAK,CAAC,QAAQ,EAAED,IAAI,CAAC;MAC1B;KACD,MAAME,OAAO,GACb;OACC,IAAI,IAAI,CAACzB,SAAS,EAAE,EACpB;SACC,OAAO,IAAI;;OAGZ,IAAI,CAACW,YAAY,GAAG,IAAI;OAExB,OAAO,IAAIe,OAAO,CAAEC,OAAO,IAAK;SAC/B,IAAI,CAACC,wBAAwB,GAAGD,OAAO;QACvC,CAAC;MACF;KACDE,eAAe,GACf;OACC,IAAI,CAAC1B,gBAAgB,EAAE;OAEvB,IAAI,CAACyB,wBAAwB,CAAC,IAAI,CAAC;OAEnC,IAAI,CAACjB,YAAY,GAAG,KAAK;MACzB;KACDmB,SAAS,GACT;OACC,IAAI,CAACF,wBAAwB,CAAC,KAAK,CAAC;OAEpC,IAAI,CAACjB,YAAY,GAAG,KAAK;MACzB;KACDoB,aAAa,CAACC,KAAoB,EAClC;OACC,IAAIA,KAAK,CAACC,GAAG,KAAK,OAAO,IAAI,EAAED,KAAK,CAACE,OAAO,IAAIF,KAAK,CAACG,OAAO,CAAC,EAC9D;SACC,KAAK,IAAI,CAACC,KAAK,CAACC,QAAQ,CAACC,WAAW,EAAE;;MAEvC;KACDC,KAAK,GACL;OACC,IAAI,CAACH,KAAK,CAACI,SAAS,CAACD,KAAK,EAAE;;IAE7B;GACDE,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;CA0BZ,CAAC;;;;;;;;"}