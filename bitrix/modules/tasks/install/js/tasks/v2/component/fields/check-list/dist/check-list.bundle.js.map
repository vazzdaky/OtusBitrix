{"version":3,"file":"check-list.bundle.js","sources":["../src/check-list-notifier.js","../src/check-list-widget/check-list-item-panel-meta.js","../src/check-list-mixin.js","../src/check-list-meta.js","../src/check-list.js","../src/check-list-chip.js","../src/check-list-stub.js","../src/check-list-widget/check-list-widget-mixin.js","../src/check-list-widget/check-list-item-mixin.js","../src/check-list-widget/check-list-parent-item.js","../src/check-list-widget/check-list-child-item.js","../src/check-list-widget/check-list-add-item.js","../src/check-list-widget/check-list-widget.js","../src/check-list-widget/check-list-item-panel.js","../src/check-list-sheet.js","../src/check-list-popup.js"],"sourcesContent":["import { Loc, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\ntype Params = {\n\tcontent: string,\n\ttimerValue?: number,\n}\n\nexport class CheckListNotifier extends EventEmitter\n{\n\t#interval: ?number = null;\n\t#timerValue: number = 5;\n\t#counter: number = 5;\n\t#content: string = '';\n\n\t#balloonWithTimer: BX.UI.Notification.Balloon;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('Tasks.V2.CheckList.CheckListNotifier');\n\n\t\tthis.#content = params.content;\n\t\tthis.#timerValue = Type.isUndefined(params.timerValue) ? this.#timerValue : params.timerValue;\n\t}\n\n\tshowBalloonWithTimer(): void\n\t{\n\t\tthis.#counter = this.#timerValue;\n\n\t\tthis.#balloonWithTimer = UI.Notification.Center.notify({\n\t\t\tid: `check-list-balloon-${Text.getRandom()}`,\n\t\t\tcontent: this.#getBalloonContent(),\n\t\t\tactions: [{\n\t\t\t\ttitle: Loc.getMessage('TASKS_V2_CHECK_LIST_BALLOON_CANCEL'),\n\t\t\t\tevents: {\n\t\t\t\t\tmouseup: this.#handleCancelClick.bind(this),\n\t\t\t\t},\n\t\t\t}],\n\t\t\tevents: {\n\t\t\t\tonClose: this.#handleClosingBalloon.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#startTimer();\n\t}\n\n\t#startTimer(): void\n\t{\n\t\tthis.#interval = setInterval(() => {\n\t\t\tthis.#counter--;\n\n\t\t\tthis.#balloonWithTimer.update({ content: this.#getBalloonContent() });\n\n\t\t\tif (this.#counter <= 0)\n\t\t\t{\n\t\t\t\tthis.#balloonWithTimer.close();\n\n\t\t\t\tthis.emit('complete', true);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\t#handleCancelClick()\n\t{\n\t\tthis.#balloonWithTimer.close();\n\t}\n\n\t#handleClosingBalloon()\n\t{\n\t\tclearInterval(this.#interval);\n\n\t\tthis.emit('complete', false);\n\t}\n\n\t#getBalloonContent(): string\n\t{\n\t\treturn this.#content.replace('#countdown#', this.#counter);\n\t}\n}\n","import { Outline } from 'ui.icon-set.api.core';\n\nexport const PanelSection = Object.freeze({\n\tImportant: 'important',\n\tAttachments: 'attachments',\n\tMovement: 'movement',\n\tAccomplice: 'accomplice',\n\tAuditor: 'auditor',\n\tForward: 'forward',\n\tDelete: 'delete',\n\tCancel: 'cancel',\n});\n\nexport const PanelAction = Object.freeze({\n\tSetImportant: 'setImportant',\n\tAttachFile: 'attachFile',\n\tMoveRight: 'moveRight',\n\tMoveLeft: 'moveLeft',\n\tAssignAccomplice: 'assignAccomplice',\n\tAssignAuditor: 'assignAuditor',\n\tForward: 'forward',\n\tDelete: 'delete',\n\tCancel: 'cancel',\n});\n\nexport const PanelMeta = Object.freeze({\n\tdefaultSections: [\n\t\t{\n\t\t\tname: PanelSection.Important,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.FIRE,\n\t\t\t\t\tactiveIcon: Outline.FIRE_SOLID,\n\t\t\t\t\taction: PanelAction.SetImportant,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_IMPORTANT_HINT',\n\t\t\t\t\tclassName: '--important',\n\t\t\t\t\thoverable: false,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Attachments,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.ATTACH,\n\t\t\t\t\taction: PanelAction.AttachFile,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_ATTACH_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Movement,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.POINT_RIGHT,\n\t\t\t\t\taction: PanelAction.MoveRight,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_MOVE_RIGHT_HINT',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.POINT_LEFT,\n\t\t\t\t\taction: PanelAction.MoveLeft,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_MOVE_LEFT_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Accomplice,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.PERSON,\n\t\t\t\t\taction: PanelAction.AssignAccomplice,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_ACCOMPLICE_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Auditor,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.OBSERVER,\n\t\t\t\t\taction: PanelAction.AssignAuditor,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_AUDITOR_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Forward,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.FORWARD,\n\t\t\t\t\taction: PanelAction.Forward,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_FORWARD_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Delete,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.TRASHCAN,\n\t\t\t\t\taction: PanelAction.Delete,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Cancel,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.CROSS_L,\n\t\t\t\t\taction: PanelAction.Cancel,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_CANCEL_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n});\n\nexport type Section = {\n\tname: string,\n\titems: Array<Item>\n};\n\nexport type Item = {\n\ticon: string,\n\tactiveIcon?: string,\n\taction: string,\n\tlabel?: string,\n\thint?: string,\n\tactive?: boolean,\n\thoverable?: boolean,\n\tdisabled?: boolean,\n\tdisabledHint?: string,\n\tclassName?: string,\n};\n\nexport type VisibleSections = Array<Section>;\nexport type VisibleActions = Array<string>;\nexport type ActiveActions = Array<string>;\n","import { Dom, Event, Text, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nimport { BMenu, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport { Item } from 'ui.entity-selector';\nimport type { MenuOptions } from 'ui.system.menu';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model } from 'tasks.v2.const';\nimport { UserSelectorDialog } from 'tasks.v2.lib.user-selector-dialog';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\nimport { participantMeta } from 'tasks.v2.component.elements.participant-list';\n\nimport { CheckListNotifier } from './check-list-notifier';\nimport { PanelAction, type VisibleActions, type ActiveActions } from './check-list-widget/check-list-item-panel-meta';\n\nexport const CheckListMixin = {\n\tcomponents: {\n\t\tBMenu,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlistShownItemPanels: [],\n\t\t\titemPanelIsShown: false,\n\t\t\tcheckListWasUpdated: false,\n\t\t\titemId: null,\n\t\t\titemPanelStyles: {\n\t\t\t\ttop: '0',\n\t\t\t\tdisplay: 'flex',\n\t\t\t},\n\t\t\tisItemPanelFreeze: false,\n\t\t\titemPanelTopOffset: 0,\n\t\t\titemPanelTopLimit: 0,\n\t\t\titemsRefs: {},\n\t\t\tisForwardMenuShown: false,\n\t\t\tforwardMenuSectionCode: 'createSection',\n\t\t\tforwardBindElement: null,\n\t\t\titemsToDelete: [],\n\t\t\tcollapsedItems: new Map(),\n\t\t\tshownPopups: new Set(),\n\t\t};\n\t},\n\tprovide(): Object\n\t{\n\t\treturn {\n\t\t\tsetItemsRef: this.setItemsRef,\n\t\t\tgetItemsRef: this.getItemsRef,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tparentCheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists.filter((checkList: CheckListModel) => checkList.parentId === 0);\n\t\t},\n\t\thasFewParentCheckLists(): boolean\n\t\t{\n\t\t\treturn this.parentCheckLists.length > 1;\n\t\t},\n\t\titem(): ?CheckListModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getById`](this.itemId);\n\t\t},\n\t\titemGroupModeSelected(): boolean\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.item.groupMode?.selected === true;\n\t\t},\n\t\tsiblings(): CheckListModel[]\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn this.checkLists.filter((item: CheckListModel) => item.parentId === this.item.parentId);\n\t\t},\n\t\tchildren(): CheckListModel[]\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn this.checkLists.filter((item: CheckListModel) => {\n\t\t\t\treturn item.parentId === this.item.id;\n\t\t\t});\n\t\t},\n\t\tvisiblePanelActions(): VisibleActions\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tlet actions = [\n\t\t\t\tPanelAction.SetImportant,\n\t\t\t\tPanelAction.MoveRight,\n\t\t\t\tPanelAction.MoveLeft,\n\t\t\t\tPanelAction.AssignAccomplice,\n\t\t\t\tPanelAction.AssignAuditor,\n\t\t\t\tPanelAction.Forward,\n\t\t\t\tPanelAction.Delete,\n\t\t\t];\n\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tactions.push(PanelAction.Cancel);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactions.push(PanelAction.AttachFile);\n\t\t\t}\n\n\t\t\tif (this.item.parentId === 0)\n\t\t\t{\n\t\t\t\tactions = [\n\t\t\t\t\tPanelAction.AssignAccomplice,\n\t\t\t\t\tPanelAction.AssignAuditor,\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tconst limits = Core.getParams().limits;\n\t\t\tconst stakeholdersActions = new Set([\n\t\t\t\tPanelAction.AssignAccomplice,\n\t\t\t\tPanelAction.AssignAuditor,\n\t\t\t]);\n\n\t\t\treturn actions.filter((action: string) => {\n\t\t\t\tconst isDisabledStakeholders = stakeholdersActions.has(action) && !limits.stakeholders;\n\n\t\t\t\treturn !isDisabledStakeholders;\n\t\t\t});\n\t\t},\n\t\tdisabledPanelActions(): []\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst disabledActions = [];\n\n\t\t\tconst itemLevel = this.getItemLevel(this.item);\n\t\t\tconst canModify = this.item.actions.modify === true;\n\t\t\tconst canRemove = this.item.actions.remove === true;\n\n\t\t\tconst conditionHandlers = {\n\t\t\t\t[PanelAction.SetImportant]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.AttachFile]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.MoveLeft]: () => {\n\t\t\t\t\treturn itemLevel === 1 || canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.MoveRight]: () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\titemLevel === 5\n\t\t\t\t\t\t|| this.item.sortIndex === 0\n\t\t\t\t\t\t|| canModify === false\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t[PanelAction.AssignAccomplice]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.AssignAuditor]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.Forward]: () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tcanModify === false\n\t\t\t\t\t\t|| this.item.title === ''\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t[PanelAction.Delete]: () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tcanRemove === false\n\t\t\t\t\t\t|| this.item.title === ''\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tObject.entries(conditionHandlers)\n\t\t\t\t.forEach(([action: string, condition: function]) => {\n\t\t\t\t\tif (condition())\n\t\t\t\t\t{\n\t\t\t\t\t\tdisabledActions.push(action);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\n\t\t\treturn disabledActions;\n\t\t},\n\t\tactivePanelActions(): ActiveActions\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst actions = [];\n\n\t\t\tif (this.item.isImportant)\n\t\t\t{\n\t\t\t\tactions.push(PanelAction.SetImportant);\n\t\t\t}\n\n\t\t\treturn actions;\n\t\t},\n\t\tforwardMenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `check-list-item-forward-menu-${this.item.id}`,\n\t\t\t\tbindElement: this.forwardBindElement,\n\t\t\t\tmaxWidth: 400,\n\t\t\t\tmaxHeight: 300,\n\t\t\t\toffsetLeft: -110,\n\t\t\t\tsections: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcode: this.forwardMenuSectionCode,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.forwardMenuItems,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t\tforwardMenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\tconst checklistItems = this.parentCheckLists\n\t\t\t\t.filter((checkList: CheckListModel) => checkList.id !== this.item.parentId)\n\t\t\t\t.map((checkList: CheckListModel) => ({\n\t\t\t\t\ttitle: checkList.title,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `ForwardMenuCheckList-${checkList.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tthis.hideItemPanel();\n\t\t\t\t\t\tvoid this.forwardToChecklist(checkList.id);\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\treturn [\n\t\t\t\t...checklistItems,\n\t\t\t\t{\n\t\t\t\t\tsectionCode: this.forwardMenuSectionCode,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_FORWARD_MENU_CREATE'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `ForwardMenuCreateNew-${this.item.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: this.forwardToNewChecklist.bind(this),\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tstub(): boolean\n\t\t{\n\t\t\treturn this.checkLists.length === 0 || this.emptyList === true;\n\t\t},\n\t\temptyList(): boolean\n\t\t{\n\t\t\tconst siblings = this.parentCheckLists\n\t\t\t\t.filter((item: CheckListModel) => !this.itemsToDelete.includes(item.id));\n\n\t\t\treturn siblings.length === 0;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tEvent.bind(this.$refs.list, 'scroll', this.handleScroll);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(this.$refs.list, 'scroll', this.handleScroll);\n\t},\n\tmethods: {\n\t\thandleScroll(): void\n\t\t{\n\t\t\tthis.isForwardMenuShown = false;\n\n\t\t\tthis.updatePanelPosition();\n\t\t},\n\t\tasync saveCheckList(): Promise<void>\n\t\t{\n\t\t\tif (this.checkListWasUpdated && this.isEdit)\n\t\t\t{\n\t\t\t\tawait checkListService.save(this.taskId, this.checkLists);\n\t\t\t}\n\n\t\t\tif (!this.isDemoCheckListModified())\n\t\t\t{\n\t\t\t\tthis.removeChecklists();\n\t\t\t}\n\n\t\t\tthis.checkListWasUpdated = false;\n\t\t},\n\t\tisDemoCheckListModified(): boolean\n\t\t{\n\t\t\tif (this.checkLists.length !== 1)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst [checkList] = this.checkLists;\n\t\t\tconst demoTitle = this.loc('TASKS_V2_CHECK_LIST_TITLE_NUMBER', { '#number#': 1 });\n\n\t\t\treturn (\n\t\t\t\tcheckList.title !== demoTitle\n\t\t\t\t|| checkList.accomplices.length > 0\n\t\t\t\t|| checkList.auditors.length > 0\n\t\t\t);\n\t\t},\n\t\tremoveChecklists(): void\n\t\t{\n\t\t\tthis.checkLists\n\t\t\t\t.filter((checklist: CheckListModel) => checklist.parentId === 0)\n\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\tthis.removeItem(item.id);\n\t\t\t\t});\n\t\t},\n\t\tasync addCheckList(empty: boolean = false): Promise<string>\n\t\t{\n\t\t\tconst parentId = Text.getRandom();\n\t\t\tconst childId = Text.getRandom();\n\n\t\t\tconst items = [this.getDataForNewCheckList(parentId)];\n\t\t\tif (!empty)\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: childId,\n\t\t\t\t\tnodeId: childId,\n\t\t\t\t\tparentId,\n\t\t\t\t\tsortIndex: 0,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait this.$store.dispatch(`${Model.CheckList}/insertMany`, items);\n\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields: { checklist: [...this.task.checklist, parentId, childId] },\n\t\t\t});\n\n\t\t\treturn parentId;\n\t\t},\n\t\taddFastCheckList(): void\n\t\t{\n\t\t\tconst parentId = Text.getRandom();\n\n\t\t\tthis.$store.dispatch(\n\t\t\t\t`${Model.CheckList}/insert`,\n\t\t\t\tthis.getDataForNewCheckList(parentId),\n\t\t\t);\n\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields: { checklist: [...this.task.checklist, parentId] },\n\t\t\t});\n\n\t\t\tvoid this.saveCheckList();\n\t\t},\n\t\tshowForwardMenu(node: HTMLElement): void\n\t\t{\n\t\t\tthis.forwardBindElement = node;\n\n\t\t\tthis.isForwardMenuShown = true;\n\t\t},\n\t\tgetCheckListsNumber(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === 0 && !this.itemsToDelete.includes(checklist.id);\n\t\t\t}).length;\n\t\t},\n\t\tgetDataForNewCheckList(parentId: string): CheckListModel\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: parentId,\n\t\t\t\tnodeId: parentId,\n\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_TITLE_NUMBER', { '#number#': this.getCountForNewCheckList() }),\n\t\t\t\tsortIndex: this.getSortForNewCheckList(),\n\t\t\t};\n\t\t},\n\t\tgetSortForNewCheckList(): number\n\t\t{\n\t\t\treturn this.getCheckListsNumber();\n\t\t},\n\t\tgetCountForNewCheckList(): number\n\t\t{\n\t\t\treturn this.getCheckListsNumber() + 1;\n\t\t},\n\t\tsetItemsRef(id, ref): void\n\t\t{\n\t\t\tthis.itemsRefs[id] = ref;\n\t\t},\n\t\tgetItemsRef(id): Object\n\t\t{\n\t\t\treturn this.itemsRefs[id];\n\t\t},\n\t\tfocusToItem(itemId: number | string): void\n\t\t{\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.getItemsRef(itemId)?.$refs.growingTextArea?.focusTextarea();\n\t\t\t});\n\t\t},\n\t\tshowItem(itemId: number | string): void\n\t\t{\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.getItemsRef(itemId)?.show();\n\t\t\t});\n\t\t},\n\t\thideItem(itemId: number | string): void\n\t\t{\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.getItemsRef(itemId)?.hide();\n\t\t\t});\n\t\t},\n\t\taddItem({ id, sort }: {id: number | string, sort: number}): void\n\t\t{\n\t\t\tif (this.hasActiveGroupMode())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemId = id;\n\n\t\t\tconst childId = Text.getRandom();\n\t\t\tconst sortIndex = sort ?? this.getSort();\n\t\t\tconst parentId = this.item.parentId === 0 ? this.item.id : this.item.parentId;\n\n\t\t\tthis.resortSiblingsItems(sortIndex);\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/insert`, {\n\t\t\t\tid: childId,\n\t\t\t\tnodeId: childId,\n\t\t\t\tparentId,\n\t\t\t\tsortIndex,\n\t\t\t});\n\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields: { checklist: [...this.task.checklist, childId] },\n\t\t\t});\n\n\t\t\tthis.syncParentCompletionState(childId);\n\t\t},\n\t\tremoveItem(id: number | string, isRootCall: boolean = true): void\n\t\t{\n\t\t\tif (!this.task)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemId = id;\n\n\t\t\tif (this.item?.title)\n\t\t\t{\n\t\t\t\tthis.checkListWasUpdated = true;\n\t\t\t}\n\n\t\t\tconst parentId = this.item?.parentId || null;\n\n\t\t\tif (this.children.length > 0)\n\t\t\t{\n\t\t\t\tthis.children.forEach((child: CheckListModel) => {\n\t\t\t\t\tthis.removeItem(child.id, false);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields: { checklist: this.task.checklist.filter((itemId) => itemId !== id) },\n\t\t\t});\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/delete`, id);\n\n\t\t\tif (isRootCall)\n\t\t\t{\n\t\t\t\tthis.resortSiblingsItems();\n\t\t\t}\n\n\t\t\tthis.syncParentCompletionState(id, parentId);\n\n\t\t\tfileService.delete(id, EntityTypes.CheckListItem);\n\t\t},\n\t\tresortSiblingsItems(sortIndex?: number): void\n\t\t{\n\t\t\tconst updates: CheckListModel[] = [];\n\n\t\t\tif (Type.isUndefined(sortIndex))\n\t\t\t{\n\t\t\t\tconst siblings = this.siblings.sort((a: CheckListModel, b: CheckListModel) => {\n\t\t\t\t\treturn a.sortIndex - b.sortIndex;\n\t\t\t\t});\n\n\t\t\t\tsiblings.forEach((item, index) => {\n\t\t\t\t\tif (item.sortIndex !== index)\n\t\t\t\t\t{\n\t\t\t\t\t\tupdates.push({\n\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\tsortIndex: index,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.siblings\n\t\t\t\t\t.filter((item: CheckListModel) => item.sortIndex >= sortIndex)\n\t\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\t\tupdates.push({\n\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\tsortIndex: item.sortIndex + 1,\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (updates.length > 0)\n\t\t\t{\n\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\t\t\t}\n\t\t},\n\t\tgetSort(): number\n\t\t{\n\t\t\tif (this.item && this.item.parentId === 0)\n\t\t\t{\n\t\t\t\treturn this.children.length;\n\t\t\t}\n\n\t\t\treturn this.siblings.length;\n\t\t},\n\t\ttoggleCompleted({ itemId, collapsed }: { itemId: number | string, collapsed: boolean }): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tconst children = this.getAllChildren();\n\n\t\t\tconst completedChildren = children.filter((item: CheckListModel) => item.isComplete === true);\n\t\t\tcompletedChildren.forEach((item: CheckListModel) => {\n\t\t\t\tif (collapsed === false)\n\t\t\t\t{\n\t\t\t\t\tthis.showItem(item.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hideItem(item.id);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\thandleUpdate(): void\n\t\t{\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\thandleRemove(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.freeze();\n\n\t\t\tthis.itemsToDelete = [...this.itemsToDelete, itemId];\n\n\t\t\tthis.hideItem(itemId);\n\n\t\t\tconst messageKey = (\n\t\t\t\tthis.item.parentId === 0\n\t\t\t\t\t? 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_PARENT'\n\t\t\t\t\t: 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD'\n\t\t\t);\n\n\t\t\tconst notifier = new CheckListNotifier({\n\t\t\t\tcontent: this.loc(messageKey),\n\t\t\t});\n\t\t\tnotifier.subscribeOnce('complete', (baseEvent: BaseEvent) => {\n\t\t\t\tconst timerHasEnded = baseEvent.getData();\n\n\t\t\t\tif (timerHasEnded)\n\t\t\t\t{\n\t\t\t\t\tthis.removeItem(itemId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showItem(itemId);\n\t\t\t\t}\n\n\t\t\t\tthis.itemsToDelete = this.itemsToDelete.filter((id) => id !== itemId);\n\n\t\t\t\tthis.unfreeze();\n\t\t\t});\n\n\t\t\tnotifier.showBalloonWithTimer();\n\t\t},\n\t\tasync handleGroupRemove(itemId: number | string): Promise<void>\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.freeze();\n\n\t\t\tthis.itemsToDelete = [...this.itemsToDelete, itemId];\n\n\t\t\tthis.hideItemPanel(itemId);\n\n\t\t\tconst allSelectedItems = this.getAllSelectedItems();\n\n\t\t\tconst nearestItem = this.findNearestItem(false);\n\t\t\tif (nearestItem)\n\t\t\t{\n\t\t\t\tawait this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\t\tid: nearestItem.id,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.showItemPanel(nearestItem.id);\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\tallSelectedItems.forEach((item: CheckListModel) => {\n\t\t\t\tthis.hideItem(item.id);\n\t\t\t});\n\n\t\t\tconst messageKey = (\n\t\t\t\tallSelectedItems.length > 1\n\t\t\t\t\t? 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILDREN'\n\t\t\t\t\t: 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD'\n\t\t\t);\n\n\t\t\tconst notifier = new CheckListNotifier({\n\t\t\t\tcontent: this.loc(messageKey),\n\t\t\t});\n\t\t\tnotifier.subscribeOnce('complete', (baseEvent: BaseEvent) => {\n\t\t\t\tconst timerHasEnded = baseEvent.getData();\n\t\t\t\tallSelectedItems.forEach((item: CheckListModel) => {\n\t\t\t\t\tif (timerHasEnded)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.removeItem(item.id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showItem(item.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.itemsToDelete = this.itemsToDelete.filter((id) => id !== item.id);\n\t\t\t\t});\n\t\t\t\tif (timerHasEnded)\n\t\t\t\t{\n\t\t\t\t\tif (nearestItem && !this.itemsToDelete.includes(nearestItem.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showItemPanel(nearestItem.id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.cancelGroupMode();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showItemPanel(this.item.id);\n\t\t\t\t}\n\n\t\t\t\tthis.unfreeze();\n\t\t\t});\n\n\t\t\tnotifier.showBalloonWithTimer();\n\t\t},\n\t\thandleToggleIsComplete(itemId: number | string): void\n\t\t{\n\t\t\tthis.syncParentCompletionState(itemId);\n\t\t},\n\t\thandleFocus(itemId: number | string): void\n\t\t{\n\t\t\tthis.showItemPanel(itemId);\n\t\t},\n\t\thandleBlur(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tif (this.isItemPanelFreeze === false)\n\t\t\t{\n\t\t\t\tthis.hideItemPanel(itemId);\n\t\t\t}\n\t\t},\n\t\thandleEmptyBlur(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tif (this.item.parentId === 0)\n\t\t\t{\n\t\t\t\tthis.setDefaultCheckListTitle(itemId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isItemPanelFreeze === false)\n\t\t\t{\n\t\t\t\tthis.removeItem(itemId);\n\t\t\t}\n\t\t},\n\t\thandleGroupMode(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tconst firstChild = this.getFirstChild();\n\t\t\tif (!firstChild)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.activateGroupMode(itemId);\n\t\t\tthis.showItemPanel(firstChild.id);\n\t\t},\n\t\thandleGroupModeSelect(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tthis.showItemPanel(itemId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showItemPanelOnNearestSelectedItem(itemId);\n\t\t\t}\n\t\t},\n\t\tshowItemPanel(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.itemPanelIsShown = true;\n\n\t\t\tif (!this.listShownItemPanels.includes(itemId))\n\t\t\t{\n\t\t\t\tthis.listShownItemPanels = [...this.listShownItemPanels, itemId];\n\t\t\t}\n\n\t\t\tvoid this.$nextTick(() => this.updatePanelPosition());\n\t\t},\n\t\thideItemPanel(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemPanelIsShown = false;\n\n\t\t\tif (this.hasActiveGroupMode() && this.getAllSelectedItems().length === 0)\n\t\t\t{\n\t\t\t\tthis.deactivateGroupMode();\n\t\t\t}\n\n\t\t\tthis.listShownItemPanels = this.listShownItemPanels.filter((id) => id !== itemId);\n\n\t\t\tthis.isItemPanelFreeze = false;\n\t\t},\n\t\tshowItemPanelOnNearestSelectedItem(itemId: number | string): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-lonely-if\n\t\t\tconst nearestSelectedItem = this.findNearestItem(true);\n\t\t\tif (nearestSelectedItem)\n\t\t\t{\n\t\t\t\tthis.showItemPanel(nearestSelectedItem.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideItemPanel(itemId);\n\t\t\t}\n\t\t},\n\t\tupdatePanelPosition()\n\t\t{\n\t\t\tif (this.itemPanelIsShown === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst itemRef = this.$refs.list.querySelector([`[data-id=\"${this.item.id}\"]`]);\n\n\t\t\tconst panelRect = Dom.getPosition(this.$refs.panel.$el);\n\t\t\tconst itemRect = Dom.getRelativePosition(itemRef, this.$refs.list);\n\t\t\tconst isParentItem = (this.item.parentId === 0);\n\n\t\t\tconst paddingOffset = 24;\n\t\t\tconst panelWidth = panelRect.width === 0 ? 304 : panelRect.width;\n\n\t\t\tconst top = itemRect.top - 10;\n\n\t\t\tif (isParentItem)\n\t\t\t{\n\t\t\t\tconst left = itemRect.width - panelWidth - (paddingOffset * 2) - 80;\n\t\t\t\tconst display = top > -30 && top < this.itemPanelTopLimit ? 'flex' : 'none';\n\n\t\t\t\tthis.itemPanelStyles = {\n\t\t\t\t\ttop: `${top}px`,\n\t\t\t\t\tleft: `${left}px`,\n\t\t\t\t\tdisplay,\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst left = itemRect.width - panelWidth - paddingOffset;\n\t\t\t\tconst display = top > 40 && top < this.itemPanelTopLimit ? 'flex' : 'none';\n\n\t\t\t\tthis.itemPanelStyles = {\n\t\t\t\t\ttop: `${top}px`,\n\t\t\t\t\tleft: `${left}px`,\n\t\t\t\t\tdisplay,\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\thandlePanelAction({ action, node }: {action: string, node: HTMLElement}): void\n\t\t{\n\t\t\tconst actionHandlers = {\n\t\t\t\t[PanelAction.SetImportant]: (n) => this.setImportant(n),\n\t\t\t\t[PanelAction.AttachFile]: (n) => this.attachFile(n),\n\t\t\t\t[PanelAction.MoveRight]: (n) => this.handleMoveRight(n),\n\t\t\t\t[PanelAction.MoveLeft]: (n) => this.handleMoveLeft(n),\n\t\t\t\t[PanelAction.AssignAccomplice]: (n) => {\n\t\t\t\t\tif (!this.isItemPanelFreeze)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showParticipantDialog(n, 'accomplices');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[PanelAction.AssignAuditor]: (n) => {\n\t\t\t\t\tif (!this.isItemPanelFreeze)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showParticipantDialog(n, 'auditors');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[PanelAction.Forward]: (n) => this.forward(n),\n\t\t\t\t[PanelAction.Delete]: (n) => this.delete(n),\n\t\t\t\t[PanelAction.Cancel]: (n) => this.cancelGroupMode(n),\n\t\t\t};\n\n\t\t\tactionHandlers[action]?.(node);\n\t\t},\n\t\tsetImportant(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tconst updates = this.getAllSelectedItems()\n\t\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\tisImportant: !item.isImportant,\n\t\t\t\t\t}));\n\n\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\t\tid: this.item.id,\n\t\t\t\t\tfields: { isImportant: !this.item.isImportant },\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\tattachFile(node: HTMLElement): void\n\t\t{\n\t\t\tthis.isItemPanelFreeze = true;\n\n\t\t\tfileService.get(this.item.id, EntityTypes.CheckListItem).browse({\n\t\t\t\tbindElement: node,\n\t\t\t});\n\n\t\t\tfileService.get(this.item.id, EntityTypes.CheckListItem).subscribeOnce('onFileComplete', () => {\n\t\t\t\tthis.isItemPanelFreeze = false;\n\n\t\t\t\tthis.focusToItem(this.item.id);\n\t\t\t});\n\t\t},\n\t\thandleMoveRight(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tthis.getAllSelectedItems()\n\t\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex)\n\t\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\t\tthis.moveRight(item);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveRight(this.item);\n\t\t\t}\n\t\t},\n\t\tmoveRight(item: CheckListModel): void\n\t\t{\n\t\t\tif (item.parentId === 0 || this.getItemLevel(item) > 5)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst siblings = this.checkLists\n\t\t\t\t.filter((sibling: CheckListModel) => sibling.parentId === item.parentId)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => (a.sortIndex || 0) - (b.sortIndex || 0));\n\n\t\t\tconst currentIndex = siblings.findIndex((sibling: CheckListModel) => sibling.id === item.id);\n\t\t\tif (currentIndex <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet newParent = null;\n\t\t\tfor (let i = currentIndex - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tconst candidate = siblings[i];\n\t\t\t\tif (!this.isItemDescendant(candidate, item))\n\t\t\t\t{\n\t\t\t\t\tnewParent = candidate;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!newParent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newParentChildren = this.checkLists\n\t\t\t\t.filter((child: CheckListModel) => child.parentId === newParent.id)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\t\tconst updates = siblings\n\t\t\t\t.filter((sibling, index) => index > currentIndex)\n\t\t\t\t.map((sibling) => ({\n\t\t\t\t\t...sibling,\n\t\t\t\t\tsortIndex: sibling.sortIndex - 1,\n\t\t\t\t}));\n\n\t\t\tupdates.push({\n\t\t\t\t...item,\n\t\t\t\tparentId: newParent.id,\n\t\t\t\tparentNodeId: newParent.nodeId,\n\t\t\t\tsortIndex: newParentChildren.length > 0\n\t\t\t\t\t? newParentChildren[newParentChildren.length - 1].sortIndex + 1\n\t\t\t\t\t: 0,\n\t\t\t});\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\t\t\tthis.checkListWasUpdated = true;\n\n\t\t\tif (!item.groupMode?.active)\n\t\t\t{\n\t\t\t\tthis.focusToItem(item.id);\n\t\t\t}\n\t\t},\n\t\thandleMoveLeft(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tthis.getAllSelectedItems()\n\t\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => b.sortIndex - a.sortIndex)\n\t\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\t\tthis.moveLeft(item);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveLeft(this.item);\n\t\t\t}\n\t\t},\n\t\tmoveLeft(item: CheckListModel): void\n\t\t{\n\t\t\tif (item.parentId === 0 || this.getItemLevel(item) <= 1)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentParent = this.checkLists.find((parent: CheckListModel) => parent.id === item.parentId);\n\t\t\tif (!currentParent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newParentId = currentParent.parentId || 0;\n\t\t\tconst newSiblings = this.checkLists\n\t\t\t\t.filter((sibling: CheckListModel) => sibling.parentId === newParentId)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\t\tconst parentInNewListIndex = newSiblings\n\t\t\t\t.findIndex((sibling: CheckListModel) => sibling.id === currentParent.id);\n\n\t\t\tconst currentSiblingsUpdates = this.checkLists\n\t\t\t\t.filter((sibling: CheckListModel) => (\n\t\t\t\t\tsibling.parentId === item.parentId\n\t\t\t\t\t&& sibling.sortIndex > item.sortIndex\n\t\t\t\t))\n\t\t\t\t.map((sibling: CheckListModel) => ({\n\t\t\t\t\t...sibling,\n\t\t\t\t\tsortIndex: sibling.sortIndex - 1,\n\t\t\t\t}));\n\n\t\t\tlet newSortIndex = 0;\n\t\t\tif (\n\t\t\t\tparentInNewListIndex === -1\n\t\t\t\t|| parentInNewListIndex === newSiblings.length - 1\n\t\t\t)\n\t\t\t{\n\t\t\t\tnewSortIndex = newSiblings.length > 0 ? newSiblings[newSiblings.length - 1].sortIndex + 1 : 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewSortIndex = newSiblings[parentInNewListIndex].sortIndex + 1;\n\n\t\t\t\tconst shiftUpdates = newSiblings\n\t\t\t\t\t.filter((sibling: CheckListModel) => sibling.sortIndex >= newSortIndex)\n\t\t\t\t\t.map((sibling: CheckListModel) => ({\n\t\t\t\t\t\t...sibling,\n\t\t\t\t\t\tsortIndex: sibling.sortIndex + 1,\n\t\t\t\t\t}));\n\n\t\t\t\tcurrentSiblingsUpdates.push(...shiftUpdates);\n\t\t\t}\n\n\t\t\tconst movedItemUpdate = {\n\t\t\t\t...item,\n\t\t\t\tparentId: newParentId,\n\t\t\t\tparentNodeId: currentParent.parentNodeId || null,\n\t\t\t\tsortIndex: newSortIndex,\n\t\t\t};\n\n\t\t\tconst updates = [...currentSiblingsUpdates, movedItemUpdate];\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\n\t\t\tthis.checkListWasUpdated = true;\n\n\t\t\tif (!item.groupMode?.active)\n\t\t\t{\n\t\t\t\tthis.focusToItem(item.id);\n\t\t\t}\n\t\t},\n\t\tisItemDescendant(potentialAncestor: CheckListModel, item: CheckListModel): boolean\n\t\t{\n\t\t\tif (item.parentId === potentialAncestor.id)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (item.parentId === 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst parent = this.checkLists.find((i: CheckListModel) => i.id === item.parentId);\n\t\t\tif (!parent)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.isItemDescendant(potentialAncestor, parent);\n\t\t},\n\t\tassignAccomplice(node: HTMLElement): void\n\t\t{\n\t\t\tthis.showParticipantDialog(node, 'accomplices');\n\t\t},\n\t\tassignAuditor(node: HTMLElement): void\n\t\t{\n\t\t\tthis.showParticipantDialog(node, 'auditors');\n\t\t},\n\t\tasync forward(node: HTMLElement): Promise<void>\n\t\t{\n\t\t\tif (this.hasFewParentCheckLists)\n\t\t\t{\n\t\t\t\tthis.showForwardMenu(node);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideItemPanel();\n\n\t\t\t\tvoid this.forwardToNewChecklist();\n\t\t\t}\n\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\tasync forwardToNewChecklist(): Promise<void>\n\t\t{\n\t\t\tconst newParentId = await this.addCheckList(true);\n\n\t\t\tvoid this.forwardToChecklist(newParentId);\n\t\t},\n\t\tasync forwardToChecklist(parentId: number | string): Promise<void>\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tconst allSelectedItems = this.getAllSelectedItems();\n\t\t\t\tconst nearestItem = this.findNearestItem(false, allSelectedItems);\n\t\t\t\tif (nearestItem)\n\t\t\t\t{\n\t\t\t\t\tthis.showItemPanel(nearestItem.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.cancelGroupMode();\n\t\t\t\t}\n\n\t\t\t\tconst allSelectedWithChildren = this.getAllSelectedItemsWithChildren();\n\n\t\t\t\tconst selectedItemsIds = new Set(allSelectedItems.map((item: CheckListModel) => item.id));\n\n\t\t\t\tconst updates = [];\n\n\t\t\t\tallSelectedItems.forEach((item: CheckListModel) => {\n\t\t\t\t\tconst shouldUpdateParentId = !selectedItemsIds.has(item.parentId);\n\t\t\t\t\tupdates.push({\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\tparentId: shouldUpdateParentId ? parentId : item.parentId,\n\t\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\t\tselected: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tallSelectedWithChildren.forEach((item: CheckListModel) => {\n\t\t\t\t\tif (!selectedItemsIds.has(item.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tupdates.push({\n\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\t\t\tselected: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tawait this.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\n\t\t\t\tif (nearestItem)\n\t\t\t\t{\n\t\t\t\t\tvoid this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\t\t\tid: nearestItem.id,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\t\tid: this.item.id,\n\t\t\t\t\tfields: { parentId },\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tdelete(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tvoid this.handleGroupRemove(this.item.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideItemPanel();\n\t\t\t\tthis.handleRemove(this.item.id);\n\t\t\t}\n\t\t},\n\t\tcancelGroupMode(): void\n\t\t{\n\t\t\tthis.deactivateGroupMode();\n\t\t\tthis.hideItemPanel();\n\t\t},\n\t\tshowParticipantDialog(targetNode: HTMLElement, type: 'accomplices' | 'auditors'): void\n\t\t{\n\t\t\tthis.isItemPanelFreeze = true;\n\n\t\t\tconst itemId = this.item.id;\n\t\t\tconst preselected = this.preselectedParticipants(type);\n\n\t\t\tthis.selectors ??= {};\n\n\t\t\tconst selectorId = `${type}-${itemId}`;\n\n\t\t\tthis.selectors[selectorId] ??= new UserSelectorDialog({\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tpreselected,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\t...participantMeta.dialogOptions(\n\t\t\t\t\t\tthis.taskId,\n\t\t\t\t\t\t`check-list-${selectorId}`,\n\t\t\t\t\t),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonShow: (baseEvent: BaseEvent) => {\n\t\t\t\t\t\t\t\tconst popup = baseEvent.getTarget();\n\t\t\t\t\t\t\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\t\t\t\t\t\t\tconst targetNodeWidth = 10;\n\n\t\t\t\t\t\t\t\tconst offsetLeft = targetNodeWidth - (popupWidth / 2);\n\t\t\t\t\t\t\t\tconst angleShift = Popup.getOption('angleLeftOffset') - Popup.getOption('angleMinTop');\n\n\t\t\t\t\t\t\t\tpopup.setAngle({ offset: popupWidth / 2 - angleShift });\n\t\t\t\t\t\t\t\tpopup.setOffset({ offsetLeft: offsetLeft + Popup.getOption('angleLeftOffset') });\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\t\tconst users = this.selectors[selectorId].getDialog()\n\t\t\t\t\t\t\t\t\t.getSelectedItems().map((item: Item) => ({\n\t\t\t\t\t\t\t\t\t\tid: item.getId(),\n\t\t\t\t\t\t\t\t\t\tname: item.getTitle(),\n\t\t\t\t\t\t\t\t\t\timage: item.getAvatar(),\n\t\t\t\t\t\t\t\t\t\ttype: item.getEntityType(),\n\t\t\t\t\t\t\t\t\t}));\n\n\t\t\t\t\t\t\t\tthis.saveParticipants(itemId, type, users);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonHide: () => {\n\t\t\t\t\t\tthis.isItemPanelFreeze = false;\n\n\t\t\t\t\t\tif (!this.itemGroupModeSelected)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.focusToItem(itemId);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.updatePanelPosition();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.selectors[selectorId].show(targetNode);\n\t\t},\n\t\tpreselectedParticipants(type: 'accomplices' | 'auditors'): [string, number][]\n\t\t{\n\t\t\tswitch (type)\n\t\t\t{\n\t\t\t\tcase 'accomplices':\n\t\t\t\t\treturn this.item.accomplices.map((user: UserModel) => ['user', user.id]);\n\t\t\t\tcase 'auditors':\n\t\t\t\t\treturn this.item.auditors.map((user: UserModel) => ['user', user.id]);\n\t\t\t\tdefault:\n\t\t\t\t\treturn [];\n\t\t\t}\n\t\t},\n\t\tsaveParticipants(id: number | string, type: 'accomplices' | 'auditors', users: UserModel[]): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tconst updates = this.getAllSelectedItems()\n\t\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\t[type]: users,\n\t\t\t\t\t}));\n\n\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\t\tid,\n\t\t\t\t\tfields: { [type]: users },\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst ids = users.map((user: UserModel) => user.id);\n\t\t\tconst fields = {\n\t\t\t\t[`${type}Ids`]: ids,\n\t\t\t};\n\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields,\n\t\t\t});\n\t\t},\n\t\tsyncParentCompletionState(itemId: number | string, parentItemId?: number | string): void\n\t\t{\n\t\t\tconst changedItem = this.checkLists.find((item: CheckListModel) => item.id === itemId);\n\t\t\tif ((!changedItem || !changedItem.parentId) && !parentItemId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst parentId = parentItemId || changedItem.parentId;\n\n\t\t\tconst parentItem = this.checkLists.find((item: CheckListModel) => item.id === parentId);\n\t\t\tif (!parentItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst childrenItems = this.checkLists.filter((item: CheckListModel) => item.parentId === parentItem.id);\n\t\t\tconst isEmptyParent = (childrenItems.length === 0);\n\n\t\t\tconst allChildrenCompleted = childrenItems.every((child: CheckListModel) => child.isComplete);\n\t\t\tconst someChildrenIncomplete = childrenItems.some((child: CheckListModel) => !child.isComplete);\n\n\t\t\tconst shouldUpdateParent = (\n\t\t\t\tisEmptyParent\n\t\t\t\t|| (allChildrenCompleted && !parentItem.isComplete)\n\t\t\t\t|| (someChildrenIncomplete && parentItem.isComplete)\n\t\t\t);\n\t\t\tif (!shouldUpdateParent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: parentItem.id,\n\t\t\t\tfields: {\n\t\t\t\t\tisComplete: allChildrenCompleted && !isEmptyParent,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (parentItem.parentId)\n\t\t\t{\n\t\t\t\tthis.syncParentCompletionState(parentItem.id);\n\t\t\t}\n\t\t},\n\t\tactivateGroupMode(parentItemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = parentItemId;\n\n\t\t\tconst updates = this.getAllChildren()\n\t\t\t\t.map((item: CheckListModel, index: number) => ({\n\t\t\t\t\t...item,\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tselected: index === 0,\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\tupdates.push({\n\t\t\t\t...this.item,\n\t\t\t\tgroupMode: {\n\t\t\t\t\tactive: true,\n\t\t\t\t\tselected: false,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\t\t},\n\t\tdeactivateGroupMode(): void\n\t\t{\n\t\t\tconst updates = this.getAllGroupModeItems()\n\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t...item,\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tselected: false,\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, updates);\n\t\t},\n\t\tgetRootParent(item: CheckListModel): ?CheckListModel\n\t\t{\n\t\t\tif (!item || item.parentId === 0)\n\t\t\t{\n\t\t\t\treturn item || null;\n\t\t\t}\n\n\t\t\tconst parentItem = this.checkLists.find((parent: CheckListModel) => parent.id === item.parentId);\n\t\t\tif (!parentItem)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.getRootParent(parentItem);\n\t\t},\n\t\tgetAllChildren(): CheckListModel[]\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst getAllChildren = (parentId: number | string): CheckListModel[] => {\n\t\t\t\tconst directChildren = this.checkLists\n\t\t\t\t\t.filter((item: CheckListModel) => item.parentId === parentId)\n\t\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\t\t\t\tlet allChildren = [...directChildren];\n\n\t\t\t\tdirectChildren.forEach((child: CheckListModel) => {\n\t\t\t\t\tallChildren = [...allChildren, ...getAllChildren(child.id)];\n\t\t\t\t});\n\n\t\t\t\treturn allChildren;\n\t\t\t};\n\n\t\t\treturn getAllChildren(this.item.id);\n\t\t},\n\t\tgetFirstChild(): ?CheckListModel\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst children = this.checkLists\n\t\t\t\t.filter((item: CheckListModel) => item.parentId === this.item.id)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\t\treturn children[0] || null;\n\t\t},\n\t\tfindNearestItem(selected: boolean, excludeChildrenOf: CheckListModel[] = []): ?CheckListModel\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst rootParent = this.getRootParent(this.item);\n\t\t\tif (!rootParent)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst currentSortIndex = this.item.sortIndex;\n\n\t\t\tconst excludedParentIds = new Set(excludeChildrenOf.map((item: CheckListModel) => item.id));\n\n\t\t\tconst eligibleItems = this.checkLists\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex)\n\t\t\t\t.filter((item: CheckListModel) => {\n\t\t\t\t\tconst isChildOfExcluded = excludedParentIds.has(item.parentId);\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\titem.id !== this.item.id\n\t\t\t\t\t\t&& item.parentId !== 0\n\t\t\t\t\t\t&& item.groupMode?.selected === selected\n\t\t\t\t\t\t&& this.getRootParent(item)?.id === rootParent.id\n\t\t\t\t\t\t&& !isChildOfExcluded\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\tif (eligibleItems.length === 0)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn eligibleItems.reduce((nearest, item) => {\n\t\t\t\treturn (\n\t\t\t\t\titem.sortIndex > currentSortIndex\n\t\t\t\t\t&& (\n\t\t\t\t\t\titem.sortIndex < nearest.sortIndex\n\t\t\t\t\t\t|| nearest.sortIndex <= currentSortIndex\n\t\t\t\t\t)\n\t\t\t\t) ? item : nearest;\n\t\t\t});\n\t\t},\n\t\tgetAllGroupModeItems(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists.filter((item: CheckListModel) => {\n\t\t\t\treturn item.groupMode?.active === true;\n\t\t\t});\n\t\t},\n\t\tgetAllSelectedItems(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists.filter((item: CheckListModel) => {\n\t\t\t\treturn (item.parentId !== 0 && item.groupMode?.selected === true);\n\t\t\t});\n\t\t},\n\t\tgetAllSelectedItemsWithChildren(): CheckListModel[]\n\t\t{\n\t\t\tconst selectedItems = this.checkLists.filter((item: CheckListModel) => {\n\t\t\t\treturn (item.parentId !== 0 && item.groupMode?.selected === true);\n\t\t\t});\n\n\t\t\tconst getChildren = (parentIds: (string | number)[]): CheckListModel[] => {\n\t\t\t\tconst children = this.checkLists.filter((item: CheckListModel) => parentIds.includes(item.parentId));\n\n\t\t\t\treturn (\n\t\t\t\t\tchildren.length > 0\n\t\t\t\t\t\t? [...children, ...getChildren(children.map((child) => child.id))]\n\t\t\t\t\t\t: children\n\t\t\t\t);\n\t\t\t};\n\n\t\t\treturn [\n\t\t\t\t...selectedItems,\n\t\t\t\t...getChildren(selectedItems.map((item: CheckListModel) => item.id)),\n\t\t\t];\n\t\t},\n\t\thasActiveGroupMode(): boolean\n\t\t{\n\t\t\treturn this.getAllGroupModeItems().length > 0;\n\t\t},\n\t\thandleShowPopup(baseEvent: BaseEvent): void\n\t\t{\n\t\t\tconst [popup] = baseEvent.getCompatData();\n\n\t\t\tthis.shownPopups.add(popup.getId());\n\n\t\t\tthis.freeze();\n\t\t},\n\t\thandleClosePopup(baseEvent: BaseEvent): void\n\t\t{\n\t\t\tconst [popup] = baseEvent.getCompatData();\n\n\t\t\tthis.shownPopups.delete(popup.getId());\n\n\t\t\tthis.unfreeze();\n\t\t},\n\t\tfreeze()\n\t\t{\n\t\t\tthis.$refs.popupComponent?.freeze();\n\t\t},\n\t\tunfreeze()\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.shownPopups.size === 0\n\t\t\t\t&& this.itemsToDelete.length === 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.$refs.popupComponent?.unfreeze();\n\t\t\t}\n\t\t},\n\t\tsetDefaultCheckListTitle(itemId: number | string): void\n\t\t{\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: itemId,\n\t\t\t\tfields: {\n\t\t\t\t\ttitle: this.loc(\n\t\t\t\t\t\t'TASKS_V2_CHECK_LIST_TITLE_NUMBER',\n\t\t\t\t\t\t{ '#number#': this.getCheckListsNumber() },\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n};\n","import { Loc } from 'main.core';\n\nexport const checkListMeta = Object.freeze({\n\tid: 'checklist',\n\ttitle: Loc.getMessage('TASKS_V2_CHECK_LIST_TITLE'),\n});\n","import { Text } from 'main.core';\n\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Animated, Outline } from 'ui.icon-set.api.core';\n\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\n\nimport { CheckListMixin } from './check-list-mixin';\nimport { checkListMeta } from './check-list-meta';\nimport './check-list.css';\n\n// @vue/component\nexport const CheckList = {\n\tname: 'TaskCheckList',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tmixins: [CheckListMixin],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['open'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAnimated,\n\t\t\tOutline,\n\t\t\tcheckListMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn this.checkLists.length === 0;\n\t\t},\n\t\tcontainsChecklist(): boolean\n\t\t{\n\t\t\treturn this.task.containsChecklist;\n\t\t},\n\t\tparentCheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists.filter((checkList: CheckListModel) => checkList.parentId === 0);\n\t\t},\n\t},\n\tasync created(): void\n\t{\n\t\tif (this.containsChecklist)\n\t\t{\n\t\t\tvoid this.loadData();\n\t\t}\n\t},\n\tmethods: {\n\t\tasync loadData(): Promise<void>\n\t\t{\n\t\t\tawait checkListService.load(this.taskId);\n\t\t},\n\t\tgetCompletedCount(parentId: number): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === parentId && checklist.isComplete;\n\t\t\t}).length;\n\t\t},\n\t\tgetTotalCount(parentId: number): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === parentId;\n\t\t\t}).length;\n\t\t},\n\t\tshowCheckList(checkListId: number): void\n\t\t{\n\t\t\tthis.$emit('open', checkListId);\n\t\t},\n\t\trenderCheckListStatus(checkListId: number | string): Object\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_CHECK_LIST_STATUS_LABEL', {\n\t\t\t\t'#completed#': this.getCompletedCount(checkListId),\n\t\t\t\t'#total#': this.getTotalCount(checkListId),\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:data-task-field-id=\"checkListMeta.id\"\n\t\t\tclass=\"tasks-field-check-list\"\n\t\t\t:class=\"{ '--default': isLoading }\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"tasks-field-check-list-content\"\n\t\t\t\t:class=\"{ '--default': isLoading }\"\n\t\t\t>\n\t\t\t\t<template v-if=\"isLoading\">\n\t\t\t\t\t<div class=\"tasks-field-check-list-content-row\">\n\t\t\t\t\t\t<BIcon :name=\"Animated.LOADER_WAIT\"/>\n\t\t\t\t\t\t<div class=\"tasks-field-check-list-content-text\">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_LOADING') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"tasks-field-check-list-content-list\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for=\"checklist in parentCheckLists\"\n\t\t\t\t\t\t\t:key=\"checklist.id\"\n\t\t\t\t\t\t\tclass=\"tasks-field-check-list-content-list-item\"\n\t\t\t\t\t\t\t@click=\"() => this.showCheckList(checklist.id)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"tasks-field-check-list-content-list-item-icon\">\n\t\t\t\t\t\t\t\t<BIcon :name=\"Outline.CHECK_LIST\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"tasks-field-check-list-content-list-item-title\">\n\t\t\t\t\t\t\t\t{{ checklist.title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"tasks-field-check-list-content-list-item-status\"\n\t\t\t\t\t\t\t\tv-html=\"renderCheckListStatus(checklist.id)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"tasks-field-check-list-content-list-item-arrow\">\n\t\t\t\t\t\t\t\t<BIcon :name=\"Outline.CHEVRON_RIGHT_L\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-field-check-list-content-row --footer\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"tasks-field-check-list-content-btn\"\n\t\t\t\t\t\t\t@click=\"addFastCheckList\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.PLUS_L\"/>\n\t\t\t\t\t\t\t<div class=\"tasks-field-check-list-content-btn-text\">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { Animated, Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { Chip, ChipDesign } from 'tasks.v2.component.elements.chip';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\nimport { EventName, Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { checkListMeta } from './check-list-meta';\n\n// @vue/component\nexport const CheckListChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['showCheckList'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tcheckListMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.task.checklist?.some((itemId) => fileService.get(itemId, EntityTypes.CheckListItem).isUploading());\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn {\n\t\t\t\t[!this.isAutonomous && !this.isSelected]: ChipDesign.Shadow,\n\t\t\t\t[!this.isAutonomous && this.isSelected]: ChipDesign.ShadowAccent,\n\t\t\t\t[this.isAutonomous && !this.isSelected]: ChipDesign.Outline,\n\t\t\t\t[this.isAutonomous && this.isSelected]: ChipDesign.OutlineAccent,\n\t\t\t}.true;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.checkLists.length > 0;\n\t\t},\n\t\tcheckListItemCount(): number\n\t\t{\n\t\t\treturn (this.checkLists.filter((checkList: CheckListModel) => checkList.parentId !== 0)).length;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.isAutonomous && this.checkListItemCount > 0)\n\t\t\t{\n\t\t\t\tconst completedCount = this.getCompletedCount();\n\n\t\t\t\treturn this.loc(\n\t\t\t\t\t'TASKS_V2_CHECK_LIST_COUNT_TITLE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#count#': completedCount,\n\t\t\t\t\t\t'#total#': this.checkListItemCount,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_CHECK_LIST_CHIP_TITLE');\n\t\t},\n\t\ticon(): string\n\t\t{\n\t\t\tif (this.isUploading)\n\t\t\t{\n\t\t\t\treturn Animated.LOADER_WAIT;\n\t\t\t}\n\n\t\t\treturn Outline.CHECK_LIST;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.$bitrix.eventEmitter.subscribe(EventName.CloseCheckList, this.handleFieldClose);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.$bitrix.eventEmitter.unsubscribe(EventName.CloseCheckList, this.handleFieldClose);\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\tvoid this.showCheckList();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-lonely-if\n\t\t\t\tif (this.isSelected)\n\t\t\t\t{\n\t\t\t\t\tthis.highlightField();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvoid this.showCheckList();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tasync showCheckList(): Promise<void>\n\t\t{\n\t\t\tif (!this.isSelected)\n\t\t\t{\n\t\t\t\tawait this.buildEmptyCheckList();\n\t\t\t}\n\n\t\t\tthis.$emit('showCheckList');\n\t\t},\n\t\tasync buildEmptyCheckList(): Promise<void>\n\t\t{\n\t\t\tconst parentId = Text.getRandom();\n\t\t\tconst childId = Text.getRandom();\n\n\t\t\tawait this.$store.dispatch(`${Model.CheckList}/insertMany`, [\n\t\t\t\t{\n\t\t\t\t\tid: parentId,\n\t\t\t\t\tnodeId: parentId,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_TITLE_NUMBER', { '#number#': 1 }),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: childId,\n\t\t\t\t\tnodeId: childId,\n\t\t\t\t\tparentId,\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields: {\n\t\t\t\t\tchecklist: [parentId, childId],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(checkListMeta.id);\n\t\t},\n\t\tgetCompletedCount(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.isComplete && checklist.parentId !== 0;\n\t\t\t}).length;\n\t\t},\n\t\thandleFieldClose(): void\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\tthis.$refs.chip.focus();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"icon\"\n\t\t\t:text=\"text\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"checkListMeta.id\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n","// @vue/component\nexport const CheckListStub = {\n\tname: 'CheckListStub',\n\ttemplate: `\n\t\t<div class=\"check-list-stub\">\n\t\t\t<div class=\"check-list-stub-title\">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_STUB_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class=\"check-list-stub-icon\"></div>\n\t\t</div>\n\t`,\n};\n","import type { CheckListModel } from 'tasks.v2.model.check-list';\n\nexport const CheckListWidgetMixin = {\n\tmethods: {\n\t\tgetItemLevel(checkList: CheckListModel): number\n\t\t{\n\t\t\tlet level = 0;\n\t\t\tlet current = checkList;\n\n\t\t\tconst findParent = (parentId) => this.checkLists\n\t\t\t\t.find((item: CheckListModel) => item.id === parentId);\n\n\t\t\twhile (current.parentId !== 0)\n\t\t\t{\n\t\t\t\tcurrent = findParent(current.parentId);\n\t\t\t\tif (!current)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlevel++;\n\t\t\t}\n\n\t\t\treturn level;\n\t\t},\n\t},\n};\n","import { Type } from 'main.core';\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { UserModel } from 'tasks.v2.model.users';\n\n// @vue/component\nexport const CheckListItemMixin = {\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tid: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tpanelIsShown: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'update',\n\t\t'addItem',\n\t\t'removeItem',\n\t\t'focus',\n\t\t'blur',\n\t\t'emptyBlur',\n\t\t'show',\n\t\t'hide',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisHovered: false,\n\t\t\tscrollContainer: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\titem(): CheckListModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getById`](this.id);\n\t\t},\n\t\tcanModify(): boolean\n\t\t{\n\t\t\treturn this.item.actions.modify === true;\n\t\t},\n\t\tcanRemove(): boolean\n\t\t{\n\t\t\treturn this.item.actions.remove === true;\n\t\t},\n\t\tcanToggle(): boolean\n\t\t{\n\t\t\treturn this.item.actions.toggle === true;\n\t\t},\n\t\thasAttachments(): boolean\n\t\t{\n\t\t\treturn this.hasUsers;\n\t\t},\n\t\thasUsers(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.hasAccomplices\n\t\t\t\t|| this.hasAuditors\n\t\t\t);\n\t\t},\n\t\thasAccomplices(): boolean\n\t\t{\n\t\t\treturn this.accomplices?.length > 0;\n\t\t},\n\t\thasAuditors(): boolean\n\t\t{\n\t\t\treturn this.auditors?.length > 0;\n\t\t},\n\t\taccomplices(): ?UserModel[]\n\t\t{\n\t\t\treturn this.item.accomplices;\n\t\t},\n\t\tauditors(): ?UserModel[]\n\t\t{\n\t\t\treturn this.item.auditors;\n\t\t},\n\t\tfiles(): ?[]\n\t\t{\n\t\t\treturn this.item.attachments;\n\t\t},\n\t\ttextColor(): string\n\t\t{\n\t\t\treturn this.item.isComplete ? 'var(--ui-color-base-4)' : 'var(--ui-color-base-1)';\n\t\t},\n\t\tgroupMode(): boolean\n\t\t{\n\t\t\treturn this.item.groupMode?.active === true;\n\t\t},\n\t\tgroupModeSelected(): boolean\n\t\t{\n\t\t\treturn this.item.groupMode?.selected === true;\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateTitle(title: string = ''): void\n\t\t{\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: { title },\n\t\t\t});\n\n\t\t\tthis.$emit('update');\n\t\t},\n\t\tclearTitle(): void\n\t\t{\n\t\t\tthis.$refs.growingTextArea?.clearValue();\n\t\t},\n\t\taddItem(sort: ?number): void\n\t\t{\n\t\t\tthis.$emit(\n\t\t\t\t'addItem',\n\t\t\t\t{\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tsort: Type.isNumber(sort) ? sort : null,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tremoveItem(): void\n\t\t{\n\t\t\tthis.$emit('removeItem', this.id);\n\t\t},\n\t\thandleFocus(): void\n\t\t{\n\t\t\tthis.$emit('focus', this.id);\n\t\t},\n\t\thandleBlur(): void\n\t\t{\n\t\t\tthis.$emit('blur', this.id);\n\t\t},\n\t\thandleEmptyBlur(): void\n\t\t{\n\t\t\tthis.$emit('emptyBlur', this.id);\n\t\t},\n\t\tshow(): void\n\t\t{\n\t\t\tthis.$emit('show', this.id);\n\t\t},\n\t\thide(): void\n\t\t{\n\t\t\tthis.$emit('hide', this.id);\n\t\t},\n\t},\n};\n","import { Event } from 'main.core';\n\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { BMenu, type MenuOptions, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport { Actions, Outline } from 'ui.icon-set.api.core';\n\nimport { GrowingTextArea } from 'tasks.v2.component.elements.growing-text-area';\nimport { UserAvatarList } from 'tasks.v2.component.elements.user-avatar-list';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { CheckListWidgetMixin } from './check-list-widget-mixin';\nimport { CheckListItemMixin } from './check-list-item-mixin';\n\n// @vue/component\nexport const CheckListParentItem = {\n\tname: 'CheckListParentItem',\n\tcomponents: {\n\t\tBIcon,\n\t\tBMenu,\n\t\tGrowingTextArea,\n\t\tUserAvatarList,\n\t},\n\tmixins: [\n\t\tCheckListWidgetMixin,\n\t\tCheckListItemMixin,\n\t],\n\tinject: ['setItemsRef'],\n\temits: [\n\t\t'toggleCompleted',\n\t\t'toggleCollapse',\n\t\t'startGroupMode',\n\t],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tActions,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisSticky: false,\n\t\t\tisMenuShown: false,\n\t\t\tmenuRemoveSectionCode: 'removeSection',\n\t\t\tareChildrenCollapsed: false,\n\t\t\tareCompletedCollapsed: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `check-list-parent-item-action-menu-${this.id}`,\n\t\t\t\tbindElement: this.$refs.more.$el,\n\t\t\t\tminWidth: 250,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\tsections: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcode: this.menuRemoveSectionCode,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.menuItems,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tcloseByEsc: true,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: (this.areCompletedCollapsed\n\t\t\t\t\t\t? this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_SHOW')\n\t\t\t\t\t\t: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_HIDE')\n\t\t\t\t\t),\n\t\t\t\t\ticon: this.areCompletedCollapsed ? Outline.OBSERVER : Outline.CROSSED_EYE,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuProfileHide-${this.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tthis.isMenuShown = false;\n\t\t\t\t\t\tthis.areCompletedCollapsed = !this.areCompletedCollapsed;\n\t\t\t\t\t\tthis.$emit('toggleCompleted', {\n\t\t\t\t\t\t\titemId: this.id,\n\t\t\t\t\t\t\tcollapsed: this.areCompletedCollapsed,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_GROUP'),\n\t\t\t\t\ticon: Outline.MULTICHOICE_ON,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuProfileGroup-${this.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tif (this.areChildrenCollapsed === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.collapseChildrenItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.$emit('startGroupMode', this.id);\n\t\t\t\t\t\tthis.isMenuShown = false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tsectionCode: this.menuRemoveSectionCode,\n\t\t\t\t\tdesign: 'alert',\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_REMOVE'),\n\t\t\t\t\ticon: Outline.TRASHCAN,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuProfileRemove-${this.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: this.removeItem.bind(this),\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\titemIcon(): string\n\t\t{\n\t\t\treturn this.item.isComplete ? Outline.CHECK_L : Outline.CHECK_LIST;\n\t\t},\n\t\tcheckListStatus(): string\n\t\t{\n\t\t\tconst label = this.loc('TASKS_V2_CHECK_LIST_STATUS_LABEL');\n\n\t\t\treturn label\n\t\t\t\t.replace('#completed#', this.getCompletedCount())\n\t\t\t\t.replace('#total#', this.getTotalCount());\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.scrollContainer = this.$parent.$el?.closest('[data-list]');\n\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, this);\n\t\t}\n\n\t\tif (this.scrollContainer)\n\t\t{\n\t\t\tEvent.bind(this.scrollContainer, 'scroll', this.handleScroll);\n\n\t\t\tvoid this.$nextTick(this.checkSticky);\n\n\t\t\tthis.mutationObserver = new MutationObserver(() => {\n\t\t\t\tthis.checkSticky();\n\t\t\t});\n\t\t\tthis.mutationObserver.observe(\n\t\t\t\tthis.scrollContainer,\n\t\t\t\t{\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.scrollContainer)\n\t\t{\n\t\t\tEvent.unbind(this.scrollContainer, 'scroll', this.handleScroll);\n\t\t}\n\n\t\tif (this.mutationObserver)\n\t\t{\n\t\t\tthis.mutationObserver.disconnect();\n\t\t}\n\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, null);\n\t\t}\n\t},\n\tmethods: {\n\t\thandleScroll(): void\n\t\t{\n\t\t\tthis.checkSticky();\n\n\t\t\tthis.isMenuShown = false;\n\t\t},\n\t\tcheckSticky(): void\n\t\t{\n\t\t\tif (!this.scrollContainer || !this.$refs.item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst stickyRect = this.$refs.item.getBoundingClientRect();\n\t\t\tconst containerRect = this.scrollContainer.getBoundingClientRect();\n\t\t\tconst paddingOffset = 18;\n\n\t\t\tthis.isSticky = stickyRect.top <= (containerRect.top + stickyRect.height - paddingOffset);\n\t\t},\n\t\tshowMenu(): void\n\t\t{\n\t\t\tthis.isMenuShown = true;\n\t\t},\n\t\tgetCompletedCount(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === this.id && checklist.isComplete;\n\t\t\t}).length;\n\t\t},\n\t\tgetTotalCount(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === this.id;\n\t\t\t}).length;\n\t\t},\n\t\tcollapseChildrenItems(): void\n\t\t{\n\t\t\tthis.areChildrenCollapsed = !this.areChildrenCollapsed;\n\n\t\t\tthis.$emit('toggleCollapse', {\n\t\t\t\tparentId: this.id,\n\t\t\t\tareChildrenCollapsed: this.areChildrenCollapsed,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"item\"\n\t\t\tclass=\"check-list-widget-parent-item\"\n\t\t\t:class=\"{\n\t\t\t\t'--complete': item.isComplete,\n\t\t\t\t'--collapsed': areChildrenCollapsed,\n\t\t\t}\"\n\t\t\t:data-id=\"id\"\n\t\t\t:data-parent=\"id\"\n\t\t>\n\t\t\t<div class=\"check-list-widget-parent-item-label-container\">\n\t\t\t\t<BIcon :name=\"itemIcon\"/>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-parent-item-title-container\">\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tclass=\"check-list-widget-parent-item-title\"\n\t\t\t\t\t:data-check-list-id=\"'check-list-parent-item-title-' + id\"\n\t\t\t\t\t:initialValue=\"item.title\"\n\t\t\t\t\t:placeholderValue=\"loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')\"\n\t\t\t\t\t:readonly=\"groupMode\"\n\t\t\t\t\t:fontColor=\"textColor\"\n\t\t\t\t\t:fontSize=\"17\"\n\t\t\t\t\t:lineHeight=\"20\"\n\t\t\t\t\t:fontWeight=\"500\"\n\t\t\t\t\t@update=\"updateTitle\"\n\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"hasAttachments\">\n\t\t\t\t\t<div class=\"check-list-widget-item-attach --parent\">\n\t\t\t\t\t\t<div v-if=\"hasUsers\" class=\"check-list-widget-item-attach-users\">\n\t\t\t\t\t\t\t<div v-if=\"hasAccomplices\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t\t<BIcon :name=\"Outline.GROUP\"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users=\"accomplices\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if=\"hasAuditors\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t\t<BIcon :name=\"Outline.OBSERVER\"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users=\"auditors\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"check-list-widget-parent-item-title-status\"\n\t\t\t\t\tv-html=\"checkListStatus\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-parent-item-action\">\n\t\t\t\t<div class=\"check-list-widget-parent-item-main-action\">\n\t\t\t\t\t<BIcon ref=\"more\" :name=\"Outline.MORE_L\" @click=\"showMenu\" />\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"areChildrenCollapsed ? Actions.CHEVRON_DOWN : Actions.CHEVRON_UP\"\n\t\t\t\t\t\t@click=\"collapseChildrenItems\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isSticky\" class=\"check-list-widget-parent-item-empty\"></div>\n\t\t\t</div>\n\t\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions\" @close=\"isMenuShown = false\"/>\n\t\t</div>\n\t`,\n};\n","import { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport { FileStatus } from 'ui.uploader.core';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport { UserFieldWidgetComponent, type UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { Model } from 'tasks.v2.const';\nimport { GrowingTextArea } from 'tasks.v2.component.elements.growing-text-area';\nimport { UserAvatarList } from 'tasks.v2.component.elements.user-avatar-list';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\n\nimport { CheckListWidgetMixin } from './check-list-widget-mixin';\nimport { CheckListItemMixin } from './check-list-item-mixin';\n\n// @vue/component\nexport const CheckListChildItem = {\n\tname: 'CheckListChildItem',\n\tcomponents: {\n\t\tBIcon,\n\t\tGrowingTextArea,\n\t\tUserAvatarList,\n\t\tUserFieldWidgetComponent,\n\t},\n\tmixins: [\n\t\tCheckListWidgetMixin,\n\t\tCheckListItemMixin,\n\t],\n\tinject: ['setItemsRef'],\n\tprops: {\n\t\titemOffset: {\n\t\t\ttype: String,\n\t\t\tdefault: '0',\n\t\t},\n\t},\n\temits: [\n\t\t'toggleIsComplete',\n\t\t'toggleGroupModeSelected',\n\t],\n\tsetup(props: Object): { uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tfileService: fileService.get(props.id, EntityTypes.CheckListItem),\n\t\t\tuploaderAdapter: fileService.get(props.id, EntityTypes.CheckListItem).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tuploadingFiles: this.fileService.getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\thasAttachments(): boolean\n\t\t{\n\t\t\treturn this.hasUsers || this.hasFilesAttach;\n\t\t},\n\t\thasFilesAttach(): boolean\n\t\t{\n\t\t\treturn this.hasFiles || this.isUploading || this.hasUploadingError;\n\t\t},\n\t\thasFiles(): boolean\n\t\t{\n\t\t\treturn this.files?.length > 0;\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.uploadingFiles.some(({ status }) => [\n\t\t\t\tFileStatus.UPLOADING,\n\t\t\t\tFileStatus.LOADING,\n\t\t\t].includes(status));\n\t\t},\n\t\thasUploadingError(): boolean\n\t\t{\n\t\t\treturn this.uploadingFiles.some(({ status }) => [\n\t\t\t\tFileStatus.UPLOAD_FAILED,\n\t\t\t\tFileStatus.LOAD_FAILED,\n\t\t\t].includes(status));\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tif (this.hasFilesAttach)\n\t\t{\n\t\t\tvoid this.loadFiles();\n\t\t}\n\t},\n\tmounted(): void\n\t{\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, this);\n\t\t}\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, null);\n\t\t}\n\t},\n\tmethods: {\n\t\ttoggleIsComplete(): void\n\t\t{\n\t\t\tif (this.canToggle === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: { isComplete: !this.item.isComplete },\n\t\t\t});\n\n\t\t\tthis.$emit('toggleIsComplete', this.id);\n\t\t},\n\t\ttoggleGroupModeSelected(): void\n\t\t{\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tselected: !this.groupModeSelected,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.$emit('toggleGroupModeSelected', this.id);\n\t\t},\n\t\tfocusToItem(): void\n\t\t{\n\t\t\tthis.scrollContainer ??= this.$parent.$el?.closest('[data-list]');\n\n\t\t\tconst offset = 200;\n\n\t\t\tthis.scrollContainer.scrollTo({\n\t\t\t\ttop: this.$refs.item.offsetTop - offset,\n\t\t\t\tbehavior: 'smooth',\n\t\t\t});\n\t\t},\n\t\tfocusToTextarea(event: PointerEvent): void\n\t\t{\n\t\t\tconst ignoreList = new Set([this.$refs.checkbox]);\n\n\t\t\tif (!ignoreList.has(event.target))\n\t\t\t{\n\t\t\t\tthis.$refs.growingTextArea?.focusTextarea();\n\t\t\t}\n\t\t},\n\t\tasync loadFiles(): Promise<void>\n\t\t{\n\t\t\tawait this.fileService.list(this.files.map((file) => file?.id ?? file));\n\t\t},\n\t\thandleEnter(): void\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addItem(this.item.sortIndex + 1);\n\t\t},\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.groupMode)\n\t\t\t{\n\t\t\t\tthis.toggleGroupModeSelected();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"item\"\n\t\t\tclass=\"check-list-widget-child-item\"\n\t\t\t:class=\"{\n\t\t\t\t'--extra-indent': hasUsers && !hasFilesAttach,\n\t\t\t\t'--complete': item.isComplete,\n\t\t\t\t'--group-mode': groupMode,\n\t\t\t\t'--group-mode-selected': groupModeSelected,\n\t\t\t}\"\n\t\t\t:data-id=\"id\"\n\t\t\t:style=\"{ marginLeft: itemOffset }\"\n\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t@mouseleave=\"isHovered = false\"\n\t\t\t@click=\"handleClick\"\n\t\t>\n\t\t\t<div class=\"check-list-widget-child-item-base\">\n\t\t\t\t<label\n\t\t\t\t\tclass=\"check-list-widget-child-item-checkbox\"\n\t\t\t\t\t:class=\"{'--important': !item.isImportant}\"\n\t\t\t\t\t@mousedown.stop\n\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"checkbox\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t:checked=\"item.isComplete\"\n\t\t\t\t\t\t:disabled=\"!canToggle || groupMode\"\n\t\t\t\t\t\t@change=\"toggleIsComplete\"\n\t\t\t\t\t>\n\t\t\t\t</label>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"item.isImportant\"\n\t\t\t\t\tclass=\"check-list-widget-child-item-important\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name=\"Outline.FIRE_SOLID\" :hoverable=\"false\"/>\n\t\t\t\t</div>\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref=\"growingTextArea\"\n\t\t\t\t\tclass=\"check-list-widget-child-item-title\"\n\t\t\t\t\t:data-check-list-id=\"'check-list-child-item-title-' + item.id\"\n\t\t\t\t\t:initialValue=\"item.title\"\n\t\t\t\t\t:placeholderValue=\"loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')\"\n\t\t\t\t\t:readonly=\"groupMode\"\n\t\t\t\t\t:fontColor=\"textColor\"\n\t\t\t\t\t:fontSize=\"15\"\n\t\t\t\t\t:lineHeight=\"20\"\n\t\t\t\t\t@update=\"updateTitle\"\n\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t\t@emptyFocus=\"focusToItem\"\n\t\t\t\t\t@enterBlur=\"handleEnter\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isHovered && !panelIsShown && !groupMode\"\n\t\t\t\t\tclass=\"check-list-widget-child-item-action\"\n\t\t\t\t\t@click=\"removeItem\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name=\"Outline.TRASHCAN\"/>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"groupMode\" class=\"check-list-widget-child-item-action-checkbox\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"checkbox\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t:checked=\"groupModeSelected\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"check-list-widget-child-item-action-stub\"></div>\n\t\t\t</div>\n\t\t\t<template v-if=\"hasAttachments\">\n\t\t\t\t<div class=\"check-list-widget-item-attach\">\n\t\t\t\t\t<div v-if=\"hasUsers\" class=\"check-list-widget-item-attach-users\">\n\t\t\t\t\t\t<div v-if=\"hasAccomplices\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.GROUP\"/>\n\t\t\t\t\t\t\t<UserAvatarList :users=\"accomplices\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"hasAuditors\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.OBSERVER\"/>\n\t\t\t\t\t\t\t<UserAvatarList :users=\"auditors\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"hasFilesAttach\" class=\"check-list-widget-item-attach-files\">\n\t\t\t\t\t\t<div class=\"check-list-widget-item-attach-files-list\">\n\t\t\t\t\t\t\t<UserFieldWidgetComponent\n\t\t\t\t\t\t\t\t:uploaderAdapter=\"uploaderAdapter\"\n\t\t\t\t\t\t\t\t:widgetOptions=\"widgetOptions\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\n\nimport { CheckListItemMixin } from './check-list-item-mixin';\n\n// @vue/component\nexport const CheckListAddItem = {\n\tname: 'CheckListAddItem',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tmixins: [CheckListItemMixin],\n\temits: ['addItem'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"check-list-widget-add-item\"\n\t\t\t@click=\"addItem\"\n\t\t>\n\t\t\t<div class=\"check-list-widget-add-item-icon\">\n\t\t\t\t<BIcon :name=\"Outline.PLUS_L\"/>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-add-item-title\">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ITEM_ADD_BTN') }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { CheckListWidgetMixin } from './check-list-widget-mixin';\nimport { CheckListParentItem } from './check-list-parent-item';\nimport { CheckListChildItem } from './check-list-child-item';\nimport { CheckListAddItem } from './check-list-add-item';\nimport './check-list-widget.css';\n\n// @vue/component\nexport const CheckListWidget = {\n\tname: 'CheckListWidget',\n\tcomponents: {\n\t\tCheckListParentItem,\n\t\tCheckListChildItem,\n\t\tCheckListAddItem,\n\t},\n\tmixins: [CheckListWidgetMixin],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcheckListId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tparentId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tlistShownItemPanels: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: [\n\t\t'show',\n\t\t'update',\n\t\t'addItem',\n\t\t'removeItem',\n\t\t'toggleIsComplete',\n\t\t'focus',\n\t\t'blur',\n\t\t'emptyBlur',\n\t\t'toggleCompleted',\n\t\t'startGroupMode',\n\t\t'toggleGroupModeSelected',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcollapsedStates: {},\n\t\t\thiddenStates: {},\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tsiblings(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists\n\t\t\t\t.filter((item: CheckListModel) => item.parentId === this.parentId)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\t\t},\n\t\tgetCollapsedClassForItem(): function\n\t\t{\n\t\t\treturn (itemId) => {\n\t\t\t\treturn `check-list-widget-collapse ${this.collapsedStates[itemId] ? '--collapsed' : '--expanded'}`;\n\t\t\t};\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (this.checkListId)\n\t\t{\n\t\t\tthis.scrollContainer = this.$root.$el?.querySelector(['[data-list]']);\n\n\t\t\tconst targetParentItem = this.scrollContainer.querySelector([`[data-parent=\"${this.checkListId}\"]`]);\n\t\t\tconst offset = 12;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.scrollContainer.scrollTop = targetParentItem.offsetTop - offset;\n\t\t\t}, 0);\n\t\t}\n\n\t\tthis.$emit('show');\n\t},\n\tmethods: {\n\t\tgetItemOffset(item: CheckListModel): string\n\t\t{\n\t\t\tif (item.parentId === 0)\n\t\t\t{\n\t\t\t\treturn '0';\n\t\t\t}\n\n\t\t\tconst level = this.getItemLevel(item);\n\t\t\tif (level === 1)\n\t\t\t{\n\t\t\t\treturn '0';\n\t\t\t}\n\n\t\t\treturn `${(level - 1) * 12}px`;\n\t\t},\n\t\ttoggleCollapse({ parentId, areChildrenCollapsed })\n\t\t{\n\t\t\tthis.collapsedStates[parentId] = areChildrenCollapsed;\n\t\t},\n\t\thandleShowItem(itemId: number | string): void\n\t\t{\n\t\t\tthis.hiddenStates[itemId] = false;\n\t\t},\n\t\thandleHideItem(itemId: number | string): void\n\t\t{\n\t\t\tthis.hiddenStates[itemId] = true;\n\t\t},\n\t\tisFirstVisibleItem(title, index): boolean\n\t\t{\n\t\t\tconst siblings = this.siblings;\n\n\t\t\tconst firstVisibleIndex = siblings.findIndex((item) => !this.hiddenStates[item.id]);\n\n\t\t\treturn firstVisibleIndex !== -1 && firstVisibleIndex === index;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"check-list-widget-container\">\n\t\t\t<ul class=\"check-list-widget\">\n\t\t\t\t<li\n\t\t\t\t\tv-for=\"(item, index) in siblings\"\n\t\t\t\t\t:key=\"item.id\"\n\t\t\t\t\tclass=\"check-list-widget-item\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'--first-visible': parentId === 0 && isFirstVisibleItem(item.title, index),\n\t\t\t\t\t\t'--hidden': hiddenStates[item.id],\n\t\t\t\t\t\t'--parent': parentId === 0\n\t\t\t\t\t}\"\n\t\t\t\t>\n\t\t\t\t\t<CheckListParentItem\n\t\t\t\t\t\tv-if=\"item.parentId === 0\"\n\t\t\t\t\t\t:id=\"item.id\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:panelIsShown=\"listShownItemPanels.includes(item.id)\"\n\t\t\t\t\t\t@update=\"$emit('update')\"\n\t\t\t\t\t\t@removeItem=\"(id) => $emit('removeItem', id)\"\n\t\t\t\t\t\t@focus=\"(id) => $emit('focus', id)\"\n\t\t\t\t\t\t@blur=\"(id) => $emit('blur', id)\"\n\t\t\t\t\t\t@emptyBlur=\"(id) => $emit('emptyBlur', id)\"\n\t\t\t\t\t\t@toggleCompleted=\"(data) => $emit('toggleCompleted', data)\"\n\t\t\t\t\t\t@toggleCollapse=\"toggleCollapse\"\n\t\t\t\t\t\t@startGroupMode=\"(id) => $emit('startGroupMode', id)\"\n\t\t\t\t\t\t@show=\"handleShowItem\"\n\t\t\t\t\t\t@hide=\"handleHideItem\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CheckListChildItem\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:id=\"item.id\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:itemOffset=\"getItemOffset(item)\"\n\t\t\t\t\t\t:panelIsShown=\"listShownItemPanels.includes(item.id)\"\n\t\t\t\t\t\t@update=\"$emit('update')\"\n\t\t\t\t\t\t@toggleIsComplete=\"(id) => $emit('toggleIsComplete', id)\"\n\t\t\t\t\t\t@addItem=\"(data) => $emit('addItem', data)\"\n\t\t\t\t\t\t@removeItem=\"(id) => $emit('removeItem', id)\"\n\t\t\t\t\t\t@focus=\"(id) => $emit('focus', id)\"\n\t\t\t\t\t\t@blur=\"(id) => $emit('blur', id)\"\n\t\t\t\t\t\t@emptyBlur=\"(id) => $emit('emptyBlur', id)\"\n\t\t\t\t\t\t@toggleGroupModeSelected=\"(id) => $emit('toggleGroupModeSelected', id)\"\n\t\t\t\t\t\t@show=\"handleShowItem\"\n\t\t\t\t\t\t@hide=\"handleHideItem\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CheckListWidget\n\t\t\t\t\t\tv-if=\"checkLists.some(child => child.parentId === item.id)\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:parentId=\"item.id\"\n\t\t\t\t\t\t:listShownItemPanels=\"listShownItemPanels\"\n\t\t\t\t\t\t:class=\"getCollapsedClassForItem(item.id)\"\n\t\t\t\t\t\t@update=\"$emit('update')\"\n\t\t\t\t\t\t@toggleIsComplete=\"(id) => $emit('toggleIsComplete', id)\"\n\t\t\t\t\t\t@addItem=\"(data) => $emit('addItem', data)\"\n\t\t\t\t\t\t@removeItem=\"(id) => $emit('removeItem', id)\"\n\t\t\t\t\t\t@focus=\"(id) => $emit('focus', id)\"\n\t\t\t\t\t\t@blur=\"(id) => $emit('blur', id)\"\n\t\t\t\t\t\t@emptyBlur=\"(id) => $emit('emptyBlur', id)\"\n\t\t\t\t\t\t@toggleCompleted=\"(data) => $emit('toggleCompleted', data)\"\n\t\t\t\t\t\t@toggleCollapse=\"toggleCollapse\"\n\t\t\t\t\t\t@startGroupMode=\"(id) => $emit('startGroupMode', id)\"\n\t\t\t\t\t\t@toggleGroupModeSelected=\"(id) => $emit('toggleGroupModeSelected', id)\"\n\t\t\t\t\t\t@show=\"handleShowItem\"\n\t\t\t\t\t\t@hide=\"handleHideItem\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"check-list-widget-add-container\" :class=\"getCollapsedClassForItem(item.id)\">\n\t\t\t\t\t\t<CheckListAddItem\n\t\t\t\t\t\t\tv-if=\"item.parentId === 0\"\n\t\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t\t:id=\"item.id\"\n\t\t\t\t\t\t\t@update=\"$emit('update')\"\n\t\t\t\t\t\t\t@addItem=\"(data) => $emit('addItem', data)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t`,\n};\n","import { Dom, Type } from 'main.core';\nimport type { PopupOptions } from 'main.popup';\n\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\n\nimport { Hint } from 'tasks.v2.component.elements.hint';\n\nimport { PanelMeta } from './check-list-item-panel-meta';\nimport type { VisibleSections, VisibleActions, Section, Item } from './check-list-item-panel-meta';\nimport './check-list-item-panel.css';\n\n// @vue/component\nexport const CheckListItemPanel = {\n\tname: 'CheckListItemPanel',\n\tcomponents: {\n\t\tBIcon,\n\t\tHint,\n\t},\n\tprops: {\n\t\tvisibleSections: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => PanelMeta.defaultSections.map((section: Section) => section.name),\n\t\t},\n\t\tvisibleActions: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tdisabledActions: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tactiveActions: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: ['action'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisHintShown: false,\n\t\t\tcurrentHintElement: null,\n\t\t\tcurrentHintText: '',\n\t\t\thintTimeout: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\thintOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\toffsetLeft: (\n\t\t\t\t\tthis.currentHintElement\n\t\t\t\t\t\t? -(Dom.getPosition(this.currentHintElement)).width\n\t\t\t\t\t\t: 0\n\t\t\t\t),\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tangle: false,\n\t\t\t};\n\t\t},\n\t\thasSections(): boolean\n\t\t{\n\t\t\treturn this.sections.length > 0;\n\t\t},\n\t\tsections(): VisibleSections\n\t\t{\n\t\t\tconst visibleActions: VisibleActions = this.visibleActions;\n\n\t\t\treturn PanelMeta.defaultSections\n\t\t\t\t.filter((section) => this.visibleSections.includes(section.name))\n\t\t\t\t.map((section) => ({\n\t\t\t\t\t...section,\n\t\t\t\t\titems: section.items\n\t\t\t\t\t\t.filter((item: Item) => visibleActions.includes(item.action))\n\t\t\t\t\t\t.map((item: Item) => ({\n\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\tdisabled: this.isItemDisabled(item),\n\t\t\t\t\t\t\tactive: this.isItemActive(item),\n\t\t\t\t\t\t\thoverable: Type.isUndefined(item.hoverable) ? true : item.hoverable,\n\t\t\t\t\t\t})),\n\t\t\t\t}))\n\t\t\t\t.filter((section) => section.items.length > 0)\n\t\t\t;\n\t\t},\n\t},\n\tmethods: {\n\t\tisItemDisabled(item: Item): boolean\n\t\t{\n\t\t\tif (!Type.isUndefined(item.disabled))\n\t\t\t{\n\t\t\t\treturn item.disabled;\n\t\t\t}\n\n\t\t\treturn this.disabledActions.includes(item.action);\n\t\t},\n\t\tisItemActive(item: Item): boolean\n\t\t{\n\t\t\tif (!Type.isUndefined(item.active))\n\t\t\t{\n\t\t\t\treturn item.active;\n\t\t\t}\n\n\t\t\treturn this.activeActions.includes(item.action);\n\t\t},\n\t\tgetItemIcon(item: Item): string\n\t\t{\n\t\t\treturn item.active && item.activeIcon ? item.activeIcon : item.icon;\n\t\t},\n\t\tgetItemHint(item: Item): string\n\t\t{\n\t\t\tif (item.disabled === true && item.disabledHint)\n\t\t\t{\n\t\t\t\treturn this.loc(item.disabledHint);\n\t\t\t}\n\n\t\t\tif (item.hint)\n\t\t\t{\n\t\t\t\treturn this.loc(item.hint);\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\thandleItemClick(event: MouseEvent, item: Item): void\n\t\t{\n\t\t\tif (!item.disabled)\n\t\t\t{\n\t\t\t\tthis.$emit(\n\t\t\t\t\t'action',\n\t\t\t\t\t{\n\t\t\t\t\t\taction: item.action,\n\t\t\t\t\t\tnode: event.currentTarget,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tshowHint(event: MouseEvent, item: Item): void\n\t\t{\n\t\t\tconst hintText = this.getItemHint(item);\n\t\t\tif (!hintText)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.hintTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.hintTimeout);\n\t\t\t\tthis.hintTimeout = null;\n\t\t\t}\n\n\t\t\tthis.currentHintElement = event.currentTarget;\n\t\t\tthis.currentHintText = hintText;\n\n\t\t\tthis.hintTimeout = setTimeout(() => {\n\t\t\t\tthis.isHintShown = true;\n\t\t\t}, 1000);\n\t\t},\n\t\thideHint(): void\n\t\t{\n\t\t\tif (this.hintTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.hintTimeout);\n\t\t\t\tthis.hintTimeout = null;\n\t\t\t}\n\n\t\t\tthis.isHintShown = false;\n\t\t\tthis.currentHintElement = null;\n\t\t\tthis.currentHintText = '';\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"hasSections\" class=\"check-list-widget-item-panel\" @mousedown.prevent>\n\t\t\t<div \n\t\t\t\tv-for=\"section in sections\" \n\t\t\t\t:key=\"section.name\"\n\t\t\t\tclass=\"check-list-widget-item-panel-section\"\n\t\t\t\t:class=\"'--' + section.name\"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tv-for=\"item in section.items\" \n\t\t\t\t\t:key=\"item.action\" \n\t\t\t\t\tclass=\"check-list-widget-item-panel-section-item\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'--disabled': item.disabled, \n\t\t\t\t\t\t'--active': item.active,\n\t\t\t\t\t\t[item.className]: !!item.className\n\t\t\t\t\t}\"\n\t\t\t\t\t@mouseenter=\"showHint($event, item)\"\n\t\t\t\t\t@mouseleave=\"hideHint()\"\n\t\t\t\t\t@click=\"handleItemClick($event, item)\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name=\"getItemIcon(item)\" :hoverable=\"item.hoverable\"/>\n\t\t\t\t\t<span v-if=\"item.label\">{{ loc(item.label) }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Hint\n\t\t\t\tv-if=\"isHintShown\"\n\t\t\t\t:bindElement=\"currentHintElement\"\n\t\t\t\t:options=\"hintOptions\"\n\t\t\t>\n\t\t\t\t{{ currentHintText }}\n\t\t\t</Hint>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { Button as UiButton, ButtonSize, ButtonIcon } from 'ui.vue3.components.button';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\n\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { Model } from 'tasks.v2.const';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { CheckListMixin } from './check-list-mixin';\nimport { CheckListStub } from './check-list-stub';\nimport { CheckListWidgetMixin } from './check-list-widget/check-list-widget-mixin';\nimport { CheckListWidget } from './check-list-widget/check-list-widget';\nimport { CheckListItemPanel } from './check-list-widget/check-list-item-panel';\n\nimport './check-list-sheet.css';\n\n// @vue/component\nexport const CheckListSheet = {\n\tname: 'TaskCheckListSheet',\n\tcomponents: {\n\t\tBottomSheet,\n\t\tCheckListWidget,\n\t\tCheckListItemPanel,\n\t\tCheckListStub,\n\t\tUiButton,\n\t\tBIcon,\n\t},\n\tmixins: [\n\t\tCheckListMixin,\n\t\tCheckListWidgetMixin,\n\t],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcheckListId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tButtonIcon,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisExpanded: false,\n\t\t\titemPanelTopOffset: 2,\n\t\t\titemPanelTopLimit: 700,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t},\n\twatch: {\n\t\ttitleFieldOffsetHeight(): void\n\t\t{\n\t\t\tthis.$refs.bottomSheet?.adjustPosition();\n\t\t},\n\t\tasync isShown(value): void\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tEvent.bind(this.$refs.list, 'scroll', this.handleScroll);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEvent.unbind(this.$refs.list, 'scroll', this.handleScroll);\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.cancelGroupMode();\n\n\t\t\tvoid this.saveCheckList();\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\t:isShown=\"isShown\"\n\t\t\t:isExpanded=\"isExpanded\"\n\t\t\t:class=\"'--check-list'\"\n\t\t\tref=\"bottomSheet\"\n\t\t>\n\t\t\t<div ref=\"wrapper\" class=\"tasks-field-check-list-sheet\">\n\t\t\t\t<div ref=\"list\" data-list class=\"tasks-field-check-list-list\">\n\t\t\t\t\t<CheckListWidget\n\t\t\t\t\t\tv-show=\"!stub\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:checkListId=\"checkListId\"\n\t\t\t\t\t\t:listShownItemPanels=\"listShownItemPanels\"\n\t\t\t\t\t\t@update=\"handleUpdate\"\n\t\t\t\t\t\t@toggleIsComplete=\"handleToggleIsComplete\"\n\t\t\t\t\t\t@addItem=\"addItem\"\n\t\t\t\t\t\t@removeItem=\"handleRemove\"\n\t\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t\t\t@toggleCompleted=\"toggleCompleted\"\n\t\t\t\t\t\t@startGroupMode=\"handleGroupMode\"\n\t\t\t\t\t\t@toggleGroupModeSelected=\"handleGroupModeSelect\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CheckListStub v-if=\"stub\" />\n\t\t\t\t\t<div class=\"tasks-field-check-list-close-icon --sheet\">\n\t\t\t\t\t\t<BIcon :name=\"Outline.CROSS_L\" @click=\"handleClose\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-check-list-footer\">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_CHECK_LIST_ADD_BTN')\"\n\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t:leftIcon=\"ButtonIcon.ADD\"\n\t\t\t\t\t\t@click=\"addCheckList\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<CheckListItemPanel\n\t\t\t\t\tv-if=\"itemPanelIsShown\"\n\t\t\t\t\tref=\"panel\"\n\t\t\t\t\t:style=\"itemPanelStyles\"\n\t\t\t\t\t:visibleActions=\"visiblePanelActions\"\n\t\t\t\t\t:disabledActions=\"disabledPanelActions\"\n\t\t\t\t\t:activeActions=\"activePanelActions\"\n\t\t\t\t\t@action=\"handlePanelAction\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</BottomSheet>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { PopupOptions } from 'main.popup';\n\nimport { Popup } from 'ui.vue3.components.popup';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { Button as UiButton, AirButtonStyle, ButtonSize, ButtonIcon } from 'ui.vue3.components.button';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\n\nimport { EventName, Model } from 'tasks.v2.const';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { CheckListMixin } from './check-list-mixin';\nimport { CheckListStub } from './check-list-stub';\nimport { CheckListWidgetMixin } from './check-list-widget/check-list-widget-mixin';\nimport { CheckListWidget } from './check-list-widget/check-list-widget';\nimport { CheckListItemPanel } from './check-list-widget/check-list-item-panel';\n\nimport './check-list-popup.css';\n\n// @vue/component\nexport const CheckListPopup = {\n\tname: 'TaskCheckListPopup',\n\tcomponents: {\n\t\tPopup,\n\t\tCheckListWidget,\n\t\tCheckListItemPanel,\n\t\tCheckListStub,\n\t\tUiButton,\n\t\tBIcon,\n\t},\n\tmixins: [\n\t\tCheckListMixin,\n\t\tCheckListWidgetMixin,\n\t],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['show', 'close', 'resize'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tresizeObserver: null,\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tButtonIcon,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\titemPanelTopOffset: 5,\n\t\t\titemPanelTopLimit: 450,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tpopupId(): string\n\t\t{\n\t\t\treturn `tasks-check-list-popup-${this.taskId}`;\n\t\t},\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tclassName: 'tasks-check-list-popup',\n\t\t\t\twidth: 580,\n\t\t\t\theight: 500,\n\t\t\t\tborderRadius: '18px',\n\t\t\t\toffsetTop: 0,\n\t\t\t\tpadding: 0,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tanimation: {\n\t\t\t\t\tshowClassName: 'tasks-check-list-popup-show',\n\t\t\t\t\tcloseClassName: 'tasks-check-list-popup-close',\n\t\t\t\t\tcloseAnimationType: 'animation',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.handleClose.bind(this),\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t}),\n\t},\n\twatch: {\n\t\tasync titleFieldOffsetHeight(): Promise<void>\n\t\t{\n\t\t\tif (!this.$refs.popupComponent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tthis.resize();\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (const entry of entries)\n\t\t\t{\n\t\t\t\tif (entry.target === this.$refs.wrapper)\n\t\t\t\t{\n\t\t\t\t\tthis.resize();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tEvent.bind(window, 'resize', this.resize);\n\n\t\tEventEmitter.subscribe('BX.Main.Popup:onShow', this.handleShowPopup);\n\t\tEventEmitter.subscribe('BX.Main.Popup:onClose', this.handleClosePopup);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'resize', this.resize);\n\n\t\tEventEmitter.unsubscribe('BX.Main.Popup:onShow', this.handleShowPopup);\n\t\tEventEmitter.unsubscribe('BX.Main.Popup:onClose', this.handleClosePopup);\n\t},\n\tmethods: {\n\t\tresize(): void\n\t\t{\n\t\t\tconst popupInstance = this.$refs.popupComponent?.getPopupInstance();\n\t\t\tif (popupInstance)\n\t\t\t{\n\t\t\t\tthis.$emit('resize');\n\t\t\t\tpopupInstance.adjustPosition();\n\t\t\t}\n\t\t},\n\t\thandleShow(): void\n\t\t{\n\t\t\tthis.$emit('show', { popupInstance: this.$refs.popupComponent.getPopupInstance() });\n\t\t\tthis.$refs.popupComponent?.getPopupInstance().adjustPosition();\n\t\t\tsetTimeout(() => this.resizeObserver.observe(this.$refs.wrapper), 300);\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.cancelGroupMode();\n\n\t\t\tvoid this.saveCheckList();\n\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.$bitrix.eventEmitter.emit(EventName.CloseCheckList);\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup :options=\"popupOptions\" ref=\"popupComponent\">\n\t\t\t<div ref=\"wrapper\" class=\"tasks-check-list-popup-wrapper\">\n\t\t\t\t<div ref=\"list\" data-list class=\"tasks-check-list-popup-list\">\n\t\t\t\t\t<CheckListWidget\n\t\t\t\t\t\tv-show=\"!stub\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:listShownItemPanels=\"listShownItemPanels\"\n\t\t\t\t\t\t@update=\"handleUpdate\"\n\t\t\t\t\t\t@toggleIsComplete=\"handleToggleIsComplete\"\n\t\t\t\t\t\t@show=\"handleShow\"\n\t\t\t\t\t\t@addItem=\"addItem\"\n\t\t\t\t\t\t@removeItem=\"handleRemove\"\n\t\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t\t\t@toggleCompleted=\"toggleCompleted\"\n\t\t\t\t\t\t@startGroupMode=\"handleGroupMode\"\n\t\t\t\t\t\t@toggleGroupModeSelected=\"handleGroupModeSelect\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CheckListStub v-if=\"stub\" />\n\t\t\t\t\t<div class=\"tasks-field-check-list-close-icon --popup\">\n\t\t\t\t\t\t<BIcon :name=\"Outline.CROSS_L\" @click=\"handleClose\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-check-list-popup-footer\">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_CHECK_LIST_NEW_BTN')\"\n\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t:leftIcon=\"ButtonIcon.ADD\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t\t\t@click=\"addCheckList\"\n\t\t\t\t\t/>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_CHECK_LIST_READY_BTN')\"\n\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<CheckListItemPanel\n\t\t\t\t\tv-if=\"itemPanelIsShown\"\n\t\t\t\t\tref=\"panel\"\n\t\t\t\t\t:style=\"itemPanelStyles\"\n\t\t\t\t\t:visibleActions=\"visiblePanelActions\"\n\t\t\t\t\t:disabledActions=\"disabledPanelActions\"\n\t\t\t\t\t:activeActions=\"activePanelActions\"\n\t\t\t\t\t@action=\"handlePanelAction\"\n\t\t\t\t/>\n\t\t\t\t<BMenu\n\t\t\t\t\tv-if=\"isForwardMenuShown\"\n\t\t\t\t\t:options=\"forwardMenuOptions\"\n\t\t\t\t\t@close=\"isForwardMenuShown = false\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n"],"names":["CheckListNotifier","EventEmitter","constructor","params","setEventNamespace","content","Type","isUndefined","timerValue","showBalloonWithTimer","UI","Notification","Center","notify","id","Text","getRandom","actions","title","Loc","getMessage","events","mouseup","bind","onClose","setInterval","update","close","emit","clearInterval","replace","PanelSection","Object","freeze","Important","Attachments","Movement","Accomplice","Auditor","Forward","Delete","Cancel","PanelAction","SetImportant","AttachFile","MoveRight","MoveLeft","AssignAccomplice","AssignAuditor","PanelMeta","defaultSections","name","items","icon","Outline","FIRE","activeIcon","FIRE_SOLID","action","hint","className","hoverable","ATTACH","POINT_RIGHT","POINT_LEFT","PERSON","OBSERVER","FORWARD","TRASHCAN","CROSS_L","CheckListMixin","components","BMenu","data","listShownItemPanels","itemPanelIsShown","checkListWasUpdated","itemId","itemPanelStyles","top","display","isItemPanelFreeze","itemPanelTopOffset","itemPanelTopLimit","itemsRefs","isForwardMenuShown","forwardMenuSectionCode","forwardBindElement","itemsToDelete","collapsedItems","Map","shownPopups","Set","provide","setItemsRef","getItemsRef","computed","isEdit","isNumber","taskId","task","$store","getters","Model","Tasks","checkLists","CheckList","checklist","parentCheckLists","filter","checkList","parentId","hasFewParentCheckLists","length","item","itemGroupModeSelected","groupMode","selected","siblings","children","visiblePanelActions","push","limits","Core","getParams","stakeholdersActions","isDisabledStakeholders","has","stakeholders","disabledPanelActions","disabledActions","itemLevel","getItemLevel","canModify","modify","canRemove","remove","conditionHandlers","sortIndex","entries","forEach","condition","activePanelActions","isImportant","forwardMenuOptions","bindElement","maxWidth","maxHeight","offsetLeft","sections","code","forwardMenuItems","targetContainer","document","body","checklistItems","map","dataset","onClick","hideItemPanel","forwardToChecklist","sectionCode","loc","forwardToNewChecklist","stub","emptyList","includes","mounted","Event","$refs","list","handleScroll","beforeUnmount","unbind","methods","updatePanelPosition","saveCheckList","checkListService","save","isDemoCheckListModified","removeChecklists","demoTitle","accomplices","auditors","removeItem","addCheckList","empty","childId","getDataForNewCheckList","nodeId","dispatch","fields","addFastCheckList","showForwardMenu","node","getCheckListsNumber","getCountForNewCheckList","getSortForNewCheckList","ref","focusToItem","$nextTick","growingTextArea","focusTextarea","showItem","show","hideItem","hide","addItem","sort","hasActiveGroupMode","getSort","resortSiblingsItems","syncParentCompletionState","isRootCall","child","fileService","delete","EntityTypes","CheckListItem","updates","a","b","index","toggleCompleted","collapsed","getAllChildren","completedChildren","isComplete","handleUpdate","handleRemove","messageKey","notifier","subscribeOnce","baseEvent","timerHasEnded","getData","unfreeze","handleGroupRemove","allSelectedItems","getAllSelectedItems","nearestItem","findNearestItem","active","setTimeout","showItemPanel","cancelGroupMode","handleToggleIsComplete","handleFocus","handleBlur","handleEmptyBlur","setDefaultCheckListTitle","handleGroupMode","firstChild","getFirstChild","activateGroupMode","handleGroupModeSelect","showItemPanelOnNearestSelectedItem","deactivateGroupMode","nearestSelectedItem","itemRef","querySelector","panelRect","Dom","getPosition","panel","$el","itemRect","getRelativePosition","isParentItem","paddingOffset","panelWidth","width","left","handlePanelAction","actionHandlers","n","setImportant","attachFile","handleMoveRight","handleMoveLeft","showParticipantDialog","forward","get","browse","moveRight","sibling","currentIndex","findIndex","newParent","i","candidate","isItemDescendant","newParentChildren","parentNodeId","moveLeft","currentParent","find","parent","newParentId","newSiblings","parentInNewListIndex","currentSiblingsUpdates","newSortIndex","shiftUpdates","movedItemUpdate","potentialAncestor","assignAccomplice","assignAuditor","allSelectedWithChildren","getAllSelectedItemsWithChildren","selectedItemsIds","shouldUpdateParentId","targetNode","type","preselected","preselectedParticipants","selectors","selectorId","UserSelectorDialog","dialogOptions","participantMeta","popupOptions","onShow","popup","getTarget","popupWidth","getPopupContainer","offsetWidth","targetNodeWidth","angleShift","Popup","getOption","setAngle","offset","setOffset","users","getDialog","getSelectedItems","getId","getTitle","image","getAvatar","getEntityType","saveParticipants","onHide","user","ids","parentItemId","changedItem","parentItem","childrenItems","isEmptyParent","allChildrenCompleted","every","someChildrenIncomplete","some","shouldUpdateParent","getAllGroupModeItems","getRootParent","directChildren","allChildren","excludeChildrenOf","rootParent","currentSortIndex","excludedParentIds","eligibleItems","isChildOfExcluded","reduce","nearest","selectedItems","getChildren","parentIds","handleShowPopup","getCompatData","add","handleClosePopup","popupComponent","size","checkListMeta","BIcon","mixins","props","Number","String","required","emits","setup","Animated","isLoading","containsChecklist","created","loadData","load","getCompletedCount","getTotalCount","showCheckList","checkListId","$emit","renderCheckListStatus","template","CheckListChip","Chip","isAutonomous","Boolean","default","isUploading","design","isSelected","ChipDesign","Shadow","ShadowAccent","OutlineAccent","true","checkListItemCount","text","completedCount","LOADER_WAIT","CHECK_LIST","$bitrix","eventEmitter","subscribe","EventName","CloseCheckList","handleFieldClose","unsubscribe","handleClick","highlightField","buildEmptyCheckList","fieldHighlighter","setContainer","$root","highlight","chip","focus","CheckListStub","CheckListWidgetMixin","level","current","findParent","CheckListItemMixin","panelIsShown","isHovered","scrollContainer","canToggle","toggle","hasAttachments","hasUsers","hasAccomplices","hasAuditors","files","attachments","textColor","groupModeSelected","updateTitle","clearTitle","clearValue","CheckListParentItem","GrowingTextArea","UserAvatarList","inject","Actions","isSticky","isMenuShown","menuRemoveSectionCode","areChildrenCollapsed","areCompletedCollapsed","menuOptions","more","minWidth","menuItems","closeByEsc","CROSSED_EYE","MULTICHOICE_ON","collapseChildrenItems","itemIcon","CHECK_L","checkListStatus","label","$parent","closest","checkSticky","mutationObserver","MutationObserver","observe","childList","subtree","disconnect","stickyRect","getBoundingClientRect","containerRect","height","showMenu","CheckListChildItem","UserFieldWidgetComponent","itemOffset","uploaderAdapter","getAdapter","uploadingFiles","getFiles","widgetOptions","isEmbedded","withControlPanel","canCreateDocuments","tileWidgetOptions","compact","hideDropArea","hasFilesAttach","hasFiles","hasUploadingError","status","FileStatus","UPLOADING","LOADING","UPLOAD_FAILED","LOAD_FAILED","loadFiles","toggleIsComplete","toggleGroupModeSelected","scrollTo","offsetTop","behavior","focusToTextarea","event","ignoreList","checkbox","target","file","handleEnter","CheckListAddItem","CheckListWidget","Array","collapsedStates","hiddenStates","getCollapsedClassForItem","targetParentItem","scrollTop","getItemOffset","toggleCollapse","handleShowItem","handleHideItem","isFirstVisibleItem","firstVisibleIndex","CheckListItemPanel","Hint","visibleSections","section","visibleActions","activeActions","isHintShown","currentHintElement","currentHintText","hintTimeout","hintOptions","bindOptions","forceBindPosition","forceTop","position","angle","hasSections","disabled","isItemDisabled","isItemActive","getItemIcon","getItemHint","disabledHint","handleItemClick","currentTarget","showHint","hintText","clearTimeout","hideHint","CheckListSheet","BottomSheet","UiButton","isShown","ButtonSize","ButtonIcon","isExpanded","mapGetters","titleFieldOffsetHeight","Interface","watch","bottomSheet","adjustPosition","value","handleClose","CheckListPopup","resizeObserver","AirButtonStyle","popupId","borderRadius","padding","autoHide","animation","showClassName","closeClassName","closeAnimationType","resize","ResizeObserver","entry","wrapper","window","popupInstance","getPopupInstance","handleShow"],"mappings":"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"}