{"version":3,"file":"responsible.bundle.js","sources":["../src/responsible-meta.js","../src/responsible.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { Core } from 'tasks.v2.core';\nimport { EntitySelectorEntity } from 'tasks.v2.const';\n\nexport const responsibleMeta = Object.freeze({\n\tid: 'responsibleId',\n\ttitle: Loc.getMessage('TASKS_V2_RESPONSIBLE_TITLE'),\n\tdialogOptions: (context: string = 'tasks-card-participant') => {\n\t\tconst limits = Core.getParams().limits;\n\n\t\treturn {\n\t\t\tcontext,\n\t\t\tmultiple: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: EntitySelectorEntity.User,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\temailUsers: true,\n\t\t\t\t\t\tinviteGuestLink: true,\n\t\t\t\t\t\tanalyticsSource: 'tasks',\n\t\t\t\t\t\tlockGuestLink: !limits.mailUserIntegration,\n\t\t\t\t\t\tlockGuestLinkFeatureId: limits.mailUserIntegrationFeatureId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t},\n});\n","import { mapGetters } from 'ui.vue3.vuex';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport type { DialogOptions } from 'ui.entity-selector';\n\nimport { Model } from 'tasks.v2.const';\nimport { Participant } from 'tasks.v2.component.elements.participant';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { responsibleMeta } from './responsible-meta';\nimport './responsible.css';\n\n// @vue/component\nexport const Responsible = {\n\tname: 'TaskResponsible',\n\tcomponents: {\n\t\tParticipant,\n\t\tBIcon,\n\t},\n\tinject: ['analytics', 'cardType'],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tselectorWithActionMenu: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tBIcon,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlocalContext: `${this.context}-${this.$options.name}`,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tdialogOptions(): DialogOptions\n\t\t{\n\t\t\treturn responsibleMeta.dialogOptions(this.localContext);\n\t\t},\n\t\tpreselected(): [string, number][]\n\t\t{\n\t\t\treturn [['user', this.task.responsibleId || this.currentUserId]];\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Number.isInteger(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tisFlowFilledOnAdd(): boolean\n\t\t{\n\t\t\treturn this.task.flowId > 0 && !this.isEdit;\n\t\t},\n\t\tdataset(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'data-task-id': this.taskId,\n\t\t\t\t'data-task-field-id': responsibleMeta.id,\n\t\t\t\t'data-task-field-value': this.task.responsibleId,\n\t\t\t};\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.delegate;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleHintClick(): void\n\t\t{\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tcreatorId: this.currentUserId,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tupdateTask(user: UserModel): void\n\t\t{\n\t\t\tvoid this.$store.dispatch(`${Model.Users}/upsert`, user);\n\n\t\t\tif (this.task.responsibleId !== user.id)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics();\n\t\t\t}\n\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tresponsibleId: user.id,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tsendAnalytics(): void\n\t\t{\n\t\t\tanalytics.sendAssigneeChange(this.analytics, {\n\t\t\t\tcardType: this.cardType,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isFlowFilledOnAdd\" class=\"tasks-field-responsible-auto\">\n\t\t\t<BIcon :name=\"Outline.BOTTLENECK\" color=\"var(--ui-color-accent-main-primary)\"></BIcon>\n\t\t\t<div>\n\t\t\t\t{{ loc('TASKS_V2_RESPONSIBLE_AUTO') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<Participant\n\t\t\tv-else\n\t\t\t:taskId=\"taskId\"\n\t\t\t:dialogOptions=\"dialogOptions\"\n\t\t\t:preselected=\"preselected\"\n\t\t\t:canChange=\"() => task.rights.delegate || task.creatorId === currentUserId\"\n\t\t\t:cantChangeHint=\"loc('TASKS_V2_RESPONSIBLE_CANT_CHANGE')\"\n\t\t\t:hintClickHandler=\"handleHintClick\"\n\t\t\t:selectorWithActionMenu=\"selectorWithActionMenu\"\n\t\t\t:dataset=\"dataset\"\n\t\t\t:readonly=\"readonly\"\n\t\t\t@update=\"updateTask\"\n\t\t/>\n\t`,\n};\n"],"names":["responsibleMeta","Object","freeze","id","title","Loc","getMessage","dialogOptions","context","limits","Core","getParams","multiple","enableSearch","entities","EntitySelectorEntity","User","options","emailUsers","inviteGuestLink","analyticsSource","lockGuestLink","mailUserIntegration","lockGuestLinkFeatureId","mailUserIntegrationFeatureId","Responsible","name","components","Participant","BIcon","inject","props","taskId","type","Number","String","required","selectorWithActionMenu","Boolean","default","setup","Outline","data","localContext","$options","computed","mapGetters","currentUserId","Model","Interface","task","$store","getters","Tasks","preselected","responsibleId","isEdit","isInteger","isFlowFilledOnAdd","flowId","dataset","readonly","rights","delegate","methods","handleHintClick","taskService","update","creatorId","updateTask","user","dispatch","Users","sendAnalytics","analytics","sendAssigneeChange","cardType","template"],"mappings":"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"}