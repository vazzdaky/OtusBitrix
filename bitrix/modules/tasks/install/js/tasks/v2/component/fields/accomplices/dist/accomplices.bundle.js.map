{"version":3,"file":"accomplices.bundle.js","sources":["../src/accomplices-meta.js","../src/accomplices-mixin.js","../src/accomplices.js","../src/accomplices-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\n\nexport const accomplicesMeta = Object.freeze({\n\tid: 'accomplicesIds',\n\ttitle: Loc.getMessage('TASKS_V2_ACCOMPLICES_TITLE'),\n});\n","import { Core } from 'tasks.v2.core';\nimport { Model } from 'tasks.v2.const';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nexport const AccomplicesMixin = {\n\tmethods: {\n\t\tupdate(users: UserModel[]): void\n\t\t{\n\t\t\tthis.insertUsers(users);\n\t\t\tthis.updateTask(users.map(({ id }) => id));\n\t\t},\n\t\tinsertUsers(users: UserModel[]): void\n\t\t{\n\t\t\tvoid Core.getStore().dispatch(`${Model.Users}/upsertMany`, users);\n\t\t},\n\t\tupdateTask(accomplicesIds: number[]): void\n\t\t{\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{ accomplicesIds },\n\t\t\t);\n\t\t},\n\t},\n};\n","import { ParticipantList } from 'tasks.v2.component.elements.participant-list';\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { accomplicesMeta } from './accomplices-meta';\nimport { AccomplicesMixin } from './accomplices-mixin';\n\n// @vue/component\nexport const Accomplices = {\n\tname: 'TaskAccomplices',\n\tcomponents: {\n\t\tParticipantList,\n\t},\n\tmixins: [AccomplicesMixin],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tusers(): UserModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Users}/getByIds`](this.task.accomplicesIds);\n\t\t},\n\t\tdataset(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'data-task-id': this.taskId,\n\t\t\t\t'data-task-field-id': accomplicesMeta.id,\n\t\t\t\t'data-task-field-value': this.task.accomplicesIds.join(','),\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ParticipantList\n\t\t\t:taskId=\"taskId\"\n\t\t\tcontext=\"accomplices\"\n\t\t\t:users=\"users\"\n\t\t\t:dataset=\"dataset\"\n\t\t\t@update=\"update\"\n\t\t/>\n\t`,\n};\n","import { Item } from 'ui.entity-selector';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { Chip, ChipDesign } from 'tasks.v2.component.elements.chip';\nimport { participantMeta } from 'tasks.v2.component.elements.participant-list';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { UserSelectorDialog } from 'tasks.v2.lib.user-selector-dialog';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { accomplicesMeta } from './accomplices-meta';\nimport { AccomplicesMixin } from './accomplices-mixin';\n\n// @vue/component\nexport const AccomplicesChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tmixins: [AccomplicesMixin],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\taccomplicesMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tpreselected(): [string, number][]\n\t\t{\n\t\t\treturn this.task.accomplicesIds.map((id: number) => ['user', id]);\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.Shadow;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, accomplicesMeta.id);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tunmounted(): void\n\t{\n\t\tthis.selector?.destroy();\n\t},\n\tmethods: {\n\t\tshowDialog(): void\n\t\t{\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selector ??= new UserSelectorDialog({\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tpreselected: this.preselected,\n\t\t\t\tdialogOptions: participantMeta.dialogOptions(this.taskId, 'accomplices'),\n\t\t\t\tevents: {\n\t\t\t\t\tonHide: () => {\n\t\t\t\t\t\tconst users = this.selector.getDialog().getSelectedItems().map((item: Item) => ({\n\t\t\t\t\t\t\tid: item.getId(),\n\t\t\t\t\t\t\tname: item.getTitle(),\n\t\t\t\t\t\t\timage: item.getAvatar(),\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tif (!this.isSelected && users.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.highlightField();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.update(users);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.selector.selectItemsByIds(this.preselected);\n\t\t\tthis.selector.show(this.$refs.chip.$el);\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(accomplicesMeta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || !readonly\"\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"Outline.PERSON\"\n\t\t\t:text=\"accomplicesMeta.title\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"accomplicesMeta.id\"\n\t\t\t:data-task-chip-value=\"task.accomplicesIds.join(',')\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"showDialog\"\n\t\t/>\n\t`,\n};\n"],"names":["accomplicesMeta","Object","freeze","id","title","Loc","getMessage","AccomplicesMixin","methods","update","users","insertUsers","updateTask","map","Core","getStore","dispatch","Model","Users","accomplicesIds","taskService","taskId","Accomplices","name","components","ParticipantList","mixins","props","type","Number","String","required","computed","task","$store","getters","Tasks","dataset","join","template","AccomplicesChip","Chip","setup","Outline","preselected","design","isSelected","ChipDesign","ShadowAccent","Shadow","readonly","rights","edit","unmounted","selector","destroy","showDialog","highlightField","UserSelectorDialog","dialogOptions","participantMeta","events","onHide","getDialog","getSelectedItems","item","getId","getTitle","image","getAvatar","length","selectItemsByIds","show","$refs","chip","$el","fieldHighlighter","setContainer","$root","highlight"],"mappings":"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"}