{"version":3,"file":"deadline.bundle.js","sources":["../src/deadline-popup/deadline-popup-content.js","../src/deadline-popup/deadline-popup.js","../src/deadline-meta.js","../src/deadline.js"],"sourcesContent":["import { Extension, Type } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport type { BaseEvent } from 'main.core.events';\n\nimport { DatePicker, DatePickerEvent } from 'ui.date-picker';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model, Analytics } from 'tasks.v2.const';\nimport { timezone } from 'tasks.v2.lib.timezone';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport './deadline-popup-content.css';\n\ntype Preset = {\n\tid: string,\n\ttitle: string,\n\ttimestamp: number,\n\tformatted: string,\n};\n\nconst calendarSettings = Extension.getSettings('tasks.v2.component.fields.deadline').calendarSettings;\nconst addZero = (unit: number) => `0${unit}`.slice(-2);\nconst defaultTime = `${addZero(calendarSettings.HOURS.END.H)}:${addZero(calendarSettings.HOURS.END.M)}`;\n\n// @vue/component\nexport const DeadlinePopupContent = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tinject: ['analytics', 'cardType'],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update', 'close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\ttoday: new Date(),\n\t\t\t/** @type DatePicker */\n\t\t\tdatePicker: null,\n\t\t\tdateTs: null,\n\t\t\thour: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tpresets(): Preset[]\n\t\t{\n\t\t\tconst [year, month, date] = [this.today.getFullYear(), this.today.getMonth(), this.today.getDate()];\n\t\t\tconst format = DateTimeFormat.getFormat('DAY_OF_WEEK_MONTH_FORMAT');\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: `today-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_TODAY'),\n\t\t\t\t\tdate: new Date(year, month, date),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `tomorrow-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_TOMORROW'),\n\t\t\t\t\tdate: new Date(year, month, date + 1),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `end-week-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_IN_THE_END_OF_THE_WEEK'),\n\t\t\t\t\tdate: new Date(year, month, date - this.today.getDay() + 5),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `in-week-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_IN_A_WEEK'),\n\t\t\t\t\tdate: new Date(year, month, date + 7),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `month-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_IN_THE_END_OF_THE_MONTH'),\n\t\t\t\t\tdate: new Date(year, month + 1, 0),\n\t\t\t\t},\n\t\t\t].map((preset): Preset => ({\n\t\t\t\tid: preset.id,\n\t\t\t\ttitle: preset.title,\n\t\t\t\ttimestamp: preset.date.getTime(),\n\t\t\t\tformatted: DateTimeFormat.format(format, preset.date),\n\t\t\t}));\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.datePicker = this.createDatePicker();\n\n\t\tconst date = new Date(this.task.deadlineTs + timezone.getOffset(this.task.deadlineTs));\n\t\tthis.dateTs = new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime();\n\t\tthis.hour = date.getHours();\n\t},\n\tmounted(): void\n\t{\n\t\tthis.datePicker.setTargetNode(this.$refs.picker);\n\t\tthis.datePicker.show();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.datePicker.destroy();\n\t},\n\tmethods: {\n\t\tcreateDatePicker(): DatePicker\n\t\t{\n\t\t\tconst offset = timezone.getOffset(this.task.deadlineTs);\n\t\t\tconst picker = new DatePicker({\n\t\t\t\tselectedDates: this.task.deadlineTs ? [this.task.deadlineTs + offset] : null,\n\t\t\t\tdefaultTime,\n\t\t\t\tinline: true,\n\t\t\t\tenableTime: true,\n\t\t\t\tevents: {\n\t\t\t\t\t[DatePickerEvent.SELECT]: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { date } = event.getData();\n\t\t\t\t\t\tconst selectedDate = this.createDateFromUtc(date);\n\t\t\t\t\t\tconst dateTs = selectedDate.getTime();\n\t\t\t\t\t\tthis.$emit('update', dateTs - timezone.getOffset(dateTs));\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tpicker.getPicker('day').subscribe('onSelect', (event: BaseEvent) => {\n\t\t\t\tconst { year, month, day } = event.getData();\n\t\t\t\tconst dateTs = new Date(year, month, day).getTime();\n\n\t\t\t\tthis.close();\n\t\t\t\tthis.sendAnalytics(Analytics.Element.Calendar);\n\n\t\t\t\tthis.dateTs = dateTs;\n\t\t\t});\n\n\t\t\tpicker.getPicker('time').subscribe('onSelect', (event: BaseEvent) => {\n\t\t\t\tconst { hour, minute } = event.getData();\n\t\t\t\tif (Type.isNumber(minute) || hour === this.hour)\n\t\t\t\t{\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t\tthis.sendAnalytics(Analytics.Element.Calendar);\n\n\t\t\t\tthis.hour = hour;\n\t\t\t});\n\n\t\t\treturn picker;\n\t\t},\n\t\tcreateDateFromUtc(date: Date): Date\n\t\t{\n\t\t\treturn new Date(\n\t\t\t\tdate.getUTCFullYear(),\n\t\t\t\tdate.getUTCMonth(),\n\t\t\t\tdate.getUTCDate(),\n\t\t\t\tdate.getUTCHours(),\n\t\t\t\tdate.getUTCMinutes(),\n\t\t\t);\n\t\t},\n\t\tfocusDate(timestamp: ?number): void\n\t\t{\n\t\t\tthis.datePicker.setFocusDate(timestamp);\n\t\t},\n\t\tselectPresetDate(timestamp: number): void\n\t\t{\n\t\t\tconst date = new Date(timestamp);\n\t\t\tconst [y, m, d] = [date.getFullYear(), date.getMonth(), date.getDate()];\n\n\t\t\tthis.datePicker.selectDate(new Date(`${m + 1}/${d}/${y} ${defaultTime}`));\n\t\t\tthis.sendAnalytics(Analytics.Element.DeadlinePreset);\n\n\t\t\tthis.close();\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tsendAnalytics(element: string): void\n\t\t{\n\t\t\tanalytics.sendDeadlineSet(this.analytics, {\n\t\t\t\tcardType: this.cardType,\n\t\t\t\telement,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-deadline-popup\">\n\t\t\t<div class=\"tasks-field-deadline-presets\">\n\t\t\t\t<template v-for=\"(preset, index) of presets\" :key=\"index\">\n\t\t\t\t\t<div\n\t\t\t\t\t\t:data-task-preset-id=\"preset.id\"\n\t\t\t\t\t\tclass=\"tasks-field-deadline-preset\"\n\t\t\t\t\t\t@click=\"selectPresetDate(preset.timestamp)\"\n\t\t\t\t\t\t@mouseenter=\"focusDate(preset.timestamp)\"\n\t\t\t\t\t\t@mouseleave=\"focusDate(null)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-field-deadline-preset-title\">{{ preset.title }}</div>\n\t\t\t\t\t\t<div class=\"tasks-field-deadline-preset-date\">{{ preset.formatted }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-field-deadline-picker-container\">\n\t\t\t\t<div class=\"tasks-field-deadline-picker\" ref=\"picker\">\n\t\t\t\t\t<BIcon v-if=\"false\" class=\"tasks-field-deadline-picker-settings\" :name=\"Outline.FILTER_2_LINES\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"false\" class=\"tasks-field-deadline-settings\">\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\nimport { Popup } from 'ui.vue3.components.popup';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { DeadlinePopupContent } from './deadline-popup-content';\n\n// @vue/component\nexport const DeadlinePopup = {\n\tcomponents: {\n\t\tPopup,\n\t\tDeadlinePopupContent,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update', 'close'],\n\tcomputed: {\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `tasks-field-deadline-popup-${this.taskId}`,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tpadding: 24,\n\t\t\t\toffsetTop: 5,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tclear(): void\n\t\t{\n\t\t\tthis.deadlineTs = null;\n\t\t},\n\t\thandleUpdate(dateTs: number): void\n\t\t{\n\t\t\tthis.deadlineTs = dateTs;\n\t\t\tthis.$emit('update', dateTs);\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tif (this.deadlineTs)\n\t\t\t{\n\t\t\t\tvoid taskService.update(\n\t\t\t\t\tthis.taskId,\n\t\t\t\t\t{\n\t\t\t\t\t\tdeadlineTs: this.deadlineTs,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup\n\t\t\t:options=\"popupOptions\"\n\t\t\t@close=\"handleClose\"\n\t\t>\n\t\t\t<DeadlinePopupContent :taskId=\"taskId\" @update=\"handleUpdate\" @close=\"handleClose\"/>\n\t\t</Popup>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const deadlineMeta = Object.freeze({\n\tid: 'deadlineTs',\n\ttitle: Loc.getMessage('TASKS_V2_DEADLINE_TITLE'),\n});\n","import { DateTimeFormat, DurationFormat } from 'main.date';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { timezone } from 'tasks.v2.lib.timezone';\nimport { heightTransition } from 'tasks.v2.lib.height-transition';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { DeadlinePopup } from './deadline-popup/deadline-popup';\nimport { deadlineMeta } from './deadline-meta';\nimport './deadline.css';\n\n// @vue/component\nexport const Deadline = {\n\tcomponents: {\n\t\tBIcon,\n\t\tDeadlinePopup,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineMeta,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tnowTs: Date.now(),\n\t\t\tisPopupShown: false,\n\t\t\tselectingDeadlineTs: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tdeadlineTs(): number\n\t\t{\n\t\t\treturn this.selectingDeadlineTs ?? this.task.deadlineTs;\n\t\t},\n\t\texpiredDuration(): number\n\t\t{\n\t\t\tif (!this.deadlineTs)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn this.nowTs - this.deadlineTs;\n\t\t},\n\t\tisExpired(): boolean\n\t\t{\n\t\t\treturn this.expiredDuration > 0 && !this.isFlowFilledOnAdd;\n\t\t},\n\t\texpiredFormatted(): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_DEADLINE_EXPIRED', {\n\t\t\t\t'#EXPIRED_DURATION#': new DurationFormat(this.expiredDuration).formatClosest(),\n\t\t\t});\n\t\t},\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\tif (this.isFlowFilledOnAdd)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_DEADLINE_AUTO');\n\t\t\t}\n\n\t\t\tif (!this.deadlineTs)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_DEADLINE_EMPTY');\n\t\t\t}\n\n\t\t\tconst isThisYear = new Date(this.deadlineTs).getFullYear() === new Date().getFullYear();\n\t\t\tconst dateFormat = DateTimeFormat.getFormat(isThisYear ? 'DAY_MONTH_FORMAT' : 'LONG_DATE_FORMAT');\n\t\t\tconst timeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\t\t\tconst offset = timezone.getOffset(this.deadlineTs);\n\n\t\t\treturn DateTimeFormat.format(`${dateFormat} ${timeFormat}`, (this.deadlineTs + offset) / 1000);\n\t\t},\n\t\ticonName(): string\n\t\t{\n\t\t\tif (this.isFlowFilledOnAdd)\n\t\t\t{\n\t\t\t\treturn Outline.BOTTLENECK;\n\t\t\t}\n\n\t\t\treturn Outline.CALENDAR_WITH_SLOTS;\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Number.isInteger(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tisFlowFilledOnAdd(): boolean\n\t\t{\n\t\t\treturn this.task.flowId > 0 && !this.isEdit;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.deadline || this.isFlowFilledOnAdd;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\theightTransition.animate(this.$refs.container);\n\t\tthis.nowTsInterval = setInterval(() => {\n\t\t\tthis.nowTs = Date.now();\n\t\t}, 1000);\n\t},\n\tupdated(): void\n\t{\n\t\theightTransition.animate(this.$refs.container);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tclearInterval(this.nowTsInterval);\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t\thandleCrossClick(event: MouseEvent): void\n\t\t{\n\t\t\tevent.stopPropagation();\n\n\t\t\tthis.$refs.popup?.clear();\n\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tdeadlineTs: 0,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\thandleUpdate(selectingDeadlineTs: number): void\n\t\t{\n\t\t\tthis.selectingDeadlineTs = selectingDeadlineTs;\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.isPopupShown = false;\n\t\t\tthis.selectingDeadlineTs = null;\n\t\t\tthis.$refs.deadline?.focus();\n\t\t},\n\t\thandleKeydown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (event.key === 'Enter' && !(event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tvoid this.handleClick();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-deadline\"\n\t\t\t:class=\"{ '--expired': isExpired }\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"deadlineMeta.id\"\n\t\t\t:data-task-field-value=\"task.deadlineTs\"\n\t\t\tref=\"container\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"tasks-field-deadline-main\"\n\t\t\t\t:class=\"{ '--readonly': readonly }\"\n\t\t\t\tref=\"deadline\"\n\t\t\t\ttabindex=\"0\"\n\t\t\t\t@click=\"handleClick\"\n\t\t\t\t@keydown=\"handleKeydown\"\n\t\t\t>\n\t\t\t\t<BIcon class=\"tasks-field-deadline-icon\" :name=\"iconName\"/>\n\t\t\t\t<div class=\"tasks-field-deadline-text\">{{ deadlineFormatted }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\tv-if=\"deadlineTs && !readonly\"\n\t\t\t\t\tclass=\"tasks-field-deadline-cross\"\n\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t@click.capture=\"handleCrossClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if=\"isExpired\" class=\"tasks-field-deadline-expired\">{{ expiredFormatted }}</div>\n\t\t</div>\n\t\t<DeadlinePopup\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:taskId=\"taskId\"\n\t\t\t:bindElement=\"$refs.deadline\"\n\t\t\tref=\"popup\"\n\t\t\t@update=\"handleUpdate\"\n\t\t\t@close=\"handleClose\"\n\t\t/>\n\t`,\n};\n"],"names":["calendarSettings","Extension","getSettings","addZero","unit","slice","defaultTime","HOURS","END","H","M","DeadlinePopupContent","components","BIcon","inject","props","taskId","type","Number","String","required","emits","setup","Outline","today","Date","datePicker","dateTs","hour","computed","task","$store","getters","Model","Tasks","presets","year","month","date","getFullYear","getMonth","getDate","format","DateTimeFormat","getFormat","id","title","loc","getDay","map","preset","timestamp","getTime","formatted","created","createDatePicker","deadlineTs","timezone","getOffset","getHours","mounted","setTargetNode","$refs","picker","show","beforeUnmount","destroy","methods","offset","DatePicker","selectedDates","inline","enableTime","events","DatePickerEvent","SELECT","event","getData","selectedDate","createDateFromUtc","$emit","getPicker","subscribe","day","close","sendAnalytics","Analytics","Element","Calendar","minute","Type","isNumber","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","focusDate","setFocusDate","selectPresetDate","y","m","d","selectDate","DeadlinePreset","element","analytics","sendDeadlineSet","cardType","template","DeadlinePopup","Popup","bindElement","HTMLElement","popupOptions","padding","offsetTop","offsetLeft","targetContainer","document","body","clear","handleUpdate","handleClose","taskService","update","deadlineMeta","Object","freeze","Loc","getMessage","Deadline","data","nowTs","now","isPopupShown","selectingDeadlineTs","expiredDuration","isExpired","isFlowFilledOnAdd","expiredFormatted","DurationFormat","formatClosest","deadlineFormatted","isThisYear","dateFormat","timeFormat","iconName","BOTTLENECK","CALENDAR_WITH_SLOTS","isEdit","isInteger","flowId","readonly","rights","deadline","heightTransition","animate","container","nowTsInterval","setInterval","updated","clearInterval","handleClick","handleCrossClick","stopPropagation","popup","focus","handleKeydown","key","ctrlKey","metaKey"],"mappings":"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"}