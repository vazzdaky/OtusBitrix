{"version":3,"file":"core.bundle.js","sources":["../src/core.js"],"sourcesContent":["import { Extension } from 'main.core';\nimport { Builder, BuilderModel, Store } from 'ui.vue3.vuex';\n\nimport { Epics } from 'tasks.v2.model.epics';\nimport { Flows } from 'tasks.v2.model.flows';\nimport { Groups } from 'tasks.v2.model.groups';\nimport { Interface } from 'tasks.v2.model.interface';\nimport { Stages } from 'tasks.v2.model.stages';\nimport { Tasks } from 'tasks.v2.model.tasks';\nimport { CheckList } from 'tasks.v2.model.check-list';\nimport { Users } from 'tasks.v2.model.users';\n\nimport { PullManager } from 'tasks.v2.provider.pull.pull-manager';\n\nimport type { CoreParams } from './types';\nexport type { CoreParams };\n\nclass CoreApplication\n{\n\t#params: CoreParams = Extension.getSettings('tasks.v2.core');\n\n\t#store: Store;\n\t#builder: Builder;\n\t#initPromise: Promise;\n\t#pullManager: ?PullManager = null;\n\n\tgetParams(): CoreParams\n\t{\n\t\treturn this.#params;\n\t}\n\n\tgetParam(name: string): any\n\t{\n\t\treturn this.#params[name] || null;\n\t}\n\n\tsetParams(params: CoreParams): void\n\t{\n\t\tthis.#params = params;\n\t}\n\n\tgetStore(): Store\n\t{\n\t\treturn this.#store;\n\t}\n\n\tinit(): Promise<void>\n\t{\n\t\t// eslint-disable-next-line no-async-promise-executor\n\t\tthis.#initPromise ??= new Promise(async (resolve) => {\n\t\t\tthis.#store = await this.#initStore();\n\t\t\tthis.#initPull();\n\t\t\tresolve();\n\t\t});\n\n\t\treturn this.#initPromise;\n\t}\n\n\tasync addDynamicModel(vuexBuilderModel: BuilderModel): Promise<void>\n\t{\n\t\tif (!(this.#builder instanceof Builder))\n\t\t{\n\t\t\tthrow new TypeError('Builder has not been init');\n\t\t}\n\n\t\tif (this.#store.hasModule(vuexBuilderModel.getName()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.#builder.addDynamicModel(vuexBuilderModel);\n\t}\n\n\tremoveDynamicModel(vuexModelName: string): void\n\t{\n\t\tif (this.#builder instanceof Builder && this.#store.hasModule(vuexModelName))\n\t\t{\n\t\t\tthis.#builder.removeDynamicModel(vuexModelName);\n\t\t}\n\t}\n\n\tasync #initStore(): Promise<Store>\n\t{\n\t\tthis.#builder = Builder.init();\n\n\t\tthis.#builder\n\t\t\t.addModel(Epics.create())\n\t\t\t.addModel(Flows.create())\n\t\t\t.addModel(Groups.create())\n\t\t\t.addModel(Interface.createWithVariables(this.#params))\n\t\t\t.addModel(Stages.create())\n\t\t\t.addModel(Tasks.create())\n\t\t\t.addModel(CheckList.create())\n\t\t\t.addModel(Users.create())\n\t\t;\n\n\t\tconst builderResult = await this.#builder.build();\n\n\t\treturn builderResult.store;\n\t}\n\n\t#initPull(): void\n\t{\n\t\tthis.#pullManager = new PullManager({\n\t\t\tcurrentUserId: this.#params.currentUserId,\n\t\t});\n\n\t\tthis.#pullManager.initQueueManager();\n\t}\n}\n\nexport const Core = new CoreApplication();\n"],"names":["CoreApplication","Extension","getSettings","getParams","getParam","name","setParams","params","getStore","init","Promise","resolve","addDynamicModel","vuexBuilderModel","Builder","TypeError","hasModule","getName","removeDynamicModel","vuexModelName","addModel","Epics","create","Flows","Groups","Interface","createWithVariables","Stages","Tasks","CheckList","Users","builderResult","build","store","PullManager","currentUserId","initQueueManager","Core"],"mappings":";;;;;;CAYkE;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAKlE,MAAMA,eAAe,CACrB;GAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACuBC,mBAAS,CAACC,WAAW,CAAC,eAAe;;KAAC;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAK/B;;;GAE7BC,SAAS,GACT;KACC,+CAAO,IAAI;;GAGZC,QAAQ,CAACC,IAAY,EACrB;KACC,OAAO,4CAAI,oBAASA,IAAI,CAAC,IAAI,IAAI;;GAGlCC,SAAS,CAACC,MAAkB,EAC5B;KACC,4CAAI,sBAAWA,MAAM;;GAGtBC,QAAQ,GACR;KACC,+CAAO,IAAI;;GAGZC,IAAI,GACJ;KAAA;;KAEC,+FAAI,yGAAkB,IAAIC,OAAO,CAAC,MAAOC,OAAO,IAAK;OACpD,4CAAI,oBAAU,8CAAM,IAAI,2BAAa;OACrC,4CAAI;OACJA,OAAO,EAAE;MACT,CAAC;KAEF,+CAAO,IAAI;;GAGZ,MAAMC,eAAe,CAACC,gBAA8B,EACpD;KACC,IAAI,EAAE,4CAAI,iCAAqBC,oBAAO,CAAC,EACvC;OACC,MAAM,IAAIC,SAAS,CAAC,2BAA2B,CAAC;;KAGjD,IAAI,4CAAI,kBAAQC,SAAS,CAACH,gBAAgB,CAACI,OAAO,EAAE,CAAC,EACrD;OACC;;KAGD,MAAM,4CAAI,sBAAUL,eAAe,CAACC,gBAAgB,CAAC;;GAGtDK,kBAAkB,CAACC,aAAqB,EACxC;KACC,IAAI,4CAAI,iCAAqBL,oBAAO,IAAI,4CAAI,kBAAQE,SAAS,CAACG,aAAa,CAAC,EAC5E;OACC,4CAAI,sBAAUD,kBAAkB,CAACC,aAAa,CAAC;;;CAgClD;CAAC,6BA3BA;GACC,4CAAI,wBAAYL,oBAAO,CAACL,IAAI,EAAE;GAE9B,4CAAI,sBACFW,QAAQ,CAACC,0BAAK,CAACC,MAAM,EAAE,CAAC,CACxBF,QAAQ,CAACG,0BAAK,CAACD,MAAM,EAAE,CAAC,CACxBF,QAAQ,CAACI,4BAAM,CAACF,MAAM,EAAE,CAAC,CACzBF,QAAQ,CAACK,kCAAS,CAACC,mBAAmB,yCAAC,IAAI,oBAAS,CAAC,CACrDN,QAAQ,CAACO,4BAAM,CAACL,MAAM,EAAE,CAAC,CACzBF,QAAQ,CAACQ,0BAAK,CAACN,MAAM,EAAE,CAAC,CACxBF,QAAQ,CAACS,kCAAS,CAACP,MAAM,EAAE,CAAC,CAC5BF,QAAQ,CAACU,0BAAK,CAACR,MAAM,EAAE,CAAC;GAG1B,MAAMS,aAAa,GAAG,MAAM,4CAAI,sBAAUC,KAAK,EAAE;GAEjD,OAAOD,aAAa,CAACE,KAAK;CAC3B;CAAC,sBAGD;GACC,4CAAI,gCAAgB,IAAIC,8CAAW,CAAC;KACnCC,aAAa,EAAE,4CAAI,oBAASA;IAC5B,CAAC;GAEF,4CAAI,8BAAcC,gBAAgB,EAAE;CACrC;AAGD,OAAaC,IAAI,GAAG,IAAIrC,eAAe,EAAE;;;;;;;;"}