{"version":3,"file":"task-compact-card.bundle.js","sources":["../src/component/full-card-button/full-card-button.js","../src/component/drop-zone/drop-zone.js","../src/component/app.js","../src/task-compact-card.js"],"sourcesContent":["import { Event } from 'main.core';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model } from 'tasks.v2.const';\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { checkListMeta } from 'tasks.v2.component.fields.check-list';\nimport { filesMeta } from 'tasks.v2.component.fields.files';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { EntityTypes, fileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport './full-card-button.css';\n\n// @vue/component\nexport const FullCardButton = {\n\tcomponents: {\n\t\tHint,\n\t\tUiButton,\n\t},\n\tinject: ['analytics'],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisOpening: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:isOpening'],\n\tsetup(props): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisHintShown: false,\n\t\t\thintBindElement: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.task?.checklist\n\t\t\t\t? this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist)\n\t\t\t\t: [];\n\t\t},\n\t\tisDisabled(): boolean\n\t\t{\n\t\t\treturn this.isUploading || this.isCheckListUploading;\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.fileService.isUploading();\n\t\t},\n\t\tisCheckListUploading(): boolean\n\t\t{\n\t\t\treturn this.task.checklist?.some((itemId) => fileService.get(itemId, EntityTypes.CheckListItem).isUploading());\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isUploading)\n\t\t\t{\n\t\t\t\tthis.highlightFiles();\n\t\t\t}\n\t\t\telse if (this.isCheckListUploading)\n\t\t\t{\n\t\t\t\tthis.highlightChecklist();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.openFullCard();\n\t\t\t}\n\t\t},\n\t\thighlightFiles(): void\n\t\t{\n\t\t\tthis.hintBindElement = fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(filesMeta.id);\n\n\t\t\tthis.showHint();\n\t\t},\n\t\thighlightChecklist(): void\n\t\t{\n\t\t\tthis.hintBindElement = fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(checkListMeta.id);\n\n\t\t\tthis.showHint();\n\t\t},\n\t\tshowHint(): void\n\t\t{\n\t\t\tconst removeHighlight = () => {\n\t\t\t\tthis.isHintShown = false;\n\t\t\t\tEvent.unbind(window, 'keydown', removeHighlight);\n\t\t\t};\n\t\t\tEvent.bind(window, 'keydown', removeHighlight);\n\n\t\t\tthis.isHintShown = true;\n\t\t},\n\t\topenFullCard(): void\n\t\t{\n\t\t\tif (this.isOpening)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('update:isOpening', true);\n\n\t\t\tconst features = Core.getParams().features;\n\t\t\tanalytics.sendOpenFullCard(this.analytics);\n\t\t\tif (features.isMiniformEnabled && !features.isV2Enabled)\n\t\t\t{\n\t\t\t\tEvent.EventEmitter.emit(`${EventName.OpenSliderCard}:${this.taskId}`, {\n\t\t\t\t\ttask: this.task,\n\t\t\t\t\tcheckLists: this.checkLists,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEvent.EventEmitter.emit(`${EventName.OpenFullCard}:${this.taskId}`, this.taskId);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-compact-card-full-button-container\"\n\t\t\t:class=\"{ '--disabled': isDisabled }\"\n\t\t\t@click=\"handleClick\"\n\t\t>\n\t\t\t<UiButton\n\t\t\t\tclass=\"tasks-compact-card-full-button\"\n\t\t\t\t:text=\"loc('TASKS_V2_TCC_FULL_CARD_BTN')\"\n\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t:loading=\"isOpening\"\n\t\t\t\t:dataset=\"{taskButtonId: 'full'}\"\n\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t/>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if=\"isHintShown\"\n\t\t\t:bindElement=\"hintBindElement\"\n\t\t\t@close=\"isHintShown = false\"\n\t\t>\n\t\t\t{{ loc('TASKS_V2_TCC_FILE_IS_UPLOADING') }}\n\t\t</Hint>\n\t`,\n};\n","import { BIcon } from 'ui.icon-set.api.vue';\nimport { Main } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\n\nimport './drop-zone.css';\n\n// @vue/component\nexport const DropZone = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tMain,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-compact-card-drop-zone-container\">\n\t\t\t<div class=\"tasks-compact-card-drop-zone\">\n\t\t\t\t<BIcon :name=\"Main.ATTACH\"/>\n\t\t\t\t<div class=\"tasks-compact-card-drop-zone-text\">{{ loc('TASKS_V2_TCC_DROP_ZONE') }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event, Text, Type } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nimport { mapActions, mapGetters } from 'ui.vue3.vuex';\nimport { Notifier } from 'ui.notification-manager';\nimport { DragOverMixin } from 'ui.uploader.tile-widget';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model, CardType, GroupType } from 'tasks.v2.const';\nimport { AddTaskButton } from 'tasks.v2.component.add-task-button';\nimport { Title as FieldTitle } from 'tasks.v2.component.fields.title';\nimport { Importance } from 'tasks.v2.component.fields.importance';\nimport { DescriptionInline } from 'tasks.v2.component.fields.description';\nimport { FieldList } from 'tasks.v2.component.elements.field-list';\nimport { Responsible, responsibleMeta } from 'tasks.v2.component.fields.responsible';\nimport { Deadline, deadlineMeta } from 'tasks.v2.component.fields.deadline';\nimport { CheckListChip, CheckList } from 'tasks.v2.component.fields.check-list';\nimport { FilesChip } from 'tasks.v2.component.fields.files';\nimport { GroupChip } from 'tasks.v2.component.fields.group';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { fileService } from 'tasks.v2.provider.service.file-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { GroupModel } from 'tasks.v2.model.groups';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { FullCardButton } from './full-card-button/full-card-button';\nimport { DropZone } from './drop-zone/drop-zone';\nimport './app.css';\n\n// @vue/component\nexport const App = {\n\tname: 'TaskCompactCard',\n\tcomponents: {\n\t\tBIcon,\n\t\tFieldTitle,\n\t\tDescriptionInline,\n\t\tImportance,\n\t\tFieldList,\n\t\tUiButton,\n\t\tAddTaskButton,\n\t\tCheckList,\n\t\tFullCardButton,\n\t\tDropZone,\n\t},\n\tmixins: [DragOverMixin],\n\tprovide(): Object\n\t{\n\t\treturn {\n\t\t\tanalytics: this.analytics,\n\t\t\tcardType: CardType.Compact,\n\t\t};\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: () => Text.getRandom(),\n\t\t},\n\t\tgroupId: {\n\t\t\ttype: [Number],\n\t\t\trequired: false,\n\t\t\tdefault: null,\n\t\t},\n\t\tdeadlineTs: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: false,\n\t\t\tdefault: null,\n\t\t},\n\t\tanalytics: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({}),\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\topeningFullCard: false,\n\t\t\tisCheckListPopupShown: false,\n\t\t\tchipsEventHandlers: {\n\t\t\t\tshowCheckList: this.showCheckListPopup,\n\t\t\t},\n\t\t\tcreationError: false,\n\t\t\tpopupCount: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t\tdefaultDeadline: `${Model.Interface}/defaultDeadline`,\n\t\t}),\n\t\thasDefaultDeadline(): boolean\n\t\t{\n\t\t\treturn this.defaultDeadline.defaultDeadlineDate !== '';\n\t\t},\n\t\tdefaultDeadlineTs(): number\n\t\t{\n\t\t\treturn new Date(this.defaultDeadline.defaultDeadlineDate).getTime();\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tgroup(): GroupModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Groups}/getById`](this.task.groupId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.task?.checklist\n\t\t\t\t? this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist)\n\t\t\t\t: [];\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tprimaryFields(): Object[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: responsibleMeta.title,\n\t\t\t\t\tcomponent: Responsible,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t\tcontext: this.$options.name,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: deadlineMeta.title,\n\t\t\t\t\tcomponent: Deadline,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tchips(): Object[]\n\t\t{\n\t\t\treturn [\n\t\t\t\tFilesChip,\n\t\t\t\tCheckListChip,\n\t\t\t\t...(Core.getParams().features.isProjectsEnabled ? [GroupChip] : []),\n\t\t\t];\n\t\t},\n\t\ttitleDisabled(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit || this.isCheckListPopupShown;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tif (!this.isEdit)\n\t\t{\n\t\t\tthis.destroy();\n\n\t\t\tconst payload = {\n\t\t\t\tid: this.taskId,\n\t\t\t\tcreatorId: this.currentUserId,\n\t\t\t\tresponsibleId: this.currentUserId,\n\t\t\t\t...(this.groupId ? { groupId: this.groupId } : {}),\n\t\t\t};\n\n\t\t\tif (this.deadlineTs !== null)\n\t\t\t{\n\t\t\t\tpayload.deadlineTs = this.deadlineTs;\n\t\t\t}\n\t\t\telse if (this.hasDefaultDeadline)\n\t\t\t{\n\t\t\t\tpayload.deadlineTs = this.defaultDeadlineTs;\n\t\t\t}\n\n\t\t\tthis.insert(payload);\n\t\t}\n\n\t\tthis.fileService = fileService.get(this.taskId);\n\n\t\tanalytics.sendOpenCard(this.analytics, {\n\t\t\tcollabId: this.group?.type === GroupType.Collab ? this.group.id : null,\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tthis.resizeObserver = new ResizeObserver(async (entries) => {\n\t\t\tconst title = entries.find(({ target }) => target === this.$refs.title);\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tawait this.updateTitleFieldOffsetHeight(title.contentRect.height);\n\t\t\t}\n\t\t});\n\n\t\tthis.resizeObserver.observe(this.$refs.title);\n\t\tthis.subscribeEvents();\n\n\t\tthis.fileService.getAdapter().getUploader().assignDropzone(this.$el);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.disconnect();\n\t\t}\n\t\tthis.unsubscribeEvents();\n\t},\n\tunmounted(): void\n\t{\n\t\tif (!this.isEdit && this.openingFullCard === false)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t},\n\tmethods: {\n\t\t...mapActions(Model.Tasks, [\n\t\t\t'insert',\n\t\t\t'delete',\n\t\t]),\n\t\t...mapActions(Model.Interface, [\n\t\t\t'updateTitleFieldOffsetHeight',\n\t\t]),\n\t\tclose(): void\n\t\t{\n\t\t\tEvent.EventEmitter.emit(`${EventName.CloseCard}:${this.taskId}`);\n\t\t},\n\t\tasync addTask(): void\n\t\t{\n\t\t\tconst [id, error] = await taskService.add(this.task);\n\n\t\t\tif (!id)\n\t\t\t{\n\t\t\t\tthis.creationError = true;\n\n\t\t\t\tNotifier.notify({\n\t\t\t\t\tid: 'task-message-add-error',\n\t\t\t\t\ttext: error.message,\n\t\t\t\t});\n\n\t\t\t\tthis.sendAddTaskAnalytics(false);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sendAddTaskAnalytics(true);\n\n\t\t\tanalytics.sendDescription(this.analytics, {\n\t\t\t\thasDescription: Type.isStringFilled(this.task?.description),\n\t\t\t\thasScroll: this.$refs?.description?.hasScroll(),\n\t\t\t});\n\n\t\t\tif (this.checkLists.length > 0)\n\t\t\t{\n\t\t\t\tawait checkListService.save(id, this.checkLists);\n\t\t\t}\n\n\t\t\tfileService.replace(this.taskId, id);\n\n\t\t\tconst baseEvent = new BaseEvent({\n\t\t\t\tdata: id,\n\t\t\t\tcompatData: [\n\t\t\t\t\t'ADD',\n\t\t\t\t\t{\n\t\t\t\t\t\ttask: this.task,\n\t\t\t\t\t\toptions: {},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tEvent.EventEmitter.emit(EventName.NotifyGrid, baseEvent);\n\n\t\t\tconst features = Core.getParams().features;\n\t\t\tif (features.isMiniformEnabled && !features.isV2Enabled)\n\t\t\t{\n\t\t\t\tthis.close();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.EventEmitter.emit(`${EventName.OpenFullCard}:${this.taskId}`, id);\n\n\t\t\tthis.close();\n\t\t},\n\t\tsendAddTaskAnalytics(isSuccess: boolean): void\n\t\t{\n\t\t\tconst collabId = this.group?.type === GroupType.Collab ? this.group.id : null;\n\t\t\tif (this.checkLists.length > 0)\n\t\t\t{\n\t\t\t\tconst checkLists = this.checkLists.filter(({ parentId }) => parentId === 0);\n\t\t\t\tconst checkListsItems = this.checkLists.filter(({ parentId }) => parentId !== 0);\n\t\t\t\tanalytics.sendAddTaskWithCheckList(this.analytics, {\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tcollabId,\n\t\t\t\t\tviewersCount: this.task.auditorsIds.length,\n\t\t\t\t\tchecklistCount: checkLists.length,\n\t\t\t\t\tchecklistItemsCount: checkListsItems.length,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.sendAddTask(this.analytics, {\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tcollabId,\n\t\t\t\t\tviewersCount: this.task.auditorsIds.length,\n\t\t\t\t\tcoexecutorsCount: this.task.accomplicesIds.length,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\thandleShowingPopup(event: BaseEvent): void\n\t\t{\n\t\t\tEvent.EventEmitter.emit(`${EventName.ShowOverlay}:${this.taskId}`, { taskId: this.taskId });\n\t\t\tthis.externalPopup = event.popupInstance;\n\t\t\tthis.adjustCardPopup(true);\n\t\t\tthis.fileService.getAdapter().getUploader().unassignDropzone(this.$el);\n\t\t},\n\t\thandleHidingPopup(): void\n\t\t{\n\t\t\tEvent.EventEmitter.emit(`${EventName.HideOverlay}:${this.taskId}`);\n\t\t\tEvent.EventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`);\n\t\t\tthis.externalPopup = null;\n\t\t\tthis.fileService.getAdapter().getUploader().assignDropzone(this.$el);\n\t\t},\n\t\thandleResizingPopup(): void\n\t\t{\n\t\t\tthis.adjustCardPopup();\n\t\t},\n\t\tadjustCardPopup(animate: boolean = false): void\n\t\t{\n\t\t\tif (!this.externalPopup)\n\t\t\t{\n\t\t\t\tEvent.EventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.EventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`, {\n\t\t\t\ttitleFieldHeight: this.titleFieldOffsetHeight,\n\t\t\t\tinnerPopup: this.externalPopup,\n\t\t\t\tanimate,\n\t\t\t});\n\t\t},\n\t\tshowCheckListPopup(): void\n\t\t{\n\t\t\tthis.isCheckListPopupShown = true;\n\t\t},\n\t\tcloseCheckListPopup(): void\n\t\t{\n\t\t\tthis.isCheckListPopupShown = false;\n\t\t},\n\t\tgetEventListeners(chip, handlers): Object\n\t\t{\n\t\t\tconst listeners = {};\n\n\t\t\tif (chip.emits)\n\t\t\t{\n\t\t\t\tObject.keys(handlers).forEach((event: string) => {\n\t\t\t\t\tif (chip.emits.includes(event))\n\t\t\t\t\t{\n\t\t\t\t\t\tlisteners[event] = handlers[event];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn listeners;\n\t\t},\n\t\tsubscribeEvents(): void\n\t\t{\n\t\t\tEventEmitter.subscribe('BX.Main.Popup:onShow', this.handlePopupShow);\n\t\t\tEvent.bind(document, 'keydown', this.handleKeyDown, { capture: true });\n\t\t},\n\t\tunsubscribeEvents(): void\n\t\t{\n\t\t\tEventEmitter.unsubscribe('BX.Main.Popup:onShow', this.handlePopupShow);\n\t\t\tEvent.unbind(document, 'keydown', this.handleKeyDown, { capture: true });\n\t\t},\n\t\thandlePopupShow(event): void\n\t\t{\n\t\t\tconst popup: Popup = event.getCompatData()[0];\n\n\t\t\tconst onClose = (): void => {\n\t\t\t\tpopup.unsubscribe('onClose', onClose);\n\t\t\t\tpopup.unsubscribe('onDestroy', onClose);\n\n\t\t\t\tthis.popupCount--;\n\t\t\t};\n\n\t\t\tpopup.subscribe('onClose', onClose);\n\t\t\tpopup.subscribe('onDestroy', onClose);\n\n\t\t\tthis.popupCount++;\n\t\t},\n\t\thandleKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (this.popupCount > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.key === 'Enter' && (event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tthis.$refs.addTaskButton.handleClick();\n\t\t\t}\n\t\t\telse if (event.key === 'Escape')\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t},\n\t\tdestroy(): void\n\t\t{\n\t\t\tthis.delete(this.taskId);\n\t\t\tfileService.delete(this.taskId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-drop class=\"tasks-compact-card-container\">\n\t\t\t<div v-if=\"task\" class=\"tasks-compact-card\" :data-task-id=\"taskId\" data-task-compact>\n\t\t\t\t<div class=\"tasks-compact-card-fields\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-compact-card-fields-title\"\n\t\t\t\t\t\t:class=\"{'--no-gap': task.description.length > 0}\"\n\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FieldTitle :taskId=\"taskId\" :disabled=\"titleDisabled\"/>\n\t\t\t\t\t\t<Importance :taskId=\"taskId\"/>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass=\"tasks-compact-card-fields-close\"\n\t\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\t\tdata-task-button-id=\"close\"\n\t\t\t\t\t\t\t@click=\"close\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DescriptionInline ref=\"description\" :taskId=\"taskId\"/>\n\t\t\t\t\t<div class=\"tasks-compact-card-fields-list\">\n\t\t\t\t\t\t<FieldList :fields=\"primaryFields\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CheckList\n\t\t\t\t\t\tv-if=\"isCheckListPopupShown\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:isAutonomous=\"true\"\n\t\t\t\t\t\t@show=\"handleShowingPopup\"\n\t\t\t\t\t\t@close=\"handleHidingPopup(); closeCheckListPopup();\"\n\t\t\t\t\t\t@resize=\"handleResizingPopup\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-compact-card-footer\">\n\t\t\t\t\t<div class=\"tasks-compact-card-chips\">\n\t\t\t\t\t\t<template v-for=\"(chip, index) of chips\" :key=\"index\">\n\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t:is=\"chip\"\n\t\t\t\t\t\t\t\tv-bind=\"{ taskId, isAutonomous: true }\"\n\t\t\t\t\t\t\t\tv-on=\"getEventListeners(chip, chipsEventHandlers)\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-compact-card-buttons\">\n\t\t\t\t\t\t<div class=\"tasks-compact-card-main-buttons\">\n\t\t\t\t\t\t\t<AddTaskButton\n\t\t\t\t\t\t\t\tref=\"addTaskButton\"\n\t\t\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t\t\tv-model:hasError=\"creationError\"\n\t\t\t\t\t\t\t\t@addTask=\"addTask\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_TCC_CANCEL_BTN')\"\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t\t\t\t:dataset=\"{\n\t\t\t\t\t\t\t\t\ttaskButtonId: 'cancel',\n\t\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t\t@click=\"close\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<FullCardButton v-model:isOpening=\"openingFullCard\" :taskId=\"taskId\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DropZone/>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { BaseEvent } from 'main.core.events';\n\nimport { BitrixVue, type VueCreateAppResult } from 'ui.vue3';\nimport { locMixin } from 'ui.vue3.mixins.loc-mixin';\n\nimport { TaskMappers } from 'tasks.v2.provider.service.task-service';\nimport { Core } from 'tasks.v2.core';\nimport { EventName } from 'tasks.v2.const';\nimport type { Params } from 'tasks.v2.application.task-card';\n\nimport { App } from './component/app';\n\nexport class TaskCompactCard extends EventEmitter\n{\n\t#params: Params;\n\t#application: ?VueCreateAppResult = null;\n\n\tconstructor(params: Params = {})\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('Tasks:TaskCompactCard');\n\n\t\tthis.#params = params;\n\n\t\tthis.#params.taskId = Type.isUndefined(this.#params.taskId) ? 0 : this.#params.taskId;\n\t}\n\n\tasync mountCard(container: HTMLElement): Promise<HTMLElement>\n\t{\n\t\tawait this.#mountApplication(container);\n\n\t\tthis.#adjustPosition();\n\t\tthis.#subscribe();\n\t}\n\n\tunmountCard(): void\n\t{\n\t\tthis.#unmountApplication();\n\n\t\tthis.#unsubscribe();\n\t}\n\n\tasync #mountApplication(container: HTMLElement): Promise<void>\n\t{\n\t\tawait Core.init();\n\n\t\tconst application = BitrixVue.createApp(App, this.#params);\n\n\t\tapplication.mixin(locMixin);\n\t\tapplication.use(Core.getStore());\n\t\tapplication.mount(container);\n\n\t\tthis.#application = application;\n\t}\n\n\t#unmountApplication(): void\n\t{\n\t\tthis.#application.unmount();\n\t}\n\n\t#subscribe(): void\n\t{\n\t\tEventEmitter.subscribe(`${EventName.CloseCard}:${this.#params.taskId}`, this.#closeCard);\n\t\tEventEmitter.subscribe(`${EventName.OpenFullCard}:${this.#params.taskId}`, this.#openFullCard);\n\t\tEventEmitter.subscribe(`${EventName.OpenSliderCard}:${this.#params.taskId}`, this.#openSliderCard);\n\t\tEventEmitter.subscribe(`${EventName.ShowOverlay}:${this.#params.taskId}`, this.#showOverlay);\n\t\tEventEmitter.subscribe(`${EventName.HideOverlay}:${this.#params.taskId}`, this.#hideOverlay);\n\t\tEventEmitter.subscribe(`${EventName.AdjustPosition}:${this.#params.taskId}`, this.#adjustPosition);\n\t}\n\n\t#unsubscribe(): void\n\t{\n\t\tEventEmitter.unsubscribe(`${EventName.CloseCard}:${this.#params.taskId}`, this.#closeCard);\n\t\tEventEmitter.unsubscribe(`${EventName.OpenFullCard}:${this.#params.taskId}`, this.#openFullCard);\n\t\tEventEmitter.unsubscribe(`${EventName.OpenSliderCard}:${this.#params.taskId}`, this.#openSliderCard);\n\t\tEventEmitter.unsubscribe(`${EventName.ShowOverlay}:${this.#params.taskId}`, this.#showOverlay);\n\t\tEventEmitter.unsubscribe(`${EventName.HideOverlay}:${this.#params.taskId}`, this.#hideOverlay);\n\t\tEventEmitter.unsubscribe(`${EventName.AdjustPosition}:${this.#params.taskId}`, this.#adjustPosition);\n\t}\n\n\t#closeCard = (): void => {\n\t\tthis.emit('closeCard');\n\t};\n\n\t#openFullCard = (baseEvent: BaseEvent): void => {\n\t\tthis.#params.taskId = baseEvent.getData();\n\n\t\tthis.emit('openFullCard', this.#params.taskId);\n\t};\n\n\t#openSliderCard = (baseEvent: BaseEvent): void => {\n\t\tconst task = baseEvent.getData().task;\n\t\tconst checkLists = baseEvent.getData().checkLists;\n\n\t\tconst data = TaskMappers.mapModelToSliderData(task, checkLists);\n\n\t\tconst path = Core.getParams().paths.editPath;\n\t\tBX.SidePanel.Instance.open(path, {\n\t\t\trequestMethod: 'post',\n\t\t\trequestParams: data,\n\t\t\tcacheable: false,\n\t\t});\n\n\t\tthis.#closeCard();\n\t};\n\n\t#showOverlay = (): void => {\n\t\tthis.emit('showOverlay');\n\t};\n\n\t#hideOverlay = (): void => {\n\t\tthis.emit('hideOverlay');\n\t};\n\n\t#adjustPosition = (baseEvent: BaseEvent = null): void => {\n\t\tthis.emit('adjustPosition', baseEvent?.getData() ?? {});\n\t};\n}\n"],"names":["FullCardButton","components","Hint","UiButton","inject","props","taskId","type","Number","String","required","isOpening","Boolean","emits","setup","AirButtonStyle","ButtonSize","fileService","get","data","isHintShown","hintBindElement","computed","task","$store","getters","Model","Tasks","checkLists","checklist","CheckList","isDisabled","isUploading","isCheckListUploading","some","itemId","EntityTypes","CheckListItem","methods","handleClick","highlightFiles","highlightChecklist","openFullCard","fieldHighlighter","setContainer","$root","$el","addChipHighlight","filesMeta","id","showHint","checkListMeta","removeHighlight","Event","unbind","window","bind","$emit","features","Core","getParams","analytics","sendOpenFullCard","isMiniformEnabled","isV2Enabled","EventEmitter","emit","EventName","OpenSliderCard","OpenFullCard","template","DropZone","BIcon","Main","App","name","FieldTitle","DescriptionInline","Importance","FieldList","AddTaskButton","mixins","DragOverMixin","provide","cardType","CardType","Compact","default","Text","getRandom","groupId","deadlineTs","Object","Outline","openingFullCard","isCheckListPopupShown","chipsEventHandlers","showCheckList","showCheckListPopup","creationError","popupCount","mapGetters","titleFieldOffsetHeight","Interface","currentUserId","defaultDeadline","hasDefaultDeadline","defaultDeadlineDate","defaultDeadlineTs","Date","getTime","group","Groups","isEdit","Type","isNumber","primaryFields","title","responsibleMeta","component","Responsible","context","$options","deadlineMeta","Deadline","chips","FilesChip","CheckListChip","isProjectsEnabled","GroupChip","titleDisabled","rights","edit","created","destroy","payload","creatorId","responsibleId","insert","sendOpenCard","collabId","GroupType","Collab","mounted","resizeObserver","ResizeObserver","entries","find","target","$refs","updateTitleFieldOffsetHeight","contentRect","height","observe","subscribeEvents","getAdapter","getUploader","assignDropzone","beforeUnmount","disconnect","unsubscribeEvents","unmounted","mapActions","close","CloseCard","addTask","error","taskService","add","Notifier","notify","text","message","sendAddTaskAnalytics","sendDescription","hasDescription","isStringFilled","description","hasScroll","length","checkListService","save","replace","baseEvent","BaseEvent","compatData","options","NotifyGrid","isSuccess","filter","parentId","checkListsItems","sendAddTaskWithCheckList","viewersCount","auditorsIds","checklistCount","checklistItemsCount","sendAddTask","coexecutorsCount","accomplicesIds","handleShowingPopup","event","ShowOverlay","externalPopup","popupInstance","adjustCardPopup","unassignDropzone","handleHidingPopup","HideOverlay","AdjustPosition","handleResizingPopup","animate","titleFieldHeight","innerPopup","closeCheckListPopup","getEventListeners","chip","handlers","listeners","keys","forEach","includes","subscribe","handlePopupShow","document","handleKeyDown","capture","unsubscribe","popup","getCompatData","onClose","key","ctrlKey","metaKey","addTaskButton","delete","TaskCompactCard","constructor","params","getData","TaskMappers","mapModelToSliderData","path","paths","editPath","BX","SidePanel","Instance","open","requestMethod","requestParams","cacheable","setEventNamespace","isUndefined","mountCard","container","unmountCard","init","application","BitrixVue","createApp","mixin","locMixin","use","getStore","mount","unmount"],"mappings":"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"}