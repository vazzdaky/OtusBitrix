{"version":3,"file":"notification.bundle.js","sources":["../src/layout/deadline-selector/deadline-picker.js","../src/layout/deadline-selector/moved-deadline-popup.js","../src/layout/deadline-selector/overdue-deadline-popup.js","../src/layout/deadline-selector/deadline-selector.js","../src/layout/skip-button-menu.js","../src/layout/footer.js","../src/layout/default-deadline-selector.js","../src/notification.js"],"sourcesContent":["import { Event, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { DatePicker } from 'ui.date-picker';\n\ntype DeadlinePickerOptions = {\n\tcalendar: BX.Tasks.Calendar,\n\tinput: HTMLInputElement,\n\tmatchWorkTime: boolean,\n\tevents: {\n\t\t[eventName: string]: (event: BaseEvent) => void,\n\t},\n}\n\nexport class DeadlinePicker extends EventEmitter\n{\n\t#EVENT_NAMESPACE: string = 'BX.Tasks.Deadline.Notification.Layout.DeadlinePicker';\n\n\t#calendar: BX.Tasks.Calendar;\n\t#datePicker: DatePicker;\n\t#input: HTMLInputElement;\n\t#matchWorkTime: boolean;\n\n\tconstructor(options: DeadlinePickerOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace(this.#EVENT_NAMESPACE);\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.#init(options);\n\t}\n\n\tgetSelectedDate(): Date | null\n\t{\n\t\treturn this.#datePicker.getSelectedDate();\n\t}\n\n\tgetToday(): Date\n\t{\n\t\treturn this.#datePicker.getToday();\n\t}\n\n\tformatDate(date: Date, format: string): string\n\t{\n\t\treturn this.#datePicker.formatDate(date, format);\n\t}\n\n\t#init(options: DeadlinePickerOptions): void\n\t{\n\t\tconst calendar = options.calendar;\n\t\tif (calendar instanceof BX.Tasks.Calendar)\n\t\t{\n\t\t\tthis.#calendar = calendar;\n\t\t}\n\t\tconst defaultTime = this.#getDefaultTime();\n\n\t\tconst input = options.input;\n\t\tif (input instanceof HTMLInputElement)\n\t\t{\n\t\t\tthis.#input = input;\n\t\t}\n\n\t\tconst matchWorkTime = options.matchWorkTime;\n\t\tthis.#matchWorkTime = Type.isBoolean(matchWorkTime) ? matchWorkTime : false;\n\n\t\tconst addZero = (unit: number) => `0${unit}`.slice(-2);\n\t\tconst pickerOptions = {\n\t\t\tdefaultTime: `${addZero(defaultTime.getHours())}:${addZero(defaultTime.getMinutes())}`,\n\t\t\ttargetNode: this.#input,\n\t\t\tenableTime: true,\n\t\t\tcutZeroTime: false,\n\t\t\tevents: {\n\t\t\t\tonSelect: this.#onSelect.bind(this),\n\t\t\t\tonHide: this.#onHide.bind(this),\n\t\t\t},\n\t\t};\n\n\t\tthis.#datePicker = new DatePicker({ ...options, ...pickerOptions });\n\t\tEvent.bind(this.#input, 'click', this.#datePicker.show.bind(this.#datePicker));\n\t}\n\n\t#getDefaultTime(): Date\n\t{\n\t\tconst now = new Date();\n\t\tconst workInterval = this.#calendar.getWorkIntervals(now).pop();\n\n\t\treturn new Date(workInterval.endDate.toLocaleString('en-US', { timeZone: 'UTC' }));\n\t}\n\n\t#onSelect(event: BaseEvent): void\n\t{\n\t\tconst { date } = event.getData();\n\n\t\tif (!this.#matchWorkTime)\n\t\t{\n\t\t\tthis.#setInputValue(date);\n\t\t\tthis.emit('onSelect');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst closestWorkDate = this.#calendar.getClosestWorkTime(date, true);\n\n\t\tif (date.getTime() !== closestWorkDate.getTime())\n\t\t{\n\t\t\tthis.#datePicker.selectDate(new Date(closestWorkDate.toLocaleString('en-US', { timeZone: 'UTC' })));\n\n\t\t\tthis.#datePicker.hide();\n\n\t\t\tthis.emit('onMoveDateToWorkTime');\n\t\t}\n\n\t\tthis.#setInputValue(closestWorkDate);\n\t\tthis.emit('onSelect');\n\t}\n\n\t#onHide(): void\n\t{\n\t\tconst date = this.getSelectedDate();\n\n\t\tconst now = this.getToday();\n\n\t\tif (Type.isDate(date) && date < now)\n\t\t{\n\t\t\tthis.emit('onLessCurrentDateSelect');\n\t\t}\n\t}\n\n\t#setInputValue(date: Date): void\n\t{\n\t\tconst dateFormat = this.#getDateFormatByDate(date);\n\n\t\tthis.#input.value = this.#datePicker.formatDate(date, dateFormat);\n\t}\n\n\t#getDateFormatByDate(date: Date): string\n\t{\n\t\tconst timeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\n\t\tconst now = new Date();\n\n\t\tlet dateFormat = DateTimeFormat.getFormat('DAY_OF_WEEK_MONTH_FORMAT');\n\t\tif (Type.isDate(date) && now.getFullYear() !== date.getFullYear())\n\t\t{\n\t\t\tdateFormat = DateTimeFormat.getFormat('FULL_DATE_FORMAT');\n\t\t}\n\n\t\treturn `${dateFormat}, ${timeFormat}`;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Popup, PopupOptions } from 'main.popup';\n\nexport class MovedDeadlinePopup extends Popup\n{\n\tconstructor(options: PopupOptions)\n\t{\n\t\tconst content = `\n\t\t\t<div class=\"tasks-deadline-notification-form__content_deadline-selector_moved-toolbar\">\n\t\t\t\t${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_MOVED_DEADLINE_TOOLTIP')}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst popupOptions = {\n\t\t\tid: 'deadline-notification-moved-deadline-popup',\n\t\t\toffsetLeft: 30,\n\t\t\toffsetTop: 5,\n\t\t\tangle: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: true,\n\t\t\tcontent,\n\t\t};\n\n\t\tsuper({ ...options, ...popupOptions });\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Popup, PopupOptions } from 'main.popup';\n\nexport class OverdueDeadlinePopup extends Popup\n{\n\tconstructor(options: PopupOptions)\n\t{\n\t\tconst content = `\n\t\t\t<div class=\"tasks-deadline-notification-form__content_deadline-selector_overdue-toolbar\">\n\t\t\t\t${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_OVERDUE_DEADLINE_TOOLTIP')}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst popupOptions = {\n\t\t\tid: 'deadline-notification-overdue-deadline-popup',\n\t\t\toffsetLeft: 30,\n\t\t\toffsetTop: 5,\n\t\t\tangle: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: true,\n\t\t\tcontent,\n\t\t};\n\n\t\tsuper({ ...options, ...popupOptions });\n\t}\n}\n","import { Tag, Extension, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DeadlinePicker } from './deadline-picker';\nimport { MovedDeadlinePopup } from './moved-deadline-popup';\nimport { OverdueDeadlinePopup } from './overdue-deadline-popup';\n\ntype DeadlineSelectorOptions = {\n\tmatchWorkTime: boolean,\n\tevents: {\n\t\t[eventName: string]: (event: BaseEvent) => void,\n\t},\n}\n\nconst DAYS_IN_WEEK = 7;\n\nexport class DeadlineSelector extends EventEmitter\n{\n\t#EVENT_NAMESPACE: string = 'BX.Tasks.Deadline.Notification.Layout.DeadlineSelector';\n\n\t#calendar: BX.Tasks.Calendar;\n\t#deadlinePicker: DeadlinePicker;\n\t#input: HTMLInputElement;\n\t#matchWorkTime: boolean;\n\n\t#movedDeadlinePopup: MovedDeadlinePopup;\n\t#overdueDeadlinePopup: OverdueDeadlinePopup;\n\n\tconstructor(options: DeadlineSelectorOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace(this.#EVENT_NAMESPACE);\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.#init(options);\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-deadline-notification-form__content_deadline-selector\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-datetime ui-ctl-w75\">\n\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-calendar\"></div>\n\t\t\t\t\t${this.#input}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetInputValue(): string\n\t{\n\t\treturn this.#input.value;\n\t}\n\n\tgetDeadline(): Date | null\n\t{\n\t\treturn this.#deadlinePicker.getSelectedDate();\n\t}\n\n\tgetToday(): Date\n\t{\n\t\treturn this.#deadlinePicker.getToday();\n\t}\n\n\tgetFormattedDeadline(format: string): string\n\t{\n\t\treturn this.#deadlinePicker.formatDate(this.getDeadline(), format);\n\t}\n\n\t#init(options: DeadlineSelectorOptions): void\n\t{\n\t\tthis.#input = Tag.render`\n\t\t\t<input class=\"ui-ctl-element\" data-id=\"tasks-deadline-notification-deadline\" readonly>\n\t\t`;\n\n\t\tconst portalSettings = this.#getPortalSettings();\n\n\t\tthis.#initCalendar(portalSettings);\n\t\tthis.#initMatchWorkTime(options, portalSettings);\n\n\t\tthis.#initDeadlinePicker(this.#input, this.#calendar, this.#matchWorkTime);\n\t}\n\n\t#initMatchWorkTime(options: DeadlineSelectorOptions, portalSettings: Object): void\n\t{\n\t\tthis.#matchWorkTime = options.matchWorkTime;\n\n\t\tconst weekends = portalSettings.WEEKEND;\n\t\tif (!Type.isArray(weekends))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst countOfWeekends = weekends.length;\n\n\t\tif (countOfWeekends === DAYS_IN_WEEK)\n\t\t{\n\t\t\tthis.#matchWorkTime = false;\n\t\t}\n\t}\n\n\t#initCalendar(portalSettings: Object): void\n\t{\n\t\tconst adaptedSettings = BX.Tasks.Calendar.adaptSettings(portalSettings);\n\n\t\tthis.#calendar = new BX.Tasks.Calendar(adaptedSettings);\n\t}\n\n\t#initDeadlinePicker(input: HTMLInputElement, calendar: BX.Tasks.Calendar, matchWorkTime: boolean): void\n\t{\n\t\tthis.#deadlinePicker = new DeadlinePicker({\n\t\t\tevents: {\n\t\t\t\tonMoveDateToWorkTime: this.#onMoveDateToWorkTime.bind(this),\n\t\t\t\tonLessCurrentDateSelect: this.#onLessCurrentDateSelect.bind(this),\n\t\t\t\tonSelect: () => this.emit('onSelect'),\n\t\t\t},\n\t\t\tinput,\n\t\t\tcalendar,\n\t\t\tmatchWorkTime,\n\t\t});\n\t}\n\n\t#onMoveDateToWorkTime(): void\n\t{\n\t\tconst overdueDeadlinePopup = this.#getOverdueDeadlinePopup();\n\t\tif (overdueDeadlinePopup.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst movedDeadlinePopup = this.#getMovedDeadlinePopup();\n\t\tmovedDeadlinePopup.show();\n\t}\n\n\t#onLessCurrentDateSelect(): void\n\t{\n\t\tconst overdueDeadlinePopup = this.#getOverdueDeadlinePopup();\n\t\toverdueDeadlinePopup.show();\n\t}\n\n\t#getOverdueDeadlinePopup(): OverdueDeadlinePopup\n\t{\n\t\tif (!this.#overdueDeadlinePopup)\n\t\t{\n\t\t\tthis.#overdueDeadlinePopup = new OverdueDeadlinePopup({\n\t\t\t\tbindElement: this.#input,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#overdueDeadlinePopup;\n\t}\n\n\t#getMovedDeadlinePopup(): MovedDeadlinePopup\n\t{\n\t\tif (!this.#movedDeadlinePopup)\n\t\t{\n\t\t\tthis.#movedDeadlinePopup = new MovedDeadlinePopup({\n\t\t\t\tbindElement: this.#input,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#movedDeadlinePopup;\n\t}\n\n\t#getPortalSettings(): Object\n\t{\n\t\tconst settings = Extension.getSettings('tasks.deadline.notification');\n\n\t\treturn settings.get('portalSettings');\n\t}\n}\n","import { Loc, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuItem } from 'main.popup';\nimport { Button } from 'ui.buttons';\n\ntype SkipButtonMenuOptions = {\n\tevents: {\n\t\t[eventName: string]: (event: BaseEvent) => void,\n\t},\n}\n\nexport class SkipButtonMenu extends EventEmitter\n{\n\t#EVENT_NAMESPACE: string = 'BX.Tasks.Deadline.Notification.Layout.SkipButtonMenu';\n\t#ACCEPTED_ITEM_CLASS: string = 'menu-popup-item-accept';\n\t#ITEMS_CLASSES: string = 'menu-popup-icon menu-popup-item-none';\n\n\t#button: Button;\n\t#items: Array;\n\t#period: string;\n\n\tconstructor(options: SkipButtonMenuOptions = {})\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace(this.#EVENT_NAMESPACE);\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.#init();\n\t}\n\n\tgetMenu(): Object\n\t{\n\t\treturn {\n\t\t\tcloseByEsc: true,\n\t\t\titems: this.#items,\n\t\t\tminWidth: 180,\n\t\t};\n\t}\n\n\tgetPeriod(): string\n\t{\n\t\treturn this.#period;\n\t}\n\n\tsetButton(button: Button): void\n\t{\n\t\tthis.#button = button;\n\t}\n\n\t#onMenuItemClick(period: string, text: string): void\n\t{\n\t\tconst buttonMenu = this.#button?.getMenuWindow();\n\t\tif (!buttonMenu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#period === period)\n\t\t{\n\t\t\tthis.#period = '';\n\t\t\tthis.#refreshMenuItemsIcons(buttonMenu.getMenuItems(), this.#period);\n\n\t\t\tconst event = new BaseEvent({\n\t\t\t\tdata: { buttonMenu },\n\t\t\t});\n\t\t\tthis.emit('onMenuItemDeselect', event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#period = period;\n\t\tthis.#refreshMenuItemsIcons(buttonMenu.getMenuItems(), this.#period);\n\n\t\tconst event = new BaseEvent({\n\t\t\tdata: { buttonMenu, text },\n\t\t});\n\t\tthis.emit('onMenuItemSelect', event);\n\t}\n\n\t#refreshMenuItemsIcons(items: MenuItem[], period: string): void\n\t{\n\t\titems.forEach((item: MenuItem): void => {\n\t\t\tconst node = item.getLayout().item;\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (item.getId() === period)\n\t\t\t{\n\t\t\t\tDom.addClass(node, this.#ACCEPTED_ITEM_CLASS);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.removeClass(node, this.#ACCEPTED_ITEM_CLASS);\n\t\t});\n\t}\n\n\t#init(): void\n\t{\n\t\tthis.#items = [\n\t\t\t{\n\t\t\t\tdataset: { id: 'tasks-deadline-notification-skip-day' },\n\t\t\t\tid: 'day',\n\t\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_DAY'),\n\t\t\t\tclassName: this.#ITEMS_CLASSES,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdataset: { id: 'tasks-deadline-notification-skip-week' },\n\t\t\t\tid: 'week',\n\t\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_WEEK'),\n\t\t\t\tclassName: this.#ITEMS_CLASSES,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdataset: { id: 'tasks-deadline-notification-skip-month' },\n\t\t\t\tid: 'month',\n\t\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_MONTH'),\n\t\t\t\tclassName: this.#ITEMS_CLASSES,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdataset: { id: 'tasks-deadline-notification-skip-forever' },\n\t\t\t\tid: 'forever',\n\t\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_FOREVER'),\n\t\t\t\tclassName: this.#ITEMS_CLASSES,\n\t\t\t},\n\t\t];\n\n\t\tthis.#items.forEach((item: Object): void => {\n\t\t\titem.onclick = this.#onMenuItemClick.bind(this, item.id, item.text);\n\t\t});\n\t}\n}\n","import { Loc, Tag } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Button, ButtonColor, ButtonSize, ButtonState } from 'ui.buttons';\nimport { SkipButtonMenu } from './skip-button-menu';\n\ntype FooterOptions = {\n\tevents: {\n\t\t[eventName: string]: (event: BaseEvent) => void,\n\t},\n}\n\nexport class Footer extends EventEmitter\n{\n\t#EVENT_NAMESPACE: string = 'BX.Tasks.Deadline.Notification.Layout.Footer';\n\n\t#submitButton: Button;\n\t#cancelButton: Button;\n\t#skipButton: Button;\n\t#skipButtonMenu: SkipButtonMenu;\n\n\tconstructor(options: FooterOptions = {})\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace(this.#EVENT_NAMESPACE);\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.#init();\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-deadline-notification-form__footer\">\n\t\t\t\t<div class=\"tasks-deadline-notification-form__footer_buttons-container\">\n\t\t\t\t\t${this.#submitButton.render()}\n\t\t\t\t\t${this.#cancelButton.render()}\n\t\t\t\t</div>\n\t\t\t\t${this.#skipButton.render()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetSkipPeriod(): string\n\t{\n\t\treturn this.#skipButtonMenu.getPeriod();\n\t}\n\n\tupdateSkipButtonText(text: string): void\n\t{\n\t\tconst defaultText = Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_SKIP_BUTTON');\n\n\t\tconst skipButtonText = (text === '') ? defaultText : `${defaultText}, ${text}`;\n\t\tthis.#skipButton.setText(skipButtonText);\n\t}\n\n\tenableButtons(): void\n\t{\n\t\tthis.enableSubmitButton();\n\t\tthis.enableCancelButton();\n\t\tthis.enableSkipButton();\n\t}\n\n\tdisableButtons(): void\n\t{\n\t\tthis.disableSubmitButton();\n\t\tthis.disableCancelButton();\n\t\tthis.disableSkipButton();\n\t}\n\n\tenableSubmitButton(): void\n\t{\n\t\tthis.#submitButton.setDisabled(false);\n\t\tthis.#submitButton.setColor(ButtonColor.PRIMARY);\n\t}\n\n\tdisableSubmitButton(): void\n\t{\n\t\tthis.#submitButton.setDisabled();\n\t\tthis.#submitButton.setColor();\n\t}\n\n\tenableCancelButton(): void\n\t{\n\t\tthis.#cancelButton.setDisabled(false);\n\t}\n\n\tdisableCancelButton(): void\n\t{\n\t\tthis.#cancelButton.setDisabled();\n\t}\n\n\tenableSkipButton(): void\n\t{\n\t\tthis.#skipButton.setDisabled(false);\n\t}\n\n\tdisableSkipButton(): void\n\t{\n\t\tthis.#skipButton.setDisabled();\n\t}\n\n\t#init(): void\n\t{\n\t\tthis.#submitButton = new Button({\n\t\t\tdataset: { id: 'tasks-deadline-notification-submit' },\n\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_SAVE_BUTTON'),\n\t\t\tsize: ButtonSize.SMALL,\n\t\t\tstate: ButtonState.DISABLED,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tonclick: this.#onSubmitButtonClick.bind(this),\n\t\t});\n\n\t\tthis.#cancelButton = new Button({\n\t\t\tdataset: { id: 'tasks-deadline-notification-cancel' },\n\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_CANCEL_BUTTON_MSGVER_1'),\n\t\t\tcolor: ButtonColor.LINK,\n\t\t\tsize: ButtonSize.SMALL,\n\t\t\tstate: ButtonState.ACTIVE,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tonclick: this.#onCancelButtonClick.bind(this),\n\t\t});\n\n\t\tthis.#skipButtonMenu = new SkipButtonMenu({\n\t\t\tevents: {\n\t\t\t\tonMenuItemSelect: this.#onSkipMenuItemSelect.bind(this),\n\t\t\t\tonMenuItemDeselect: this.#onSkipMenuItemDeselect.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#skipButton = new Button({\n\t\t\tdataset: { id: 'tasks-deadline-notification-skip' },\n\t\t\ttext: Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_SKIP_BUTTON'),\n\t\t\tclassName: 'tasks-deadline-notification-form__footer_skip-button',\n\t\t\tcolor: ButtonColor.LINK,\n\t\t\tnoCaps: true,\n\t\t\tdropdown: true,\n\t\t\tmenu: this.#skipButtonMenu.getMenu(),\n\t\t});\n\n\t\tthis.#skipButtonMenu.setButton(this.#skipButton);\n\t}\n\n\t#onSubmitButtonClick(): void\n\t{\n\t\tif (this.#submitButton.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('onSubmitButtonClick');\n\t}\n\n\t#onCancelButtonClick(): void\n\t{\n\t\tif (this.#cancelButton.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('onCancelButtonClick');\n\t}\n\n\t#onSkipMenuItemSelect(event: BaseEvent): void\n\t{\n\t\tconst { buttonMenu, text } = event.getData();\n\n\t\tbuttonMenu.close();\n\t\tthis.updateSkipButtonText(text.toLowerCase());\n\n\t\tthis.emit('onSkipMenuItemSelect', event);\n\t}\n\n\t#onSkipMenuItemDeselect(event: BaseEvent): void\n\t{\n\t\tconst { buttonMenu } = event.getData();\n\n\t\tbuttonMenu.close();\n\t\tthis.updateSkipButtonText('');\n\n\t\tthis.emit('onSkipMenuItemDeselect', event);\n\t}\n}\n","import { Tag, Event } from 'main.core';\nimport { IntervalSelector } from 'tasks.interval-selector';\n\nfunction removeNonNumeric(value: string): string\n{\n\treturn value.replaceAll(/\\D/g, '');\n}\n\nfunction clamp(value: number, min: number, max: number): number\n{\n\tlet clampedValue = Math.max(value, min);\n\tclampedValue = Math.min(clampedValue, max);\n\n\treturn clampedValue;\n}\n\nconst MAX_INT = (2 ** 32) / 2 - 1;\nconst SECONDS_IN_MONTH = 60 * 60 * 24 * 31;\n\nexport class DefaultDeadlineSelector\n{\n\t#intervalSelector: IntervalSelector;\n\t#input: HTMLInputElement;\n\n\tconstructor()\n\t{\n\t\tthis.#input = Tag.render`\n\t\t\t<input class=\"ui-ctl-element\" placeholder=\"0\" data-id=\"tasks-deadline-notification-default-deadline\">\n\t\t`;\n\t\tEvent.bind(this.#input, 'input', this.#onInput.bind(this));\n\n\t\tthis.#intervalSelector = new IntervalSelector({\n\t\t\tshowDropdownIcon: true,\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div hidden>\n\t\t\t\t<div class=\"tasks-deadline-notification-form__content_default-deadline-container\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w25\">\n\t\t\t\t\t\t${this.#input}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-deadline-notification-form__content_default-deadline-container_interval-selector\"\n\t\t\t\t\t\tdata-id=\"tasks-deadline-notification-interval-selector\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${this.#intervalSelector.render()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisExactDeadlineTime(): boolean\n\t{\n\t\treturn ['minutes', 'hours'].includes(this.#intervalSelector.getInterval());\n\t}\n\n\tgetDeadlineInSeconds(): number\n\t{\n\t\treturn Number(this.#input.value) * this.#intervalSelector.getDuration();\n\t}\n\n\tfocus(): void\n\t{\n\t\tthis.#input.focus();\n\t}\n\n\tclear(): void\n\t{\n\t\tthis.#input.value = '';\n\t}\n\n\tselect(deadline: number): void\n\t{\n\t\tthis.#input.value = deadline;\n\t}\n\n\t#onInput(): void\n\t{\n\t\tlet normalizedValue = removeNonNumeric(this.#input.value);\n\t\tnormalizedValue = parseInt(normalizedValue, 10);\n\n\t\tconst minValue = 1;\n\t\tconst maxValue = Math.floor(MAX_INT / SECONDS_IN_MONTH);\n\n\t\tnormalizedValue = clamp(normalizedValue, minValue, maxValue);\n\n\t\tthis.#input.value = normalizedValue || '';\n\t}\n}\n","import { Event, Loc, Tag, Type, ajax as Ajax, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { Popup } from 'main.popup';\nimport { Checker } from 'ui.form-elements.view';\nimport { DateRounder } from 'tasks.date-rounder';\nimport { DeadlineSelector } from './layout/deadline-selector/deadline-selector';\nimport { Footer } from './layout/footer';\nimport { DefaultDeadlineSelector } from './layout/default-deadline-selector';\nimport './style.css';\n\ntype NotificationOptions = {\n\ttargetForm: HTMLFormElement;\n\ttargetInput: HTMLInputElement;\n\ttargetButton: ?HTMLButtonElement;\n\tmatchWorkTime: boolean;\n}\n\nexport class Notification extends EventEmitter\n{\n\t#EVENT_NAMESPACE: string = 'BX.Tasks.Deadline.Notification';\n\n\t#popup: Popup;\n\n\t#targetForm: HTMLFormElement;\n\t#targetInput: HTMLInputElement;\n\t#targetButton: ?HTMLButtonElement;\n\t#matchWorkTime: boolean;\n\n\t#layout: {\n\t\terrorContainer: HTMLDivElement,\n\t\tdeadlineSelector: DeadlineSelector,\n\t\tdefaultDeadlineChecker: Checker,\n\t\tdefaultDeadlineSelector: DefaultDeadlineSelector,\n\t\tfooter: Footer,\n\t};\n\n\tconstructor(options: NotificationOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace(this.#EVENT_NAMESPACE);\n\n\t\tthis.#init(options);\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#popup.show();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup.close();\n\t}\n\n\t#getPopupContent(): HTMLElement\n\t{\n\t\tconst form = Tag.render`\n\t\t\t<form class=\"tasks-deadline__notification-form\">\n\t\t\t\t${this.#getTitleContainer()}\n\t\t\t\t${this.#getErrorsContainer()}\n\t\t\t\t${this.#getDeadlineContainer()}\n\t\t\t\t${this.#layout.footer.render()}\n\t\t\t</form>\n\t\t`;\n\n\t\tEvent.bind(form, 'submit', (e): void => {\n\t\t\te.preventDefault();\n\t\t});\n\n\t\treturn form;\n\t}\n\n\t#getTitleContainer(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-deadline-notification-form__title\">\n\t\t\t\t<div class=\"tasks-deadline-notification-form__title_icon\"></div>\n\t\t\t\t<div class=\"tasks-deadline-notification-form__title_text\">\n\t\t\t\t\t${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_TITLE')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-deadline-notification-form__subtitle\">\n\t\t\t\t${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_DESCRIPTION')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getErrorsContainer(): HTMLDivElement\n\t{\n\t\tthis.#layout.errorContainer = Tag.render`\n\t\t\t<div class=\"tasks-deadline-notification-form__errors\" hidden>\n\t\t\t\t<div class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t<span class=\"ui-alert-message\">${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_ERROR_MESSAGE')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.errorContainer;\n\t}\n\n\t#getDeadlineContainer(): HTMLElement\n\t{\n\t\tthis.#layout.defaultDeadlineChecker = new Checker({\n\t\t\tid: 'tasks-deadline-notification-default-deadline-checker',\n\t\t\tinputName: 'defaultDeadlineChecker',\n\t\t\tchecked: false,\n\t\t\ttitle: this.#getDefaultDeadlineCheckerTitle(),\n\t\t\thideSeparator: true,\n\t\t\tsize: 'extra-small',\n\t\t});\n\n\t\tconst defaultDeadlineContainer = this.#layout.defaultDeadlineSelector.render();\n\t\tEventEmitter.subscribe(\n\t\t\tthis.#layout.defaultDeadlineChecker,\n\t\t\t'change',\n\t\t\tthis.#onDefaultDeadlineCheckerChange.bind(this, defaultDeadlineContainer),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-deadline-notification-form__content\">\n\t\t\t\t<div class=\"tasks-deadline-notification-form__content_title\">\n\t\t\t\t\t${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_DEADLINE_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t${this.#layout.deadlineSelector.render()}\n\t\t\t\t<div class=\"tasks-deadline-notification-form__content_default-deadline-checker\">\n\t\t\t\t\t${this.#layout.defaultDeadlineChecker.render()}\n\t\t\t\t</div>\n\t\t\t\t${defaultDeadlineContainer}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getDefaultDeadlineCheckerTitle(): string\n\t{\n\t\treturn `\n\t\t\t<div>\n\t\t\t\t${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_DEFAULT_DEADLINE_CHECKER')}\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tdata-id=\"defaultDeadlineHint\"\n\t\t\t\tclass=\"ui-hint\"\n\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_DEADLINE_NOTIFICATION_DEFAULT_DEADLINE_HINT')}\"\n\t\t\t\tdata-hint-no-icon\n\t\t\t>\n\t\t\t\t<span class=\"ui-hint-icon\">\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#saveTargetButtonStateInForm(): void\n\t{\n\t\tif (!this.#targetButton || !this.#targetButton.name || !this.#targetButton.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetButtonInput = Tag.render`\n\t\t\t<input name=\"${this.#targetButton.name}\" value=\"${this.#targetButton.value}\" hidden>\n\t\t`;\n\n\t\tDom.append(targetButtonInput, this.#targetForm);\n\t}\n\n\t#onSubmitButtonClick(): void\n\t{\n\t\tthis.#layout.footer.disableButtons();\n\n\t\tconst defaultDeadline = this.#layout.defaultDeadlineSelector.getDeadlineInSeconds();\n\t\tconst isExactDeadlineTime = this.#layout.defaultDeadlineSelector.isExactDeadlineTime();\n\t\tconst skipPeriod = this.#layout.footer.getSkipPeriod();\n\n\t\tthis.#setDefaultDeadline(defaultDeadline, isExactDeadlineTime)\n\t\t\t.then((): Promise => {\n\t\t\t\treturn this.#setSkipNotificationPeriod(skipPeriod);\n\t\t\t})\n\t\t\t.then((): void => {\n\t\t\t\tthis.#setTargetInputValue();\n\t\t\t\tthis.#submit();\n\t\t\t})\n\t\t\t.catch((): void => this.#onPromiseError())\n\t\t;\n\t}\n\n\t#onCancelButtonClick(): void\n\t{\n\t\tthis.#layout.footer.disableButtons();\n\t\tthis.#submit();\n\t}\n\n\t#onSkipMenuItemSelect(): void\n\t{\n\t\tif (this.#layout.deadlineSelector.getInputValue())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#layout.footer.disableButtons();\n\t\tconst skipPeriod = this.#layout.footer.getSkipPeriod();\n\n\t\tthis.#setSkipNotificationPeriod(skipPeriod)\n\t\t\t.then((): void => {\n\t\t\t\tthis.#submit();\n\t\t\t})\n\t\t\t.catch((): void => this.#onPromiseError())\n\t\t;\n\t}\n\n\t#onDefaultDeadlineCheckerChange(defaultDeadlineContainer: HTMLElement, event: BaseEvent): void\n\t{\n\t\tconst checked = event.getData();\n\n\t\tif (!checked)\n\t\t{\n\t\t\tDom.hide(defaultDeadlineContainer);\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.show(defaultDeadlineContainer);\n\n\t\tif (!this.#layout.deadlineSelector.getInputValue())\n\t\t{\n\t\t\tthis.#layout.defaultDeadlineSelector.clear();\n\t\t\tthis.#layout.defaultDeadlineSelector.focus();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst now = this.#layout.deadlineSelector.getToday();\n\t\tconst selectedDeadline = this.#layout.deadlineSelector.getDeadline();\n\n\t\tconst offsetInSeconds = (selectedDeadline - now) / 1000;\n\n\t\tconst defaultDeadline = DateRounder.roundToDays(offsetInSeconds);\n\t\tif (defaultDeadline <= 0)\n\t\t{\n\t\t\tthis.#layout.defaultDeadlineSelector.clear();\n\t\t\tthis.#layout.defaultDeadlineSelector.focus();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#layout.defaultDeadlineSelector.select(defaultDeadline);\n\t}\n\n\t#onDeadlineSelect(): void\n\t{\n\t\tconst selectedDate = this.#layout.deadlineSelector.getDeadline();\n\t\tif (selectedDate === null)\n\t\t{\n\t\t\tthis.#layout.footer.disableSubmitButton();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#layout.footer.enableSubmitButton();\n\t}\n\n\t#onPopupFirstShow(event: BaseEvent): void\n\t{\n\t\tBX.UI.Hint.init(event.getTarget().contentContainer);\n\t}\n\n\t#onPromiseError(): void\n\t{\n\t\tthis.#layout.footer.enableCancelButton();\n\t\tthis.#layout.footer.enableSkipButton();\n\n\t\tconst selectedDate = this.#layout.deadlineSelector.getDeadline();\n\t\tif (!Type.isNull(selectedDate))\n\t\t{\n\t\t\tthis.#layout.footer.enableSubmitButton();\n\t\t}\n\n\t\tDom.show(this.#layout.errorContainer);\n\t}\n\n\t#setDefaultDeadline(deadline: number, isExactDeadlineTime: boolean): Promise\n\t{\n\t\tif (!this.#layout.defaultDeadlineChecker.isChecked())\n\t\t{\n\t\t\treturn new Promise((resolve): void => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst deadlineData = {\n\t\t\tdefault: deadline,\n\t\t\tisExactTime: isExactDeadlineTime ? 'Y' : 'N',\n\t\t};\n\n\t\treturn Ajax.runAction('tasks.deadline.Deadline.setDefault', {\n\t\t\tdata: {\n\t\t\t\tdeadlineData,\n\t\t\t},\n\t\t});\n\t}\n\n\t#setSkipNotificationPeriod(skipPeriod: string): Promise\n\t{\n\t\tif (!this.#layout.footer.getSkipPeriod())\n\t\t{\n\t\t\treturn new Promise((resolve): void => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tconst notificationData = {\n\t\t\tskipPeriod,\n\t\t};\n\n\t\treturn Ajax.runAction('tasks.deadline.Notification.skip', {\n\t\t\tdata: {\n\t\t\t\tnotificationData,\n\t\t\t},\n\t\t});\n\t}\n\n\t#submit(): void\n\t{\n\t\tthis.close();\n\n\t\tthis.#saveTargetButtonStateInForm();\n\n\t\tthis.emit('onBeforeSubmit');\n\n\t\tthis.#targetForm.submit();\n\t}\n\n\t#setTargetInputValue(): void\n\t{\n\t\tconst dateFormat = DateTimeFormat.getFormat('FORMAT_DATETIME');\n\n\t\tthis.#targetInput.value = this.#layout.deadlineSelector.getFormattedDeadline(dateFormat);\n\t}\n\n\t#init(options: NotificationOptions): void\n\t{\n\t\tthis.#targetForm = options.targetForm;\n\t\tthis.#targetInput = options.targetInput;\n\t\tthis.#targetButton = options.targetButton;\n\t\tthis.#matchWorkTime = options.matchWorkTime;\n\n\t\tthis.#layout = {};\n\n\t\tthis.#layout.deadlineSelector = new DeadlineSelector({\n\t\t\tmatchWorkTime: this.#matchWorkTime,\n\t\t\tevents: {\n\t\t\t\tonSelect: this.#onDeadlineSelect.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#layout.defaultDeadlineSelector = new DefaultDeadlineSelector();\n\n\t\tthis.#layout.footer = new Footer({\n\t\t\tevents: {\n\t\t\t\tonSubmitButtonClick: this.#onSubmitButtonClick.bind(this),\n\t\t\t\tonCancelButtonClick: this.#onCancelButtonClick.bind(this),\n\t\t\t\tonSkipMenuItemSelect: this.#onSkipMenuItemSelect.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#popup = new Popup({\n\t\t\tid: 'deadline-notification',\n\t\t\tcontent: this.#getPopupContent(),\n\t\t\tclassName: 'tasks__deadline-notification-popup',\n\t\t\toverlay: {\n\t\t\t\topacity: 40,\n\t\t\t},\n\t\t\twidth: 600,\n\t\t\tautoHide: false,\n\t\t\tcloseIcon: false,\n\t\t\tevents: {\n\t\t\t\tonFirstShow: this.#onPopupFirstShow.bind(this),\n\t\t\t},\n\t\t});\n\t}\n}\n"],"names":["DeadlinePicker","EventEmitter","constructor","options","setEventNamespace","subscribeFromOptions","events","getSelectedDate","getToday","formatDate","date","format","calendar","BX","Tasks","Calendar","defaultTime","input","HTMLInputElement","matchWorkTime","Type","isBoolean","addZero","unit","slice","pickerOptions","getHours","getMinutes","targetNode","enableTime","cutZeroTime","onSelect","bind","onHide","DatePicker","Event","show","now","Date","workInterval","getWorkIntervals","pop","endDate","toLocaleString","timeZone","event","getData","emit","closestWorkDate","getClosestWorkTime","getTime","selectDate","hide","isDate","dateFormat","value","timeFormat","DateTimeFormat","getFormat","getFullYear","MovedDeadlinePopup","Popup","content","Loc","getMessage","popupOptions","id","offsetLeft","offsetTop","angle","autoHide","closeByEsc","closeIcon","OverdueDeadlinePopup","DAYS_IN_WEEK","DeadlineSelector","render","Tag","getInputValue","getDeadline","getFormattedDeadline","portalSettings","weekends","WEEKEND","isArray","countOfWeekends","length","adaptedSettings","adaptSettings","onMoveDateToWorkTime","onLessCurrentDateSelect","overdueDeadlinePopup","isShown","movedDeadlinePopup","bindElement","settings","Extension","getSettings","get","SkipButtonMenu","getMenu","items","minWidth","getPeriod","setButton","button","period","text","buttonMenu","getMenuWindow","getMenuItems","BaseEvent","data","forEach","item","node","getLayout","getId","Dom","addClass","removeClass","dataset","className","onclick","Footer","getSkipPeriod","updateSkipButtonText","defaultText","skipButtonText","setText","enableButtons","enableSubmitButton","enableCancelButton","enableSkipButton","disableButtons","disableSubmitButton","disableCancelButton","disableSkipButton","setDisabled","setColor","ButtonColor","PRIMARY","Button","size","ButtonSize","SMALL","state","ButtonState","DISABLED","noCaps","round","color","LINK","ACTIVE","onMenuItemSelect","onMenuItemDeselect","dropdown","menu","isDisabled","close","toLowerCase","removeNonNumeric","replaceAll","clamp","min","max","clampedValue","Math","MAX_INT","SECONDS_IN_MONTH","DefaultDeadlineSelector","IntervalSelector","showDropdownIcon","isExactDeadlineTime","includes","getInterval","getDeadlineInSeconds","Number","getDuration","focus","clear","select","deadline","normalizedValue","parseInt","minValue","maxValue","floor","Notification","form","footer","e","preventDefault","errorContainer","defaultDeadlineChecker","Checker","inputName","checked","title","hideSeparator","defaultDeadlineContainer","defaultDeadlineSelector","subscribe","deadlineSelector","name","targetButtonInput","append","defaultDeadline","skipPeriod","then","catch","selectedDeadline","offsetInSeconds","DateRounder","roundToDays","selectedDate","UI","Hint","init","getTarget","contentContainer","isNull","isChecked","Promise","resolve","deadlineData","default","isExactTime","Ajax","runAction","notificationData","submit","targetForm","targetInput","targetButton","onSubmitButtonClick","onCancelButtonClick","onSkipMenuItemSelect","overlay","opacity","width","onFirstShow"],"mappings":"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"}