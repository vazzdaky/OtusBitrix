{"version":3,"file":"script.js","sources":["src/counters-helper.js","src/entry.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nclass Filter\n{\n\tconstructor(options)\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\n\t\tthis.bindEvents();\n\t\tthis.updateFields();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.updateFields();\n\t}\n\n\tupdateFields()\n\t{\n\t\tthis.fields = this.filterManager.getFilterFieldsValues();\n\t}\n\n\tisFilteredByField(field)\n\t{\n\t\tif (!Object.keys(this.fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(this.fields[field]))\n\t\t{\n\t\t\treturn this.fields[field].length > 0;\n\t\t}\n\n\t\treturn this.fields[field] !== '';\n\t}\n\n\tisFilteredByFieldValue(field, value)\n\t{\n\t\treturn this.isFilteredByField(field) && this.fields[field] === value;\n\t}\n\n\ttoggleByField(field)\n\t{\n\t\tconst name = field.filterField;\n\t\tconst value = field.filterValue;\n\n\t\tif (!this.isFilteredByFieldValue(name, value))\n\t\t{\n\t\t\tthis.filterManager.getApi().extendFilter(\n\t\t\t\t{[name]: value},\n\t\t\t\tfalse,\n\t\t\t\t{COUNTER_TYPE: 'TASKS_COUNTER_TYPE_' + value}\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.filterManager.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tthis.filterManager.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tthis.filterManager.getSearch().apply();\n\t}\n\n\tgetFilter()\n\t{\n\t\treturn this.filterManager;\n\t}\n}\n\nexport {\n\tFilter\n}\n","import { Loc, Runtime, Event, ajax as Ajax } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { CounterItem, CounterPanel } from 'ui.counterpanel';\nimport { Filter } from './counters-helper';\nimport { Controller as Viewed } from 'tasks.viewed';\n\nexport class Counters extends CounterPanel\n{\n\tstatic READ_ALL_ID = 'read_all';\n\tstatic COLOR_GRAY = 'GRAY';\n\tstatic COLOR_THEME = 'THEME';\n\tstatic COLOR_SUCCESS = 'SUCCESS';\n\n\tstatic get counterTypes()\n\t{\n\t\treturn {\n\t\t\tmy: [\n\t\t\t\t'expired',\n\t\t\t\t'my_expired',\n\t\t\t\t'originator_expired',\n\t\t\t\t'accomplices_expired',\n\t\t\t\t'auditor_expired',\n\t\t\t\t'new_comments',\n\t\t\t\t'my_new_comments',\n\t\t\t\t'originator_new_comments',\n\t\t\t\t'accomplices_new_comments',\n\t\t\t\t'auditor_new_comments',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'flow_total_expired',\n\t\t\t\t'flow_total_comments',\n\t\t\t],\n\t\t\tother: [\n\t\t\t\t'project_expired',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t],\n\t\t\tadditional: [\n\t\t\t\t'muted_new_comments',\n\t\t\t],\n\t\t\texpired: [\n\t\t\t\t'expired',\n\t\t\t\t'my_expired',\n\t\t\t\t'originator_expired',\n\t\t\t\t'accomplices_expired',\n\t\t\t\t'auditor_expired',\n\t\t\t\t'project_expired',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'flow_total_expired',\n\t\t\t],\n\t\t\tcomment: [\n\t\t\t\t'new_comments',\n\t\t\t\t'my_new_comments',\n\t\t\t\t'originator_new_comments',\n\t\t\t\t'accomplices_new_comments',\n\t\t\t\t'auditor_new_comments',\n\t\t\t\t'muted_new_comments',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t\t'flow_total_comments',\n\t\t\t],\n\t\t\tproject: [\n\t\t\t\t'project_expired',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t],\n\t\t\tscrum: [\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t],\n\t\t};\n\t}\n\n\tstatic updateTimeout = false;\n\tstatic needUpdate = false;\n\n\tstatic timeoutTTL = 5000;\n\t#filterId: string;\n\n\tconstructor(options)\n\t{\n\t\tsuper({\n\t\t\ttarget: options.renderTo,\n\t\t\titems: [],\n\t\t\tmultiselect: true,\n\t\t\ttitle: Loc.getMessage('TASKS_COUNTER_MY'),\n\t\t});\n\n\t\tthis.userId = options.userId;\n\t\tthis.targetUserId = options.targetUserId;\n\t\tthis.groupId = options.groupId;\n\t\tthis.counters = options.counters;\n\t\tthis.initialCounterTypes = options.counterTypes;\n\t\tthis.role = options.role;\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.#filterId = options.filterId;\n\n\t\tthis.setData(this.counters);\n\t\tthis.initPull();\n\n\t\tthis.elements = this.getCounterItems(this.counters);\n\t\tthis.setItems(this.elements);\n\t}\n\n\tisMyTaskList()\n\t{\n\t\treturn this.userId === this.targetUserId;\n\t}\n\n\tisUserTaskList()\n\t{\n\t\treturn (Object.keys(this.otherCounters).length === 0);\n\t}\n\n\tisProjectsTaskList()\n\t{\n\t\treturn this.groupId > 0;\n\t}\n\n\tisProjectList()\n\t{\n\t\treturn !this.isUserTaskList() && !this.isProjectsTaskList();\n\t}\n\n\tinitPull()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'tasks',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tthis.extendWatch();\n\t}\n\n\textendWatch()\n\t{\n\t\tif (this.isProjectsTaskList() || this.isProjectList())\n\t\t{\n\t\t\tlet tagId = 'TASKS_PROJECTS';\n\n\t\t\tif (this.isProjectsTaskList())\n\t\t\t{\n\t\t\t\ttagId = `TASKS_PROJECTS_${this.groupId}`;\n\t\t\t}\n\n\t\t\tBX.PULL.extendWatch(tagId, true);\n\t\t\tsetTimeout(() => this.extendWatch(), 29 * 60 * 1000);\n\t\t}\n\t}\n\n\tprocessPullEvent(data)\n\t{\n\t\tconst eventHandlers = {\n\t\t\tuser_counter: this.onUserCounter.bind(this),\n\t\t\tproject_counter: this.onProjectCounter.bind(this),\n\t\t\tcomment_read_all: this.onCommentReadAll.bind(this),\n\t\t};\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tconst { command, params } = data;\n\t\tif (has.call(eventHandlers, command))\n\t\t{\n\t\t\tconst method = eventHandlers[command];\n\t\t\tif (method)\n\t\t\t{\n\t\t\t\tmethod.apply(this, [params]);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:activate', this.#onActivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:deactivate', this.#onDeactivateItem.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:click', this.#readAll.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\n\t\tEvent.bind(window, 'resize', Runtime.throttle(() => {\n\t\t\tif (this.#isBigScreen())\n\t\t\t{\n\t\t\t\tthis.getItemById(Counters.READ_ALL_ID)?.expand();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getItemById(Counters.READ_ALL_ID)?.collapse();\n\t\t\t}\n\t\t}, 10, this));\n\t}\n\n\t#readAll(event: BaseEvent)\n\t{\n\t\tconst item = event.getData().item;\n\n\t\tif (item.getId() === Counters.READ_ALL_ID)\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.isUserTaskList()\n\t\t\t\t|| (this.isProjectsTaskList() && this.role !== 'view_all')\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.readAllByRole();\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tthis.myCounters.scrum_total_comments\n\t\t\t\t|| this.otherCounters.scrum_foreign_comments\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.readAllForScrum();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.readAllForProjects();\n\t\t\t}\n\n\t\t\titem.lock();\n\t\t}\n\t}\n\n\t#isBigScreen(): Boolean\n\t{\n\t\treturn window.innerWidth > 1520;\n\t}\n\n\t#onActivateItem(event: BaseEvent)\n\t{\n\t\tconst item = event.getData();\n\t\tconst itemId = item.id;\n\t\tlet count = null;\n\n\t\tObject.values(this.elements).forEach((element) => {\n\t\t\tif (element.id === itemId)\n\t\t\t{\n\t\t\t\tcount = element;\n\t\t\t}\n\t\t});\n\n\t\tthis.#activateLinkedMenuItem(item);\n\t\tthis.filter.toggleByField(count);\n\n\t\tEventEmitter.emit('Tasks.Toolbar:onItem', {\n\t\t\tcounter: count,\n\t\t});\n\n\t\tEventEmitter.emit('BX.Tasks.Counters:active', count);\n\t}\n\n\t#activateLinkedMenuItem(item: CounterItem): void\n\t{\n\t\tconst items = this.getItems();\n\n\t\tObject.values(items).forEach((element) => {\n\t\t\tif (element.id !== item.id)\n\t\t\t{\n\t\t\t\telement.deactivate(false);\n\t\t\t}\n\t\t});\n\n\t\tif (item.hasParentId())\n\t\t{\n\t\t\tthis.getItemById(item.parentId).activate(false);\n\t\t}\n\t}\n\n\t#onDeactivateItem(event: BaseEvent)\n\t{\n\t\tconst item = event.getData();\n\t\tlet itemId = item.id;\n\t\tlet count = null;\n\n\t\tif (item.parent)\n\t\t{\n\t\t\titem.getItems().forEach(childItemId => {\n\t\t\t\tconst childItem = this.getItemById(childItemId);\n\n\t\t\t\tif (childItem.isActive)\n\t\t\t\t{\n\t\t\t\t\titemId = childItem.id;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tObject.values(this.elements).forEach((element) => {\n\t\t\tif (element.id === itemId)\n\t\t\t{\n\t\t\t\tcount = element;\n\t\t\t}\n\t\t});\n\n\t\tthis.#deactivateLinkedMenuItem(item);\n\t\tthis.filter.toggleByField(count);\n\n\t\tEventEmitter.emit('Tasks.Toolbar:onItem', {\n\t\t\tcounter: count,\n\t\t});\n\n\t\tEventEmitter.emit('BX.Tasks.Counters:unActive', count);\n\t}\n\n\t#deactivateLinkedMenuItem(item: CounterItem): void\n\t{\n\t\tif (item.hasParentId())\n\t\t{\n\t\t\tconst parentItem = this.getItemById(item.parentId);\n\t\t\tparentItem.deactivate(false);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (item.parent)\n\t\t{\n\t\t\titem.getItems().forEach(childItemId => {\n\t\t\t\tconst childItem = this.getItemById(childItemId);\n\n\t\t\t\tif (childItem.isActive)\n\t\t\t\t{\n\t\t\t\t\tchildItem.deactivate(false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#getColorByValue(value: Number, color: String): String\n\t{\n\t\treturn Number(value) === 0 ? Counters.COLOR_GRAY : (color).toUpperCase();\n\t}\n\n\tonFilterApply()\n\t{\n\t\tif (this.isRoleChanged())\n\t\t{\n\t\t\tthis.updateRole();\n\t\t\tthis.updateCountersData();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tObject.values(this.elements).forEach((element) => {\n\t\t\t\tconst item = this.getItemById(element.id);\n\t\t\t\tconst isFiltered = this.filter.isFilteredByFieldValue(element.filterField, element.filterValue);\n\n\t\t\t\tif (!isFiltered)\n\t\t\t\t{\n\t\t\t\t\titem.deactivate(false);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.#markCounters();\n\t\t}\n\t}\n\n\tupdateCountersData()\n\t{\n\t\tif (Counters.updateTimeout)\n\t\t{\n\t\t\tCounters.needUpdate = true;\n\t\t\treturn;\n\t\t}\n\n\t\tCounters.updateTimeout = true;\n\t\tCounters.needUpdate = false;\n\n\t\tAjax.runComponentAction('bitrix:tasks.interface.counters', 'getCounters', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\trole: this.role,\n\t\t\t\tcounters: this.initialCounterTypes,\n\t\t\t},\n\t\t\tsignedParameters: this.signedParameters,\n\t\t}).then(\n\t\t\t(response) => this.rerender(response.data),\n\t\t\t(response) => console.log(response),\n\t\t);\n\n\t\tsetTimeout(() => {\n\t\t\tCounters.updateTimeout = false;\n\t\t\tif (Counters.needUpdate)\n\t\t\t{\n\t\t\t\tthis.updateCountersData();\n\t\t\t}\n\t\t}, Counters.timeoutTTL);\n\t}\n\n\tisRoleChanged()\n\t{\n\t\treturn this.role !== (this.filter.isFilteredByField('ROLEID') ? this.filter.fields.ROLEID : 'view_all');\n\t}\n\n\tupdateRole()\n\t{\n\t\tthis.role = (this.filter.isFilteredByField('ROLEID') ? this.filter.fields.ROLEID : 'view_all');\n\t}\n\n\tonCommentReadAll(data)\n\t{\n\t\tthis.updateCountersData();\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tif (\n\t\t\t!this.isUserTaskList()\n\t\t\t|| !this.isMyTaskList()\n\t\t\t|| !has.call(data, this.groupId)\n\t\t\t|| this.userId !== Number(data.userId)\n\t\t)\n\t\t{\n\t\t\t// most likely project counters were updated, but due to 'isSonetEnable' flag only user counters are comming\n\t\t\tthis.updateCountersData();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.isSonetEnabled !== undefined && data.isSonetEnabled === false)\n\t\t{\n\t\t\tthis.updateCountersData();\n\t\t}\n\t}\n\n\tonProjectCounter(data)\n\t{\n\t\tif (this.isUserTaskList())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateCountersData();\n\t}\n\n\tgetCounterItems(counters): Array\n\t{\n\t\tlet items = [];\n\t\tlet parentTotal = 0;\n\t\tconst parentItemId = 'tasks_more';\n\t\tlet hasOther = false;\n\n\t\tconst availableTypes = new Set([\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other,\n\t\t]);\n\n\t\titems = [];\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tif (!availableTypes.has(type))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Counters.counterTypes.other.includes(type))\n\t\t\t{\n\t\t\t\thasOther = true;\n\t\t\t\tparentTotal += Number(data.VALUE);\n\n\t\t\t\titems.push({\n\t\t\t\t\tid: type,\n\t\t\t\t\ttitle: this.getCounterNameByType(type),\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tvalue: Number(data.VALUE),\n\t\t\t\t\t\torder: -1,\n\t\t\t\t\t},\n\t\t\t\t\tparentId: parentItemId,\n\t\t\t\t\tcolor: this.#getColorByValue(Number(data.VALUE), data.STYLE),\n\t\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: type,\n\t\t\t\t\ttitle: this.getCounterNameByType(type),\n\t\t\t\t\tvalue: Number(data.VALUE),\n\t\t\t\t\tisRestricted: false,\n\t\t\t\t\tcolor: this.#getColorByValue(Number(data.VALUE), data.STYLE),\n\t\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (!this.isUserTaskList() || this.isMyTaskList())\n\t\t{\n\t\t\titems.push({\n\t\t\t\tid: Counters.READ_ALL_ID,\n\t\t\t\ttitle: Loc.getMessage('TASKS_COUNTER_READ_ALL'),\n\t\t\t\tcollapsedIcon: 'chat-check',\n\t\t\t\tcollapsed: !this.#isBigScreen(),\n\t\t\t\tlocked: false,\n\t\t\t\tdataAttributes: {\n\t\t\t\t\trole: 'tasks-counters--item-head-read-all',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (hasOther)\n\t\t{\n\t\t\titems.push({\n\t\t\t\tid: parentItemId,\n\t\t\t\ttitle: Loc.getMessage('TASKS_COUNTER_MORE'),\n\t\t\t\tvalue: {\n\t\t\t\t\tvalue: parentTotal,\n\t\t\t\t\torder: -1,\n\t\t\t\t},\n\t\t\t\tisRestricted: false,\n\t\t\t\tcolor: Counters.COLOR_THEME,\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetCounterNameByType(type: String): String\n\t{\n\t\tif (Counters.counterTypes.expired.includes(type))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_COUNTER_EXPIRED');\n\t\t}\n\n\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_COUNTER_NEW_COMMENTS');\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tsetData(counters)\n\t{\n\t\tthis.myCounters = {};\n\t\tthis.otherCounters = {};\n\n\t\tconst availableTypes = new Set([\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other,\n\t\t]);\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tif (!availableTypes.has(type))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst counterItem = {\n\t\t\t\tid: type,\n\t\t\t\ttitle: this.getCounterNameByType(type),\n\t\t\t\tvalue: Number(data.VALUE),\n\t\t\t\tcolor: this.#getColorByValue(Number(data.VALUE), data.STYLE),\n\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t};\n\n\t\t\tif (Counters.counterTypes.my.includes(type))\n\t\t\t{\n\t\t\t\tthis.myCounters[type] = counterItem;\n\t\t\t}\n\t\t\telse if (Counters.counterTypes.other.includes(type))\n\t\t\t{\n\t\t\t\tthis.otherCounters[type] = counterItem;\n\t\t\t}\n\t\t});\n\t}\n\n\treadAllByRole()\n\t{\n\t\t(new Viewed()).userComments({\n\t\t\tgroupId: this.groupId,\n\t\t\tuserId: this.userId,\n\t\t\trole: this.role,\n\t\t});\n\t}\n\n\treadAllForProjects()\n\t{\n\t\tconst allCounters = { ...this.myCounters, ...this.otherCounters };\n\n\t\tObject.entries(allCounters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tcounter.updateCount(0);\n\t\t\t}\n\t\t});\n\n\t\t(new Viewed()).projectComments({\n\t\t\tgroupId: this.groupId,\n\t\t});\n\t}\n\n\treadAllForScrum()\n\t{\n\t\tconst allCounters = { ...this.myCounters, ...this.otherCounters };\n\n\t\tObject.entries(allCounters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tcounter.updateCount(0);\n\t\t\t}\n\t\t});\n\n\t\t(new Viewed()).scrumComments({\n\t\t\tgroupId: this.groupId,\n\t\t});\n\t}\n\n\trerender(counters)\n\t{\n\t\tthis.setData(counters);\n\n\t\tlet isValueUpdated = false;\n\t\tlet parentTotal = 0;\n\t\tlet parentId = null;\n\t\tlet canResetReadAll = false;\n\n\t\tconst availableTypes = new Set([\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other,\n\t\t]);\n\n\t\tObject.entries(counters).forEach(([code, counter]) => {\n\t\t\tif (!availableTypes.has(code))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.getItemById(code);\n\t\t\tif (item.hasParentId())\n\t\t\t{\n\t\t\t\tparentId = item.parentId;\n\t\t\t\tparentTotal += Number(counter.VALUE);\n\t\t\t}\n\n\t\t\titem.updateValue(Number(counter.VALUE));\n\t\t\titem.updateColor(this.#getColorByValue(Number(counter.VALUE), counter.STYLE));\n\t\t\tisValueUpdated = isValueUpdated || true;\n\n\t\t\tif (this.#getColorByValue(Number(counter.VALUE), counter.STYLE) === Counters.COLOR_SUCCESS)\n\t\t\t{\n\t\t\t\tcanResetReadAll = true;\n\t\t\t}\n\t\t});\n\n\t\tif (canResetReadAll && (!this.isUserTaskList() || this.isMyTaskList()))\n\t\t{\n\t\t\tthis.#updateReadAllItem(canResetReadAll);\n\t\t}\n\n\t\tif (parentId)\n\t\t{\n\t\t\tconst item = this.getItemById(parentId);\n\t\t\titem.updateValue(parentTotal);\n\t\t}\n\t}\n\n\trender(): void\n\t{\n\t\tsuper.init();\n\t}\n\n\tconnectWithFilter(): void\n\t{\n\t\tthis.filter = new Filter({\n\t\t\tfilterId: this.#filterId,\n\t\t});\n\n\t\tthis.bindEvents();\n\n\t\tthis.#markCounters();\n\t}\n\n\t#markCounters(): void\n\t{\n\t\tlet parentId = null;\n\t\tlet canResetReadAll = false;\n\n\t\tObject.values(this.elements).forEach((element) => {\n\t\t\tconst item = this.getItemById(element.id);\n\t\t\tconst isFiltered = this.filter.isFilteredByFieldValue(element.filterField, element.filterValue);\n\n\t\t\tif (item.color === Counters.COLOR_SUCCESS)\n\t\t\t{\n\t\t\t\tcanResetReadAll = true;\n\t\t\t}\n\n\t\t\tif (isFiltered)\n\t\t\t{\n\t\t\t\tif (item.hasParentId())\n\t\t\t\t{\n\t\t\t\t\tparentId = item.parentId;\n\t\t\t\t}\n\n\t\t\t\titem.activate(false);\n\t\t\t}\n\t\t});\n\n\t\tif (canResetReadAll && (!this.isUserTaskList() || this.isMyTaskList()))\n\t\t{\n\t\t\tthis.#updateReadAllItem(canResetReadAll);\n\t\t}\n\n\t\tif (parentId)\n\t\t{\n\t\t\tthis.getItemById(parentId).activate(false);\n\t\t}\n\t}\n\n\t#updateReadAllItem(canResetReadAll: Boolean)\n\t{\n\t\tconst readAllItem = this.getItemById(Counters.READ_ALL_ID);\n\n\t\tif (canResetReadAll && readAllItem.isLocked())\n\t\t{\n\t\t\treadAllItem.unLock();\n\t\t}\n\n\t\tif (!canResetReadAll && !readAllItem.isLocked())\n\t\t{\n\t\t\treadAllItem.lock();\n\t\t}\n\t}\n}\n"],"names":["Filter","options","filterId","filterManager","BX","Main","getById","bindEvents","updateFields","EventEmitter","subscribe","onFilterApply","bind","fields","getFilterFieldsValues","field","Object","keys","includes","Type","isArray","length","value","isFilteredByField","name","filterField","filterValue","isFilteredByFieldValue","getApi","extendFilter","COUNTER_TYPE","getFilterFields","forEach","getAttribute","getFields","deleteField","getSearch","apply","Counters","my","other","additional","expired","comment","project","scrum","target","renderTo","items","multiselect","title","Loc","getMessage","userId","targetUserId","groupId","counters","initialCounterTypes","counterTypes","role","signedParameters","setData","initPull","elements","getCounterItems","setItems","otherCounters","isUserTaskList","isProjectsTaskList","PULL","moduleId","callback","data","processPullEvent","extendWatch","isProjectList","tagId","setTimeout","eventHandlers","user_counter","onUserCounter","project_counter","onProjectCounter","comment_read_all","onCommentReadAll","has","prototype","hasOwnProperty","command","params","call","method","Event","window","Runtime","throttle","getItemById","READ_ALL_ID","expand","collapse","isRoleChanged","updateRole","updateCountersData","values","element","item","id","isFiltered","filter","deactivate","updateTimeout","needUpdate","Ajax","runComponentAction","mode","then","response","rerender","console","log","timeoutTTL","ROLEID","isMyTaskList","Number","isSonetEnabled","undefined","parentTotal","parentItemId","hasOther","availableTypes","Set","entries","type","VALUE","push","getCounterNameByType","order","parentId","color","STYLE","FILTER_FIELD","FILTER_VALUE","isRestricted","collapsedIcon","collapsed","locked","dataAttributes","COLOR_THEME","myCounters","counterItem","Viewed","userComments","allCounters","counter","updateCount","projectComments","scrumComments","canResetReadAll","code","hasParentId","updateValue","updateColor","COLOR_SUCCESS","CounterPanel","event","getData","getId","readAllByRole","scrum_total_comments","scrum_foreign_comments","readAllForScrum","readAllForProjects","lock","innerWidth","itemId","count","toggleByField","emit","getItems","activate","parent","childItemId","childItem","isActive","parentItem","COLOR_GRAY","toUpperCase","readAllItem","isLocked","unLock"],"mappings":"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"}