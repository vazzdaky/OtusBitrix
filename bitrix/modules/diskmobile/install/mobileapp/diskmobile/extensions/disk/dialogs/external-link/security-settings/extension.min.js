jn.define("disk/dialogs/external-link/security-settings",((e,t,s)=>{const{BaseDialog:i}=e("disk/dialogs/base");const{Loc:a}=e("loc");const{Indent:d,Component:n,Color:r}=e("tokens");const{showErrorToast:o}=e("toast");const{CardList:h}=e("ui-system/layout/card-list");const{Card:l}=e("ui-system/layout/card");const{SettingSelector:u}=e("ui-system/blocks/setting-selector");const{SwitcherSize:c}=e("ui-system/blocks/switcher");const{StringInput:T}=e("ui-system/form/inputs/string");const{NumberInput:m}=e("ui-system/form/inputs/number");const{Input:g,InputDesign:p}=e("ui-system/form/inputs/input");const{Icon:w}=e("ui-system/blocks/icon");const{UIMenu:S}=e("layout/ui/menu");const{DeathTimeByType:I,DeathTimeType:E,deathTimeTypeNamePlural:D,getDeathTimeTypeByDeathTime:y,getDeathTimeValueByType:b}=e("disk/dialogs/external-link/death-time-util");const{selectById:_}=e("disk/statemanager/redux/slices/files/selector");const C=e("statemanager/redux/store");const P=42;class f extends i{constructor(e){super(e);this.objectId=e.objectId??"";this.object=_(C.getState(),Number(this.objectId))??{};this.linkObject=this.object?.links?.external??null;this.DeathTimeTypeMenuTargetRef=null;const t=y(e.deathTime);this.state={hasPassword:Boolean(e.hasPassword),showPassword:false,deathTimeType:t,deathTimeValue:b(e.deathTime,t),deathTimeEnabled:Boolean(e.deathTime),canEditDocument:this.isEditAvailable&&e.canEditDocument,password:e.password??null,pending:false}}get isEditAvailable(){return this.linkObject?.availableEdit??null}get deathTime(){return I[this.state.deathTimeType]*this.state.deathTimeValue}getTestId(e){return`security-settings-dialog-${e}`}isButtonDisabled(){return false}getButtonText(){return a.getMessage("M_DISK_SECURITY_SETTING_DIALOG_SAVE_BUTTON")}saveSettings(){if(this.props.onSave){this.props.onSave({deathTime:this.state.deathTimeEnabled?this.deathTime:0,hasPassword:this.state.hasPassword,canEditDocument:this.state.canEditDocument,password:this.state.hasPassword?this.state.password:null})}this.layoutWidget.close()}save=()=>{if(this.object?.links?.external?.id){this.setState({pending:true},(()=>{BX.ajax.runAction("diskmobile.ExternalLink.updateSecuritySettings",this.prepareUpdateSettingsConfig()).then(this.onUpdateSettingsFulfilled).catch(this.onUpdateSettingsRejected)}))}else{this.saveSettings()}};onUpdateSettingsFulfilled=()=>{this.saveSettings()};onUpdateSettingsRejected=e=>{console.error(e);this.setState({pending:false});o({message:a.getMessage("M_DISK_SECURITY_SETTING_DIALOG_SAVE_ERROR")})};prepareUpdateSettingsConfig(){const e=e=>e/1e3;const t=e=>e*1e3;const s=this.state.deathTimeEnabled?new Date(Date.now()+t(this.deathTime)).getTime():null;return{data:{id:this.object?.links?.external?.id,newPassword:this.state.hasPassword?this.state.password:null,disablePassword:this.state.hasPassword?0:1,deathTime:this.state.deathTimeEnabled?e(s):null,disableDeathTime:this.state.deathTimeEnabled?0:1,allowEditDocument:this.state.canEditDocument?1:0}}}getStartingLayoutHeight(){const e=44;const t=48+n.cardPaddingT.toNumber()+n.cardPaddingB.toNumber();const s=24+n.cardPaddingT.toNumber()+n.cardPaddingB.toNumber();const i=42+d.XL2.toNumber()*2;const a=(P+d.L.getValue())*2;return e+t+n.cardListGap.getValue()+s+i+a}getTitleParams(){return{text:a.getMessage("M_DISK_SECURITY_SETTING_DIALOG_SECURITY"),type:"dialog"}}static async open(e,t){super.open(e,t)}renderContent(){return View({style:{flex:1},onClick:()=>Keyboard.dismiss()},h({divided:true},this.renderDeathTimeCard(),this.renderPasswordCard(),this.isEditAvailable&&this.renderAllowEditCard()))}renderDeathTimeCard(){return l({testId:this.getTestId("death-time-card"),border:true},u({testId:this.getTestId("death-time-card"),checked:this.state.deathTimeEnabled,title:a.getMessage("M_DISK_SECURITY_SETTING_DIALOG_ENABLE_DEATH_TIME"),additionalContent:this.state.deathTimeEnabled?this.renderDeathTimeFields():null,switcherSize:c.L,onClick:()=>{this.setState({deathTimeEnabled:!this.state.deathTimeEnabled,deathTimeValue:this.state.deathTimeValue||1})}}))}renderDeathTimeFields(){return View({style:{marginTop:d.L.getValue(),flexDirection:"row",alignItems:"center",alignContent:"center"}},View({style:{flex:1}},this.renderDeathTimeValueField()),this.renderVerticalDivider(),View({style:{flex:1}},this.renderDeathTimeTypeField()))}renderDeathTimeValueField(){return m({testId:"duration-value-field",design:p.GREY,required:false,value:this.state.deathTimeValue||"",shouldShowToolbar:false,onChange:e=>this.setState({deathTimeValue:e}),title:"",placeholder:"0"})}renderDeathTimeTypeField(){return g({testId:this.getTestId("death-time-type-field"),readOnly:true,dropdown:true,onClick:this.openDeathTimeTypeMenu,design:p.GREY,value:D(this.state.deathTimeValue)[this.state.deathTimeType],forwardRef:e=>{this.DeathTimeTypeMenuTargetRef=e}})}openDeathTimeTypeMenu=()=>{const e=Object.values(E).map((e=>this.createDeathTimeTypeMenuItem(e)));this.menu=new S(e);this.menu.show({target:this.DeathTimeTypeMenuTargetRef})};createDeathTimeTypeMenuItem(e){return{id:e,testId:this.getTestId(`death-time-type-menu-item-${e}`),title:D(this.state.deathTimeValue)[e],onItemSelected:(e,t)=>this.setState({deathTimeType:t.id}),sectionCode:"default"}}renderVerticalDivider(){return View({style:{height:14,width:1,backgroundColor:r.bgSeparatorPrimary.toHex(),marginHorizontal:d.XL2.toNumber()}})}renderPasswordCard(){return l({testId:this.getTestId("password-card"),border:true},u({testId:this.getTestId("password-card-selector"),checked:this.state.hasPassword,title:a.getMessage("M_DISK_SECURITY_SETTING_DIALOG_ENABLE_PASSWORD"),additionalContent:this.state.hasPassword?this.renderPasswordField():null,switcherSize:c.L,onClick:()=>{this.setState({hasPassword:!this.state.hasPassword})}}))}renderPasswordField(){return T({testId:this.getTestId("password-field"),design:p.GREY,style:{marginTop:d.L.getValue()},isPassword:!this.state.showPassword,value:this.state.password,rightContent:this.state.showPassword?w.OBSERVER:w.CROSSED_EYE,onChange:e=>{this.setState({password:e})},onClickRightContent:()=>{this.setState({showPassword:!this.state.showPassword})}})}renderAllowEditCard(){return l({testId:this.getTestId("allow-edit-card"),border:true},u({testId:this.getTestId("allow-edit-selector"),checked:this.state.canEditDocument,title:a.getMessage("M_DISK_SECURITY_SETTING_DIALOG_ALLOW_EDIT"),switcherSize:c.L,onClick:()=>{this.setState({canEditDocument:!this.state.canEditDocument})}}))}}s.exports={SecuritySettingsDialog:f}}));
//# sourceMappingURL=extension.map.js