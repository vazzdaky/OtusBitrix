this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,n,s,i,a,r,o,c,l,d,_,T,E,h,u,m,p){"use strict";const A=Object.freeze({containerDataTestId:"hr-department-content_users-tab__head-list-container",listActionButtonDataTestId:"hr-department-content_users-tab__head-list-action-button",listActonMenuDataTestId:"hr-department-content_users-tab__head-list-action-menu-container",listCounterDataTestId:"hr-department-content_users-tab__head-list-counter"});const C=Object.freeze({containerDataTestId:"hr-department-content_users-tab__employee-list-container",listActionButtonDataTestId:"hr-department-content_users-tab__employee-list-action-button",listActonMenuDataTestId:"hr-department-content_users-tab__employee-list-action-menu-container",listCounterDataTestId:"hr-department-content_users-tab__employee-list-counter"});const N={name:"emptyStateContainer",components:{RouteActionMenu:h.RouteActionMenu},props:{departmentId:{type:Number,required:true},entityType:{type:String,default:E.EntityTypes.department}},data(){return{menuVisible:false}},computed:{menu(){return new n.EmptyUsersTabActionMenu(this.departmentId,s.AnalyticsSourceType.DETAIL,null,this.entityType)},...p.mapState(m.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onClick(){if(this.entityType===E.EntityTypes.team&&this.menu.items.length===1){this.onActionMenuItemClick(this.menu.items[0].id)}else{this.menuVisible=true}},onActionMenuItemClick(t){this.menu.onActionMenuItemClick(t)}},template:`\n\t\t<div class="hr-department-detail-content__users-empty-tab-add_buttons-container">\n\t\t\t<button\n\t\t\t\tclass="hr-add-employee-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round"\n\t\t\t\tref="actionMenuButton"\n\t\t\t\t@click.stop="onClick"\n\t\t\t\tdata-id="hr-department-detail-content__user-empty-tab_add-user-button"\n\t\t\t>\n\t\t\t\t<span class="hr-add-employee-empty-tab-entity-btn-text">{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_ADD_BUTTON')}}</span>\n\t\t\t</button>\n\t\t\t<RouteActionMenu\n\t\t\t\tv-if="menuVisible"\n\t\t\t\t:id="'empty-state-department-detail-add-menu-' + focusedNode"\n\t\t\t\t:items="menu.items"\n\t\t\t\t:width="302"\n\t\t\t\t:bindElement="$refs['actionMenuButton']"\n\t\t\t\t@action="onActionMenuItemClick"\n\t\t\t\t@close="menuVisible = false"\n\t\t\t/>\n\t\t</div>\n\t`};const R={getPagedEmployees:(t,e,n)=>s.getData("humanresources.api.Structure.Node.Member.Employee.list",{nodeId:t,page:e,countPerPage:n}),removeUserFromDepartment:(t,e)=>s.postData("humanresources.api.Structure.Node.Member.deleteUser",{nodeId:t,userId:e}),moveUserToDepartment:(t,e,n)=>s.postData("humanresources.api.Structure.Node.Member.moveUser",{nodeId:t,userId:e,targetNodeId:n}),isUserInMultipleDepartments:t=>s.getData("humanresources.api.User.isUserInMultipleDepartments",{userId:t}),getUserInfo:(t,e)=>s.getData("humanresources.api.User.getInfoByUserMember",{nodeId:t,userId:e}),fireUser:t=>s.postData("intranet.user.fire",{userId:t}),findMemberByQuery:(t,e)=>s.getData("humanresources.api.Structure.Node.Member.find",{nodeId:t,query:e}),getChatsAndChannels:t=>s.getData("humanresources.api.Structure.Node.Member.Chat.getList",{nodeId:t}),saveChats:(t,e)=>s.postData("humanresources.api.Structure.Node.Member.Chat.saveChatList",{nodeId:t,ids:e})};const U={moveUserToDepartment:(t,e,n,i)=>{var a;const r=m.useChartStore();const o=r.departments.get(t);const c=r.departments.get(n);if(!o||!c){return}const l=s.getMemberRoles(o.entityType);const d=s.getMemberRoles(c.entityType);const _=i===l.employee?(a=o.employees)==null?void 0:a.find((t=>t.id===e)):o.heads.find((t=>t.id===e));if(!_){return}o.userCount-=1;if(i===l.employee){o.employees=o.employees.filter((t=>t.id!==e))}else{o.heads=o.heads.filter((t=>t.id!==e))}c.userCount+=1;if(e===r.userId){r.changeCurrentDepartment(t,n)}_.role=d.employee;if(!c.employees){return}c.employees.push(_)},removeUserFromDepartment:(t,e,n)=>{const i=m.useChartStore();const a=i.departments.get(t);const r=s.getMemberRoles(a.entityType);if(!a){return}if(e===i.userId){i.changeCurrentDepartment(t)}a.userCount-=1;if(n===r.employee){a.employees=a.employees.filter((t=>t.id!==e));return}a.heads=a.heads.filter((t=>t.id!==e))},updateEmployees:(t,e)=>{const{departments:n}=m.useChartStore();const s=n.get(t);if(!s){return}n.set(t,{...s,employees:e})},updateEmployeeListOptions:(t,e)=>{const{departments:n}=m.useChartStore();const s=n.get(t);if(!s){return}s.employeeListOptions={...s.employeeListOptions,...e};n.set(t,s)},setChatsAndChannels:(t,e,n)=>{const s=m.useChartStore();const i=s.departments.get(t);if(!i){return}i.channels=n;i.chats=e;i.chatAndChannelsCount=e.length+n.length},removeUserFromAllDepartments:async t=>{const e=m.useChartStore();const n=e.departments;const s=[];for(const[e,i]of n){if("heads"in i&&u.Type.isArray(i.heads)&&i.heads.some((e=>e.id===t))||"employees"in i&&u.Type.isArray(i.employees)&&i.employees.some((e=>e.id===t))){s.push(e)}}return e.refreshDepartments(s)}};const S={name:"MoveUserActionPopup",components:{ConfirmationPopup:h.ConfirmationPopup},emits:["close","action"],props:{parentId:{type:Number,required:true},user:{type:Object,required:true},entityType:{type:String,required:true}},created(){this.permissionChecker=i.PermissionChecker.getInstance();if(!this.permissionChecker){return}this.action=this.isTeamEntity?i.PermissionActions.teamAddMember:i.PermissionActions.employeeAddToDepartment;this.selectedDepartmentId=0},data(){return{showMoveUserActionLoader:false,lockMoveUserActionButton:false,showUserAlreadyBelongsToDepartmentPopup:false,accessDenied:false}},mounted(){const t=this.$refs["department-selector"];this.departmentSelector=this.createTagSelector();this.departmentSelector.renderTo(t)},computed:{...p.mapState(m.useChartStore,["departments","focusedNode"]),includedNodeEntityTypesInDialog(){return this.isTeamEntity?["team"]:["department"]},getMoveUserActionPhrase(){var t,e;const n=u.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");const s=u.Text.encode((e=this.user.name)!=null?e:"");let i="";if(this.isTeamEntity){i="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_REMOVE_USER_DESCRIPTION";i+=this.user.gender==="F"?"_F":"_M"}else{i="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1"}return this.loc(i,{"#USER_NAME#":s,"#DEPARTMENT_NAME#":n}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`).replace("[/link]","</a>")},getUserAlreadyBelongsToDepartmentPopupPhrase(){var t,e,n;const s=u.Text.encode((t=this.departments.get((e=this.selectedParentDepartment)!=null?e:0).name)!=null?t:"");const i=u.Text.encode((n=this.user.name)!=null?n:"");let a="";if(this.isTeamEntity){a="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ALREADY_BELONGS_TO_TEAM_DESCRIPTION";a+=this.user.gender==="F"?"_F":"_M"}else{a="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1"}let r=this.loc(a,{"#USER_NAME#":i,"#DEPARTMENT_NAME#":s});r=r.replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`);r=r.replace("[/link]","</a>");return r},memberRoles(){return s.getMemberRoles(this.entityType)},isTeamEntity(){return this.entityType===E.EntityTypes.team},confirmTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_CONFIRM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_TITLE")},confirmDescription(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_ACTION_SELECT_TEAM_DESCRIPTION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_ACTION_SELECT_DEPARTMENT_DESCRIPTION")}},methods:{createTagSelector(){return new a.TagSelector({events:{onTagAdd:t=>{this.accessDenied=false;const{tag:e}=t.data;this.selectedParentDepartment=e.id;if(i.PermissionChecker.hasPermission(this.action,e.id)){this.lockMoveUserActionButton=false;return}this.accessDenied=true;this.lockMoveUserActionButton=true},onTagRemove:()=>{this.lockMoveUserActionButton=true}},multiple:false,dialogOptions:{width:425,height:350,dropdownMode:true,hideOnDeselect:true,entities:[{id:"structure-node",options:{selectMode:"departmentsOnly",restricted:"addMember",includedNodeEntityTypes:this.includedNodeEntityTypesInDialog,useMultipleTabs:true}}],preselectedItems:[["structure-node",this.parentId]]}})},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},async confirmMoveUser(){var t,e,n;this.showMoveUserActionLoader=true;const s=this.focusedNode;const i=this.user.id;const a=this.selectedParentDepartment;try{await R.moveUserToDepartment(s,i,a)}catch(t){var o;this.showMoveUserActionLoader=false;const e=(o=t.code)!=null?o:0;if(e==="MEMBER_ALREADY_BELONGS_TO_NODE"){this.showUserAlreadyBelongsToDepartmentPopup=true}else{const t=this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ERROR");r.UI.Notification.Center.notify({content:t,autoHideDelay:2e3});this.$emit("close")}return}const c=u.Text.encode((t=(e=this.departments.get(a))==null?void 0:e.name)!=null?t:"");const l=this.isTeamEntity?"HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUCCESS_MESSAGE":"HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUCCESS_MESSAGE";r.UI.Notification.Center.notify({content:this.loc(l,{"#DEPARTMENT_NAME#":c}),autoHideDelay:2e3});U.moveUserToDepartment(s,i,a,(n=this.user.role)!=null?n:this.memberRoles.employee);this.$emit("action");this.showMoveUserActionLoader=false},closeAction(){this.$emit("close")},closeUserAlreadyBelongsToDepartmentPopup(){this.showUserAlreadyBelongsToDepartmentPopup=false;this.closeAction()}},template:`\n\t\t<ConfirmationPopup\n\t\t\t@action="confirmMoveUser"\n\t\t\t@close="closeAction"\n\t\t\t:showActionButtonLoader="showMoveUserActionLoader"\n\t\t\t:lockActionButton="lockMoveUserActionButton"\n\t\t\t:title="confirmTitle"\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div v-html="getMoveUserActionPhrase"/>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{confirmDescription}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-department-detail-content__move-user-department-selector"\n\t\t\t\t\tref="department-selector"\n\t\t\t\t\t:class="{ 'ui-ctl-warning': accessDenied }"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="accessDenied"\n\t\t\t\t\tclass="hr-department-detail-content__move-user-department_item-error"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --warning"></div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__move-user-department_item-error-message"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_PERMISSION_ERROR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\t@action="closeUserAlreadyBelongsToDepartmentPopup"\n\t\t\t@close="closeUserAlreadyBelongsToDepartmentPopup"\n\t\t\tv-if="showUserAlreadyBelongsToDepartmentPopup"\n\t\t\t:withoutTitleBar = true\n\t\t\t:onlyConfirmButtonMode = true\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')"\n\t\t\t:width="300"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-belongs-to-department-text-container"\n\t\t\t\t\t\tv-html="getUserAlreadyBelongsToDepartmentPopupPhrase"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__move-user-department-selector" ref="department-selector"></div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`};const M={name:"userList",props:{user:{type:Object,required:true},departmentId:{type:Number,required:true}},components:{RouteActionMenu:h.RouteActionMenu,ConfirmationPopup:h.ConfirmationPopup,MoveUserActionPopup:S},data(){return{menuVisible:{},showRemoveUserConfirmationPopup:false,showRemoveUserConfirmationActionLoader:false,showMoveUserPopup:false,showFireUserPopup:false,fireUserLoad:false}},methods:{toggleMenu(t){this.menuVisible[t]=!this.menuVisible[t]},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){if(t===n.MenuActions.removeUserFromDepartment){this.showRemoveUserConfirmationPopup=true}if(t===n.MenuActions.moveUserToAnotherDepartment){this.showMoveUserPopup=true}if(t===n.MenuActions.fireUserFromCompany){this.showFireUserPopup=true}},async removeUser(){var t;this.showRemoveUserConfirmationActionLoader=true;const e=this.user.id;const n=await R.isUserInMultipleDepartments(e);const s=this.focusedNode;this.showRemoveUserConfirmationActionLoader=false;this.showRemoveUserConfirmationPopup=false;try{await R.removeUserFromDepartment(s,e)}catch{const t=this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_ERROR");r.UI.Notification.Center.notify({content:t,autoHideDelay:2e3});return}const i=this.isTeamEntity?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_SUCCESS":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUCCESS";const a=u.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");r.UI.Notification.Center.notify({content:this.loc(i,{"#DEPARTMENT_NAME#":a}),autoHideDelay:2e3});const o=this.user.role;if(n||this.isTeamEntity){U.removeUserFromDepartment(s,e,o);return}const c=[...this.departments.values()].find((t=>t.parentId===0));if(!c){return}U.moveUserToDepartment(s,e,c.id,o)},cancelRemoveUser(){this.showRemoveUserConfirmationPopup=false},async fireUser(){this.fireUserLoad=true;const t=this.user.id;try{await R.fireUser(t)}catch(t){if(t.code!=="STRUCTURE_ACCESS_DENIED"){r.UI.Notification.Center.notify({content:this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_ERROR"),autoHideDelay:2e3})}this.showFireUserPopup=false;this.fireUserLoad=false;return}U.removeUserFromDepartment(this.focusedNode,t,this.user.role);await U.removeUserFromAllDepartments(t);this.showFireUserPopup=false;this.fireUserLoad=false},cancelFireUser(){this.showFireUserPopup=false},handleMoveUserAction(){this.showMoveUserPopup=false},handleMoveUserClose(){this.showMoveUserPopup=false},getMemberKeyByValue(t){return Object.keys(s.memberRoles).find((e=>s.memberRoles[e]===t))||""}},created(){this.menu=new n.UserListActionMenu(this.focusedNode,this.entityType,this.user.isInvited)},computed:{...p.mapState(m.useChartStore,["focusedNode","departments"]),memberRoles(){return s.memberRoles},getFirePopupDescription(){var t,e;const n=u.Text.encode((t=this.user.name)!=null?t:"");const s=u.Text.encode((e=this.user.url)!=null?e:"");const i=this.user.gender==="F"?"_F":"_M";const a=this.user.isInvited?`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_DESCRIPTION${i}`:`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_DESCRIPTION${i}`;const r=this.loc(a,{"#USER_NAME#":n});return r.replace("[link]",`<a class="hr-department-detail-content__fire-user-link" href="${s}">`).replace("[/link]","</a>")},getFirePopupTitle(){return this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_TITLE")},getFirePopupButtonText(){return this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_CONFIRM_BUTTON"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_CONFIRM_BUTTON")},getRemovePopupTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_TITLE")},getRemovePopupDescription(){var t,e;const n=u.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");const s=u.Text.encode((e=this.user.name)!=null?e:"");if(this.isTeamEntity){const t="HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_DESCRIPTION";const e=this.user.gender==="F"?"_F":"_M";return this.loc(t+e,{"#USER_NAME#":s,"#DEPARTMENT_NAME#":n}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`).replace("[/link]","</a>")}return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_DESCRIPTION")},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===E.EntityTypes.team}},template:`\n\t\t<button\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="ui-icon-set --more hr-department-detail-content__user-action-btn"\n\t\t\t:class="{ '--focused': menuVisible[user.id] }"\n\t\t\t@click.stop="toggleMenu(user.id)"\n\t\t\tref="actionUserButton"\n\t\t\t:data-id="'hr-department-detail-content__'+ getMemberKeyByValue(user.role) + '-list_user-' + user.id + '-action-btn'"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible[user.id]"\n\t\t\t:id="'tree-node-department-menu-' + user.id"\n\t\t\t:items="menu.items"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.actionUserButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible[user.id] = false"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref="removeUserConfirmationPopup"\n\t\t\tv-if="showRemoveUserConfirmationPopup"\n\t\t\t:showActionButtonLoader="showRemoveUserConfirmationActionLoader"\n\t\t\t:title="getRemovePopupTitle"\n\t\t\t:confirmBtnText="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t:confirmButtonClass="isTeamEntity ? 'ui-btn-danger' : 'ui-btn-primary'"\n\t\t\t@action="removeUser"\n\t\t\t@close="cancelRemoveUser"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t<div\n\t\t\t\t\tv-html="getRemovePopupDescription"\n\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\tref="fireUserConfirmationPopup"\n\t\t\tv-if="showFireUserPopup"\n\t\t\t:showActionButtonLoader="fireUserLoad"\n\t\t\t:title="getFirePopupTitle"\n\t\t\t:confirmBtnText="getFirePopupButtonText"\n\t\t\t:confirmButtonClass="'ui-btn-danger'"\n\t\t\t@action="fireUser"\n\t\t\t@close="cancelFireUser"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html="getFirePopupDescription"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<MoveUserActionPopup\n\t\t\tv-if="showMoveUserPopup"\n\t\t\t:parentId="focusedNode"\n\t\t\t:user="user"\n\t\t\t:entityType="entityType"\n\t\t\t@action="handleMoveUserAction"\n\t\t\t@close="handleMoveUserClose"\n\t\t/>\n\t`};const O={name:"userList",props:{user:{type:Object,required:true},selectedUserId:{type:Number,required:false,default:null},entityType:{type:String,required:true}},components:{UserListItemActionButton:M},computed:{memberRoles(){return s.getMemberRoles(this.entityType)},defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},...p.mapState(m.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},handleUserClick(t){BX.SidePanel.Instance.open(t.url,{cacheable:false})}},template:`\n\t\t<div \n\t\t\t:key="user.id"\n\t\t\tclass="hr-department-detail-content__user-container"\n\t\t\t:class="{ '--searched': user.id === selectedUserId }"\n\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item'"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__user-avatar-container" @click="handleUserClick(user)">\n\t\t\t\t<img \n\t\t\t\t\tclass="hr-department-detail-content__user-avatar-img"\n\t\t\t\t\t:src="user.avatar ? encodeURI(user.avatar) : defaultAvatar"\n\t\t\t\t/>\n\t\t\t\t<div v-if="user.role === memberRoles.head" class="hr-department-detail-content__user-avatar-overlay"></div>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content-user__text-container">\n\t\t\t\t<div class="hr-department-detail-content__user-title">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-name" \n\t\t\t\t\t\t@click="handleUserClick(user)"\n\t\t\t\t\t\t:bx-tooltip-user-id="user.id"\n\t\t\t\t\t\tbx-tooltip-context="b24"\n\t\t\t\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item-name'"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="user.badgeText" class="hr-department-detail-content-user__name-badge">{{ user.badgeText }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="hr-department-detail-content__user-subtitle" \n\t\t\t\t\t:class="{ '--without-work-position': !user.subtitle }"\n\t\t\t\t>\n\t\t\t\t\t{{ (user.subtitle?.length ?? 0) > 0 ? user.subtitle : this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_DEFAULT_WORK_POSITION') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if="user.isInvited" class="hr-department-detail-content-user__item-badge">\n\t\t\t\t\t{{ this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_INVITED_BADGE_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UserListItemActionButton\n\t\t\t\t:user="user"\n\t\t\t\t:departmentId="focusedNode"\n\t\t\t/>\n\t\t</div>\n\t`};const I={name:"emptyState",props:{title:{type:String,required:false},imageClass:{type:String,required:false},description:{type:String,required:false},list:{type:Array,required:false,default:[]}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="hr-department-detail-content_tab__empty-state-container">\n\t\t\t<div v-if="imageClass" :class="['hr-department-detail-content_tab__empty-state-icon', imageClass]"/>\n\t\t\t<span v-if="title" class="hr-department-detail-content__empty-tab-entity-title">\n\t\t\t\t{{ title }}\n\t\t\t</span>\n\t\t\t<span v-if="description" class="hr-department-detail-content_tab__empty-state-description">\n\t\t\t\t{{ description }}\n\t\t\t</span>\n\t\t\t<div v-if="list.length > 0" class="hr-department-detail-content_tab__empty-state-list">\n\t\t\t\t<div class="hr-department-detail-content_tab__empty-state-list-item"  v-for="item in list">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="ui-icon-set --circle-check hr-department-detail-content_tab__empty-state-list-item-check"\n\t\t\t\t\t\tstyle="--ui-icon-set__icon-size: 20px;"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class="hr-department-detail-content_tab__empty-state-list--item-text">\n\t\t\t\t\t\t{{ item.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot name="content"/>\n\t\t</div>\n\t`};const y={name:"tabEmptyListItem",props:{title:{type:String,required:true},imageClass:{type:String,required:true},withAddPermission:{type:Boolean,required:false,default:true}},template:`\n\t\t<div :class="['hr-department-detail-content__tab-empty-list_item-wrapper', { '--with-add': withAddPermission }]">\n\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-image" :class="imageClass"/>\n\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-content">\n\t\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const f={name:"userListActionButton",emits:["tabListAction","close"],props:{id:{type:String,required:true},menuItems:{type:Array,required:true},dataTestIds:{type:Object,required:false,default:{}}},components:{RouteActionMenu:h.RouteActionMenu},computed:{...p.mapState(m.useChartStore,["focusedNode"])},data(){return{menuVisible:false}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.$emit("tabListAction",t)}},template:`\n\t\t<button\n\t\t\tv-if="menuItems.length"\n\t\t\tclass="hr-department-detail-content__tab-list_header-button"\n\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t:ref="id + '-route-action-menu'"\n\t\t\t@click.stop="menuVisible = true"\n\t\t\t:data-test-id="dataTestIds.buttonDataTestId"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_ACTION_BUTTON_TITLE') }}\n\t\t</button>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="id + '-route-action-menu'"\n\t\t\t:items="menuItems"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs[id + '-route-action-menu']"\n\t\t\t:containerDataTestId="dataTestIds.containerDataTestId"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const P={name:"tabList",components:{ListActionButton:f,EmptyListItem:y},emits:["tabListAction"],props:{id:{type:String,required:true},title:{type:String,required:true},count:{type:Number,required:false},menuItems:{type:Array,required:false,default:[]},listItems:{type:Array,required:true},emptyItemTitle:{type:String,required:false},emptyItemImageClass:{type:String,required:false},hideEmptyItem:{type:Boolean,required:false,default:false},withAddPermission:{type:Boolean,required:false,default:true},dataTestIds:{type:Object,required:false,default:{}}},computed:{needToShowCount(){return u.Type.isNumber(this.count)}},methods:{onActionMenuItemClick(t){this.$emit("tabListAction",t)}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__tab-list_container"\n\t\t\t :data-test-id="dataTestIds.containerDataTestId"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__tab-list_header-container">\n\t\t\t\t<div class="hr-department-detail-content__tab-list_list-title">\n\t\t\t\t\t{{ title}}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="needToShowCount"\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_header-count"\n\t\t\t\t\t\t:data-test-id="dataTestIds.listCounterDataTestId"\n\t\t\t\t\t>\n\t\t\t\t\t{{ count }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<ListActionButton\n\t\t\t\t\t:id="id"\n\t\t\t\t\t:menuItems="menuItems"\n\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t:dataTestIds="{buttonDataTestId: dataTestIds.listActionButtonDataTestId, containerDataTestId: dataTestIds.listActonMenuDataTestId}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab_list-container">\n\t\t\t\t<template v-for="(item) in listItems">\n\t\t\t\t\t<slot :item="item"/>\n\t\t\t\t</template>\n\t\t\t\t<EmptyListItem v-if="emptyItemTitle && emptyItemImageClass && !listItems.length && !hideEmptyItem"\n\t\t\t\t\t:title="emptyItemTitle"\n\t\t\t\t\t:imageClass="emptyItemImageClass"\n\t\t\t\t\t:withAddPermission="withAddPermission"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const D={name:"searchInput",props:{value:{type:String,required:false,default:""},placeholder:{type:String,required:true},dataTestId:{type:String,required:false}},data(){return{hasFocus:false}},methods:{handleInput(t){this.$emit("inputChange",t.target.value)},handleBlur(){if(this.value.length===0){this.hasFocus=false}},clearInput(){this.hasFocus=false;this.$emit("inputChange","")}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__content-search"\n\t\t\t:class="{'--focused': hasFocus}"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__content-search-icon ui-icon-set --search-1"/>\n\t\t\t<input\n\t\t\t\tclass="hr-department-detail-content__content-search-input"\n\t\t\t\ttype="text"\n\t\t\t\t:placeholder="!hasFocus ?  placeholder : ''"\n\t\t\t\t:data-test-id="dataTestId"\n\t\t\t\t:value="value"\n\t\t\t\t@input="handleInput"\n\t\t\t\t@focus="hasFocus = true"\n\t\t\t\t@blur="handleBlur"\n\t\t\t>\n\t\t\t<div\n\t\t\t\tclass="hr-department-detail-content__content-search-close-button ui-icon-set --cross-circle-50"\n\t\t\t\t:class="{'--hide': !hasFocus}"\n\t\t\t\t@click="clearInput"\n\t\t\t/>\n\t\t</div>\n\t`};const b={name:"usersTab",components:{SearchInput:D,EmptyState:I,TabList:P,EmptyTabAddButton:N,UserListItem:O},emits:["showDetailLoader","hideDetailLoader"],data(){return{searchQuery:"",selectedUserId:null,needToScroll:false}},computed:{memberRoles(){return s.getMemberRoles(this.entityType)},heads(){var t;return(t=this.departments.get(this.focusedNode).heads)!=null?t:[]},headCount(){var t;return(t=this.heads.length)!=null?t:0},departmentId(){return this.focusedNode},formattedHeads(){return this.heads.map((t=>({...t,subtitle:t.workPosition,badgeText:this.getBadgeText(t.role)}))).sort(((t,e)=>{const n={[this.memberRoles.head]:1,[this.memberRoles.deputyHead]:2};const s=n[t.role]||3;const i=n[e.role]||3;return s-i}))},filteredHeads(){return this.formattedHeads.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},employeeCount(){var t,e;const n=(t=this.departments.get(this.focusedNode).userCount)!=null?t:0;return n-((e=this.headCount)!=null?e:0)},formattedEmployees(){return this.employees.map((t=>({...t,subtitle:t.workPosition}))).reverse()},filteredEmployees(){return this.formattedEmployees.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},memberCount(){var t;return(t=this.departments.get(this.focusedNode).userCount)!=null?t:0},...p.mapState(m.useChartStore,["focusedNode","departments","searchedUserId"]),...p.mapWritableState(m.useChartStore,["searchedUserId"]),employees(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.employees)!=null?t:[]},showSearchBar(){return this.memberCount>0},showSearchEmptyState(){return this.filteredHeads.length===0&&this.filteredEmployees.length===0},canAddUsers(){const t=i.PermissionChecker.getInstance();if(!t){return false}const e=this.focusedNode;const n=this.isTeamEntity?i.PermissionActions.teamAddMember:i.PermissionActions.employeeAddToDepartment;return t.hasPermission(n,e)},headListEmptyStateTitle(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},employeesListEmptyStateTitle(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},shouldUpdateList(){var t,e;return(t=(e=this.departments.get(this.focusedNode).employeeListOptions)==null?void 0:e.shouldUpdateList)!=null?t:true},departmentUsersStatus(){const t=this.departments.get(this.focusedNode);if(t!=null&&t.heads&&t.employees){return{departmentId:this.focusedNode,loaded:true}}return{departmentId:this.focusedNode,loaded:false}},headMenu(){return new n.UsersTabActionMenu(this.focusedNode,s.AnalyticsSourceType.DETAIL,"head",this.entityType)},employeeMenu(){return new n.UsersTabActionMenu(this.focusedNode,s.AnalyticsSourceType.DETAIL,"employee",this.entityType)},isEmployeeListOptionsSet(){const t=this.departments.get(this.focusedNode)||{};return t.employeeListOptions&&Object.keys(t.employeeListOptions).length>0},employeeTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_LIST_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_LIST_TITLE")},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===E.EntityTypes.team},emptyStateTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_TITLE")},emptyStateDescription(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_SUBTITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")}return this.isTeamEntity?"":this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")}},watch:{focusedNode(t){const e=this.departments.get(t)||{};if(!this.isEmployeeListOptionsSet){const n={page:0,shouldUpdateList:true,isListUpdated:false};U.updateEmployeeListOptions(t,n);this.departments.set(t,e)}if(e.employeeListOptions.page===0&&e.employeeListOptions.isListUpdated===false&&e.employeeListOptions.shouldUpdateList===true){this.loadEmployeesAction()}this.isDescriptionExpanded=false;this.searchQuery="";if(this.searchedUserId){this.needToFocusUserId=this.searchedUserId;this.$nextTick((()=>{this.scrollToUser()}))}},searchedUserId:{handler(t){if(!t){return}this.needToFocusUserId=t;if(this.isListUpdated){this.needToScroll=true}else{this.$nextTick((()=>{this.scrollToUser()}))}},immediate:true},async searchQuery(t){await this.searchMembers(t)},departmentUsersStatus(t,e){const{departmentId:n,loaded:s}=t;const{departmentId:i,loaded:a}=e;if(n===i&&s===a){return}if(s){this.$emit("hideDetailLoader")}else{this.$emit("showDetailLoader");this.loadEmployeesAction()}}},created(){this.loadEmployeesAction();this.clearSearchTimeout=null},mounted(){this.tabContainer=this.$refs["tab-container"]},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},getBadgeText(t){if(t===this.memberRoles.head){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE")}if(t===this.memberRoles.deputyHead){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_DEPUTY_HEAD_BADGE")}return null},updateList(t){const e=t.target;const n=e.scrollTop+e.clientHeight;if(e.scrollHeight-n<40){this.loadEmployeesAction()}},async loadEmployeesAction(){var t,e,n,s,i,a;const r=this.focusedNode;if(!this.departments.get(r)){return}const o=(t=this.departments.get(r).employeeListOptions)!=null?t:{};o.page=(e=o.page)!=null?e:0;o.shouldUpdateList=(n=o.shouldUpdateList)!=null?n:true;o.isListUpdated=(s=o.isListUpdated)!=null?s:false;U.updateEmployeeListOptions(r,o);if(o.isListUpdated||!o.shouldUpdateList){return}if(!o.isListUpdated&&o.page===0&&o.shouldUpdateList===true){this.$emit("showDetailLoader")}o.isListUpdated=true;o.page+=1;U.updateEmployeeListOptions(r,o);let c=await R.getPagedEmployees(r,o.page,25);if(!c){o.shouldUpdateList=false;o.isListUpdated=false;U.updateEmployeeListOptions(r,o);return}c=c.map((t=>({...t,role:this.memberRoles.employee})));const l=(i=(a=this.departments.get(r))==null?void 0:a.employees)!=null?i:[];const d=new Set(l.map((t=>t.id)));const _=c.reverse().filter((t=>!d.has(t.id)));l.unshift(..._);o.shouldUpdateList=_.length===25;o.isListUpdated=false;U.updateEmployeeListOptions(r,o);U.updateEmployees(r,l);if(this.departmentUsersStatus.loaded){this.$emit("hideDetailLoader")}if(this.needToScroll){this.scrollToUser()}},async scrollToUser(){const t=this.needToFocusUserId;this.needToFocusUserId=null;this.needToScroll=false;const e=`.hr-department-detail-content__user-container[data-id="hr-department-detail-content__user-${t}-item"]`;let n=this.tabContainer.querySelector(e);if(!n){let a=null;try{a=await R.getUserInfo(this.focusedNode,t)}catch{}const r=this.departments.get(this.focusedNode);if(!a||!r){return}if(a.role===this.memberRoles.head||a.role===this.memberRoles.deputyHead){var s;r.heads=(s=r.heads)!=null?s:[];if(!r.heads.some((t=>t.id===a.id))){return}}else{var i;r.employees=(i=r.employees)!=null?i:[];if(!r.employees.some((t=>t.id===a.id))){r.employees.push(a)}}await this.$nextTick((()=>{n=this.tabContainer.querySelector(e)}))}if(!n){return}n.scrollIntoView({behavior:"smooth",block:"center"});setTimeout((()=>{this.selectedUserId=t}),750);if(this.clearSearchTimeout){clearTimeout(this.clearSearchTimeout)}this.clearSearchTimeout=setTimeout((()=>{if(this.searchedUserId===t){this.selectedUserId=null;this.searchedUserId=null}}),4e3)},async searchMembers(t){if(t.length===0){return}this.findQueryResult=this.findQueryResult||{};this.findQueryResult[this.focusedNode]=this.findQueryResult[this.focusedNode]||{success:[],failure:[]};const e=this.findQueryResult[this.focusedNode];if(e.failure.some((e=>t.startsWith(e)))){return}if(e.success.includes(t)||e.failure.includes(t)){return}const n=await R.findMemberByQuery(this.focusedNode,t);if(n.length===0){e.failure.push(t);return}const s=this.departments.get(this.focusedNode);const i=n.filter((t=>!s.heads.some((e=>e.id===t.id))&&!s.employees.some((e=>e.id===t.id))));s.employees.push(...i);e.success.push(t)},searchUser(t){this.searchQuery=t},onHeadListActionMenuItemClick(t){this.headMenu.onActionMenuItemClick(t)},onEmployeeListActionMenuItemClick(t){this.employeeMenu.onActionMenuItemClick(t)},getHeadListDataTestIds(){return A},getEmployeeListDataTestIds(){return C}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --users" ref="tab-container">\n\t\t\t<template v-if="memberCount > 0">\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if="showSearchBar"\n\t\t\t\t\t:placeholder="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_SEARCH_PLACEHOLDER')"\n\t\t\t\t\t:value="searchQuery"\n\t\t\t\t\t@inputChange="searchUser"\n\t\t\t\t\tdataTestId="hr-department-detail-content_users-tab__users-search-input"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!showSearchEmptyState"\n\t\t\t\t\tv-on="shouldUpdateList ? { scroll: updateList } : {}"\n\t\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_LIST_TITLE')"\n\t\t\t\t\t\t:count="headCount"\n\t\t\t\t\t\t:menuItems="headMenu.items"\n\t\t\t\t\t\t:listItems="filteredHeads"\n\t\t\t\t\t\t:emptyItemTitle="headListEmptyStateTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__empty-user-list-item-image"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t:withAddPermission="canAddUsers"\n\t\t\t\t\t\t@tabListAction="onHeadListActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getHeadListDataTestIds()"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user="item"\n\t\t\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title="employeeTitle"\n\t\t\t\t\t\t:count="employeeCount"\n\t\t\t\t\t\t:menuItems="employeeMenu.items"\n\t\t\t\t\t\t:listItems="filteredEmployees"\n\t\t\t\t\t\t:emptyItemTitle="employeesListEmptyStateTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__empty-user-list-item-image"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t:withAddPermission="canAddUsers"\n\t\t\t\t\t\t@tabListAction="onEmployeeListActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getEmployeeListDataTestIds()"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user="item"\n\t\t\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState v-else\n\t\t\t\t\timageClass="hr-department-detail-content__empty-tab-user-not-found-icon"\n\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')"\n\t\t\t\t\t:description ="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState v-else\n\t\t\t\t:imageClass="canAddUsers \n\t\t\t\t\t? 'hr-department-detail-content__empty-tab-add-user-icon' \n\t\t\t\t\t: 'hr-department-detail-content__empty-tab-cant-add-user-icon'"\n\t\t\t\t:title="emptyStateTitle"\n\t\t\t\t:description ="emptyStateDescription"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButton v-if="canAddUsers" :departmentId="departmentId" :entityType="entityType"/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t</div>\n\t`};const L=Object.freeze({addChat:"addChat",linkChat:"linkChat",addChannel:"addChannel",linkChannel:"linkChannel"});const v=Object.freeze({id:L.linkChat,title:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_TITLE"),description:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_DESC"),bIcon:{name:l.Main.CHAT_MESSAGE,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__chat-list-action-link"});const g=Object.freeze({id:L.addChat,title:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_ADD_BUTTON_TITLE"),description:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_ADD_BUTTON_DESC"),bIcon:{name:l.Main.ADD_CHAT,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__chat-list-action-add"});const B=Object.freeze({id:L.linkChannel,title:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_TITLE"),description:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_DESC"),bIcon:{name:l.Main.SPEAKER_MOUTHPIECE,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__channel-list-action-link"});const H=Object.freeze({id:L.addChannel,title:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_ADD_BUTTON_TITLE"),description:u.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_ADD_BUTTON_DESC"),bIcon:{name:l.Main.SPEAKER_MOUTHPIECE_PLUS,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__channel-list-action-add"});const k=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__chat-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__chat-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__chat-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__chat-list-counter"});const Y=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__channel-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__channel-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__channel-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__channel-list-counter"});const w=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-chat-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-chat-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-chat-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-chat-close-button"});const x=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-channel-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-channel-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-channel-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-channel-close-button"});const F={name:"emptyStateButtons",emits:["emptyStateAddAction"],components:{RouteActionMenu:h.RouteActionMenu},data(){return{chatMenuVisible:false,channelMenuVisible:false,chatButtonId:"hr-empty-tab-chat-add-button",channelButtonId:"hr-empty-tab-chat-add-button"}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onChatButtonClick(){this.$emit("emptyStateAddAction",L.linkChat)},onChannelButtonClick(){this.$emit("emptyStateAddAction",L.linkChannel)}},template:`\n\t\t<div class="hr-department-detail-content__chat-empty-tab-add_buttons-container">\n\t\t\t<button\n\t\t\t\t:ref="chatButtonId"\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_chat-button"\n\t\t\t\t@click.stop="this.onChatButtonClick()"\n\t\t\t\tdata-test-id="hr-department-detail-content_chats-tab__empty-tab-add_chat-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --add-chat hr-department-detail-content__chat-empty-tab-add_chat-button-icon"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHAT_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:ref="channelButtonId"\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_channel-button"\n\t\t\t\t@click.stop="onChannelButtonClick()"\n\t\t\t\tdata-test-id="hr-department-detail-content_chats-tab__empty-tab-add_channel-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --speaker-mouthpiece-plus hr-department-detail-content__chat-empty-tab-add_chat-button-icon"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHANNEL_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t</div>\n\t`};const V={name:"chatListItem",props:{chat:{type:Object,required:true}},data(){return{avatar:null}},created(){this.prepareAvatar()},methods:{prepareAvatar(){if(this.chat.avatar){this.chat.color=E.getColorCode("whiteBase")}const t={size:32,userName:this.chat.title,baseColor:this.isExtranet()&&!this.chat.avatar?E.getColorCode("extranetColor"):this.chat.color,events:{click:()=>{this.onChatItemClick()}}};if(this.chat.avatar){t.userpicPath=this.chat.avatar}this.avatar=this.isChat()?new _.AvatarRound(t):new _.AvatarSquare(t)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onChatItemClick(){T.Messenger.openChat(this.chat.dialogId)},isChat(){return this.chat.type!=="CHANNEL"},isExtranet(){return this.chat.isExtranet}},template:`\n\t\t<div\n\t\t\t:key="chat.id"\n\t\t\tclass="hr-department-detail-content__tab-list_item-wrapper --chat"\n\t\t\t:class="{ '--isExtranet': isExtranet() }"\n\t\t\t:data-test-id="'hr-department-content_chats-tab__list_chat-item-' + chat.id"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="hr-department-detail-content__tab-list_item-avatar-container"\n\t\t\t\tv-html="this.avatar.getContainer().outerHTML"\n\t\t\t\t@click="onChatItemClick"\n\t\t\t/>\n\t\t\t<div class="hr-department-detail-content__tab-list_item-text-container">\n\t\t\t\t<div class="hr-department-detail-content__tab-list_item-title-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_item-title"\n\t\t\t\t\t\t:data-test-id="'hr-department-content_chats-tab__list_chat-item-' + chat.id + '-title'"\n\t\t\t\t\t\t@click="onChatItemClick"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ chat.title }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__tab-list_item-subtitle">\n\t\t\t\t\t{{ chat.subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="hr-department-detail-content__tab-list_item-action-btn --chat-item-action-btn ui-icon-set --arrow-right"\n\t\t\t\t@click="onChatItemClick"\n\t\t\t/>\n\t\t</div>\n\t`};const $={name:"chatsTab",components:{SearchInput:D,TabList:P,EmptyState:I,EmptyTabAddButtons:F,ChatListItem:V,ManagementDialog:h.ManagementDialog},data(){return{chatMenuItems:[],channelMenuItems:[],isChatLinkActive:false,chatLinkDialogVisible:false,isChannelLinkActive:false,channelLinkDialogVisible:false,isLoading:false,searchQuery:""}},created(){this.loadChatAction();this.chatMenuItems=this.getChatListMenuItems();this.channelMenuItems=this.getChannelListMenuItems()},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},searchChatOrChannel(t){this.searchQuery=t},async loadChatAction(t){var e,n;const s=this.focusedNode;const i=this.departments.get(s);if(!i){return}if(!t&&u.Type.isArray(i.chats)&&u.Type.isArray(i.channels)){return}if(this.isLoading){return}this.isLoading=true;this.$emit("showDetailLoader");const a=await R.getChatsAndChannels(s);U.setChatsAndChannels(s,(e=a.chats)!=null?e:[],(n=a.channels)!=null?n:[]);this.$emit("hideDetailLoader");this.isLoading=false},getChatListMenuItems(){return[v]},getChannelListMenuItems(){return[B]},onActionMenuItemClick(t){if(t===L.linkChat){this.chatLinkDialogVisible=true}if(t===L.linkChannel){this.channelLinkDialogVisible=true}},getAddEmptyStateList(){let t=[];if(this.isTeamEntity){t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_3")]}else{t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_3")]}return t.map((t=>({text:t})))},getChatListDataTestIds(){return k},getChannelListDataTestIds(){return Y},getChatLinkDialogEntities(){const t=h.getChatDialogEntity();t.options.excludeIds=this.chats.map((t=>t.id));return[t]},getChannelLinkDialogEntities(){const t=h.getChannelDialogEntity();t.options.excludeIds=this.channels.map((t=>t.id));return[t]},getChatLinkRecentTabOptions(){return h.getChatRecentTabOptions(this.teamEntity,h.ChatTypeDict.chat)},getChannelLinkRecentTabOptions(){return h.getChatRecentTabOptions(this.teamEntity,h.ChatTypeDict.channel)},async linkChats(t){this.isChatLinkActive=true;const e=t.map((t=>Number(t.id.replace("chat",""))));const n=this.focusedNode;const s={chat:e};try{await R.saveChats(n,s)}catch{}this.isChatLinkActive=false;this.chatLinkDialogVisible=false;this.loadChatAction(true)},async linkChannel(t){this.isChannelLinkActive=true;const e=t.map((t=>Number(t.id.replace("chat",""))));const n=this.focusedNode;const s={channel:e};try{await R.saveChats(n,s)}catch{}this.isChannelLinkActive=false;this.channelLinkDialogVisible=false;this.loadChatAction(true)},getChatLinkDialogDataTestIds(){return w},getChannelLinkDialogDataTestIds(){return x}},computed:{chats(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chats)!=null?t:[]},channels(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.channels)!=null?t:[]},filteredChats(){return this.chats.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},filteredChannels(){return this.channels.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},showAddEmptyState(){return this.chats.length===0&&this.channels.length===0},showSearchEmptyState(){return this.filteredChats.length===0&&this.filteredChannels.length===0},getLinkedChatIds(){return this.chats.map((t=>`chat${t.id}`))},getLinkedChannelIds(){return this.channels.map((t=>`chat${t.id}`))},isChatsLoaded(){const t=this.departments.get(this.focusedNode);return Boolean(u.Type.isArray(t.chats)&&u.Type.isArray(t.channels))},teamEntity(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.teamEntity===E.EntityTypes.team},getAddEmptyStateTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TITLE")},getAddChatDescription(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TEAM_DESC"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_DESC")},getAddChannelDescription(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TEAM_DESC"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_DESC")},...p.mapState(m.useChartStore,["focusedNode","departments"])},watch:{isChatsLoaded(t){if(t===false){this.loadChatAction()}}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --chat">\n\t\t\t<template v-if="!showAddEmptyState">\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_SEARCH_INPUT_PLACEHOLDER')"\n\t\t\t\t\t:value="searchQuery"\n\t\t\t\t\t@inputChange="searchChatOrChannel"\n\t\t\t\t\tdataTestId="hr-department-detail-content_chats-tab__chats-and-channels-search-input"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!showSearchEmptyState"\n\t\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_TITLE')"\n\t\t\t\t\t\t:count="chats.length"\n\t\t\t\t\t\t:menuItems="chatMenuItems"\n\t\t\t\t\t\t:listItems="filteredChats"\n\t\t\t\t\t\t:emptyItemTitle="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_TEXT')"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__chat-empty-tab-list-item_tab-icon"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getChatListDataTestIds()"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<ChatListItem :chat="item"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_TITLE')"\n\t\t\t\t\t\t:count="channels.length"\n\t\t\t\t\t\t:menuItems="channelMenuItems"\n\t\t\t\t\t\t:listItems="filteredChannels"\n\t\t\t\t\t\t:emptyItemTitle="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_TEXT')"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__chat-empty-tab-list-item_tab-icon"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getChannelListDataTestIds()"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<ChatListItem :chat="item"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState \n\t\t\t\t\tv-else\n\t\t\t\t\timageClass="hr-department-detail-content__empty-tab-search_tab-icon"\n\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')"\n\t\t\t\t\t:description ="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState \n\t\t\t\tv-else\n\t\t\t\timageClass="hr-department-detail-content__chat-empty-tab-add_tab-icon"\n\t\t\t\t:title="getAddEmptyStateTitle"\n\t\t\t\t:list="getAddEmptyStateList()"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButtons\n\t\t\t\t\t\t@emptyStateAddAction="onActionMenuItemClick"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if="chatLinkDialogVisible"\n\t\t\t\tid="hr-department-detail-content-chats-tab-chat-link-dialog"\n\t\t\t\t:entities="getChatLinkDialogEntities()"\n\t\t\t\t:recentTabOptions="getChatLinkRecentTabOptions()"\n\t\t\t\t:hiddenItemsIds="getLinkedChatIds"\n\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TITLE')"\n\t\t\t\t:description="getAddChatDescription"\n\t\t\t\t:isActive="isChatLinkActive"\n\t\t\t\t@managementDialogAction="linkChats"\n\t\t\t\t@close="chatLinkDialogVisible = false"\n\t\t\t\t:dataTestIds="getChatLinkDialogDataTestIds()"\n\t\t\t/>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if="channelLinkDialogVisible"\n\t\t\t\tid="hr-department-detail-content-chats-tab-channel-link-dialog"\n\t\t\t\t:entities="getChannelLinkDialogEntities()"\n\t\t\t\t:recentTabOptions="getChannelLinkRecentTabOptions()"\n\t\t\t\t:hiddenItemsIds="getLinkedChannelIds"\n\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TITLE')"\n\t\t\t\t:description="getAddChannelDescription"\n\t\t\t\t:isActive="isChannelLinkActive"\n\t\t\t\t@managementDialogAction="linkChannel"\n\t\t\t\t@close="channelLinkDialogVisible = false"\n\t\t\t\t:dataTestIds="getChannelLinkDialogDataTestIds()"\n\t\t\t/>\n\t\t</div>\n\t`};const q={name:"departmentContent",components:{UsersTab:b,ChatsTab:$},props:{isCollapsed:Boolean},emits:["showDetailLoader","hideDetailLoader","editEmployee"],data(){return{activeTab:"usersTab",tabs:[{name:"usersTab",component:"UsersTab",id:"users-tab"},{name:"chatsTab",component:"ChatsTab",id:"chats-tab"}],isDescriptionOverflowed:false,isDescriptionExpanded:false}},computed:{...p.mapState(m.useChartStore,["focusedNode","departments"]),activeTabComponent(){const t=this.tabs.find((t=>t.name===this.activeTab));return t?t.component:null},usersCount(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.userCount)!=null?t:0},chatAndChannelsCount(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chatAndChannelsCount)!=null?t:null},tabArray(){return this.tabs.map((t=>{if(t.name==="usersTab"){return{...t,count:this.usersCount}}if(t.name==="chatsTab"){return{...t,count:this.chatAndChannelsCount}}return t}))},description(){const t=this.departments.get(this.focusedNode);if(!t.description){return null}return t.description}},watch:{description(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))},focusedNode(){this.isDescriptionExpanded=false;this.selectTab("usersTab")},isCollapsed(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},selectTab(t){this.activeTab=t},getTabLabel(t){if(t==="usersTab"){var e;return((e=this.departments.get(this.focusedNode))==null?void 0:e.entityType)===E.EntityTypes.team?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_TEAM_USERS_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TITLE")}if(t==="chatsTab"){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE")}return""},toggleDescriptionExpand(){this.isDescriptionExpanded=!this.isDescriptionExpanded},checkDescriptionOverflowed(){var t;const e=(t=this.$refs.descriptionContainer)!=null?t:null;if(e){return e.scrollHeight>e.clientHeight}return false},hideDetailLoader(){this.$emit("hideDetailLoader");this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))}},template:`\n\t\t<div class="hr-department-detail-content hr-department-detail-content__scope">\n\t\t\t<div\n\t\t\t\tref="descriptionContainer"\n\t\t\t\tv-show="description"\n\t\t\t\t:class="[\n\t\t\t\t\t'hr-department-detail-content-description',\n\t\t\t\t\t{ '--expanded': isDescriptionExpanded },\n\t\t\t\t\t{ '--overflowed': isDescriptionOverflowed},\n\t\t\t\t]"\n\t\t\t\tv-on="isDescriptionOverflowed ? { click: toggleDescriptionExpand } : {}"\n\t\t\t>\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab-list">\n\t\t\t\t<button\n\t\t\t\t\tv-for="tab in tabArray"\n\t\t\t\t\t:key="tab.name"\n\t\t\t\t\tclass="hr-department-detail-content__tab-item"\n\t\t\t\t\t:class="[{'--active-tab' : activeTab === tab.name}]"\n\t\t\t\t\t@click="selectTab(tab.name)"\n\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_button' : null"\n\t\t\t\t>\n\t\t\t\t\t{{ this.getTabLabel(tab.name) }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-count"\n\t\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_counter' : null"\n\t\t\t\t\t>{{ tab.count }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<component\n\t\t\t\tv-if="activeTab === 'usersTab'"\n\t\t\t\t:is="activeTabComponent"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t\t<component\n\t\t\t\tv-if="activeTab === 'chatsTab'"\n\t\t\t\t:is="activeTabComponent"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t</div>\n\t`};t.DepartmentContent=q})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.UI.EntitySelector,BX,BX.UI,BX.UI,BX.UI.IconSet,BX,BX.UI,BX.Messenger.v2.Lib,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.Vue3.Pinia);
//# sourceMappingURL=department-content.bundle.map.js