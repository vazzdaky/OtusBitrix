this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(e,t,r,s){"use strict";const i=e=>{const t=new Map;e.forEach((e=>{var r,i,n;const{id:a,parentId:o,colorName:u,entityType:c}=e;const l=(r=t.get(a))!=null?r:{};const m=s.getNodeColorSettings(u,c);t.set(a,{...l,...e,teamColor:m});if(o===0){return}const p=(i=t.get(o))!=null?i:{};const d=(n=p.children)!=null?n:[];t.set(o,{...p,children:[...d,a]})}));return t};const n={removeDepartment:e=>t.getData("humanresources.api.Structure.Node.delete",{nodeId:e}),getDepartmentsData:()=>t.getData("humanresources.api.Structure.get",{},{tool:"structure",category:"structure",event:"open_structure"}),getCurrentDepartments:()=>t.getData("humanresources.api.Structure.Node.current"),getDictionary:()=>t.getData("humanresources.api.Structure.dictionary"),getUserId:()=>t.getData("humanresources.api.User.getCurrentId"),firstTimeOpened:()=>t.postData("humanresources.api.User.firstTimeOpen"),createTreeDataStore:i};const a=Object.freeze({structureView:"ACTION_STRUCTURE_VIEW",departmentCreate:"ACTION_DEPARTMENT_CREATE",departmentDelete:"ACTION_DEPARTMENT_DELETE",departmentEdit:"ACTION_DEPARTMENT_EDIT",employeeAddToDepartment:"ACTION_EMPLOYEE_ADD_TO_DEPARTMENT",employeeRemoveFromDepartment:"ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT",employeeFire:"ACTION_FIRE_EMPLOYEE",accessEdit:"ACTION_USERS_ACCESS_EDIT",teamAccessEdit:"ACTION_TEAM_ACCESS_EDIT",inviteToDepartment:"ACTION_USER_INVITE",teamView:"ACTION_TEAM_VIEW",teamCreate:"ACTION_TEAM_CREATE",teamEdit:"ACTION_TEAM_EDIT",teamDelete:"ACTION_TEAM_DELETE",teamAddMember:"ACTION_TEAM_MEMBER_ADD",teamRemoveMember:"ACTION_TEAM_MEMBER_REMOVE",teamSettingsEdit:"ACTION_TEAM_SETTINGS_EDIT"});const o=Object.freeze({fullCompany:30,selfAndSub:20,self:10,none:0});var u=babelHelpers.classPrivateFieldLooseKey("isTeamAction");var c=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfTeamAction");var l=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfDepartmentAction");var m=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfTeamActionByTeamPermission");var p=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfTeamActionByDepartmentPermission");class d{constructor(){Object.defineProperty(this,p,{value:A});Object.defineProperty(this,m,{value:E});Object.defineProperty(this,l,{value:h});Object.defineProperty(this,c,{value:T});Object.defineProperty(this,u,{value:f});if(!d.instance){this.currentUserPermissions={};this.permissionVariablesDictionary=[];this.isTeamsAvailable=false;this.isInitialized=false;d.instance=this}return d.instance}getInstance(){return d.instance}async init(){if(this.isInitialized){return}const{currentUserPermissions:e,permissionVariablesDictionary:t,teamsAvailable:r}=await n.getDictionary();this.currentUserPermissions=e;this.permissionVariablesDictionary=t;this.isTeamsAvailable=r;this.isInitialized=true}hasPermission(e,t,r=o.none){const s=this.currentUserPermissions[e];if(!s||t===0){return false}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)){if(!this.isTeamsAvailable){return false}return babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,t,e)}return babelHelpers.classPrivateFieldLooseBase(this,l)[l](s,t,e,r)}hasPermissionWithAnyNode(e){const t=this.currentUserPermissions[e];if(!t){return false}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)){if(!this.isTeamsAvailable){return false}return t.TEAM>o.none||t.DEPARTMENT>o.none}return t>o.none}hasPermissionOfAction(e){if(babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)){return this.hasPermissionWithAnyNode(e)}return this.currentUserPermissions[e]!==undefined&&this.currentUserPermissions[e]!==null&&this.currentUserPermissions[e]!==o.none}}function f(e){const t=[a.teamView,a.teamCreate,a.teamEdit,a.teamDelete,a.teamAddMember,a.teamRemoveMember,a.teamSettingsEdit];return t.includes(e)}function T(e,t,i){if(e.TEAM===o.fullCompany){const e=r.useChartStore().departments;const n=e.get(t);if(i===a.teamCreate&&n.entityType===s.EntityTypes.department){return this.hasPermission(a.structureView,n.id)}return true}if(babelHelpers.classPrivateFieldLooseBase(this,m)[m](t,e.TEAM)){return true}return babelHelpers.classPrivateFieldLooseBase(this,p)[p](t,e.DEPARTMENT,i)}function h(e,t,i,n){const u=this.permissionVariablesDictionary.find((t=>t.id===e));if(!u){return false}const c=r.useChartStore().departments;if(i===a.departmentDelete){const e=[...c.values()].find((e=>e.parentId===0)).id;if(t===e){return false}}const l=r.useChartStore().currentDepartments;const m=new Set(l.filter((e=>{const t=c.get(e);return t&&t.entityType===s.EntityTypes.department})));if(u.id<n){return false}switch(u.id){case o.fullCompany:return true;case o.selfAndSub:{if(m.has(t)){return true}let e=c.get(t);while(e){if(m.has(e.id)){return true}e=c.get(e.parentId)}return false}case o.self:return m.has(t);case o.none:default:return false}}function E(e,t=o.none){if(t===o.none){return false}const i=r.useChartStore().departments;const n=r.useChartStore().currentDepartments;const a=new Set(n.filter((e=>{const t=i.get(e);return t&&t.entityType===s.EntityTypes.team})));if(a.has(e)){return true}if(t===o.self){return false}let u=i.get(e);while(u){if(u.entityType===s.EntityTypes.department){return false}if(a.has(u.id)){return true}u=i.get(u.parentId)}return false}function A(e,t=o.none,i=""){if(t===o.none){return false}const n=r.useChartStore().departments;const u=r.useChartStore().currentDepartments;const c=new Set(u.filter((e=>{const t=n.get(e);return t&&t.entityType===s.EntityTypes.department})));if(c.has(e)){return true}let l=n.get(e);while(l){if(c.has(l.id)){return true}if(t===o.self&&l.type===s.EntityTypes.department){if(i===a.teamCreate){return this.hasPermission(a.structureView,l.id)&&c.has(l.id)}return false}l=n.get(l.parentId)}return false}const y=new d;e.PermissionActions=a;e.PermissionLevels=o;e.PermissionCheckerClass=d;e.PermissionChecker=y})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=checker.bundle.map.js