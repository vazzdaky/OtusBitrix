this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(e,s,t,i,r,o,a,l){"use strict";const n={getDepartmentName:e=>{const{departments:s}=a.useChartStore();const t=s.get(e);if(!t){return""}return t.name},moveUsersToDepartment:(e,s,t,i)=>{var r;const o=a.useChartStore();const l=o.departments.get(e);if(!l){return}const n=new Set(s.map((e=>e.id)));const d=((r=l.employees)!=null?r:[]).filter((e=>!n.has(e.id)));const c=new Set(l.heads.map((e=>e.id)));const h=s.filter((e=>!c.has(e.id)));d.push(...h);l.employees=d;l.userCount=t;if(i.length>0){void o.refreshDepartments(i)}},addUsersToDepartment:(e,s,t,i)=>{var r,o;const n=a.useChartStore();const d=n.departments.get(e);if(!d){return}const c=l.getMemberRoles(d.entityType);const h=new Set(s.map((e=>e.id)));if(h.has(n.userId)){n.changeCurrentDepartment(0,d.id)}const E=((r=d.heads)!=null?r:[]).filter((e=>!h.has(e.id)));const u=((o=d.employees)!=null?o:[]).filter((e=>!h.has(e.id)));(i===c.employee?u:E).push(...s);d.heads=E;d.employees=u;d.userCount=t}};const d={moveUsersToDepartment:(e,s)=>l.postData("humanresources.api.Structure.Node.Member.moveUserListToDepartment",{nodeId:e,userIds:s}),addUsersToDepartment:(e,s,t)=>l.postData("humanresources.api.Structure.Node.Member.addUserMember",{nodeId:e,userIds:s,roleXmlId:t})};const c=["add","move"];let h=e=>e,E;const u="ui-btn-disabled";var p=babelHelpers.classPrivateFieldLooseKey("handleOnTagAdd");var _=babelHelpers.classPrivateFieldLooseKey("handleOnTagRemove");var b=babelHelpers.classPrivateFieldLooseKey("onUserToggle");var m=babelHelpers.classPrivateFieldLooseKey("toggleAddButton");var v=babelHelpers.classPrivateFieldLooseKey("setConfirmButtonText");var T=babelHelpers.classPrivateFieldLooseKey("saveUsers");class R extends i.BaseFooter{constructor(e,s){var i,o,a;super(e,s);Object.defineProperty(this,T,{value:U});Object.defineProperty(this,v,{value:S});Object.defineProperty(this,m,{value:y});Object.defineProperty(this,b,{value:A});Object.defineProperty(this,_,{value:M});Object.defineProperty(this,p,{value:g});this.nodeId=this.getOption("nodeId");if(!t.Type.isInteger(this.nodeId)){throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}this.entityType=(i=this.getOption("entityType"))!=null?i:r.EntityTypes.team;this.memberRoles=l.getMemberRoles(this.entityType);this.role=(o=this.getOption("role"))!=null?o:this.memberRoles.employee;const n=(a=this.getOption("type"))!=null?a:"";if(t.Type.isString(n)&&c.includes(n)){this.type=n}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}babelHelpers.classPrivateFieldLooseBase(this,v)[v]();const d=this.getDialog().getSelectedItems();this.userCount=d.length;this.users=[];d.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b](e)}));this.getDialog().subscribe("Item:onSelect",babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this));this.getDialog().subscribe("Item:onDeselect",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}render(){var e;const{footer:s,footerAddButton:i,footerCloseButton:r}=t.Tag.render(E||(E=h`
			<div ref="footer" class="hr-user-management-dialog__footer">
				<button ref="footerAddButton" class="ui-btn ui-btn ui-btn-sm ui-btn-primary ${0} ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
				<button ref="footerCloseButton" class="ui-btn ui-btn ui-btn-sm ui-btn-light-border ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
			</div>
		`),this.users.length===0?u:"",(e=this.confirmButtonText)!=null?e:"",t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_CANCEL_BUTTON"));this.footerAddButton=i;t.Event.bind(r,"click",(e=>{this.dialog.hide()}));t.Event.bind(i,"click",(e=>{const s=this.dialog.getSelectedItems();const r=s.map((e=>e.getId()));if(r.length>0){t.Dom.addClass(i,"ui-btn-wait");this.action(r)}}));return s}destroyDialog(){this.isInProcess=false;this.getDialog().destroy()}async action(e){if(!this.userCount||this.isInProcess){return}this.isInProcess=true;const s=this.type==="move"?{[this.memberRoles.employee]:e}:e;const t=await babelHelpers.classPrivateFieldLooseBase(this,T)[T](s).catch((()=>{}));if(!t){this.destroyDialog();return}if(this.type==="add"){var i,r;n.addUsersToDepartment(this.nodeId,this.users,(i=t.userCount)!=null?i:0,(r=this.role)!=null?r:this.memberRoles.employee)}if(this.type==="move"){var o,a;n.moveUsersToDepartment(this.nodeId,this.users,(o=t.userCount)!=null?o:0,(a=t.updatedDepartmentIds)!=null?a:[])}const l=this.getNotificationMessageCode();if(l){this.showNotification(l)}this.destroyDialog()}showNotification(e){const s=n.getDepartmentName(this.nodeId);o.UI.Notification.Center.notify({content:t.Text.encode(t.Loc.getMessage(e,{"#DEPARTMENT#":s})),autoHideDelay:2e3})}getNotificationMessageCode(){if(this.type==="add"){if(this.users.length>1){if(this.entityType===r.EntityTypes.team){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_USER_ADD_EMPLOYEES_MESSAGE")}else{this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEES_MESSAGE")}}if(this.users.length===1){if(this.entityType===r.EntityTypes.team){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_USER_ADD_EMPLOYEE_MESSAGE")}else{this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEE_MESSAGE")}}}if(this.type==="move"){if(this.users.length>1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEES_MESSAGE")}if(this.users.length===1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEE_MESSAGE")}}return null}}function g(e){const{item:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,b)[b](s)}function M(e){const{item:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,b)[b](s,false)}function A(e,s=true){if(!s){this.users=this.users.filter((s=>s.id!==e.id));this.userCount-=1;babelHelpers.classPrivateFieldLooseBase(this,m)[m]();return}const t=r.getUserDataBySelectorItem(e,this.role);this.users=[...this.users,t];this.userCount+=1;babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}function y(){if(this.userCount===0){t.Dom.addClass(this.footerAddButton,u);return}t.Dom.removeClass(this.footerAddButton,u)}function S(){if(this.type==="move"){this.confirmButtonText=t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_CONFIRM_BUTTON");return}if(this.type==="add"){this.confirmButtonText=t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_CONFIRM_BUTTON");return}this.confirmButtonText=""}function U(e){if(this.type==="move"){return d.moveUsersToDepartment(this.nodeId,e)}return d.addUsersToDepartment(this.nodeId,e,this.role)}let O=e=>e,L,P,f,N,C;var D=babelHelpers.classPrivateFieldLooseKey("addRoleSwitcher");var H=babelHelpers.classPrivateFieldLooseKey("toggleRoleSwitcherMenu");var B=babelHelpers.classPrivateFieldLooseKey("changeRole");class I extends i.BaseHeader{constructor(e,s){var i,r,o,a;super(e,s);Object.defineProperty(this,B,{value:G});Object.defineProperty(this,H,{value:w});Object.defineProperty(this,D,{value:F});this.tiltle=t.Text.encode((i=this.getOption("title"))!=null?i:"");this.description=t.Text.encode((r=this.getOption("description"))!=null?r:"");this.memberRoles=(o=this.getOption("memberRoles"))!=null?o:l.memberRoles;this.role=(a=this.getOption("role"))!=null?a:this.memberRoles.employee}render(){const{header:e,headerCloseButton:s}=t.Tag.render(L||(L=O`
			<div ref="header" class="hr-user-management-dialog__header">
				<div ref="headerCloseButton" class="hr-user-management-dialog__header-close_button"></div>
				<span class="hr-user-management-dialog__header-title">
					${0}
				</span>
			</div>
		`),this.tiltle);t.Event.bind(s,"click",(()=>{this.getDialog().hide()}));this.header=e;if(this.role===this.memberRoles.employee){const e=t.Tag.render(P||(P=O`
				<span class="hr-user-management-dialog__header-description">
					${0}
				</span>
			`),this.description);t.Dom.append(e,this.header)}else{babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}return e}}function F(){const{roleSwitcherContainer:e,roleSwitcher:s}=t.Tag.render(f||(f=O`
			<div ref="roleSwitcherContainer" class="hr-user-management-dialog__role_switcher-container">
				<span class="hr-user-management-dialog__role_switcher_title">
					${0}
					</span>
				<div ref="roleSwitcher" class="hr-user-management-dialog__role_switcher">
					${0}
				</div>
			</div>
		`),t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ROLE_PICKER_TEXT"),t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE"));t.Dom.append(e,this.header);this.roleSwitcher=s;t.Event.bind(this.roleSwitcher,"click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H]()}))}function w(){const e=`${this.getDialog().id}-role-switcher`;const i=s.PopupManager.getPopupById(e);if(i){i.destroy();return}const r=new s.Menu({id:e,bindElement:this.roleSwitcher,autoHide:true,closeByEsc:true,maxWidth:263,events:{onPopupDestroy:()=>{t.Dom.removeClass(this.roleSwitcher,"--focused")}}});const o=[{html:t.Tag.render(N||(N=O`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-head"
					>
						${0}
					</div>
				`),t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE")),onclick:()=>{this.roleSwitcher.innerText=t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE");babelHelpers.classPrivateFieldLooseBase(this,B)[B](this.memberRoles.head);r.destroy()}},{html:t.Tag.render(C||(C=O`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-deputy"
					>
						${0}
					</div>
				`),t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_DEPUTY_ROLE_TITLE")),onclick:()=>{this.roleSwitcher.innerText=t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_DEPUTY_ROLE_TITLE");babelHelpers.classPrivateFieldLooseBase(this,B)[B](this.memberRoles.deputyHead);r.destroy()}}];o.forEach((e=>r.addMenuItem(e)));if(r.isShown){r.destroy();return}r.show();t.Dom.addClass(this.roleSwitcher,"--focused")}function G(e){const s=this.getDialog().getFooter().getOptions();s.role=e;this.getDialog().setFooter(R,s)}const Y="hr-user-management-dialog";var j=babelHelpers.classPrivateFieldLooseKey("dialog");var K=babelHelpers.classPrivateFieldLooseKey("nodeId");var x=babelHelpers.classPrivateFieldLooseKey("type");var X=babelHelpers.classPrivateFieldLooseKey("role");var $=babelHelpers.classPrivateFieldLooseKey("entityType");var V=babelHelpers.classPrivateFieldLooseKey("memberRoles");var k=babelHelpers.classPrivateFieldLooseKey("createDialog");var W=babelHelpers.classPrivateFieldLooseKey("getTitleByTypeAndRoleAndEntity");var q=babelHelpers.classPrivateFieldLooseKey("getDescriptionByTypeRoleAndEntity");class z{constructor(e){Object.defineProperty(this,q,{value:Z});Object.defineProperty(this,W,{value:Q});Object.defineProperty(this,k,{value:J});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,x,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});if(t.Type.isInteger(e.nodeId)){babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e.nodeId}else{throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}if(t.Type.isString(e.type)&&c.includes(e.type)){babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e.type}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}if(t.Type.isString(e.entityType)&&Object.values(r.EntityTypes).includes(e.entityType)){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e.entityType;if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]===r.EntityTypes.team){babelHelpers.classPrivateFieldLooseBase(this,x)[x]="add"}}else{babelHelpers.classPrivateFieldLooseBase(this,$)[$]=r.EntityTypes.department}babelHelpers.classPrivateFieldLooseBase(this,V)[V]=l.getMemberRoles(babelHelpers.classPrivateFieldLooseBase(this,$)[$]);if(Object.values(babelHelpers.classPrivateFieldLooseBase(this,V)[V]).includes(e.role)){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=e.role}else{babelHelpers.classPrivateFieldLooseBase(this,X)[X]=babelHelpers.classPrivateFieldLooseBase(this,V)[V].employee}this.id=`${Y}-${babelHelpers.classPrivateFieldLooseBase(this,x)[x]}`;this.title=babelHelpers.classPrivateFieldLooseBase(this,W)[W](babelHelpers.classPrivateFieldLooseBase(this,x)[x],babelHelpers.classPrivateFieldLooseBase(this,X)[X],babelHelpers.classPrivateFieldLooseBase(this,$)[$]);this.description=babelHelpers.classPrivateFieldLooseBase(this,q)[q](babelHelpers.classPrivateFieldLooseBase(this,x)[x],babelHelpers.classPrivateFieldLooseBase(this,X)[X],babelHelpers.classPrivateFieldLooseBase(this,$)[$]);babelHelpers.classPrivateFieldLooseBase(this,k)[k]()}static openDialog(e){const s=new z(e);s.show()}show(){babelHelpers.classPrivateFieldLooseBase(this,j)[j].show()}}function J(){babelHelpers.classPrivateFieldLooseBase(this,j)[j]=new i.Dialog({id:this.id,width:400,height:511,multiple:true,cacheable:false,dropdownMode:true,compactView:false,enableSearch:true,showAvatars:true,autoHide:false,header:I,headerOptions:{title:this.title,role:babelHelpers.classPrivateFieldLooseBase(this,X)[X],description:this.description,memberRoles:babelHelpers.classPrivateFieldLooseBase(this,V)[V]},footer:R,footerOptions:{nodeId:babelHelpers.classPrivateFieldLooseBase(this,K)[K],role:babelHelpers.classPrivateFieldLooseBase(this,X)[X],type:babelHelpers.classPrivateFieldLooseBase(this,x)[x],entityType:babelHelpers.classPrivateFieldLooseBase(this,$)[$]},popupOptions:{overlay:{opacity:40}},entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]})}function Q(e,s,i){if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,V)[V].employee&&i===r.EntityTypes.team){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_EMPLOYEE_TITLE")}if(e==="move"&&s===babelHelpers.classPrivateFieldLooseBase(this,V)[V].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_TITLE")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,V)[V].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_TITLE")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,V)[V].head){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_HEAD_TITLE")}return""}function Z(e,s,i){if(e==="add"&&i===r.EntityTypes.team){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_EMPLOYEE_DESCRIPTION")}if(e==="move"&&s===babelHelpers.classPrivateFieldLooseBase(this,V)[V].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_DESCRIPTION")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,V)[V].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_DESCRIPTION")}return""}e.UserManagementDialog=z})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Main,BX,BX.UI.EntitySelector,BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=user-management-dialog.bundle.map.js