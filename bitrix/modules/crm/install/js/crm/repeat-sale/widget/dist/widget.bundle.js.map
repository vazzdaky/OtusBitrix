{"version":3,"file":"widget.bundle.js","sources":["../src/content/base.js","../src/footer.js","../src/content/start.js","../src/content/statistics.js","../src/content-factory.js","../src/widget.js"],"sourcesContent":["import { ajax as Ajax, Dom, Loc, Tag, Type } from 'main.core';\nimport 'ui.design-tokens';\nimport type { PopupOptions } from 'main.popup';\nimport { Popup } from 'main.popup';\nimport { Confetti } from 'ui.confetti';\nimport { Lottie } from 'ui.lottie';\nimport { UI } from 'ui.notification';\nimport type { WidgetParams, WidgetTypeEnum } from '../widget';\n\nexport class Base\n{\n\t#data: ?Object = null;\n\t#popup: ?Popup = null;\n\t#bindElement: ?HTMLElement = null;\n\t#isConfettiShowed: boolean = true;\n\tparams: WidgetParams = {};\n\n\tconstructor(params: WidgetParams = {})\n\t{\n\t\tthis.params = params;\n\n\t\tif (Type.isBoolean(this.params.showConfetti))\n\t\t{\n\t\t\tthis.#isConfettiShowed = !this.params.showConfetti;\n\t\t}\n\t}\n\n\tgetType(): WidgetTypeEnum\n\t{\n\t\tthrow new Error('Must be implement in child class');\n\t}\n\n\tasync show(forceShowConfetti: boolean = false): void\n\t{\n\t\tconst data = await this.getData();\n\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = new Popup(this.getPopupParams(data, { forceShowConfetti }));\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\tgetPopupParams(data: Object, params: Object = {}): PopupOptions\n\t{\n\t\tconst hasParentButton = Boolean(this.#bindElement.closest('button'));\n\t\tconst hasParentLink = Boolean(this.#bindElement.closest('a'));\n\n\t\tlet bindElement = this.#bindElement;\n\t\tif (hasParentButton)\n\t\t{\n\t\t\tbindElement = this.#bindElement.closest('button');\n\t\t}\n\t\telse if (hasParentLink)\n\t\t{\n\t\t\tbindElement = this.#bindElement.closest('a');\n\t\t}\n\n\t\tconst bindElementRect = bindElement.getBoundingClientRect();\n\n\t\treturn {\n\t\t\tid: `crm_repeat_sale_widget_${this.getType()}`,\n\t\t\tbindElement: {\n\t\t\t\ttop: bindElementRect.top + bindElementRect.height + 10,\n\t\t\t\tleft: bindElementRect.right - 410,\n\t\t\t},\n\t\t\tcontent: this.getPopupContent(data),\n\t\t\tcacheable: false,\n\t\t\tisScrollBlock: true,\n\t\t\tclassName: `crm-repeat-sale-widget-popup --${this.getType()}`,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\tpadding: 16,\n\t\t\twidth: 410,\n\t\t\tmaxHeight: 500,\n\t\t\toverlay: null,\n\t\t\tautoHide: true,\n\t\t\tevents: {\n\t\t\t\tonclose: () => {\n\t\t\t\t\tthis.onClose();\n\t\t\t\t},\n\t\t\t\tonFirstShow: () => {\n\t\t\t\t\tif (this.#isConfettiShowed && params?.forceShowConfetti !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.#showConfetti();\n\t\t\t\t\t\tthis.#isConfettiShowed = true;\n\t\t\t\t\t}, 100);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPopupContent(data: Object): HTMLElement\n\t{\n\t\tthrow new Error('Must be implement in child class');\n\t}\n\n\tsetPopupContent(content: HTMLElement): void\n\t{\n\t\tthis.#popup.setContent(content);\n\t}\n\n\tonClose(): void\n\t{\n\t\tif (this.params.showConfetti)\n\t\t{\n\t\t\tvoid Ajax.runAction('crm.repeatsale.widget.incrementShowedConfettiCount');\n\t\t}\n\n\t\tthis.#popup = null;\n\t}\n\n\t#showConfetti(): void\n\t{\n\t\tconst container = this.#popup?.getPopupContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet canvas = null;\n\n\t\tif (container.getElementsByTagName('canvas').length === 0)\n\t\t{\n\t\t\tcanvas = Tag.render`<canvas></canvas>`;\n\n\t\t\tDom.style(canvas, {\n\t\t\t\tposition: 'fixed',\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0,\n\t\t\t\tpointerEvents: 'none',\n\t\t\t\tzIndex: '9',\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t});\n\n\t\t\tDom.append(canvas, this.#popup.getPopupContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanvas = container.getElementsByTagName('canvas')[0];\n\t\t}\n\n\t\tconst confetti = Confetti.create(canvas, {\n\t\t\tresize: true,\n\t\t\tuseWorker: true,\n\t\t});\n\n\t\tconfetti({\n\t\t\tparticleCount: 400,\n\t\t\torigin: {\n\t\t\t\ty: 1.2,\n\t\t\t\tx: 0,\n\t\t\t},\n\t\t\tspread: 100,\n\t\t});\n\t}\n\n\tasync getData(): Object\n\t{\n\t\tthis.#data = await this.fetchData();\n\n\t\treturn this.#data;\n\t}\n\n\tasync fetchData(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tAjax\n\t\t\t\t.runAction(this.getFetchUrl(), { data: this.getFetchParams() })\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(response.data);\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t},\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError();\n\n\t\t\t\t\tthrow response;\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\tgetFetchUrl(): string\n\t{\n\t\tthrow new Error('Must be implement in child class');\n\t}\n\n\tgetFetchParams(): Object\n\t{\n\t\treturn {};\n\t}\n\n\tshowError(): void\n\t{\n\t\tconst messageCode = 'CRM_REPEAT_SALE_WIDGET_ERROR';\n\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage(messageCode),\n\t\t\tautoHideDelay: 6000,\n\t\t});\n\t}\n\n\tsetBindElement(element: HTMLElement): Base\n\t{\n\t\tthis.#bindElement = element;\n\n\t\treturn this;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#popup?.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\trenderLottieAnimation(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm-rs__w-lottie-container\">\n\t\t\t\t<div ref=\"lottie\" class=\"crm-rs__w-lottie\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\tpath: '/bitrix/js/crm/repeat-sale/widget/lottie/animation.json',\n\t\t\tcontainer: container.lottie,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t});\n\n\t\tmainAnimation.setSpeed(0.75);\n\n\t\treturn container.root;\n\t}\n}\n","import { Extension, Loc, Tag, Type } from 'main.core';\n\nexport class Footer\n{\n\t#showSettingsButton: boolean = false;\n\n\tconstructor(showSettingsButton: boolean = false)\n\t{\n\t\tthis.#showSettingsButton = showSettingsButton;\n\t}\n\n\tgetFooterContent(): HTMLElement\n\t{\n\t\tconst settingsButton = this.#showSettingsButton ? Tag.render`\n\t\t\t<div\n\t\t\t\tonclick=\"${this.#onSettingsClick.bind(this)}\"\n\t\t\t \tclass=\"crm-rs__w-footer-button --settings\"\n\t\t\t >\n\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_SETTINGS')}\n\t\t\t</div>\n\t\t` : '';\n\n\t\tconst feedbackButton = Tag.render`\n\t\t\t<div\n\t\t\t\tonclick=\"${this.#onFeedbackClick.bind(this)}\"\n\t\t\t\tclass=\"crm-rs__w-footer-button --feedback\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_FEEDBACK')}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-footer-row\">\n\t\t\t\t${Type.isArrayFilled(this.#getFeedbackFormParams()) ? feedbackButton : '<div></div>'}\n\t\t\t\t${settingsButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#onSettingsClick(): void\n\t{\n\t\twindow.location.href = '/crm/repeat-sale-segment/';\n\t}\n\n\t#onFeedbackClick(): void\n\t{\n\t\tconst [numberCode, stringCode] = this.#getFeedbackFormParams();\n\n\t\tthis.#showFeedbackCrmForm(numberCode, stringCode);\n\t}\n\n\t#showFeedbackCrmForm(numberCode: number, stringCode: string): void\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\t'bx-repeat-sale-slider',\n\t\t\t{\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn `<script data-b24-form=\"inline/${numberCode}/${stringCode}\" data-skip-moving=\"true\"></script>`;\n\t\t\t\t},\n\t\t\t\twidth: 664,\n\t\t\t\tloader: 'default-loader',\n\t\t\t\tcacheable: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tdata: { rightBoundary: 0 },\n\t\t\t\tevents: {\n\t\t\t\t\tonOpen: () => {\n\t\t\t\t\t\t(function(w,d,u){\n\t\t\t\t\t\t\tvar s=d.createElement('script');\n\t\t\t\t\t\t\ts.async=true;\n\t\t\t\t\t\t\ts.src=u+'?'+(Date.now()/180000|0);\n\t\t\t\t\t\t\tvar h=d.getElementsByTagName('script')[0];\n\t\t\t\t\t\t\th.parentNode.insertBefore(s,h);\n\t\t\t\t\t\t})(window,document,`https://cdn.bitrix24.com/b5309667/crm/form/loader_${numberCode}.js`);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t#getFeedbackFormParams(): Array\n\t{\n\t\treturn Extension.getSettings('crm.repeat-sale.widget').get('feedbackFormParams');\n\t}\n}\n","import { ajax as Ajax, Loc, Tag } from 'main.core';\nimport 'ui.design-tokens';\nimport { Footer } from '../footer';\nimport type { WidgetParams, WidgetTypeEnum } from '../widget';\nimport { WidgetType } from '../widget';\nimport { Base } from './base';\n\nexport class Start extends Base\n{\n\t#isFlowStarted: ?boolean = null;\n\t#showSettingsButton: boolean = true;\n\n\tconstructor(params: WidgetParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.#showSettingsButton = params.showSettingsButton ?? true;\n\t}\n\n\tgetType(): WidgetTypeEnum\n\t{\n\t\treturn WidgetType.start;\n\t}\n\n\tonClose(): void\n\t{\n\t\tsuper.onClose();\n\n\t\tvoid Ajax.runAction('crm.repeatsale.widget.incrementShowedFlowStartCount');\n\t}\n\n\tgetPopupContent(data: Object): HTMLElement\n\t{\n\t\tif (this.#isFlowStarted === null)\n\t\t{\n\t\t\tconst { isFlowStarted } = data;\n\t\t\tthis.#isFlowStarted = isFlowStarted;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<header class=\"crm-rs__w-header\">\n\t\t\t\t\t${this.#getTitle(data)}\n\t\t\t\t</header>\n\t\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-content\">\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-title\">\n\t\t\t\t\t\t\t${this.#getBodyTitle(data)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.#getButton(data)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-rs__w-body-bubble ${this.#isFlowStarted ? '--flow-started' : ''}\">\n\t\t\t\t\t\t${this.renderLottieAnimation()}\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<footer class=\"crm-rs__w-footer\">\n\t\t\t\t\t${this.#getFooterContent(data)}\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTitle(data: Object): string | HTMLElement\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_FLOW_STARTED_POPUP_TITLE')}</span>\n\t\t\t`;\n\t\t}\n\n\t\tconst code = (\n\t\t\tthis.#hasClients(data)\n\t\t\t\t? 'CRM_REPEAT_SALE_WIDGET_START_POPUP_TITLE_WITH_CLIENTS'\n\t\t\t\t: 'CRM_REPEAT_SALE_WIDGET_START_POPUP_TITLE_WITHOUT_CLIENTS'\n\t\t);\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getBodyTitle(data: Object): string | HTMLElement\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_FLOW_STARTED_TITLE')}</span>\n\t\t\t`;\n\t\t}\n\n\t\tconst hasClients = this.#hasClients(data);\n\n\t\tconst code = (\n\t\t\thasClients\n\t\t\t\t? 'CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITH_CLIENTS'\n\t\t\t\t: 'CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITHOUT_CLIENTS'\n\t\t);\n\n\t\tif (hasClients)\n\t\t{\n\t\t\treturn Loc.getMessagePlural(code, data.count, { '#COUNT#': data.count });\n\t\t}\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getButton(data: Object): ?string\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst hasClients = this.#hasClients(data);\n\n\t\tconst code = (\n\t\t\thasClients\n\t\t\t\t? 'CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_WITH_CLIENTS'\n\t\t\t\t: 'CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_WITHOUT_CLIENTS'\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-body-title-btn ${hasClients ? '--has-clients' : ''}\">\n\t\t\t\t<span\n\t\t\t\t\tonclick=\"${this.#onButtonClick.bind(this, data)}\"\n\t\t\t\t>${Loc.getMessage(code)}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getFooterContent(data: Object): HTMLElement\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\tconst footer = new Footer(this.#showSettingsButton);\n\n\t\t\treturn footer.getFooterContent();\n\t\t}\n\n\t\tconst code = (\n\t\t\tthis.#hasClients(data)\n\t\t\t\t? 'CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITH_CLIENTS'\n\t\t\t\t: 'CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_CLIENTS'\n\t\t);\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#onButtonClick(data: Object): void\n\t{\n\t\tif (this.#hasClients(data))\n\t\t{\n\t\t\tAjax\n\t\t\t\t.runAction('crm.repeatsale.flow.enable')\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#isFlowStarted = true;\n\t\t\t\t\t\t\tthis.setPopupContent(this.getPopupContent(data));\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError();\n\t\t\t\t\tthis.close();\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// @todo\n\t\t\talert('empty clients, need show manual');\n\n\t\t\tvoid Ajax.runAction('crm.repeatsale.widget.finalizeShowedFlowStart');\n\t\t}\n\t}\n\n\t#hasClients(data: Object): boolean\n\t{\n\t\treturn data.count > 0;\n\t}\n\n\tgetFetchUrl(): string\n\t{\n\t\treturn 'crm.repeatsale.statistics.getInitData';\n\t}\n\n\tgetFetchParams(): Object\n\t{\n\t\treturn {};\n\t}\n}","import 'ui.design-tokens';\nimport { ajax as Ajax, Loc, Tag } from 'main.core';\nimport { PopupManager } from 'main.popup';\nimport { Lottie } from 'ui.lottie';\nimport { Footer } from '../footer';\nimport type { WidgetParams, WidgetTypeEnum } from '../widget';\nimport { PeriodType, WidgetType } from '../widget';\nimport { Base } from './base';\n\nexport class Statistics extends Base\n{\n\t#periodType: number = PeriodType.day30;\n\t#showSettingsButton: boolean = true;\n\n\tconstructor(params: WidgetParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.#showSettingsButton = params.showSettingsButton ?? true;\n\t}\n\n\tgetType(): WidgetTypeEnum\n\t{\n\t\treturn WidgetType.statistics;\n\t}\n\n\t#getLoadingPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<header class=\"crm-rs__w-header --statistics\">\n\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE')}\n\t\t\t\t</header>\n\t\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-loading-bubble\">\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-loading-bubble-wrapper\">\n\t\t\t\t\t\t\t${this.renderLottieAnimation()}\n\t\t\t\t\t\t\t${this.#renderLoadingLottieAnimation()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-bubble-subtitle\">\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_LOADING')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<footer class=\"crm-rs__w-footer --statistics\">\n\t\t\t\t\t${this.#getFooterContent()}\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderLoadingLottieAnimation(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm-rs__w-loading-lottie-container\">\n\t\t\t\t<div ref=\"lottie\" class=\"crm-rs__w-lottie\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\tpath: '/bitrix/js/crm/repeat-sale/widget/lottie/loading.json',\n\t\t\tcontainer: container.lottie,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t});\n\n\t\tmainAnimation.setSpeed(0.75);\n\n\t\treturn container.root;\n\t}\n\n\tgetPopupContent(data: Object): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<header class=\"crm-rs__w-header --statistics\">\n\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE')}\n\t\t\t\t</header>\n\t\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-content --statistics\">\n\t\t\t\t\t\t<div class=\"crm-rs__w-period-selector\">\n\t\t\t\t\t\t\t${this.#getSelectorTitle()}\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tonclick=\"${this.#onPeriodChange.bind(this, this.#periodType)}\"\n\t\t\t\t\t\t\t\tclass=\"crm-rs__w-period-selector-icon\"\n\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics\">\n\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-rs-statistics\">\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-rs-statistics-title\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BODY_TITLE')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-row\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessagePlural(\n\t\t\t\t\t\t\t\t\t\t\t'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BODY_RS_WIN',\n\t\t\t\t\t\t\t\t\t\t\tdata.repeatSaleWinCount ?? 0,\n\t\t\t\t\t\t\t\t\t\t\t{ '#COUNT#': data.repeatSaleWinCount ?? 0 },\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item --sum\">\n\t\t\t\t\t\t\t\t\t\t${data.repeatSaleWinSum ?? ''}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-row\">\n\t\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item\">\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BODY_RS_PROCESS')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item --sum\">\n\t\t\t\t\t\t\t\t\t\t${data.repeatSaleProcessSum ?? 0}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-row\">\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BODY_OTHER')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item --sum\">\n\t\t\t\t\t\t\t\t\t${data.otherWinSum ?? 0}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-row\">\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BODY_TOTAL')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-item --sum\">\n\t\t\t\t\t\t\t\t\t${data.totalSum ?? 0}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-rs__w-body-bubble --statistics\">\n\t\t\t\t\t\t${this.renderLottieAnimation()}\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-icon\"></div>\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-bubble-percent\">\n\t\t\t\t\t\t\t<span>${data.percent ?? 0}</span>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-bubble-percent-arrow ${data.percent > 0 ? '' : '--hidden'}\"></div>\n\t\t\t\t\t\t\t\t<div class=\"crm-rs__w-body-bubble-percent-icon\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-bubble-subtitle\">\n\t\t\t\t\t\t\t${this.#getBubbleSubTitle()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<footer class=\"crm-rs__w-footer --statistics\">\n\t\t\t\t\t${this.#getFooterContent()}\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getSelectorTitle(): string\n\t{\n\t\tlet code = null;\n\n\t\tswitch (this.#periodType)\n\t\t{\n\t\t\tcase PeriodType.day30:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_DAY_30';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.quarter:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_QUARTER';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.halfYear:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_HALF_YEAR';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.year:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_YEAR';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new RangeError('unknown period type');\n\t\t}\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getBubbleSubTitle(): string\n\t{\n\t\tlet code = null;\n\n\t\tswitch (this.#periodType)\n\t\t{\n\t\t\tcase PeriodType.day30:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BUBBLE_PERIOD_DAY_30';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.quarter:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BUBBLE_PERIOD_QUARTER';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.halfYear:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BUBBLE_PERIOD_HALF_YEAR';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.year:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_BUBBLE_PERIOD_YEAR';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new RangeError('unknown period type');\n\t\t}\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getFooterContent(): HTMLElement\n\t{\n\t\tconst footer = new Footer(this.#showSettingsButton);\n\n\t\treturn footer.getFooterContent();\n\t}\n\n\tgetFetchUrl(): string\n\t{\n\t\treturn 'crm.repeatsale.statistics.getData';\n\t}\n\n\tgetFetchParams(): Object\n\t{\n\t\treturn {\n\t\t\tperiodType: this.#periodType,\n\t\t};\n\t}\n\n\t#onPeriodChange(periodTypeId: number): void\n\t{\n\t\tlet nextPeriodTypeId = PeriodType.day30;\n\n\t\tconst periodTypeIds = Object.values(PeriodType);\n\n\t\tif (periodTypeIds.includes(periodTypeId))\n\t\t{\n\t\t\tconst index = periodTypeIds.indexOf(periodTypeId);\n\t\t\tif (index + 1 < periodTypeIds.length)\n\t\t\t{\n\t\t\t\tnextPeriodTypeId = index + 1;\n\t\t\t}\n\t\t}\n\n\t\tconst data = {\n\t\t\tperiodTypeId: nextPeriodTypeId,\n\t\t};\n\n\t\t// @todo maybe pointless loader\n\t\t// const popup = PopupManager.getPopupById(`crm_repeat_sale_widget_${this.getType()}`);\n\t\t// if (popup)\n\t\t// {\n\t\t// \tpopup.setContent(this.#getLoadingPopupContent());\n\t\t// }\n\n\t\tAjax\n\t\t\t.runAction(this.getFetchUrl(), { data })\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst popup = PopupManager.getPopupById(`crm_repeat_sale_widget_${this.getType()}`);\n\t\t\t\t\t\tif (popup === null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.data = response.data;\n\t\t\t\t\t\tthis.#periodType = nextPeriodTypeId;\n\n\t\t\t\t\t\tpopup.setContent(this.getPopupContent(this.data));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.showError();\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\t//popup.setContent(this.getPopupContent(this.data));\n\t\t\t\t\tthis.showError();\n\t\t\t\t},\n\t\t\t)\n\t\t\t.catch((response) => {\n\t\t\t\t//popup.setContent(this.getPopupContent(this.data));\n\t\t\t\tthis.showError();\n\t\t\t})\n\t\t;\n\t}\n}\n","import { Base } from './content/base';\nimport { Start } from './content/start';\nimport { Statistics } from './content/statistics';\nimport type { WidgetParams, WidgetTypeEnum } from './widget';\nimport { WidgetType } from './widget';\n\nexport class ContentFactory\n{\n\tstatic getContentInstance(widgetType: WidgetTypeEnum, params: WidgetParams = {}): Base\n\t{\n\t\tswitch (widgetType)\n\t\t{\n\t\t\tcase WidgetType.start:\n\t\t\t\treturn new Start(params);\n\t\t\tcase WidgetType.statistics:\n\t\t\t\treturn new Statistics(params);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n}\n","import { ContentFactory } from './content-factory';\nimport { Base } from './content/base';\nimport 'ui.design-tokens';\nimport './widget.css';\n\nexport type WidgetTypeEnum = WidgetType.start | WidgetType.statistics;\n\nexport const PeriodType = Object.freeze({\n\tday30: 0,\n\tquarter: 1,\n\thalfYear: 2,\n\tyear: 3,\n});\n\nexport const WidgetType = Object.freeze({\n\tstart: 'start',\n\tstatistics: 'statistics',\n});\n\nexport type WidgetParams = {\n\tshowSettingsButton?: boolean,\n\tshowConfetti?: boolean,\n}\n\nexport class Widget\n{\n\tstatic instance: Array = [];\n\t#contentPopupInstance: ?Base = null;\n\n\tstatic execute(\n\t\twidgetType: WidgetTypeEnum,\n\t\tbindElement: ?HTMLElement = null,\n\t\tparams: WidgetParams = {},\n\t\tevent: ?Event = null,\n\t): void\n\t{\n\t\tif (!this.instance[widgetType])\n\t\t{\n\t\t\tthis.instance[widgetType] = new Widget(widgetType, bindElement, params);\n\t\t}\n\n\t\tif (this.instance[widgetType].isShown())\n\t\t{\n\t\t\tthis.instance[widgetType].close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst forceShowConfetti = (event?.altKey && event?.ctrlKey) ?? false;\n\n\t\t\tthis.instance[widgetType].show(forceShowConfetti);\n\t\t}\n\t}\n\n\tconstructor(widgetType: WidgetTypeEnum, bindElement: ?HTMLElement = null, params: WidgetParams = {})\n\t{\n\t\tthis.#contentPopupInstance = ContentFactory.getContentInstance(widgetType, params);\n\n\t\tif (bindElement)\n\t\t{\n\t\t\tthis.#contentPopupInstance.setBindElement(bindElement);\n\t\t}\n\t}\n\n\tshow(forceShowConfetti: boolean = false): void\n\t{\n\t\tthis.#contentPopupInstance.show(forceShowConfetti);\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#contentPopupInstance.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#contentPopupInstance.close();\n\t}\n}"],"names":["Base","constructor","params","Type","isBoolean","showConfetti","getType","Error","show","forceShowConfetti","data","getData","Popup","getPopupParams","hasParentButton","Boolean","closest","hasParentLink","bindElement","bindElementRect","getBoundingClientRect","id","top","height","left","right","content","getPopupContent","cacheable","isScrollBlock","className","closeByEsc","closeIcon","padding","width","maxHeight","overlay","autoHide","events","onclose","onClose","onFirstShow","setTimeout","setPopupContent","setContent","Ajax","runAction","fetchData","Promise","resolve","getFetchUrl","getFetchParams","then","response","status","showError","catch","messageCode","UI","Notification","Center","notify","Loc","getMessage","autoHideDelay","setBindElement","element","isShown","close","renderLottieAnimation","container","Tag","render","mainAnimation","Lottie","loadAnimation","path","lottie","renderer","loop","autoplay","setSpeed","root","getPopupContainer","canvas","getElementsByTagName","length","Dom","style","position","pointerEvents","zIndex","append","confetti","Confetti","create","resize","useWorker","particleCount","origin","y","x","spread","Footer","showSettingsButton","getFooterContent","settingsButton","bind","feedbackButton","isArrayFilled","window","location","href","numberCode","stringCode","BX","SidePanel","Instance","open","contentCallback","loader","rightBoundary","onOpen","w","d","u","s","createElement","async","src","Date","now","h","parentNode","insertBefore","document","Extension","getSettings","get","Start","WidgetType","start","isFlowStarted","code","hasClients","getMessagePlural","count","footer","alert","Statistics","PeriodType","day30","statistics","repeatSaleWinCount","repeatSaleWinSum","repeatSaleProcessSum","otherWinSum","totalSum","percent","periodType","quarter","halfYear","year","RangeError","periodTypeId","nextPeriodTypeId","periodTypeIds","Object","values","includes","index","indexOf","popup","PopupManager","getPopupById","ContentFactory","getContentInstance","widgetType","freeze","Widget","execute","event","instance","altKey","ctrlKey"],"mappings":"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"}