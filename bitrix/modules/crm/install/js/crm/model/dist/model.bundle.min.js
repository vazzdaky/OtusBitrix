this.BX=this.BX||{};(function(e,t){"use strict";class s{constructor(e,s){this.deleted=false;this.progress=false;this.data={};if(t.Type.isPlainObject(e)){this.data=e}this.getParameters={add:{},get:{},update:{},delete:{}};if(t.Type.isPlainObject(s)){this.getParameters=s.getParameters}}get actions(){return{get:this.compileActionString("get"),add:this.compileActionString("add"),update:this.compileActionString("update"),delete:this.compileActionString("delete")}}compileActionString(e){return"crm.api."+this.getModelName()+"."+e}getId(){const e=this.data.id;return t.Type.isNil(e)?null:t.Text.toInteger(e)}getEntityTypeId(){return this.data.entityTypeId}isSaved(){return this.getId()>0}isDeleted(){return this.deleted}setData(e){this.data=e;return this}getData(){return this.data}setGetParameters(e,t){this.getParameters[e]=t}getGetParameters(e){return{...{analyticsLabel:"crmModel"+this.getModelName()+e},...this.getParameters[e]}}getModelName(){throw new Error('Method "getModelName" should be overridden')}setDataFromResponse(e){this.setData(e.data[this.getModelName()])}load(){return new Promise(((e,s)=>{const r=[];if(this.progress){r.push("Another action is in progress");s(r);return}if(!this.isSaved()){r.push("Cant load "+this.getModelName()+" without id");s(r);return}const i=this.actions.get;if(!t.Type.isString(i)||i.length<=0){r.push("Load action is not specified");s(r);return}this.progress=true;t.ajax.runAction(i,{data:{id:this.getId()},getParameters:this.getGetParameters("get")}).then((t=>{this.progress=false;this.setDataFromResponse(t);e(t)})).catch((e=>{this.progress=false;e.errors.forEach((({message:e})=>{r.push(e)}));s(r)}))}))}save(){return new Promise(((e,s)=>{let r=[];if(this.progress){r.push("Another action is in progress");s(r);return}let i;let a;let h;if(this.isSaved()){i=this.actions.update;a={id:this.getId(),fields:this.getData()};h=this.getGetParameters("update")}else{i=this.actions.add;a={fields:this.getData()};h=this.getGetParameters("add")}if(!t.Type.isString(i)||i.length<=0){r.push("Save action is not specified");s(r);return}this.progress=true;t.ajax.runAction(i,{data:a,getParameters:h}).then((t=>{this.progress=false;this.setDataFromResponse(t);e(t)})).catch((e=>{this.progress=false;r=[...r,...this.extractErrorMessages(e)];s(r)}))}))}extractErrorMessages({errors:e}){const s=[];e.forEach((({message:e})=>{if(t.Type.isPlainObject(e)&&e.text){s.push(e.text)}else{s.push(e)}}));return s}delete(){return new Promise(((e,s)=>{const r=[];if(this.progress){r.push("Another action is in progress");s(r);return}if(!this.isSaved()){r.push("Cant delete "+this.getModelName()+" without id");s(r);return}const i=this.actions.delete;if(!t.Type.isString(i)||i.length<=0){r.push("Delete action is not specified");s(r);return}this.progress=true;t.ajax.runAction(i,{data:{id:this.getId()},getParameters:this.getGetParameters("delete")}).then((t=>{this.deleted=true;this.progress=false;e(t)})).catch((e=>{this.progress=false;e.errors.forEach((({message:e})=>{r.push(e)}));s(r)}))}))}}e.Model=s})(this.BX.Crm=this.BX.Crm||{},BX);
//# sourceMappingURL=model.bundle.map.js