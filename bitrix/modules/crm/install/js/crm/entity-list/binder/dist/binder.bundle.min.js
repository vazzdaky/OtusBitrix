this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,s,r,i){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("parentEntityId");var a=babelHelpers.classPrivateFieldLooseKey("parentEntityTypeId");var o=babelHelpers.classPrivateFieldLooseKey("childEntityTypeId");var n=babelHelpers.classPrivateFieldLooseKey("gridId");class d{constructor(e,t,s,r){Object.defineProperty(this,l,{writable:true,value:void 0});Object.defineProperty(this,a,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});e=i.Text.toInteger(e);if(e>0){babelHelpers.classPrivateFieldLooseBase(this,a)[a]=e}t=i.Text.toInteger(t);if(t>0){babelHelpers.classPrivateFieldLooseBase(this,l)[l]=t}s=i.Text.toInteger(s);if(s>0){babelHelpers.classPrivateFieldLooseBase(this,o)[o]=s}babelHelpers.classPrivateFieldLooseBase(this,n)[n]=r}getId(){return`relation-${babelHelpers.classPrivateFieldLooseBase(this,a)[a]}-${babelHelpers.classPrivateFieldLooseBase(this,l)[l]}-${babelHelpers.classPrivateFieldLooseBase(this,o)[o]}`}getParentEntityId(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,l)[l])!=null?e:null}getParenEntityTypeId(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,a)[a])!=null?e:null}getChildEntityTypeId(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,o)[o])!=null?e:null}async bind(e){const t={parentEntityTypeId:babelHelpers.classPrivateFieldLooseBase(this,a)[a],parentEntityId:babelHelpers.classPrivateFieldLooseBase(this,l)[l],childEntityTypeId:babelHelpers.classPrivateFieldLooseBase(this,o)[o],selectedIds:e};return new Promise((async(e,s)=>{i.ajax.runAction("crm.controller.item.relation.update",{data:t}).then((t=>{e(t);this.refreshLayout()})).catch((e=>{if(e.errors){e.errors.forEach((({message:e})=>{this.showError(e)}))}}))}))}showError(e){r.UI.Notification.Center.notify({content:e,autoHideDelay:5e3})}refreshLayout(){BX.Main.gridManager.getInstanceById(babelHelpers.classPrivateFieldLooseBase(this,n)[n]).reload()}}var c=babelHelpers.classPrivateFieldLooseKey("dialogProp");var b=babelHelpers.classPrivateFieldLooseKey("binder");var h=babelHelpers.classPrivateFieldLooseKey("target");var p=babelHelpers.classPrivateFieldLooseKey("dialog");var u=babelHelpers.classPrivateFieldLooseKey("linking");class v{constructor(e,t=null){Object.defineProperty(this,u,{value:P});Object.defineProperty(this,p,{get:y,set:void 0});Object.defineProperty(this,c,{writable:true,value:null});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});if(e instanceof d){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e}if(i.Type.isDomNode(t)||i.Type.isNil(t)){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=t}if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){console.error("Invalid constructor params:",{binder:e});throw new Error("Invalid constructor params")}}show(){return new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p].subscribeOnce("onShow",e);babelHelpers.classPrivateFieldLooseBase(this,p)[p].show()}))}hide(){return new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p].subscribeOnce("onHide",e);babelHelpers.classPrivateFieldLooseBase(this,p)[p].hide()}))}destroy(){return new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p].destroy();e()}))}}function y(){if(babelHelpers.classPrivateFieldLooseBase(this,c)[c]){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}const e=new t.ApplyButton({color:t.ButtonColor.SUCCESS,onclick:()=>{void this.hide();babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}});const r=new t.CancelButton({onclick:()=>{void this.hide()}});const i=BX.CrmEntityType.resolveName(babelHelpers.classPrivateFieldLooseBase(this,b)[b].getChildEntityTypeId());babelHelpers.classPrivateFieldLooseBase(this,c)[c]=new s.Dialog({targetNode:babelHelpers.classPrivateFieldLooseBase(this,h)[h],enableSearch:true,context:`crm.binder.entity-selector.for-${i}`,entities:[{id:i.startsWith(BX.CrmEntityType.dynamicTypeNamePrefix)?"DYNAMIC":i,dynamicLoad:true,dynamicSearch:true,options:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,b)[b].getChildEntityTypeId(),sourceTypeId:babelHelpers.classPrivateFieldLooseBase(this,b)[b].getParenEntityTypeId(),notLinkedOnly:true,withoutRecentItems:true,withoutGlobalRecentItems:true}}],footer:[e.render(),r.render()],footerOptions:{containerStyles:{display:"flex","justify-content":"center"}},tagSelectorOptions:{textBoxWidth:565}});return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}function P(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,p)[p].getSelectedItems().length===0){r.UI.Notification.Center.notify({content:i.Loc.getMessage("ENTITY_BINDER_ITEMS_NOT_SELECTED"),autoHideDelay:5e3});return}babelHelpers.classPrivateFieldLooseBase(this,p)[p].getSelectedItems().forEach((t=>{e.push(t.getId())}));babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(e)}let B=null;var L=babelHelpers.classPrivateFieldLooseKey("binders");class H{constructor(){Object.defineProperty(this,L,{writable:true,value:{}})}static get Instance(){if(B===null){B=new H}return B}initializeBinder(e,t,s,r){const i=new d(e,t,s,r);babelHelpers.classPrivateFieldLooseBase(this,L)[L][i.getId()]=i;return i}getBinder(e){return babelHelpers.classPrivateFieldLooseBase(this,L)[L][e]}createRelatedSelector(e,t=null){const s=this.getBinder(e);if(!s){console.error("Binder with given id not found",e,this);return null}if(!s.getParenEntityTypeId()||!s.getParentEntityId()||!s.getChildEntityTypeId()){console.error("Not well configured binder",e,s);return null}return new v(s,document.getElementById(t))}}e.EntitySelector=v;e.Binder=d;e.Manager=H})(this.BX.Crm.Binder=this.BX.Crm.Binder||{},BX.UI,BX.UI.EntitySelector,BX,BX);
//# sourceMappingURL=binder.bundle.map.js