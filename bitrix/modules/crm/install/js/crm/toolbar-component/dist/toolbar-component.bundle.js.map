{"version":3,"file":"toolbar-component.bundle.js","sources":["../src/communications/communication-button.js","../src/communications/email-button.js","../src/communications/messenger-button.js","../src/communications/phone-button.js","../src/navigationbar.js","../src/toolbar-component.js","../src/index.js"],"sourcesContent":["import { ClientSelector } from 'crm.client-selector';\nimport { type JsonObject, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu, type MenuItemOptions } from 'main.popup';\nimport { type Receiver } from 'crm.messagesender';\nimport { type BaseButton } from 'ui.buttons';\n\n/**\n * @abstract\n */\nexport class CommunicationButton\n{\n\t/**\n\t * @protected\n\t */\n\townerInfo: JsonObject;\n\t/**\n\t * @protected\n\t */\n\tdata: JsonObject;\n\t/**\n\t * @protected\n\t */\n\tuseClientSelector: boolean;\n\n\t#settings: JsonObject = {};\n\t#button: BaseButton;\n\t#isMenuOpened: boolean = false;\n\t#menuPopup: ?Menu;\n\t#isEnabled: boolean = false;\n\t#clientSelector: ?ClientSelector;\n\n\tconstructor(settings: JsonObject)\n\t{\n\t\tthis.#settings = settings || {};\n\n\t\tthis.#button = this.#settings.button;\n\t\tthis.#button.bindEvent('click', this.onButtonClick.bind(this));\n\n\t\tthis.ownerInfo = BX.prop.getObject(this.#settings, 'ownerInfo', {});\n\t\tthis.data = BX.prop.getObject(this.#settings, 'data', {});\n\n\t\tthis.#enable(this.#hasData());\n\n\t\tthis.useClientSelector = BX.prop.getBoolean(this.#settings, 'useClientSelector', false);\n\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', this.#onReceiversChange.bind(this));\n\t}\n\n\tgetOwnerInfo(): JsonObject\n\t{\n\t\treturn (\n\t\t\t{\n\t\t\t\townerID: this.ownerInfo.ENTITY_ID,\n\t\t\t\townerType: this.ownerInfo.ENTITY_TYPE_NAME,\n\t\t\t\townerUrl: this.ownerInfo.SHOW_URL,\n\t\t\t\townerTitle: this.ownerInfo.TITLE,\n\t\t\t}\n\t\t);\n\t}\n\n\t#getOwnerTypeName(): string\n\t{\n\t\treturn BX.prop.getString(this.ownerInfo, 'ENTITY_TYPE_NAME', '');\n\t}\n\n\t#getOwnerId(): number\n\t{\n\t\treturn BX.prop.getInteger(this.ownerInfo, 'ENTITY_ID', 0);\n\t}\n\n\t/**\n\t * @abstract\n\t */\n\tgetMultifieldTypeName(): string\n\t{\n\t\treturn '';\n\t}\n\n\t#hasData(): boolean\n\t{\n\t\treturn Type.isPlainObject(this.data) && Type.isArrayFilled(Object.keys(this.data));\n\t}\n\n\tisEnabled(): boolean\n\t{\n\t\treturn this.#isEnabled;\n\t}\n\n\t#enable(enabled: boolean): void\n\t{\n\t\tthis.#isEnabled = Boolean(enabled);\n\n\t\tthis.#button.setDisabled(!this.#isEnabled);\n\t\tif (!this.#isEnabled)\n\t\t{\n\t\t\tconst title = this.getAddAddressSourceMessage(this.#getOwnerTypeName());\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tthis.#button.getContainer().title = title;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetAddAddressSourceMessage(entityTypeName: string): string\n\t{\n\t\treturn '';\n\t}\n\n\t/**\n\t * @abstract\n\t */\n\tonButtonClick(button: BaseButton, event: PointerEvent): void\n\t{}\n\n\tprepareMenuItem(key: any, value: any): MenuItemOptions\n\t{}\n\n\topenMenu(): void\n\t{\n\t\tif (this.#isMenuOpened)\n\t\t{\n\t\t\tthis.#closeMenu();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItems = [];\n\t\tfor (const [key, items] of Object.entries(this.data))\n\t\t{\n\t\t\tfor (const item of items)\n\t\t\t{\n\t\t\t\tmenuItems.push(this.prepareMenuItem(key, item));\n\t\t\t}\n\t\t}\n\n\t\tif (this.useClientSelector)\n\t\t{\n\t\t\tthis.#openClientSelector(menuItems);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#openPopupMenu(menuItems);\n\t\t}\n\t}\n\n\t#openClientSelector(menuItems: MenuItemOptions[]): void\n\t{\n\t\tif (!this.#clientSelector)\n\t\t{\n\t\t\tthis.#clientSelector = BX.Crm.ClientSelector.createFromItems({\n\t\t\t\ttargetNode: this.#button.getContainer(),\n\t\t\t\titems: menuItems,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onClientSelectorSelect.bind(this),\n\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\tthis.#isMenuOpened = true;\n\t\t\t\t\t},\n\t\t\t\t\tonHide: () => {\n\t\t\t\t\t\tthis.#isMenuOpened = false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.#clientSelector.show();\n\t}\n\n\tonClientSelectorSelect({ data: { item } }): void\n\t{\n\t\t// may be implement in children classes\n\t}\n\n\t#openPopupMenu(menuItems: MenuItemOptions[]): void\n\t{\n\t\tthis.#menuPopup = new Menu({\n\t\t\tbindElement: this.#button.getContainer(),\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tcacheable: false,\n\t\t\titems: menuItems,\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tthis.#isMenuOpened = true;\n\t\t\t\t},\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.#isMenuOpened = false;\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => {\n\t\t\t\t\tthis.#isMenuOpened = false;\n\t\t\t\t\tthis.#menuPopup = null;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.#menuPopup.show();\n\t}\n\n\t#closeMenu(): void\n\t{\n\t\tthis.#menuPopup?.close();\n\n\t\tthis.#clientSelector?.hide();\n\t}\n\n\t#onReceiversChange(event: BaseEvent): void\n\t{\n\t\tconst { item, current } = event.getData();\n\n\t\tif (item.entityTypeName !== this.#getOwnerTypeName() || item.entityId !== this.#getOwnerId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.data = {};\n\n\t\tfor (const receiver: Receiver of current)\n\t\t{\n\t\t\tif (receiver.address.typeId !== this.getMultifieldTypeName())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst key = `${receiver.addressSource.entityTypeId}_${receiver.addressSource.entityId}`;\n\n\t\t\tthis.data[key] ??= [];\n\n\t\t\tthis.data[key].push({\n\t\t\t\tID: receiver.address.id,\n\t\t\t\tENTITY_ID: receiver.addressSource.entityId,\n\t\t\t\tENTITY_TYPE_NAME: receiver.addressSource.entityTypeName,\n\t\t\t\tTYPE_ID: receiver.address.typeId,\n\t\t\t\tVALUE_TYPE: receiver.address.valueType,\n\t\t\t\tVALUE: receiver.address.value,\n\t\t\t\tVALUE_FORMATTED: receiver.address.valueFormatted,\n\t\t\t\tCOMPLEX_ID: receiver.address.complexId,\n\t\t\t\tCOMPLEX_NAME: receiver.address.complexName,\n\t\t\t\tOWNER: {\n\t\t\t\t\tID: receiver.addressSource.entityId,\n\t\t\t\t\tTYPE_ID: receiver.addressSource.entityTypeId,\n\t\t\t\t\tTITLE: receiver.addressSourceData.title,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.#enable(this.#hasData());\n\t}\n}\n","import { type JsonObject, Loc, Type } from 'main.core';\nimport { type MenuItemOptions } from 'main.popup';\nimport { type BaseButton } from 'ui.buttons';\nimport { CommunicationButton } from './communication-button';\n\nexport class EmailButton extends CommunicationButton\n{\n\tgetAddAddressSourceMessage(entityTypeName: string): string\n\t{\n\t\treturn Loc.getMessage(`CRM_TOOLBAR_COMPONENT_ADD_CLIENT_FOR_EMAIL_SEND_${entityTypeName}`) || Loc.getMessage('CRM_TOOLBAR_COMPONENT_ADD_CLIENT_FOR_EMAIL_SEND');\n\t}\n\n\tonButtonClick(button: BaseButton, event: PointerEvent): void\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.useClientSelector)\n\t\t{\n\t\t\tBX.CrmActivityEditor.addEmail(this.getOwnerInfo());\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = Object.keys(this.data);\n\t\tif (keys.length === 1)\n\t\t{\n\t\t\tconst firstKey = keys[0];\n\t\t\tconst items = this.data[firstKey];\n\t\t\tif (items.length === 1)\n\t\t\t{\n\t\t\t\tBX.CrmActivityEditor.addEmail(this.getOwnerInfo());\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.openMenu();\n\t}\n\n\tprepareMenuItem(key: string, value: JsonObject): MenuItemOptions\n\t{\n\t\tif (!Type.isPlainObject(value) || !this.useClientSelector)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\treturn {\n\t\t\tid: value.ID,\n\t\t\ttitle: value.OWNER ? value.OWNER.TITLE : value.VALUE_FORMATTED,\n\t\t\tsubtitle: value.OWNER ? `${value.VALUE_FORMATTED}, ${value.COMPLEX_NAME}` : value.COMPLEX_NAME,\n\t\t\tavatar: null,\n\t\t\tcustomData: {\n\t\t\t\tentityId: value.OWNER ? value.OWNER.ID : null,\n\t\t\t\tentityTypeId: value.OWNER ? value.OWNER.TYPE_ID : null,\n\t\t\t\tvalue: value.VALUE ?? null,\n\t\t\t\tvalueType: value.VALUE_TYPE ?? null,\n\t\t\t},\n\t\t};\n\t}\n\n\tonClientSelectorSelect({ data: { item } }): void\n\t{\n\t\tconst { customData } = item;\n\t\tconst entityTypeId = customData.get('entityTypeId');\n\n\t\tconst data = this.getOwnerInfo();\n\n\t\tdata.mailDefaultCommunications = [\n\t\t\t{\n\t\t\t\tENTITY_ID: customData.get('entityId'),\n\t\t\t\tENTITY_TYPE_ID: entityTypeId,\n\t\t\t\tENTITY_TYPE_NAME: BX.CrmEntityType.resolveName(entityTypeId),\n\t\t\t\tTYPE: this.getMultifieldTypeName(),\n\t\t\t\tVALUE: customData.get('value'),\n\t\t\t\tVALUE_TYPE: customData.get('valueType'),\n\t\t\t},\n\t\t];\n\n\t\tBX.CrmActivityEditor.addEmail(data);\n\t}\n\n\tgetMultifieldTypeName(): string\n\t{\n\t\treturn 'EMAIL';\n\t}\n}\n","import { type JsonObject, Type } from 'main.core';\nimport { type MenuItemOptions } from 'main.popup';\nimport { CommunicationButton } from './communication-button';\nimport { type BaseButton } from 'ui.buttons';\n\nexport class MessengerButton extends CommunicationButton\n{\n\tonButtonClick(button: BaseButton, event: PointerEvent): void\n\t{\n\t\tconst keys = Object.keys(this.data);\n\t\tif (keys.length === 1)\n\t\t{\n\t\t\tconst firstKey = keys[0];\n\t\t\tconst items = this.data[firstKey];\n\t\t\tif (items.length === 1)\n\t\t\t{\n\t\t\t\tconst parts = firstKey.split('_');\n\t\t\t\tif (parts.length >= 2)\n\t\t\t\t{\n\t\t\t\t\tthis.#openChat(firstKey, items[0]);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.openMenu();\n\t}\n\n\tprepareMenuItem(key: string, value: JsonObject | string): MenuItemOptions\n\t{\n\t\tlet\tmessengerText = '';\n\t\tlet messengerValue = '';\n\n\t\tif (Type.isPlainObject(value))\n\t\t{\n\t\t\tmessengerValue = BX.prop.getString(value, 'VALUE', '');\n\t\t\tconst valueType = BX.prop.getString(value, 'VALUE_TYPE', '');\n\t\t\tif (valueType === 'OPENLINE')\n\t\t\t{\n\t\t\t\t// Open line does not have formatted value\n\t\t\t\tmessengerText = BX.prop.getString(value, 'COMPLEX_NAME', '');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessengerText = `${BX.prop.getString(value, 'COMPLEX_NAME', '')}: ${BX.prop.getString(value, 'VALUE_FORMATTED', '')}`;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessengerText = value;\n\t\t\tmessengerValue = value;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: messengerText,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#openChat(key, messengerValue);\n\t\t\t},\n\t\t};\n\t}\n\n\t#openChat(entityKey: string, messenger: JsonObject | string): void\n\t{\n\t\tif (Type.isNil(window.top.BXIM))\n\t\t{\n\t\t\tconsole.error('crm.toolbar-component: messaging not supported');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst messengerValue = Type.isPlainObject(messenger) ? messenger.VALUE : messenger;\n\t\twindow.top.BXIM.openMessengerSlider(messengerValue, { RECENT: 'N', MENU: 'N' });\n\t}\n\n\tgetMultifieldTypeName(): string\n\t{\n\t\treturn 'IM';\n\t}\n}\n","import { type JsonObject, Loc, Text, Type } from 'main.core';\nimport { type MenuItemOptions } from 'main.popup';\nimport { type BaseButton } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { type ItemOptions } from 'ui.entity-selector';\nimport { CommunicationButton } from './communication-button';\n\nexport class PhoneButton extends CommunicationButton\n{\n\tgetAddAddressSourceMessage(entityTypeName: string): string\n\t{\n\t\treturn Loc.getMessage(`CRM_TOOLBAR_COMPONENT_ADD_CLIENT_FOR_CALL_${entityTypeName}`) || Loc.getMessage('CRM_TOOLBAR_COMPONENT_ADD_CLIENT_FOR_CALL');\n\t}\n\n\tonButtonClick(button: BaseButton, event: PointerEvent): void\n\t{\n\t\tif (!this.isEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = Object.keys(this.data);\n\t\tif (keys.length === 1)\n\t\t{\n\t\t\tconst firstKey = keys[0];\n\t\t\tconst items = this.data[firstKey];\n\n\t\t\tif (items.length === 1)\n\t\t\t{\n\t\t\t\tconst parts = firstKey.split('_');\n\t\t\t\tif (parts.length >= 2)\n\t\t\t\t{\n\t\t\t\t\tthis.#addCall(firstKey, items[0]);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.openMenu();\n\t}\n\n\tprepareMenuItem(key, value): MenuItemOptions\n\t{\n\t\tlet\tphoneText = value;\n\t\tlet phoneValue = value;\n\n\t\tif (Type.isPlainObject(value))\n\t\t{\n\t\t\tconst complexName = BX.prop.getString(value, 'COMPLEX_NAME', '');\n\t\t\tconst valueFormatted = BX.prop.getString(value, 'VALUE_FORMATTED', '');\n\n\t\t\tphoneText = `${complexName}: ${valueFormatted}`;\n\t\t\tphoneValue = BX.prop.getString(value, 'VALUE', '');\n\n\t\t\tif (this.useClientSelector)\n\t\t\t{\n\t\t\t\treturn this.#createClientSelectorMenuItem(value);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#createPopupMenuItem(key, phoneValue, phoneText);\n\t}\n\n\t#createClientSelectorMenuItem(value: JsonObject): ItemOptions\n\t{\n\t\tconst complexName = BX.prop.getString(value, 'COMPLEX_NAME', '');\n\t\tconst valueFormatted = BX.prop.getString(value, 'VALUE_FORMATTED', '');\n\t\tconst phoneValue = BX.prop.getString(value, 'VALUE', '');\n\n\t\tconst owner = Type.isObjectLike(value.OWNER) ? value.OWNER : null;\n\n\t\treturn {\n\t\t\tid: value.ID,\n\t\t\ttitle: owner ? owner.TITLE : valueFormatted,\n\t\t\tsubtitle: owner ? `${valueFormatted}, ${complexName}` : complexName,\n\t\t\tavatar: null,\n\t\t\tcustomData: {\n\t\t\t\tentityId: owner ? owner.ID : null,\n\t\t\t\tentityTypeId: owner ? owner.TYPE_ID : null,\n\t\t\t\tvalue: phoneValue,\n\t\t\t},\n\t\t};\n\t}\n\n\t#createPopupMenuItem(entityKey: string, value: JsonObject, text: string): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttext,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#addCall(entityKey, value);\n\t\t\t},\n\t\t};\n\t}\n\n\tonClientSelectorSelect({ data: { item } }): void\n\t{\n\t\tconst { customData } = item;\n\t\tconst entityKey = `${customData.get('entityTypeId')}_${customData.get('entityId')}`;\n\t\tconst value = customData.get('value');\n\n\t\tthis.#addCall(entityKey, value);\n\t}\n\n\t#addCall(entityKey: string, phone: JsonObject | string): void\n\t{\n\t\tif (Type.isNil(window.top.BXIM))\n\t\t{\n\t\t\tMessageBox.alert(\n\t\t\t\tLoc.getMessage('CRM_TOOLBAR_COMPONENT_TELEPHONY_NOT_SUPPORTED'),\n\t\t\t\tnull,\n\t\t\t\tLoc.getMessage('CRM_TOOLBAR_COMPONENT_TELEPHONY_NOT_SUPPORTED_OK'),\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst parts = entityKey.split('_');\n\t\tif (parts.length < 2)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst entityTypeId = Text.toInteger(parts[0]);\n\t\tconst entityId = Text.toInteger(parts[1]);\n\n\t\tconst ownerTypeId = BX.prop.getInteger(this.ownerInfo, 'ENTITY_TYPE_ID', 0);\n\t\tconst ownerId = BX.prop.getInteger(this.ownerInfo, 'ENTITY_ID', 0);\n\n\t\tconst phoneValue = Type.isPlainObject(phone) ? phone.VALUE : phone;\n\n\t\tconst params = {\n\t\t\tENTITY_TYPE_NAME: BX.CrmEntityType.resolveName(entityTypeId),\n\t\t\tENTITY_ID: entityId,\n\t\t\tAUTO_FOLD: true,\n\t\t};\n\t\tif (ownerTypeId !== entityTypeId || ownerId !== entityId)\n\t\t{\n\t\t\tparams.BINDINGS = [{ OWNER_TYPE_NAME: BX.CrmEntityType.resolveName(ownerTypeId), OWNER_ID: ownerId }];\n\t\t}\n\n\t\twindow.top.BXIM.phoneTo(phoneValue, params);\n\t}\n\n\tgetMultifieldTypeName(): string\n\t{\n\t\treturn 'PHONE';\n\t}\n}\n","import { Type } from 'main.core';\nimport { NavigationPanel } from 'ui.navigationpanel';\n\nimport './style.css';\n\nexport default class NavigationBar extends NavigationPanel\n{\n\t#id: string;\n\t#binding: Array;\n\n\tconstructor(options: Object): void\n\t{\n\t\tif (!Type.isPlainObject(options))\n\t\t{\n\t\t\tthrow 'BX.Crm.NavigationBar: The \"options\" argument must be object.';\n\t\t}\n\n\t\toptions.items = Type.isArray(options.items) ? options.items : [];\n\t\toptions.items.forEach(item => {\n\t\t\tif (\n\t\t\t\t!item.hasOwnProperty('active')\n\t\t\t\t&& item.hasOwnProperty('isActive')\n\t\t\t)\n\t\t\t{\n\t\t\t\titem.active = item.isActive;\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.lockedCallback))\n\t\t\t{\n\t\t\t\titem.locked = true;\n\t\t\t\titem.url = '';\n\t\t\t\titem.events = {click: () => eval(item.lockedCallback)}\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(item.url))\n\t\t\t{\n\t\t\t\titem.events = {click: () => this.openUrl(item.id, item.url)}\n\t\t\t}\n\t\t});\n\n\t\tsuper({\n\t\t\ttarget: BX(options.id),\n\t\t\titems: options.items,\n\t\t});\n\n\t\tthis.#id = options.id;\n\t\tthis.#binding = options.binding;\n\t}\n\n\topenUrl(itemId: String, url: String): void\n\t{\n\t\tif (!Type.isStringFilled(url))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#binding && Type.isPlainObject(this.#binding))\n\t\t{\n\t\t\tconst category = Type.isStringFilled(this.#binding.category)\n\t\t\t\t? this.#binding.category\n\t\t\t\t: '';\n\t\t\tconst name = Type.isStringFilled(this.#binding.name)\n\t\t\t\t? this.#binding.name\n\t\t\t\t: '';\n\t\t\tconst key = Type.isStringFilled(this.#binding.key)\n\t\t\t\t? this.#binding.key\n\t\t\t\t: '';\n\n\t\t\tif (category !== '' && name !== '' && key !== '')\n\t\t\t{\n\t\t\t\tconst value = itemId + \":\" + BX.formatDate(new Date(), 'YYYYMMDD');\n\n\t\t\t\tBX.userOptions.save(category, name, key, value, false);\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(function() { window.location.href = url; }, 150);\n\t}\n}\n","import { Router } from 'crm.router';\nimport { ajax as Ajax, Dom, Event, Loc, Reflection, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu } from 'main.popup';\nimport { BaseButton, Button, ButtonIcon } from 'ui.buttons';\nimport { Guide } from 'ui.tour';\n\nimport 'ui.hint';\n\nimport './style.css';\n\nconst MENU_ID_PREFIX = 'toolbar-category-';\n\nlet instance = null;\n\nclass ToolbarEvents\n{\n\tstatic TYPE_UPDATED = 'TypeUpdated';\n\tstatic CATEGORIES_UPDATED = 'CategoriesUpdated';\n\tstatic AUTOMATED_SOLUTION_UPDATED = 'CategoriesUpdated';\n}\n\n/**\n * @memberOf BX.Crm\n */\nexport default class ToolbarComponent extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.initHints();\n\t\tthis.setEventNamespace('BX.Crm.ToolbarComponent');\n\n\t\tEvent.ready(this.bindEvents.bind(this));\n\t}\n\n\tstatic get Instance(): ToolbarComponent\n\t{\n\t\tif ((window.top !== window) && Reflection.getClass('top.BX.Crm.ToolbarComponent'))\n\t\t{\n\t\t\treturn window.top.BX.Crm.ToolbarComponent.Instance;\n\t\t}\n\n\t\tif (instance === null)\n\t\t{\n\t\t\tinstance = new ToolbarComponent();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tinitHints(): void\n\t{\n\t\tBX.UI.Hint.init(BX('ui-toolbar-after-title-buttons'));\n\t\tBX.UI.Hint.popupParameters = {\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tangle: {\n\t\t\t\toffset: 60,\n\t\t\t},\n\t\t\toffsetLeft: 40,\n\t\t};\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tconst buttonNode = document.querySelector('[data-role=\"bx-crm-toolbar-categories-button\"]');\n\t\tif (buttonNode)\n\t\t{\n\t\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\t\tconst button = toolbar.getButton(Dom.attr(buttonNode, 'data-btn-uniqid'));\n\t\t\tconst entityTypeId = Number(buttonNode.dataset.entityTypeId);\n\n\t\t\tif (button.counterNode && button.counterNode.innerText > 99)\n\t\t\t{\n\t\t\t\tbutton.counterNode.innerText = '99+';\n\t\t\t}\n\n\t\t\tif (button && entityTypeId > 0)\n\t\t\t{\n\t\t\t\tthis.subscribeCategoriesUpdatedEvent(() => {\n\t\t\t\t\tthis.#reloadCategoriesMenu(button, entityTypeId, buttonNode.dataset.categoryId);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#bindAutomationGuide();\n\t}\n\n\temitTypeUpdatedEvent(data): void\n\t{\n\t\tthis.emit(ToolbarEvents.TYPE_UPDATED, data);\n\t}\n\n\temitAutomatedSolutionUpdatedEvent(data: Object): void\n\t{\n\t\tthis.emit(ToolbarEvents.AUTOMATED_SOLUTION_UPDATED, data);\n\t}\n\n\temitCategoriesUpdatedEvent(data): void\n\t{\n\t\tthis.emit(ToolbarEvents.CATEGORIES_UPDATED, data);\n\t}\n\n\tsubscribeTypeUpdatedEvent(callback): void\n\t{\n\t\tthis.subscribe(ToolbarEvents.TYPE_UPDATED, callback);\n\t}\n\n\tsubscribeCategoriesUpdatedEvent(callback): void\n\t{\n\t\tthis.subscribe(ToolbarEvents.CATEGORIES_UPDATED, callback);\n\t}\n\n\tsubscribeAutomatedSolutionUpdatedEvent(callback): void\n\t{\n\t\tthis.subscribe(ToolbarEvents.AUTOMATED_SOLUTION_UPDATED, callback);\n\t}\n\n\tunsubscribeAutomatedSolutionUpdatedEvent(callback): void\n\t{\n\t\tthis.unsubscribe(ToolbarEvents.AUTOMATED_SOLUTION_UPDATED, callback);\n\t}\n\n\tgetSettingsButton(): ?Button\n\t{\n\t\tconst toolbar: ?BX.UI.Toolbar = BX.UI.ToolbarManager.getDefaultToolbar();\n\t\tif (!toolbar)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (const [key: string, button: Button] of Object.entries(toolbar.getButtons()))\n\t\t{\n\t\t\tif (button.getIcon() === ButtonIcon.SETTING)\n\t\t\t{\n\t\t\t\treturn button;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#bindAutomationGuide(): void\n\t{\n\t\tconst hash = document.location.hash;\n\t\tlet guide = null;\n\n\t\tif (hash === '#robots')\n\t\t{\n\t\t\tconst robotsBtn = document.querySelector('.crm-robot-btn');\n\t\t\tif (robotsBtn)\n\t\t\t{\n\t\t\t\tguide = new Guide({\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: robotsBtn,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TOOLBAR_COMPONENT_ROBOTS_GUIDE_TEXT_1'),\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tonEvents: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (hash === '#scripts')\n\t\t{\n\t\t\tconst scriptsBtn = document.querySelector('.intranet-binding-menu-btn');\n\t\t\tif (scriptsBtn)\n\t\t\t{\n\t\t\t\tguide = new Guide({\n\t\t\t\t\tsteps: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: scriptsBtn,\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TOOLBAR_COMPONENT_SCRIPTS_GUIDE_TEXT'),\n\t\t\t\t\t\t\tarticle: '13281632',\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tonEvents: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (guide)\n\t\t{\n\t\t\tguide.start();\n\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\tguide.getPopup().setClosingByEsc(true);\n\t\t}\n\t}\n\n\t#reloadCategoriesMenu(button: BaseButton, entityTypeId: number, categoryId: ?number): void\n\t{\n\t\tconst menu = button.getMenuWindow();\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAjax.runAction('crm.controller.category.list', {\n\t\t\tdata: {\n\t\t\t\tentityTypeId,\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tlet startKey = 0;\n\t\t\tconst items = [];\n\t\t\tconst categories = response.data.categories;\n\n\t\t\tmenu.menuItems.forEach((item) => {\n\t\t\t\tif (item.id.indexOf(MENU_ID_PREFIX) !== 0)\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t}\n\t\t\t\telse if (item.id === 'toolbar-category-all')\n\t\t\t\t{\n\t\t\t\t\titems.push(item.options);\n\t\t\t\t\tstartKey = 1;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tmenu.destroy();\n\n\t\t\tEvent.unbindAll(button.getContainer(), 'click');\n\n\t\t\tcategories.forEach((category) => {\n\t\t\t\tconst link = entityTypeId === BX.CrmEntityType.enumeration.deal\n\t\t\t\t\t? Router.Instance.getDealKanbanUrl(category.id)?.toString()\n\t\t\t\t\t: Router.Instance.getItemListUrlInCurrentView(entityTypeId, category.id)?.toString()\n\t\t\t\t;\n\n\t\t\t\titems.splice(startKey, 0, {\n\t\t\t\t\tid: `${MENU_ID_PREFIX}${category.id}`,\n\t\t\t\t\ttext: Text.encode(category.name),\n\t\t\t\t\thref: link || null,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tisDefault: category.isDefault || false,\n\t\t\t\t\t\tcategoryId: category.id\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (category.id > 0 && categoryId > 0 && Number(categoryId) === Number(category.id))\n\t\t\t\t{\n\t\t\t\t\tbutton.setText(category.name);\n\t\t\t\t}\n\n\t\t\t\tstartKey++;\n\t\t\t});\n\n\t\t\tconst options = menu.params;\n\t\t\toptions.items = items;\n\n\t\t\tbutton.menuWindow = new Menu(options);\n\t\t\tEvent.bind(button.getContainer(), 'click', button.menuWindow.show.bind(button.menuWindow));\n\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.deal)\n\t\t\t{\n\t\t\t\tthis.#reloadAddButtonMenu(categories);\n\t\t\t}\n\n\t\t\tthis.#tryRedirectToDefaultCategory(items);\n\t\t}).catch((response) => {\n\t\t\tconsole.log('error trying reload categories', response.errors);\n\t\t});\n\t}\n\n\t#reloadAddButtonMenu(categories: Array)\n\t{\n\t\tconst addButtonNode = document.querySelector('.ui-btn-split.ui-btn-success');\n\t\tif (!addButtonNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addButtonId = addButtonNode.dataset.btnUniqid;\n\t\tconst toolbar =\tBX.UI.ToolbarManager.getDefaultToolbar();\n\t\tconst button = toolbar.getButton(addButtonId, 'data-btn-uniqid');\n\t\tif (!button)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menu = button.menuWindow;\n\t\tif (!menu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItemsIds = menu\n\t\t\t.getMenuItems()\n\t\t\t.map((item) => item.id)\n\t\t\t.filter((id) => Type.isInteger(id));\n\t\tconst categoryIds = new Set(categories.map((item) => item.id));\n\t\tconst idsToRemove = menuItemsIds.filter((id) => !categoryIds.has(id));\n\t\tconst newCategories = categories.filter((item) => !menuItemsIds.includes(item.id) && item.id > 0);\n\n\t\t// remove menu item(s)\n\t\tif (idsToRemove.length > 0)\n\t\t{\n\t\t\tidsToRemove.forEach((idToRemove) => menu.removeMenuItem(idToRemove));\n\t\t}\n\n\t\t// add new item(s)\n\t\tif (newCategories.length > 0)\n\t\t{\n\t\t\tconst targetItemId = menu\n\t\t\t\t.getMenuItems()\n\t\t\t\t.map((item) => item.id)\n\t\t\t\t.filter((id) => Type.isString(id))\n\t\t\t\t.at(1);\n\n\t\t\tnewCategories.forEach((item) => {\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: item.id,\n\t\t\t\t\ttext: item.name,\n\t\t\t\t\tonclick()\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.SidePanel.Instance.open(`/crm/deal/details/0/?category_id=${item.id}`);\n\t\t\t\t\t},\n\t\t\t\t}, targetItemId);\n\t\t\t});\n\t\t}\n\t}\n\n\t#tryRedirectToDefaultCategory(items: Array): void\n\t{\n\t\tconst currentPage = window.location.pathname;\n\t\tconst matches = currentPage.match(/\\/(\\d+)\\/?$/);\n\t\tconst currentPageCategoryId = matches ? parseInt(matches[1], 10) : null;\n\t\tconst currentCategoryIsUndefined = Type.isUndefined(\n\t\t\titems.find((row) => row?.dataset?.categoryId === currentPageCategoryId)\n\t\t);\n\t\tif (currentCategoryIsUndefined)\n\t\t{\n\t\t\tconst defaultPage = items.find((row) => row?.dataset?.isDefault);\n\t\t\tif (Type.isObject(defaultPage) && Type.isStringFilled(defaultPage.href))\n\t\t\t{\n\t\t\t\twindow.location.href = defaultPage.href;\n\t\t\t}\n\t\t}\n\t}\n}\n","import { EmailButton } from './communications/email-button';\nimport { MessengerButton } from './communications/messenger-button';\n\nimport { PhoneButton } from './communications/phone-button';\nimport NavigationBar from './navigationbar';\nimport ToolbarComponent from './toolbar-component';\n\n/**\n * @memberOf BX.Crm.ToolbarComponent.Communications\n */\nToolbarComponent.Communications = Object.freeze({\n\tPhoneButton,\n\tEmailButton,\n\tMessengerButton,\n});\n\n/**\n * @memberOf BX.Crm\n */\nexport {\n\tToolbarComponent,\n\tNavigationBar,\n};\n"],"names":["CommunicationButton","settings","button","bindEvent","onButtonClick","bind","ownerInfo","BX","prop","getObject","data","useClientSelector","getBoolean","EventEmitter","subscribe","ownerID","ENTITY_ID","ownerType","ENTITY_TYPE_NAME","ownerUrl","SHOW_URL","ownerTitle","TITLE","entityTypeName","event","key","value","menuItems","items","Object","entries","item","push","prepareMenuItem","getString","getInteger","Type","isPlainObject","isArrayFilled","keys","enabled","Boolean","setDisabled","title","getAddAddressSourceMessage","getContainer","Crm","ClientSelector","createFromItems","targetNode","events","onSelect","onClientSelectorSelect","onShow","onHide","show","Menu","bindElement","offsetTop","offsetLeft","cacheable","onPopupShow","onPopupClose","onPopupDestroy","close","hide","current","getData","entityId","receiver","address","typeId","getMultifieldTypeName","addressSource","entityTypeId","ID","id","TYPE_ID","VALUE_TYPE","valueType","VALUE","VALUE_FORMATTED","valueFormatted","COMPLEX_ID","complexId","COMPLEX_NAME","complexName","OWNER","addressSourceData","EmailButton","Loc","getMessage","isEnabled","CrmActivityEditor","addEmail","getOwnerInfo","length","firstKey","openMenu","subtitle","avatar","customData","get","mailDefaultCommunications","ENTITY_TYPE_ID","CrmEntityType","resolveName","TYPE","MessengerButton","_classPrivateMethodInitSpec","parts","split","_classPrivateMethodGet","messengerText","messengerValue","text","onclick","entityKey","messenger","isNil","window","top","BXIM","console","error","openMessengerSlider","RECENT","MENU","PhoneButton","phoneText","phoneValue","owner","isObjectLike","phone","MessageBox","alert","Text","toInteger","ownerTypeId","ownerId","params","AUTO_FOLD","BINDINGS","OWNER_TYPE_NAME","OWNER_ID","phoneTo","NavigationBar","options","isArray","forEach","hasOwnProperty","active","isActive","isStringFilled","lockedCallback","locked","url","click","eval","openUrl","target","_classPrivateFieldInitSpec","binding","itemId","category","name","formatDate","Date","userOptions","save","setTimeout","location","href","NavigationPanel","MENU_ID_PREFIX","instance","ToolbarEvents","ToolbarComponent","initHints","setEventNamespace","Event","ready","bindEvents","UI","Hint","init","popupParameters","closeByEsc","autoHide","angle","offset","buttonNode","document","querySelector","toolbar","ToolbarManager","getDefaultToolbar","getButton","Dom","attr","Number","dataset","counterNode","innerText","subscribeCategoriesUpdatedEvent","categoryId","emit","TYPE_UPDATED","AUTOMATED_SOLUTION_UPDATED","CATEGORIES_UPDATED","callback","unsubscribe","getButtons","getIcon","ButtonIcon","SETTING","Reflection","getClass","Instance","hash","guide","robotsBtn","Guide","steps","onEvents","scriptsBtn","article","start","getPopup","setAutoHide","setClosingByEsc","menu","getMenuWindow","Ajax","runAction","then","response","startKey","categories","indexOf","destroy","unbindAll","link","enumeration","deal","Router","getDealKanbanUrl","toString","getItemListUrlInCurrentView","splice","encode","isDefault","setText","menuWindow","catch","log","errors","addButtonNode","addButtonId","btnUniqid","menuItemsIds","getMenuItems","map","filter","isInteger","categoryIds","Set","idsToRemove","has","newCategories","includes","idToRemove","removeMenuItem","targetItemId","isString","at","addMenuItem","SidePanel","open","currentPage","pathname","matches","match","currentPageCategoryId","parseInt","currentCategoryIsUndefined","isUndefined","find","row","defaultPage","isObject","Communications","freeze"],"mappings":"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"}