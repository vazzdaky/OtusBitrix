{"version":3,"file":"script.js","sources":["action-button.js","active-field.js","round-chart-field.js"],"sourcesContent":["import { Reflection } from 'main.core';\nimport { SidePanel } from 'ui.sidepanel';\n\nconst namespace = Reflection.namespace('BX.Crm.RepeatSale.SegmentList');\n\nexport class ActionButton {\n\n\texecute(): void\n\t{\n\t\tif (!SidePanel.Instance)\n\t\t{\n\t\t\tconsole.error('SidePanel.Instance not found');\n\n\t\t\treturn;\n\t\t}\n\n\t\tSidePanel.Instance.open(\n\t\t\t`/crm/repeat-sale-segment/details/0/`,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\twidth: 700,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t}\n\t\t);\n\t}\n}\n\nnamespace.ActionButton = ActionButton;\n","import { ajax as Ajax, Dom, Loc, Reflection, Runtime, Tag, Text } from 'main.core';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { UI } from 'ui.notification';\n\nconst namespace = Reflection.namespace('BX.Crm.RepeatSale.SegmentList');\n\nexport class ActiveField\n{\n\t#id: string;\n\t#targetNode: string;\n\t#checked: boolean;\n\t#readOnly: boolean;\n\t#isFlowDisabled: boolean;\n\n\tconstructor({ id, targetNodeId, checked, readOnly, isFlowDisabled })\n\t{\n\t\tthis.#id = id;\n\t\tthis.#targetNode = document.getElementById(targetNodeId);\n\t\tthis.#checked = checked;\n\t\tthis.#readOnly = readOnly;\n\t\tthis.#isFlowDisabled = isFlowDisabled;\n\t}\n\n\tinit(): void\n\t{\n\t\tvoid Runtime.loadExtension('ui.switcher').then((exports) => {\n\t\t\tconst { Switcher } = exports;\n\n\t\t\tconst switcher = new Switcher({\n\t\t\t\tchecked: this.#checked,\n\t\t\t\tdisabled: this.#readOnly,\n\t\t\t\thandlers: {\n\t\t\t\t\tchecked: (event) => {\n\t\t\t\t\t\tevent.stopPropagation();\n\n\t\t\t\t\t\tthis.#showMessageBox(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tthis.#changeRepeatSaleSegmentActive(false);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tswitcher.check(true, false);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tunchecked: (event) => {\n\t\t\t\t\t\tevent.stopPropagation();\n\n\t\t\t\t\t\tif (this.#isFlowDisabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#showAllFlowEnableMessageBox(\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.#changeRepeatSaleSegmentActive(true);\n\t\t\t\t\t\t\t\t\tthis.#isFlowDisabled = false;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tswitcher.check(true, false);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#changeRepeatSaleSegmentActive(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tDom.clean(this.#targetNode);\n\t\t\tswitcher.renderTo(this.#targetNode);\n\t\t});\n\t}\n\n\t#showMessageBox(onOk: () => void, onCancel: () => void): void\n\t{\n\t\tconst popupContainer = Tag.render`\n\t\t\t<div class=\"crm-repeat-sale-segment-list-confirm-container\">\n\t\t\t\t<div class=\"crm-repeat-sale-segment-list-confirm-message\">\n\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_LIST_COLUMN_IS_ENABLED_CONFIRM_DIALOG_MESSAGE')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tMessageBox.show({\n\t\t\tmodal: true,\n\t\t\tminHeight: 100,\n\t\t\tminWidth: 400,\n\t\t\tpopupOptions: {\n\t\t\t\tcontent: popupContainer,\n\t\t\t\tcloseIcon: false,\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_LIST_COLUMN_IS_ENABLED_CONFIRM_DIALOG_OK_BTN'),\n\t\t\tonOk: (messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tonOk();\n\t\t\t},\n\t\t\tonCancel: (messageBox: MessageBox) => {\n\t\t\t\tonCancel();\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t});\n\t}\n\n\t#showAllFlowEnableMessageBox(onOk: () => void, onCancel: () => void): void\n\t{\n\t\tconst popupContainer = Tag.render`\n\t\t\t<div class=\"crm-repeat-sale-segment-list-confirm-container\">\n\t\t\t\t<div class=\"crm-repeat-sale-segment-list-confirm-message\">\n\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_LIST_COLUMN_IS_ENABLED_RS_CONFIRM_DIALOG_MESSAGE')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tMessageBox.show({\n\t\t\tmodal: true,\n\t\t\tminHeight: 100,\n\t\t\tminWidth: 400,\n\t\t\tpopupOptions: {\n\t\t\t\tcontent: popupContainer,\n\t\t\t\tcloseIcon: false,\n\t\t\t},\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_LIST_COLUMN_IS_ENABLED_RS_CONFIRM_DIALOG_OK_BTN'),\n\t\t\tonOk: (messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tonOk();\n\t\t\t},\n\t\t\tonCancel: (messageBox: MessageBox) => {\n\t\t\t\tonCancel();\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t});\n\t}\n\n\t#changeRepeatSaleSegmentActive(isEnabled: boolean): void\n\t{\n\t\tRuntime.throttle(() => {\n\t\t\tAjax\n\t\t\t\t.runAction('crm.repeatsale.segment.active', {\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tid: this.#id,\n\t\t\t\t\t\tisEnabled: isEnabled ? 'Y' : 'N',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Text.encode(response.errors[0].message),\n\t\t\t\t\t\tautoHideDelay: 6000,\n\t\t\t\t\t});\n\n\t\t\t\t\tthrow response;\n\t\t\t\t})\n\t\t\t;\n\t\t}, 100)();\n\t}\n}\n\nnamespace.ActiveField = ActiveField;\n","import { Dom, Reflection, Tag } from 'main.core';\nimport { ProgressRound } from 'ui.progressround';\n\nconst namespace = Reflection.namespace('BX.Crm.RepeatSale.SegmentList');\n\ntype Borders = Border[];\n\ntype Border = {\n\tvalue?: number;\n\tcolor: string;\n\tid: string;\n}\n\nconst DEFAULT_BORDER = 'default';\nconst LOW_BORDER = 'lowBorder';\nconst HIGH_BORDER = 'highBorder';\n\nexport class RoundChartField\n{\n\t#id: string;\n\t#targetNode: string;\n\t#borders: ?Borders;\n\t#value: number;\n\t#valueContainer: HTMLElement;\n\n\tconstructor({ id, targetNodeId, borders, value })\n\t{\n\t\tthis.#id = id;\n\t\tthis.#targetNode = document.getElementById(targetNodeId);\n\t\tthis.#borders = borders ?? null;\n\t\tthis.#value = value;\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.#value === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#valueContainer = Tag.render`<div></div>`;\n\n\t\tconst content = Tag.render`\n\t\t\t<div class=\"crm-repeat-sale-segment-list-client-percent\">\n\t\t\t\t${this.#valueContainer}\n\t\t\t\t<div class=\"crm-repeat-sale-segment-list-client-percent-value\">\n\t\t\t\t\t${this.#value}\n\t\t\t\t\t<span class=\"crm-repeat-sale-segment-list-client-percent-percent\">%</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(content, this.#targetNode);\n\n\t\tconst loader = new ProgressRound({\n\t\t\twidth: 28,\n\t\t\tlineSize: 8,\n\t\t\tcolorBar: this.#getTrackColor(),\n\t\t\tcolorTrack: '#EBF1F6',\n\t\t\trotation: false,\n\t\t\tvalue: this.#value,\n\t\t\tcolor: ProgressRound.Color.SUCCESS,\n\t\t});\n\n\t\tloader.renderTo(this.#valueContainer);\n\t}\n\n\t#getTrackColor(): string\n\t{\n\t\tconst highBorder = this.#getBorderById(HIGH_BORDER);\n\t\tif (highBorder && this.#value >= highBorder?.value)\n\t\t{\n\t\t\treturn highBorder.color;\n\t\t}\n\n\t\tconst lowBorder = this.#getBorderById(LOW_BORDER);\n\t\tif (lowBorder && this.#value <= lowBorder?.value)\n\t\t{\n\t\t\treturn lowBorder.color;\n\t\t}\n\n\t\tconst defaultBorder = this.#getBorderById(DEFAULT_BORDER);\n\t\tif (defaultBorder)\n\t\t{\n\t\t\treturn defaultBorder.color;\n\t\t}\n\n\t\tthrow new RangeError('unknown track color');\n\t}\n\n\t#getBorderById(id: string): ?string\n\t{\n\t\treturn this.#borders.find((border) => {\n\t\t\treturn border.id === id;\n\t\t}) ?? null;\n\t}\n}\n\nnamespace.RoundChartField = RoundChartField;\n"],"names":["namespace","Reflection","ActionButton","SidePanel","Instance","console","error","open","cacheable","width","allowChangeHistory","ActiveField","id","targetNodeId","checked","readOnly","isFlowDisabled","document","getElementById","Runtime","loadExtension","then","exports","Switcher","switcher","disabled","handlers","event","stopPropagation","check","unchecked","Dom","clean","renderTo","onOk","onCancel","popupContainer","Tag","render","Loc","getMessage","MessageBox","show","modal","minHeight","minWidth","popupOptions","content","closeIcon","buttons","MessageBoxButtons","OK_CANCEL","okCaption","messageBox","close","isEnabled","throttle","Ajax","runAction","json","response","UI","Notification","Center","notify","Text","encode","errors","message","autoHideDelay","DEFAULT_BORDER","LOW_BORDER","HIGH_BORDER","RoundChartField","borders","value","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","append","loader","ProgressRound","lineSize","colorBar","colorTrack","rotation","color","Color","SUCCESS","highBorder","lowBorder","defaultBorder","RangeError","find","border"],"mappings":"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"}