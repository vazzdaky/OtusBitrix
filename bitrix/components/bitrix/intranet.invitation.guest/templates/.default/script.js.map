{"version":3,"file":"script.js","sources":["src/row.js","src/form.js"],"sourcesContent":["import { Cache, Tag, Loc, Type, Dom } from 'main.core';\nimport type { RowOptions } from './row-options';\n\nexport default class Row\n{\n\temail: string = null;\n\tname: ?string = null;\n\tlastName: ?string = null;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(rowOptions: RowOptions)\n\t{\n\t\tconst options = Type.isPlainObject(rowOptions) ? rowOptions : {};\n\n\t\tif (Type.isStringFilled(options.email))\n\t\t{\n\t\t\tthis.getEmailTextBox().value = options.email;\n\t\t}\n\n\t\tif (Type.isStringFilled(options.name))\n\t\t{\n\t\t\tthis.getNameTextBox().value = options.name;\n\t\t}\n\n\t\tif (Type.isStringFilled(options.lastName))\n\t\t{\n\t\t\tthis.getLastNameTextBox().value = options.lastName;\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\tconst email = this.getEmailTextBox().value.trim();\n\n\t\treturn !Type.isStringFilled(email);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tconst email = this.getEmail();\n\t\tconst name = this.getName();\n\t\tconst lastName = this.getLastName();\n\n\t\tif (Type.isStringFilled(email))\n\t\t{\n\t\t\tconst atom = '=_0-9a-z+~\\'!\\$&*^`|\\\\#%/?{}-';\n\t\t\tconst regExp = new RegExp('^[' + atom + ']+(\\\\.[' + atom + ']+)*@(([-0-9a-z]+\\\\.)+)([a-z0-9-]{2,20})$', 'i');\n\t\t\tif (!email.match(regExp))\n\t\t\t{\n\t\t\t\tDom.addClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\t\telse if (Type.isStringFilled(name) || Type.isStringFilled(lastName))\n\t\t{\n\t\t\tDom.addClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\t\t\treturn false;\n\t\t}\n\n\t\tDom.removeClass(this.getEmailTextBox().parentNode, 'ui-ctl-danger');\n\n\t\treturn true;\n\t}\n\n\tfocus()\n\t{\n\t\tthis.getEmailTextBox().focus();\n\t}\n\n\tgetEmail()\n\t{\n\t\treturn this.getEmailTextBox().value.trim();\n\t}\n\n\tgetName()\n\t{\n\t\treturn this.getNameTextBox().value.trim();\n\t}\n\n\tgetLastName()\n\t{\n\t\treturn this.getLastNameTextBox().value.trim();\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-form-row\">\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_EMAIL')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getEmailTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_NAME')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getNameTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-col\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_FIELD_LAST_NAME')}</div>\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100 ui-ctl-textbox\">\n\t\t\t\t\t\t\t${this.getLastNameTextBox()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetEmailTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('email', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"email\"\n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\tplaceholder=\"${Loc.getMessage('INTRANET_INVITATION_GUEST_ENTER_EMAIL')}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('name', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetLastNameTextBox(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('last-name', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input \n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n}","import { Type, Tag, Cache, Dom, ajax as Ajax, Loc, BaseError, Text, Runtime } from 'main.core';\nimport { ButtonManager } from 'ui.buttons';\nimport Row from './row';\nimport type { Button } from 'ui.buttons';\nimport type { FormOptions } from './form-options';\n\n\nexport default class Form\n{\n\ttargetNode: HTMLElement = null;\n\tcache = new Cache.MemoryCache();\n\tsaveButton: Button = null;\n\tcancelButton: Button = null;\n\trows: Row[] = [];\n\terror: typeof(BX.UI.Alert) = null;\n\tuserOptions: { [key: string]: any } = {};\n\n\tconstructor(formOptions: FormOptions)\n\t{\n\t\tconst options = Type.isPlainObject(formOptions) ? formOptions : {};\n\n\t\tthis.targetNode = options.targetNode;\n\t\tthis.userOptions = Type.isPlainObject(options.userOptions) ? options.userOptions : {};\n\t\tDom.append(this.getContainer(), this.targetNode);\n\n\t\tif (Type.isElementNode(options.saveButtonNode))\n\t\t{\n\t\t\tthis.saveButton = ButtonManager.createFromNode(options.saveButtonNode);\n\t\t\tthis.saveButton.bindEvent('click', this.handleSaveButtonClick.bind(this));\n\t\t}\n\n\t\tif (Type.isElementNode(options.cancelButtonNode))\n\t\t{\n\t\t\tthis.cancelButton = ButtonManager.createFromNode(options.cancelButtonNode);\n\t\t\tthis.cancelButton.bindEvent('click', this.handleCancelButtonClick.bind(this));\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.rows))\n\t\t{\n\t\t\toptions.rows.forEach(row => {\n\t\t\t\tthis.addRow(row);\n\t\t\t});\n\n\t\t\tthis.addRows(Math.max(2, 5 - options.rows.length));\n\t\t\tthis.getRows()[0].focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addRows();\n\t\t}\n\n\t\tRuntime.loadExtension('ui.hint').then(() => {\n\t\t\tconst hint = BX.UI.Hint.createInstance();\n\t\t\tconst node = hint.createNode(Loc.getMessage('INTRANET_INVITATION_GUEST_HINT'));\n\n\t\t\tconst title = document.querySelector('#pagetitle') || this.getTitleContainer();\n\t\t\tDom.append(node, title);\n\t\t});\n\t}\n\n\tgetRows(): Row[]\n\t{\n\t\treturn this.rows;\n\t}\n\n\tlock(): void\n\t{\n\t\tDom.style(this.getContainer(), 'pointer-events', 'none');\n\t}\n\n\tunlock(): void\n\t{\n\t\tDom.style(this.getContainer(), 'pointer-events', 'none');\n\t}\n\n\tsubmit(): Promise\n\t{\n\t\tlet valid = true;\n\t\tconst guests = [];\n\t\tlet invalidRow = null;\n\t\tthis.getRows().forEach((row: Row) => {\n\n\t\t\tif (!row.validate())\n\t\t\t{\n\t\t\t\tinvalidRow = invalidRow || row;\n\t\t\t\tvalid = false;\n\t\t\t}\n\n\t\t\tif (valid && !row.isEmpty())\n\t\t\t{\n\t\t\t\tguests.push({\n\t\t\t\t\temail: row.getEmail(),\n\t\t\t\t\tname: row.getName(),\n\t\t\t\t\tlastName: row.getLastName()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (!valid)\n\t\t{\n\t\t\treturn Promise.reject(new BaseError(\n\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_WRONG_DATA'),\n\t\t\t\t'wrong_data',\n\t\t\t\t{ invalidRow }\n\t\t\t));\n\t\t}\n\t\telse if (!Type.isArrayFilled(guests))\n\t\t{\n\t\t\treturn Promise.reject(new BaseError(\n\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_EMPTY_DATA'),\n\t\t\t\t'empty_data',\n\t\t\t\t{ invalidRow: this.getRows()[0] }\n\t\t\t));\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treturn Ajax.runComponentAction(\n\t\t\t\t'bitrix:intranet.invitation.guest',\n\t\t\t\t'addGuests',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tguests,\n\t\t\t\t\t\tuserOptions: this.userOptions\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\tresponse => {\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\treason => {\n\t\t\t\t\tconst error =\n\t\t\t\t\t\treason && Type.isArrayFilled(reason.errors)\n\t\t\t\t\t\t\t? reason.errors.map(error => Text.encode(error.message)).join('<br><br>')\n\t\t\t\t\t\t\t: 'Server Response Error'\n\t\t\t\t\t;\n\n\t\t\t\t\treject(new BaseError(\n\t\t\t\t\t\terror,\n\t\t\t\t\t\t'wrong_response'\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSaveButton(): ?Button\n\t{\n\t\treturn this.saveButton;\n\t}\n\n\tgetCancelButton(): ?Button\n\t{\n\t\treturn this.cancelButton;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-wrap\">\n\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t<div class=\"invite-content-container\">\n\t\t\t\t\t\t${this.getRowsContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"invite-form-buttons\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-sm ui-btn-light-border ui-btn-icon-add ui-btn-round\"\n\t\t\t\t\t\t\tonclick=\"${this.handleAddMoreClick.bind(this)}\">${\n\t\t\t\t\t\t\t\tLoc.getMessage('INTRANET_INVITATION_GUEST_ADD_MORE')\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRowsContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('rows-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-form-container\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('title-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"invite-title-container\">\n\t\t\t\t\t<div class=\"invite-title-icon invite-title-icon-message\"></div>\n\t\t\t\t\t<div class=\"invite-title-text\">${Loc.getMessage('INTRANET_INVITATION_GUEST_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\taddRow(rowOptions): Row\n\t{\n\t\tconst row = new Row(rowOptions);\n\t\tthis.rows.push(row);\n\t\tDom.append(row.getContainer(), this.getRowsContainer());\n\n\t\treturn row;\n\t}\n\n\taddRows(numberOfRows: number = 5): void\n\t{\n\t\tArray(numberOfRows).fill().forEach((el, index) => {\n\t\t\tconst row = this.addRow();\n\t\t\tif (index === 0)\n\t\t\t{\n\t\t\t\trow.focus();\n\t\t\t}\n\t\t});\n\t}\n\n\tremoveRows(): void\n\t{\n\t\tthis.getRows().forEach((row: Row) => {\n\t\t\tDom.remove(row.getContainer());\n\t\t});\n\n\t\tthis.rows = [];\n\t}\n\n\tshowError(reason: string): void\n\t{\n\t\tconst animate = this.error === null;\n\n\t\tthis.hideError();\n\n\t\tthis.error = new BX.UI.Alert({\n\t\t\tcolor: BX.UI.Alert.Color.DANGER,\n\t\t\tanimated: animate,\n\t\t\ttext: reason\n\t\t});\n\n\t\tDom.prepend(this.error.getContainer(), this.getContainer());\n\t}\n\n\thideError(): void\n\t{\n\t\tif (this.error !== null)\n\t\t{\n\t\t\tDom.remove(this.error.container);\n\t\t\tthis.error = null;\n\t\t}\n\t}\n\n\thandleSaveButtonClick(): void\n\t{\n\t\tif (this.getSaveButton().isWaiting())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSaveButton().setWaiting();\n\n\t\tthis.submit().then(response => {\n\t\t\tthis.getSaveButton().setWaiting(false);\n\n\t\t\tthis.hideError();\n\t\t\tthis.removeRows();\n\t\t\tthis.addRows();\n\n\t\t\tBX.SidePanel.Instance.postMessageAll(window, 'BX.Intranet.Invitation.Guest:onAdd', response.data);\n\t\t\tBX.SidePanel.Instance.close();\n\t\t}).catch((error: BaseError) => {\n\t\t\tthis.getSaveButton().setWaiting(false);\n\t\t\tthis.showError(error.getMessage());\n\n\t\t\tif (error.getCustomData() && error.getCustomData()['invalidRow'])\n\t\t\t{\n\t\t\t\terror.getCustomData()['invalidRow'].focus();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleCancelButtonClick(): void\n\t{\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\thandleAddMoreClick(): void\n\t{\n\t\tconst row = this.addRow();\n\t\trow.focus();\n\t}\n}"],"names":["Row","constructor","rowOptions","email","name","lastName","cache","Cache","MemoryCache","options","Type","isPlainObject","isStringFilled","getEmailTextBox","value","getNameTextBox","getLastNameTextBox","isEmpty","trim","validate","getEmail","getName","getLastName","atom","regExp","RegExp","match","Dom","addClass","parentNode","removeClass","focus","getContainer","remember","Tag","render","Loc","getMessage","Form","formOptions","targetNode","saveButton","cancelButton","rows","error","userOptions","append","isElementNode","saveButtonNode","ButtonManager","createFromNode","bindEvent","handleSaveButtonClick","bind","cancelButtonNode","handleCancelButtonClick","isArrayFilled","forEach","row","addRow","addRows","Math","max","length","getRows","Runtime","loadExtension","then","hint","BX","UI","Hint","createInstance","node","createNode","title","document","querySelector","getTitleContainer","lock","style","unlock","submit","valid","guests","invalidRow","push","Promise","reject","BaseError","resolve","Ajax","runComponentAction","mode","json","response","reason","errors","map","Text","encode","message","join","getSaveButton","getCancelButton","getRowsContainer","handleAddMoreClick","numberOfRows","Array","fill","el","index","removeRows","remove","showError","animate","hideError","Alert","color","Color","DANGER","animated","text","prepend","container","isWaiting","setWaiting","SidePanel","Instance","postMessageAll","window","data","close","catch","getCustomData"],"mappings":"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"}