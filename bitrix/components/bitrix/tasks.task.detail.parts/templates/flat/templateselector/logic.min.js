BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TaskDetailPartsTemplateSelector!="undefined"){return}BX.Tasks.Component.TaskDetailPartsTemplateSelector=BX.Tasks.Util.Widget.extend({sys:{code:"templateselector"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.templateBtn=document.getElementById("templateselector-open");BX.bind(this.templateBtn,"click",this.onPopupOpen.bind(this));this.menu=null;this.menuItems=null},onPopupOpen:function(t){t=t||window.event;var e=t.currentTarget;this.getMenuItems().then(function(t){this.menuItems=t;this.showMenu(e)}.bind(this))},showMenu:function(t){if(!this.menu){this.menu=this.createMenu(t)}this.menu.popupWindow.show();BX.addClass(t,"webform-button-active")},getMenuItems:function(){var t=new BX.Promise;if(this.option("menuItems").length){t.fulfill(this.option("menuItems"))}else if(this.menuItems){t.fulfill(this.menuItems)}else{BX.ajax.runComponentAction("bitrix:tasks.templates.list","getList",{mode:"class",data:{select:["ID","TITLE"],order:{ID:"DESC"},filter:{ZOMBIE:"N"}}}).then(function(e){t.fulfill(this.makeItemsFromResult(e))}.bind(this),function(e){t.reject()}.bind(this))}return t},makeItemsFromResult:function(t){var e=[];var n=this.option("commonUrl");var i=t.data;if(i&&i.length){var s=n+(n.indexOf("?")<0?"?":"&");var o=window.location.href;var a=window.location.pathname;var l=o.split(a)[1];var u=l.substr(1,l.length-1);var r=u.split("&");Object.keys(r).forEach((function(t){if(r[t].indexOf("IFRAME")===0||r[t].indexOf("TEMPLATE")===0){delete r[t]}}));r=r.filter((function(t){return t!==undefined}));if(r.length){s+=r.join("&")+"&"}BX.Tasks.each(i,(function(t){e.push({ID:parseInt(t.ID),TITLE:t.TITLE,URL:s+"TEMPLATE="+parseInt(t.ID)})}))}return e},createMenu:function(t){var e=[];var n=function(){this.popupWindow.close()};BX.Tasks.each(this.menuItems||[],(function(t){e.push({text:BX.util.htmlspecialchars(t.TITLE),title:t.TITLE,href:t.URL,onclick:n})}));e.push({delimiter:true});e.push({text:BX.util.htmlspecialchars(BX.message("TASKS_TTDP_TEMPLATESELECTOR_TO_LIST")),title:BX.util.htmlspecialchars(BX.message("TASKS_TTDP_TEMPLATESELECTOR_TO_LIST")),href:this.option("toTemplates"),target:"_top",onclick:n});var i=this.id()+"-form-transport";var s=new BX.PopupMenuWindow(i,t,e,{offsetLeft:20,closeByEsc:true,angle:{position:"top"},events:{onPopupClose:this.onPopupClose.bind(this)},maxWidth:300});if(!this.option("useSlider")){var o=s.menuItems;for(var a=0;a<o.length;a++){var l=o[a].layout;if(l&&l.item){l.item.dataset.sliderIgnoreAutobinding=true}}}return s},onPopupClose:function(){BX.removeClass(this.templateBtn,"webform-button-active")}}})}).call(this);
//# sourceMappingURL=logic.map.js