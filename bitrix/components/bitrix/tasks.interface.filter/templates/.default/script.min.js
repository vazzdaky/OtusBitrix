if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},keypress:function(e){},open:function(e,t){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate((function(e){this._control.setData(BX.util.htmlspecialcharsback(e.nameFormatted),e.id);if(!this.getSetting("multi")){this._selector.close()}}),this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(e){this._control=e;if(this._fieldId!==e.getId()){this._selector=null;this.close()}else{this._selector=e;this.open(e.field)}},onCustomEntitySelectorClose:function(e){if(this._fieldId!==e.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(e,t){var i=new BX.FilterEntitySelector(e,t);i.initialize(e,t);this.items[i.getId()]=i;return i}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(e){var t=null,i=e.selectorId,s=e.buttonAddId,n=e.pathTaskAdd.indexOf("?")===-1?e.pathTaskAdd+"?GROUP_ID=":e.pathTaskAdd+"&GROUP_ID=",o=e.messages,r=e.groups,a=e.currentGroup,l=e.groupLimit,c=e.offsetLeft;var d=function(e){if(BX(s)){BX(s).setAttribute("href",n+e)}};a.id=parseInt(a.id);a.text=BX.util.htmlspecialchars(a.text);d(a.id);BX.bind(BX(i),"click",(function(){if(t===null){var e=[];var s=function(e,n){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[n.id,a.id]);BX.onCustomEvent(window,"BX.Tasks.ChangeGroup",[n.id,a.id]);if(n.id!==a.id){var o=t.getMenuItems();t.addMenuItem({id:a.id,text:a.text,onclick:BX.delegate(s,this)},o.length>0?o[0]["id"]:null);if(n.id!=="wo"){if(t.getMenuItem(n.id)){t.removeMenuItem(n.id)}else if(o.length>=l){t.removeMenuItem(o[o.length-3].id)}}}t.close();a={id:n.id,text:n.text};d(n.id);if(BX(i+"_text")){BX(i+"_text").innerHTML=n.text}BX.onCustomEvent(this,"onTasksGroupSelectorChange",[a])};for(var n=0,u=r.length;n<u;n++){e.push({id:parseInt(r[n]["id"]),text:BX.util.htmlspecialchars(r[n]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(s,this)})}if(r.length>0){e.push({delimiter:true});e.push({id:"new",text:o.TASKS_BTN_GROUP_SELECT,onclick:function(e,i){t.getPopupWindow().setAutoHide(false);var n=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:i.getContainer(),id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});n.bindEvent("item-selected",(function(e){s(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});n.close()}));n.bindEvent("close",(function(e){t.getPopupWindow().setAutoHide(true)}));n.open()}})}if(!c){c=0}t=BX.PopupMenu.create(i,BX(i),e,{autoHide:true,closeByEsc:true,offsetLeft:c})}t.popupWindow.show()}))}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(e,t,i){t=t||"asc";if(BX.Main.gridManager!=undefined){var s=BX.Main.gridManager.getById(i).instance;s.sortByColumn({sort_by:e,sort_order:t});if(e==="SORTING"){s.getRows().enableDragAndDrop()}else{s.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:i,action:"setSort"}),{by:e,order:t},(function(e){try{e=JSON.parse(e);if(!e.error){window.location.reload()}}catch(e){}}))}}}}if(typeof BX.Tasks.SprintSelector==="undefined"){BX.Tasks.SprintSelector=function(e,t){if(!BX(e)){return}const i=BX.UI.ButtonManager.createFromNode(BX(e));BX.bind(BX(e),"click",(function(){var s=new BX.UI.EntitySelector.Dialog({targetNode:BX(e),width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,cacheable:false,preselectedItems:[["sprint-selector",t.sprintId]],entities:[{id:"sprint-selector",options:{groupId:t.groupId,onlyCompleted:true},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onSelect":function(s){var n=s.getData().item;t.sprintId=n.id;BX.onCustomEvent(BX(e),"onTasksGroupSelectorChange",[{id:t.groupId,sprintId:n.id,name:n.customData.get("name")}]);i.setText(n.customData.get("label"))}}});s.show()}))}}if(typeof BX.Tasks.ProjectSelector==="undefined"){BX.Tasks.ProjectSelector={reloadProject:function(e){var t=document.location.href;t=BX.util.add_url_param(t,{group_id:e});document.location.href=t}}}this.BX=this.BX||{};(function(e,t,i,s){"use strict";function n(e,t){r(e,t);t.add(e)}function o(e,t,i){r(e,t);t.set(e,i)}function r(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function a(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var l=new WeakMap;var c=new WeakMap;var d=new WeakSet;var u=new WeakSet;var h=new WeakSet;var p=new WeakSet;var f=new WeakSet;var g=function(){function e(t){babelHelpers.classCallCheck(this,e);n(this,f);n(this,p);n(this,h);n(this,u);n(this,d);o(this,l,{writable:true,value:void 0});o(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,l,t.filterId);a(this,d,m).call(this)}babelHelpers.createClass(e,[{key:"payAttention",value:function t(){var i=this;setTimeout((function(){i.guide.showNextStep();a(i,p,v).call(i)}),e.DELAY)}}]);return e}();function m(){var e;a(e=a(this,u,B).call(this),h,X).call(e)}function B(){babelHelpers.classPrivateFieldSet(this,c,BX.Main.filterManager.getById(babelHelpers.classPrivateFieldGet(this,l)));return this}function X(){this.guide=new t.Guide({simpleMode:true,onEvents:true,steps:[{target:babelHelpers.classPrivateFieldGet(this,c).getPopupBindElement(),title:i.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TITLE"),text:i.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TEXT"),position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});this.guide.getPopup().setWidth(420);return this}function v(){var e=this;i.ajax.runComponentAction("bitrix:tasks.interface.filter","markPresetAhaMomentViewed",{mode:"class",data:{}})["catch"]((function(t){a(e,f,S).call(e,t)}))}function S(e){console.log(e)}babelHelpers.defineProperty(g,"DELAY",1e3);function w(e,t){T(e,t);t.add(e)}function b(e,t,i){T(e,t);t.set(e,i)}function T(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function k(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var I=new WeakMap;var _=new WeakSet;var E=new WeakSet;var y=function e(t){babelHelpers.classCallCheck(this,e);w(this,E);w(this,_);b(this,I,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,I,t);k(this,_,P).call(this);k(this,E,C).call(this)};function P(){var e=this;if(!babelHelpers.classPrivateFieldGet(this,I).isV2Form||!babelHelpers.classPrivateFieldGet(this,I).createNode){return}var t=new s.Button({className:"ui-btn-main",text:i.Loc.getMessage("TASKS_BTN_CREATE_TASK"),onclick:function t(){new BX.Tasks.V2.Application.TaskCard({groupId:babelHelpers.classPrivateFieldGet(e,I).groupId,analytics:babelHelpers.classPrivateFieldGet(e,I).analytics}).showCompactCard()},props:{id:"tasks-buttonAdd"}});babelHelpers.classPrivateFieldGet(this,I).createNode.replaceWith(t.render())}function C(){if(!babelHelpers.classPrivateFieldGet(this,I).showPresetTourGuide){return}BX.Tasks.Preset.Aha=new BX.Tasks.Preset({filterId:babelHelpers.classPrivateFieldGet(this,I).filterId});BX.Tasks.Preset.Aha.payAttention()}e.Preset=g;e.TasksInterfaceFilter=y})(this.BX.Tasks=this.BX.Tasks||{},BX.UI.Tour,BX,BX.UI);
//# sourceMappingURL=script.map.js