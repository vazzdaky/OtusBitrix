{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { EditableColumnManager } from 'biconnector.grid.editable-columns';\nimport { Loc, Reflection, Text, ajax as Ajax } from 'main.core';\nimport { UI } from 'ui.notification';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { SidePanel } from 'main.sidepanel';\nimport 'ui.alerts';\n\ntype Props = {\n\tgridId: ?string,\n};\n\nclass SupersetDashboardTagGridManager\n{\n\t#grid: BX.Main.grid;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\n\t\tEditableColumnManager.init(\n\t\t\tprops.gridId,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tname: 'TITLE',\n\t\t\t\t\tsaveEndpoint: 'biconnector.dashboardTag.rename',\n\t\t\t\t\tonValueCheck: (newValue) => {\n\t\t\t\t\t\tif (newValue.trim() === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_TITLE_ERROR_EMPTY'),\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\tonSave: (rowId, newValue) => {\n\t\t\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_RENAME_TITLE_SUCCESS', {\n\t\t\t\t\t\t\t'#NEW_TITLE#': Text.encode(newValue),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: msg,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.#sendChangeEventMessage(rowId, newValue);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t);\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\treturn this.#grid;\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n\n\tdeleteTag(tagId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(tagId);\n\t\tconst count = row.getEditData().DASHBOARD_COUNT;\n\t\tif (!count)\n\t\t{\n\t\t\tthis.#delete(tagId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst messageBox = MessageBox.confirm(\n\t\t\tLoc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_DELETE_POPUP'),\n\t\t\t() => {\n\t\t\t\tthis.#delete(tagId);\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t\tLoc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_DELETE_POPUP_YES'),\n\t\t);\n\t}\n\n\t#delete(tagId: number): Promise\n\t{\n\t\treturn Ajax.runAction('biconnector.dashboardTag.delete', {\n\t\t\tdata: {\n\t\t\t\tid: tagId,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.getGrid().removeRow(tagId, null, null, () => {\n\t\t\t\t\tthis.#sendDeleteEventMessage(tagId);\n\t\t\t\t});\n\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_TAG_LIST_DELETE_SUCCESS');\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: msg,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#sendChangeEventMessage(tagId: number, title: number): void\n\t{\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.postMessage(window, 'BIConnector.Superset.DashboardTagGrid:onTagChange', { tagId, title });\n\t\t}\n\t}\n\n\t#sendDeleteEventMessage(tagId: number): void\n\t{\n\t\tif (SidePanel.Instance)\n\t\t{\n\t\t\tSidePanel.Instance.postMessage(window, 'BIConnector.Superset.DashboardTagGrid:onTagDelete', { tagId });\n\t\t}\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardTagGridManager = SupersetDashboardTagGridManager;\n"],"names":["SupersetDashboardTagGridManager","props","BX","Main","gridManager","getById","gridId","instance","EditableColumnManager","init","name","saveEndpoint","onValueCheck","newValue","trim","UI","Notification","Center","notify","content","Loc","getMessage","onSave","rowId","msg","Text","encode","tagId","grid","getGrid","row","getRows","count","getEditData","DASHBOARD_COUNT","messageBox","MessageBox","confirm","close","errors","message","Ajax","runAction","data","id","then","removeRow","response","title","SidePanel","Instance","postMessage","window","Reflection","namespace"],"mappings":";;;;;;;;AAAA,CAKmB;CAAA;CAAA;CAAA;CAAA;CAAA,IAMbA,+BAA+B;GAIpC,yCAAYC,KAAY,EACxB;KAAA;OAAA;KAAA;KAAA;KAAA;KAAA;KAAA;KAAA;OAAA;OAAA;;KACC,sCAAI,kCAASC,EAAE,CAACC,IAAI,CAACC,WAAW,CAACC,OAAO,CAACJ,KAAK,CAACK,MAAM,CAAC,0DAAzC,sBAA2CC,QAAQ;KAEhEC,sDAAqB,CAACC,IAAI,CACzBR,KAAK,CAACK,MAAM,EACZ,CACC;OACCI,IAAI,EAAE,OAAO;OACbC,YAAY,EAAE,iCAAiC;OAC/CC,YAAY,EAAE,sBAACC,QAAQ,EAAK;SAC3B,IAAIA,QAAQ,CAACC,IAAI,EAAE,KAAK,EAAE,EAC1B;WACCC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;aAC7BC,OAAO,EAAEC,aAAG,CAACC,UAAU,CAAC,kEAAkE;YAC1F,CAAC;WAEF,OAAO,KAAK;;SAGb,OAAO,IAAI;QACX;OACDC,MAAM,EAAE,gBAACC,KAAK,EAAEV,QAAQ,EAAK;SAC5B,IAAMW,GAAG,GAAGJ,aAAG,CAACC,UAAU,CAAC,qEAAqE,EAAE;WACjG,aAAa,EAAEI,cAAI,CAACC,MAAM,CAACb,QAAQ;UACnC,CAAC;SAEFE,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7BC,OAAO,EAAEK;UACT,CAAC;SAEF,4BAAI,0DAAJ,KAAI,EAAyBD,KAAK,EAAEV,QAAQ;;MAE7C,CACD,CACD;;GACD;KAAA;KAAA,0BAGD;OACC,yCAAO,IAAI;;;KACX;KAAA,0BAYSc,KAAa,EACvB;OAAA;OACC,IAAMC,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;OAC3B,IAAMC,GAAG,GAAGF,IAAI,CAACG,OAAO,EAAE,CAAC1B,OAAO,CAACsB,KAAK,CAAC;OACzC,IAAMK,KAAK,GAAGF,GAAG,CAACG,WAAW,EAAE,CAACC,eAAe;OAC/C,IAAI,CAACF,KAAK,EACV;SACC,2BAAI,0BAAJ,IAAI,EAASL,KAAK;SAElB;;OAGD,IAAMQ,UAAU,GAAGC,gCAAU,CAACC,OAAO,CACpCjB,aAAG,CAACC,UAAU,CAAC,6DAA6D,CAAC,EAC7E,YAAM;SACL,6BAAI,0BAAJ,MAAI,EAASM,KAAK;SAClBQ,UAAU,CAACG,KAAK,EAAE;QAClB,EACDlB,aAAG,CAACC,UAAU,CAAC,iEAAiE,CAAC,CACjF;;;GACD;CAAA;CAAA,wBA9BakB,MAAa,EAC3B;GACC,IAAIA,MAAM,CAAC,CAAC,CAAC,IAAIA,MAAM,CAAC,CAAC,CAAC,CAACC,OAAO,EAClC;KACCtC,EAAE,CAACa,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;OAChCC,OAAO,EAAEM,cAAI,CAACC,MAAM,CAACa,MAAM,CAAC,CAAC,CAAC,CAACC,OAAO;MACtC,CAAC;;CAEJ;CAAC,kBAwBOb,KAAa,EACrB;GAAA;GACC,OAAOc,cAAI,CAACC,SAAS,CAAC,iCAAiC,EAAE;KACxDC,IAAI,EAAE;OACLC,EAAE,EAAEjB;;IAEL,CAAC,CACAkB,IAAI,CAAC,YAAM;KACX,MAAI,CAAChB,OAAO,EAAE,CAACiB,SAAS,CAACnB,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,YAAM;OACjD,6BAAI,0DAAJ,MAAI,EAAyBA,KAAK;MAClC,CAAC;KACF,IAAMH,GAAG,GAAGJ,aAAG,CAACC,UAAU,CAAC,+DAA+D,CAAC;KAE3FN,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;OAC7BC,OAAO,EAAEK;MACT,CAAC;IACF,CAAC,SACI,CAAC,UAACuB,QAAQ,EAAK;KACpB,IAAIA,QAAQ,CAACR,MAAM,EACnB;OACC,6BAAI,sCAAJ,MAAI,EAAeQ,QAAQ,CAACR,MAAM;;IAEnC,CAAC;CAEJ;CAAC,kCAEuBZ,KAAa,EAAEqB,KAAa,EACpD;GACC,IAAIC,wBAAS,CAACC,QAAQ,EACtB;KACCD,wBAAS,CAACC,QAAQ,CAACC,WAAW,CAACC,MAAM,EAAE,mDAAmD,EAAE;OAAEzB,KAAK,EAALA,KAAK;OAAEqB,KAAK,EAALA;MAAO,CAAC;;CAE/G;CAAC,kCAEuBrB,KAAa,EACrC;GACC,IAAIsB,wBAAS,CAACC,QAAQ,EACtB;KACCD,wBAAS,CAACC,QAAQ,CAACC,WAAW,CAACC,MAAM,EAAE,mDAAmD,EAAE;OAAEzB,KAAK,EAALA;MAAO,CAAC;;CAExG;AAGD0B,qBAAU,CAACC,SAAS,CAAC,gBAAgB,CAAC,CAACtD,+BAA+B,GAAGA,+BAA+B;;;;"}