(function(e,t,n,r){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){l(e,t);t.add(e)}function c(e,t,n){l(e,t);t.set(e,n)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function s(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var u=new WeakMap;var d=new WeakMap;var f=new WeakSet;var v=new WeakSet;var p=new WeakSet;var h=function(){function e(r){var i;babelHelpers.classCallCheck(this,e);o(this,p);o(this,v);o(this,f);c(this,u,{writable:true,value:void 0});c(this,d,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,u,(i=BX.Main.gridManager.getById(r.gridId))===null||i===void 0?void 0:i.instance);babelHelpers.classPrivateFieldSet(this,d,BX.Main.filterManager.getById(r.gridId));s(this,v,g).call(this);s(this,f,b).call(this);t.EditableColumnManager.init(r.gridId,[{name:"DESCRIPTION",saveEndpoint:"biconnector.externalsource.source.updateComment",onValueCheck:function e(){return true},onSave:function e(){BX.UI.Notification.Center.notify({content:n.Text.encode(n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_COMMENT_UPDATED"))})}}])}babelHelpers.createClass(e,[{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"getFilter",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"handleCreatedByClick",value:function e(t){this.handleDatasetFilterChange(a({fieldId:"CREATED_BY_ID"},t))}},{key:"handleDatasetFilterChange",value:function e(t){var n,r;var i=this.getFilter().getFilterFieldsValues();var a=(n=i[t.fieldId])!==null&&n!==void 0?n:[];var o=(r=i["".concat(t.fieldId,"_label")])!==null&&r!==void 0?r:[];if(t.IS_FILTERED){a=a.filter((function(e){return parseInt(e,10)!==t.ID}));o=o.filter((function(e){return e!==t.TITLE}))}else if(!a.includes(t.ID)){a.push(t.ID);o.push(t.TITLE)}var c=this.getFilter().getApi();var l={};l[t.fieldId]=a;l["".concat(t.fieldId,"_label")]=o;c.extendFilter(l);c.apply()}},{key:"openSourceDetail",value:function e(t,r){var i="";var a=0;if(r==="BI"){i=new n.Uri("/bitrix/components/bitrix/biconnector.externalconnection/slider.php?sourceId=".concat(t));a=564}else if(r==="CRM"){i=new n.Uri("/crm/tracking/source/edit/".concat(t,"/"));a=900}else{return}BX.SidePanel.Instance.open(i.toString(),{width:a,allowChangeHistory:false,cacheable:false,events:{onClose:BX.BIConnector.TrackingAnalyticsHandler.handleSliderClose}})}},{key:"openCreateSourceSlider",value:function e(){var t=new n.Uri("/bitrix/components/bitrix/biconnector.apachesuperset.source.connect.list/slider.php");BX.SidePanel.Instance.open(t.toString(),{width:900,allowChangeHistory:false,cacheable:false})}},{key:"changeActivitySource",value:function e(t,r){var i=this;n.ajax.runAction("biconnector.externalsource.source.changeActivity",{data:{id:t,moduleId:r}}).then((function(){i.getGrid().reload()}))["catch"]((function(e){if(e.errors){s(i,p,I).call(i,e.errors)}}))}},{key:"deleteSource",value:function e(t,r){var i=this;n.ajax.runAction("biconnector.externalsource.source.delete",{data:{id:t,moduleId:r}}).then((function(){i.getGrid().reload()}))["catch"]((function(e){if(e.errors){s(i,p,I).call(i,e.errors)}}))}}]);return e}();function b(){var e=this;r.EventEmitter.subscribe("Grid::updated",(function(){s(e,v,g).call(e)}));r.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(t){var n=t.getData(),r=babelHelpers.slicedToArray(n,1),i=r[0];var a=i.getEventId();if(a==="BIConnector:ExternalConnectionGrid:reload"||a==="BIConnector:ExternalConnection:onConnectionSave"){babelHelpers.classPrivateFieldGet(e,u).reload()}}))}function g(){var e=BX.UI.Hint.createInstance({popupParameters:{autoHide:true}});e.init(babelHelpers.classPrivateFieldGet(this,u).getContainer())}function I(e){if(e[0]&&e[0].message){BX.UI.Notification.Center.notify({content:n.Text.encode(e[0].message)})}}n.Reflection.namespace("BX.BIConnector").ExternalSourceManager=h})(this.window=this.window||{},BX.BIConnector.Grid,BX,BX.Event);
//# sourceMappingURL=script.map.js