{"version":3,"file":"chart-wizard.bundle.js","sources":["../src/components/tree-preview/head-users.js","../src/components/tree-preview/tree-node.js","../src/components/tree-preview/tree-preview.js","../src/components/team-color-picker/team-color-picker.js","../src/components/steps/department.js","../src/components/change-save-mode-control/change-save-mode-control.js","../src/components/steps/employees.js","../src/components/responsive-hint/responsive-hint.js","../src/components/responsive-hint/default-hint.js","../src/components/steps/bind-chat.js","../src/components/steps/entities.js","../src/consts.js","../src/components/steps/team-rights.js","../src/api.js","../src/actions.js","../src/components/wizard.js"],"sourcesContent":["import { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const HeadUsers = {\n\tname: 'headUsers',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t},\n\n\tprops: {\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tshowPlaceholder: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisExistingDepartment: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserType: {\n\t\t\ttype: String,\n\t\t\tdefault: 'head',\n\t\t},\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { headsVisible: boolean; }\n\t{\n\t\treturn {\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\theadItemsCount(): number\n\t\t{\n\t\t\treturn this.isExistingDepartment ? 1 : 2;\n\t\t},\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tplaceholderAvatar(): string\n\t\t{\n\t\t\tif (!this.isTeamEntity || !this.teamColor)\n\t\t\t{\n\t\t\t\treturn '/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/placeholder-avatar.svg';\n\t\t\t}\n\n\t\t\treturn `/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/${this.teamColor.avatarImage}`;\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.users.map((user: UserData): UserData => {\n\t\t\t\tconst workPosition = user.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION');\n\n\t\t\t\treturn { ...user, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t\tisDeputy(): boolean\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\t:class=\"{ '--deputy': isDeputy }\"\n\t\t\tv-for=\"(user, index) in users.slice(0, headItemsCount)\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"user.avatar || defaultAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{ '--deputy': isDeputy, '--old': isExistingDepartment }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\" :class=\"{'--deputy': isDeputy }\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-name --crop\"\n\t\t\t\t\t:class=\"{'--old': isExistingDepartment }\"\n\t\t\t\t>\n\t\t\t\t\t{{ user.name }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!isDeputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t\t:class=\"{'--old': isExistingDepartment }\"\n\t\t\t\t>\n\t\t\t\t\t{{ user.workPosition || loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tv-if=\"index === headItemsCount - 1 && users.length > headItemsCount\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-rest\"\n\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\tref=\"showMoreHeadUserWizardList\"\n\t\t\t\t:data-test-id=\"'hr-company-structure_chart-wizard-tree__preview-' + userType + '-rest'\"\n\t\t\t\t@click.stop=\"headsVisible = true\"\n\t\t\t>\n\t\t\t\t\t{{ '+' + String(users.length - headItemsCount) }}\n\t\t\t</span>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"users.length === 0 && showPlaceholder\"\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\t:class=\"{ '--deputy': isDeputy }\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"placeholderAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{'--deputy': isDeputy, '--old': isExistingDepartment  }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__placeholder_name\"\n\t\t\t\t\t:class=\"{'--deputy': isDeputy, '--team': isTeamEntity }\"\n\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.namePlaceholder : false }\"\n\t\t\t\t></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!isDeputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"isDeputy ? 'wizard-head-list-popup-deputy' : 'wizard-head-list-popup-head' \"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadUserWizardList[0]\"\n\t\t\t@close=\"headsVisible = false\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { Loader } from 'main.loader';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Loc } from 'main.core';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { HeadUsers } from './head-users';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { DepartmentData } from '../../types';\n\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: { HeadUsers },\n\n\tprops: {\n\t\tname: String,\n\t\theads: Array,\n\t\tuserCount: Number,\n\t\tnodeId: Number,\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\t/** @type NodeColorSettingsType | null */\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { isShowLoader: boolean; }\n\t{\n\t\treturn { isShowLoader: false };\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.memberRoles = getMemberRoles(this.departmentData.entityType);\n\t},\n\n\twatch:\n\t{\n\t\tisShowLoader(newValue: boolean): void\n\t\t{\n\t\t\tif (!newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst { loaderContainer } = this.$refs;\n\t\t\t\tconst loader = new Loader({ size: 30 });\n\t\t\t\tloader.show(loaderContainer);\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdepartmentData(): DepartmentData | { name: string, ...Partial<DepartmentData> }\n\t\t{\n\t\t\tif (this.isExistingDepartment)\n\t\t\t{\n\t\t\t\tif (!this.isHeadsLoaded)\n\t\t\t\t{\n\t\t\t\t\tthis.loadHeads([this.nodeId]);\n\t\t\t\t}\n\n\t\t\t\treturn this.departments.get(this.nodeId);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tname: this.name,\n\t\t\t\theads: this.heads,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t\tentityType: this.entityType,\n\t\t\t};\n\t\t},\n\t\tisExistingDepartment(): boolean\n\t\t{\n\t\t\treturn Boolean(this.nodeId);\n\t\t},\n\t\temployeesCount(): number\n\t\t{\n\t\t\treturn (this.userCount || 0) - (this.heads?.length || 0);\n\t\t},\n\t\theadUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputyUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\tshowInfo(): boolean\n\t\t{\n\t\t\treturn this.nodeId\n\t\t\t\t? PermissionChecker.getInstance().hasPermission(PermissionActions.structureView, this.nodeId)\n\t\t\t\t: true;\n\t\t},\n\t\tisHeadsLoaded(departmentId: number): boolean\n\t\t{\n\t\t\tconst { heads } = this.departments.get(this.nodeId);\n\n\t\t\treturn Boolean(heads);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departmentData.entityType === EntityTypes.team;\n\t\t},\n\t\tdataTestIdSuffix(): string\n\t\t{\n\t\t\treturn this.isExistingDepartment ? '' : '_new';\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tasync loadHeads(departmentIds: number[]): Promise<void>\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.isShowLoader = true;\n\t\t\t\tawait store.loadHeads(departmentIds);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.isShowLoader = false;\n\t\t\t}\n\t\t},\n\t\tformatDataTestId(prefix: string): string\n\t\t{\n\t\t\treturn prefix + this.dataTestIdSuffix;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node\"\n\t\t\t:class=\"{ '--new': !isExistingDepartment, '--old': isExistingDepartment,'--team': isTeamEntity }\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"chart-wizard-tree-preview__node_summary\" \n\t\t\t\t:class=\"{ '--old': isExistingDepartment, '--team': isTeamEntity }\"\n\t\t\t\t:style=\"{ '--team-border-color': teamColor?.previewBorder }\"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_name --crop\"\n\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_name')\"\n\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.headBackground : false }\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"!departmentData.name\" \n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__placeholder_node_name\"\n\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.namePlaceholder : false }\"\n\t\t\t\t\t></span>\n\t\t\t\t\t{{departmentData.name}}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_content\"\n\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__head_list')\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__head_list\"\n\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__head_list')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\tv-if=\"showInfo && headUsers\"\n\t\t\t\t\t\t\t:users=\"headUsers\"\n\t\t\t\t\t\t\t:showPlaceholder=\"!isExistingDepartment\"\n\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t\t:isExistingDepartment=\"isExistingDepartment\"\n\t\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t\t/> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"isShowLoader\" ref=\"loaderContainer\"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"showInfo && !isExistingDepartment\"\n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees-list\"\n\t\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_employees-list')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_EMPLOYEES_TITLE') \n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<span class=\"chart-wizard-tree-preview__node_employees_count\">\n\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_COUNT', employeesCount)}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_deputies\"\n\t\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_deputies-list')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPUTIES_TITLE')}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\t\t:users=\"deputyUsers\"\n\t\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t\t\t:isExistingDepartment=\"isExistingDepartment\"\n\t\t\t\t\t\t\t\tuserType=\"deputy\"\n\t\t\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot v-if=\"isExistingDepartment\"></slot>\n\t\t</div>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { TreeNode } from './tree-node';\nimport { EntityTypes, type NodeColorSettingsType } from 'humanresources.company-structure.utils';\nimport './style.css';\n\nexport const TreePreview = {\n\tname: 'treePreview',\n\n\tcomponents: { TreeNode },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tuserCount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\t/** @type NodeColorSettingsType | null */\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst parentNode = this.departments.get(this.parentId);\n\t\t\tif (parentNode)\n\t\t\t{\n\t\t\t\treturn parentNode.parentId ?? 0;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\t\tcompanyName(): string\n\t\t{\n\t\t\tconst { name } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn name;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard-tree-preview\">\n\t\t\t<div class=\"chart-wizard-tree-preview__header\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_text\">\n\t\t\t\t\t{{\n\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_TITLE')\n\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPARTMENT_TITLE')\n\t\t\t\t\t}}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_name\">\n\t\t\t\t\t{{ companyName }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tv-if=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t>\n\t\t\t\t<TreeNode :nodeId=\"parentId\">\n\t\t\t\t\t<TreeNode\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t></TreeNode>\n\t\t\t\t</TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else-if=\"parentId\"\n\t\t\t\t:nodeId=\"parentId\"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t></TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else\n\t\t\t\t:name=\"name\"\n\t\t\t\t:heads=\"heads\"\n\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t></TreeNode>\n\t\t</div>\n\t`,\n};\n","import { BasePopup } from 'humanresources.company-structure.structure-components';\nimport type { PopupOptions } from 'main.popup';\nimport { NodeColorsSettingsDict } from 'humanresources.company-structure.utils';\n\n// @vue/component\nexport const TeamColorPicker = {\n\tname: 'TeamColorPicker',\n\n\tcomponents: {\n\t\tBasePopup,\n\t},\n\n\tprops: {\n\t\t/** @type NodeColorSettingsType */\n\t\tmodelValue: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['action', 'close', 'update:modelValue'],\n\n\tcomputed:\n\t{\n\t\tpopupConfig(): PopupOptions\n\t\t{\n\t\t\tconst popupWidth = 164;\n\t\t\tconst pickerWidth = 41;\n\t\t\tconst initialPopupOffset = 39;\n\t\t\tconst angleWidth = 33;\n\n\t\t\treturn {\n\t\t\t\twidth: popupWidth,\n\t\t\t\theight: 116,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tborderRadius: 12,\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tpadding: 0,\n\t\t\t\toffsetTop: 4,\n\t\t\t\toffsetLeft: pickerWidth / 2 - popupWidth / 2 + initialPopupOffset,\n\t\t\t\tangleOffset: popupWidth / 2 - angleWidth / 2,\n\t\t\t};\n\t\t},\n\t\tnodeColorsSettingsDict(): typeof NodeColorsSettingsDict => NodeColorsSettingsDict\n\t\t{\n\t\t\treturn NodeColorsSettingsDict;\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<BasePopup\n\t\t\t:config=\"popupConfig\"\n\t\t\t:id=\"'chart_wizard__department__color-picker_popup'\"\n\t\t\t@close=\"close\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"chart_wizard__department__color-picker_popup-container\"\n\t\t\t\t:data-test-id=\"'wizard-department-color-picker-popup'\"\n\t\t\t>\n\t\t\t\t<div v-for=\"item in nodeColorsSettingsDict\" \n\t\t\t\t\t class=\"chart_wizard__department__color-picker_color-item\"\n\t\t\t\t\t :class=\" {'--active': item.name === modelValue.name }\"\n\t\t\t\t\t @click=\"$emit('update:modelValue', item)\"\n\t\t\t\t\t :data-test-id=\"'wizard-department-color-picker-item-'+item.name\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"chart_wizard__department__color-picker_color-item_inner\"\n\t\t\t\t\t\t :style=\"{ 'background-color': item.pickerColor }\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`,\n};\n","import { TeamColorPicker } from '../team-color-picker/team-color-picker';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, type NodeColorSettingsType } from 'humanresources.company-structure.utils';\nimport { type BaseEvent } from 'main.core.events';\nimport { TagSelector, type Item } from 'ui.entity-selector';\nimport { MemoryCache } from 'main.core.cache';\n\ntype DepartmentStepDataType = {\n\tdeniedError: boolean,\n\tshowColorPicker: boolean,\n\tteamColorValue: NodeColorSettingsType | null,\n}\n\n// @vue/component\nexport const Department = {\n\tname: 'department',\n\n\tcomponents: { TeamColorPicker },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshouldErrorHighlight: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t\trefToFocus: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tdata(): DepartmentStepDataType\n\t{\n\t\treturn {\n\t\t\tdeniedError: false,\n\t\t\tshowColorPicker: false,\n\t\t\tteamColorValue: this.teamColor,\n\t\t};\n\t},\n\n\twatch:\n\t{\n\t\tisTeamEntity(): void\n\t\t{\n\t\t\t// tag selector is not valid now\n\t\t\tthis.recreateTagSelector();\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedParentDepartment = this.parentId;\n\t\tthis.departmentName = this.name;\n\t\tthis.departmentDescription = this.description;\n\t\tthis.departmentSelectorCashe = new MemoryCache();\n\t\tthis.departmentsSelector = this.getOrCreateTagSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.teamColorValue = this.teamColor;\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid:\n\t\t\t\tthis.departmentName !== ''\n\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t&& !this.deniedError\n\t\t\t,\n\t\t});\n\n\t\tif (this.refToFocus && this.$refs[this.refToFocus])\n\t\t{\n\t\t\tthis.$refs[this.refToFocus].focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.$refs.title.focus();\n\t\t}\n\t},\n\n\tmethods:\n\t{\n\t\trecreateTagSelector(): void\n\t\t{\n\t\t\tthis.$refs['tag-selector'].innerHTML = '';\n\t\t\tthis.departmentsSelector = this.getOrCreateTagSelector();\n\t\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t\t},\n\t\tcreateTagSelector(): TagSelector\n\t\t{\n\t\t\tconst locked = this.parentId === 0 && this.isEditMode;\n\t\t\tlet preselectedItems = this.parentId ? [['structure-node', this.parentId]] : [];\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\tconst permissionAction = this.isTeamEntity ? PermissionActions.teamCreate : PermissionActions.departmentCreate;\n\t\t\t\tif (\n\t\t\t\t\tpermissionChecker\n\t\t\t\t\t&& !permissionChecker.hasPermission(permissionAction, this.parentId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tpreselectedItems = [['structure-node', 0]];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isTabEmpty = (tab) => tab.getRootNode().getChildren().count() === 0;\n\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tlocked,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t\trestricted: this.isEditMode ? 'update' : 'create',\n\t\t\t\t\t\t\t\tincludedNodeEntityTypes: this.includedNodeEntityTypesInDialog,\n\t\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tconst dialog = selector.getDialog();\n\n\t\t\t\t\t\t\tdialog.getTabs()\n\t\t\t\t\t\t\t\t.filter((tab) => isTabEmpty(tab))\n\t\t\t\t\t\t\t\t.forEach((tab) => tab.setVisible(false))\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tif (this.isEditMode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\t\t\t\t\t\t\tconst nodes = target.items.get('structure-node');\n\n\t\t\t\t\t\t\tconst permissionAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamCreate\n\t\t\t\t\t\t\t\t: PermissionActions.departmentCreate\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tfor (const [, node] of nodes)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif \t(\n\t\t\t\t\t\t\t\t\tpermissionChecker.hasPermission(permissionAction, node.id)\n\t\t\t\t\t\t\t\t\t&& !permissionChecker.hasPermission(permissionAction, selectedItem?.id ?? 0)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tnode.select();\n\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoadError: () => {\n\t\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onSelect': (event: BaseEvent<{ item: Item }>) => {\n\t\t\t\t\t\t\tthis.deniedError = false;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst permissionCreateAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamCreate\n\t\t\t\t\t\t\t\t: PermissionActions.departmentCreate\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst permissionEditAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamEdit\n\t\t\t\t\t\t\t\t: PermissionActions.departmentEdit\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst permissionAction = this.isEditMode\n\t\t\t\t\t\t\t\t? permissionEditAction\n\t\t\t\t\t\t\t\t: permissionCreateAction\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tif (!permissionChecker.hasPermission(permissionAction, selectedItem.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.deniedError = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn selector;\n\t\t},\n\t\tgetOrCreateTagSelector(): TagSelector\n\t\t{\n\t\t\tconst key = String(this.isTeamEntity);\n\n\t\t\treturn this.departmentSelectorCashe.remember(key, () => this.createTagSelector());\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tname: this.departmentName,\n\t\t\t\tdescription: this.departmentDescription,\n\t\t\t\tparentId: this.selectedParentDepartment,\n\t\t\t\tteamColor: this.teamColorValue,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t\tisValid:\n\t\t\t\t\tthis.departmentName !== ''\n\t\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t\t&& !this.deniedError\n\t\t\t\t,\n\t\t\t});\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tincludedNodeEntityTypesInDialog(): string[]\n\t\t{\n\t\t\treturn this.isTeamEntity ? ['department', 'team'] : ['department'];\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\tnamePlaceholder(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_PLACEHOLDER_MSGVER_1')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_PLACEHOLDER');\n\t\t},\n\t\tdescriptionPlaceholder(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_DESCR_PLACEHOLDER')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_PLACEHOLDER');\n\t\t},\n\t\thigherLevelDepartmentContainer(): string\n\t\t{\n\t\t\t// for team entity department tag selector should be placed after name and description\n\t\t\t// to presumably encourage user to fill in the description field\n\t\t\treturn this.isTeamEntity ? '.chart-wizard__department_higher_bottom' : '.chart-wizard__department_higher_top';\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__department\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<Teleport defer :to=\"higherLevelDepartmentContainer\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_WITH_TEAM_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_LABEL')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': deniedError || (selectedParentDepartment === null && shouldErrorHighlight) }\"\n\t\t\t\t\t\tref=\"tag-selector\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"deniedError || (selectedParentDepartment === null && shouldErrorHighlight)\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if=\"deniedError\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__department_item-error-message\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ADD_TO_DEPARTMENT_DENIED_MSG_VER_1') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"chart-wizard__department_item-error-message\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_PARENT_ERROR')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_PARENT_ERROR')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</Teleport>\n\t\t\t\t<div\n\t\t\t\t\tv-show=\"!isTeamEntity\"\n\t\t\t\t\tclass=\"chart-wizard__department_item chart-wizard__department_higher_top\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TEAM_NAME_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_LABEL') \n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"chart-wizard__department_control-wrapper\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-ctl ui-ctl-textbox\"\n\t\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': shouldErrorHighlight && departmentName === '' }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tv-model=\"departmentName\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\t\t\t:placeholder=\"namePlaceholder\"\n\t\t\t\t\t\t\t\t@input=\"applyData()\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"isTeamEntity\" \n\t\t\t\t\t\t\t class=\"chart-wizard__department__color-picker\" \n\t\t\t\t\t\t\t @click=\"showColorPicker = true\"\n\t\t\t\t\t\t\t ref=\"TeamColorPicker\"\n\t\t\t\t\t\t\t :data-test-id=\"'wizard-department-color-picker'\"\n\t\t\t\t\t\t\t :class=\"{ '--active': showColorPicker }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__department__color-picker_inner\"\n\t\t\t\t\t\t\t\t :style=\"{ 'background-color': teamColorValue?.pickerColor }\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"shouldErrorHighlight && departmentName === ''\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_ERROR')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_ERROR')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_LABEL') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"departmentDescription\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tref=\"description\"\n\t\t\t\t\t\t\t:placeholder=\"descriptionPlaceholder\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-show=\"isTeamEntity\"\n\t\t\t\t\tclass=\"chart-wizard__department_item chart-wizard__department_higher_bottom\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<TeamColorPicker\n\t\t\t\tv-if=\"showColorPicker\"\n\t\t\t\t:bindElement=\"$refs.TeamColorPicker\"\n\t\t\t\tv-model=\"teamColorValue\"\n\t\t\t\t@update:model-value=\"applyData()\"\n\t\t\t\t@close=\"showColorPicker = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { getColorCode } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { CRM, Main } from 'ui.icon-set.api.core';\nimport './style.css';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChangeSaveModeControl = {\n\tname: 'changeSaveModeControl',\n\temits: ['saveModeChanged'],\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItems = this.getMenuItems();\n\t},\n\n\tdata(): { menuVisible: boolean; actionId: MenuOption.moveUsers | MenuOption.addUsers }\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tactionId: MenuOption.moveUsers,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.actionId = actionId;\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.moveUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.addUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tgetControlButtonText(): string\n\t\t{\n\t\t\tconst phraseCode = this.actionId === MenuOption.moveUsers\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE';\n\n\t\t\treturn this.loc(phraseCode);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard__change-save-mode-control-container\"\n\t\t>\n\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_CONTROL_TEXT') }}</span>\n\t\t\t<a\n\t\t\t\tclass=\"chart-wizard__change-save-mode-control-button\"\n\t\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t\tref='changeSaveModeButton'\n\t\t\t\t@click=\"menuVisible = true\"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'hr-wizard-save-mode-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.changeSaveModeButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { getMemberRoles, memberRolesKeys } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { ChangeSaveModeControl } from '../change-save-mode-control/change-save-mode-control';\nimport { TagSelector, type ItemOptions } from 'ui.entity-selector';\nimport { getUserDataBySelectorItem } from 'humanresources.company-structure.utils';\n\nexport const Employees = {\n\tname: 'employees',\n\n\tcomponents: { ChangeSaveModeControl },\n\n\temits: ['applyData', 'saveModeChanged'],\n\n\tprops: {\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temployeesIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.memberRoles = getMemberRoles(this.entityType);\n\t\tthis.selectedUsers = new Set();\n\t\tthis.departmentHeads = [];\n\t\tthis.departmentEmployees = [];\n\t\tthis.removedUsers = [];\n\t\tthis.headSelector = this.getUserSelector(memberRolesKeys.head);\n\t\tthis.deputySelector = this.getUserSelector(memberRolesKeys.deputyHead);\n\t\tthis.employeesSelector = this.getUserSelector(memberRolesKeys.employee);\n\t\tthis.userCount = 0;\n\n\t\t// store initial users to control applyData method in tagSelector\n\t\tthis.initialUsers = this.heads.reduce((set, item) => set.add(item.id), new Set());\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.headSelector.renderTo(this.$refs['head-selector']);\n\t\tthis.deputySelector.renderTo(this.$refs['deputy-selector']);\n\t\tthis.employeesSelector.renderTo(this.$refs['employees-selector']);\n\t},\n\n\twatch:\n\t{\n\t\tentityType(entityType: string): void\n\t\t{\n\t\t\tconst prevMemberRoles = this.memberRoles;\n\t\t\tconst rolesKeys = Object.keys(prevMemberRoles);\n\t\t\tthis.memberRoles = getMemberRoles(entityType);\n\n\t\t\tthis.departmentHeads = this.departmentHeads.map((item) => {\n\t\t\t\tconst roleKey = rolesKeys.find((key) => prevMemberRoles[key] === item.role);\n\n\t\t\t\treturn { ...item, role: this.memberRoles[roleKey] };\n\t\t\t});\n\n\t\t\tthis.departmentEmployees = this.departmentEmployees\n\t\t\t\t.map((item) => ({ ...item, role: this.memberRoles.employee }))\n\t\t\t;\n\t\t},\n\t\temployeesIds:\n\t\t{\n\t\t\thandler(payload: number[]): void\n\t\t\t{\n\t\t\t\tthis.employeesIds.forEach((item) => this.initialUsers.add(item));\n\t\t\t\tconst preselectedEmployees = payload.map((employeeId) => ['user', employeeId]);\n\t\t\t\tconst { dialog } = this.employeesSelector;\n\t\t\t\tdialog.setPreselectedItems(preselectedEmployees);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tgetPreselectedItems(role: string): Array<number>\n\t\t{\n\t\t\tif (this.memberRoles.employee === role)\n\t\t\t{\n\t\t\t\treturn this.employeesIds.map((employeeId) => ['user', employeeId]);\n\t\t\t}\n\n\t\t\treturn this.heads.filter((head) => head.role === role).map((head) => {\n\t\t\t\treturn ['user', head.id];\n\t\t\t});\n\t\t},\n\t\tgetUserSelector(roleKey: String): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.add(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, this.memberRoles[roleKey]);\n\n\t\t\t\t\t\tif (this.initialUsers.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initialUsers.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.delete(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, this.memberRoles[roleKey]);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: this.getPreselectedItems(this.memberRoles[roleKey]),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonBeforeShow: () => {\n\t\t\t\t\t\t\t\tdialog.setHeight(250);\n\t\t\t\t\t\t\t\tif (dialog.isLoaded())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\tconst { dialog } = selector;\n\t\t\t\t\t\t\tconst container = dialog.getContainer();\n\t\t\t\t\t\t\tconst { top } = container.getBoundingClientRect();\n\t\t\t\t\t\t\tconst offset = top + container.offsetHeight - document.body.offsetHeight;\n\t\t\t\t\t\t\tif (offset > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst margin = 5;\n\t\t\t\t\t\t\t\tdialog.setHeight(container.offsetHeight - offset - margin);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\tconst users = event.target.items.get('user');\n\n\t\t\t\t\t\t\tusers.forEach((user) => {\n\t\t\t\t\t\t\t\tuser.setLink('');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'SearchTab:onLoad': () => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tinviteEmployeeLink: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: false,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst dialog = selector.getDialog();\n\n\t\t\treturn selector;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\ttoggleUsers(dialog): void\n\t\t{\n\t\t\tconst items = dialog.getItems();\n\t\t\titems.forEach((item) => {\n\t\t\t\tconst hidden = this.selectedUsers.has(item.id)\n\t\t\t\t\t&& !dialog.selectedItems.has(item);\n\t\t\t\titem.setHidden(hidden);\n\t\t\t});\n\t\t},\n\t\tonSelectorToggle(tag: ItemOptions, role: string): void\n\t\t{\n\t\t\tconst item = tag.selector.dialog.getItem(['user', tag.id]);\n\t\t\tconst userData = getUserDataBySelectorItem(item, role);\n\n\t\t\tconst isEmployee = role === this.memberRoles.employee;\n\t\t\tif (!tag.rendered)\n\t\t\t{\n\t\t\t\tthis.removedUsers = this.removedUsers.filter((user) => user.id !== userData.id);\n\t\t\t\tif (isEmployee)\n\t\t\t\t{\n\t\t\t\t\tthis.departmentEmployees = [...this.departmentEmployees, { ...userData }];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.departmentHeads = [...this.departmentHeads, { ...userData }];\n\t\t\t\t}\n\n\t\t\t\tthis.userCount += 1;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { preselectedItems = [] } = tag.selector.dialog;\n\t\t\tconst parsedPreselected = preselectedItems.flat().filter((item) => item !== 'user');\n\t\t\tif (parsedPreselected.includes(userData.id))\n\t\t\t{\n\t\t\t\tthis.removedUsers = [...this.removedUsers, { ...userData, role }];\n\t\t\t}\n\n\t\t\tif (isEmployee)\n\t\t\t{\n\t\t\t\tthis.departmentEmployees = this.departmentEmployees.filter((employee) => employee.id !== tag.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.departmentHeads = this.departmentHeads.filter((head) => head.id !== tag.id);\n\t\t\t}\n\n\t\t\tthis.userCount -= 1;\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\theads: this.departmentHeads,\n\t\t\t\temployees: this.departmentEmployees,\n\t\t\t\tremovedUsers: this.removedUsers,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\thandleSaveModeChangedChanged(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\temployeeTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_EMPLOYEES_TITLE');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__employee\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"head-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-head-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_DESCR') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"deputy-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-deputy-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_DESCR') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ employeeTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"employees-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-employee-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"!isTeamEntity\" class=\"chart-wizard__employee_item --change-save-mode-control\">\n\t\t\t\t\t<ChangeSaveModeControl\n\t\t\t\t\t\tv-if=\"!isEditMode\"\n\t\t\t\t\t\t@saveModeChanged=\"handleSaveModeChangedChanged\"\n\t\t\t\t\t></ChangeSaveModeControl>\n\t\t\t\t\t<div class=\"chart-wizard__change-save-mode-control-container\" v-else>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_EDIT_WIZARD_EMPLOYEE_SAVE_MODE_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Reflection, Event } from 'main.core';\nimport 'ui.hint';\n\n/**\n * ui.hint with reactive content\n */\nexport const ResponsiveHint = {\n\tname: 'ResponsiveHint',\n\n\tprops: {\n\t\tcontent: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 300,\n\t\t},\n\t\textraClasses: {\n\t\t\ttype: Object,\n\t\t},\n\t\ttop: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\talignCenter: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.hint = null;\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst container = this.$refs['hint-container'];\n\t\tconst parameters = {\n\t\t\twidth: this.width,\n\t\t};\n\n\t\tif (this.top)\n\t\t{\n\t\t\tparameters.bindOptions = { position: 'top' };\n\t\t}\n\n\t\tif (this.alignCenter)\n\t\t{\n\t\t\tparameters.offsetLeft = (container.offsetWidth / 2) - this.width / 2 + 39;\n\t\t\tparameters.angle = { offset: this.width / 2 - 33 / 2 };\n\t\t}\n\n\t\tEvent.bind(this.$refs['hint-container'], 'mouseenter', () => {\n\t\t\tthis.hint = Reflection.getClass('BX.UI.Hint').createInstance({\n\t\t\t\tpopupParameters: { ...parameters }, // destruct parameters to recreate hint\n\t\t\t});\n\t\t\tthis.hint.show(this.$refs['hint-container'], this.content);\n\t\t});\n\n\t\tEvent.bind(this.$refs['hint-container'], 'mouseleave', () => {\n\t\t\tthis.hint?.hide(); // hide() function also destroys popup\n\t\t});\n\t},\n\n\tunmounted(): void\n\t{\n\t\tthis.hint?.hide();\n\t},\n\n\ttemplate: `\n\t\t<span class=\"ui-hint\" ref=\"hint-container\" :class=\"extraClasses\">\n\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t</span>\n\t`,\n};\n","import 'ui.hint';\nimport { ResponsiveHint } from './responsive-hint';\n\n// @vue/component\nexport const DefaultHint = {\n\tname: 'DefaultHint',\n\n\tcomponents: { ResponsiveHint },\n\n\tprops: {\n\t\tcontent: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 300,\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<ResponsiveHint :content=content :classes=\"{ 'ui-hint': true }\">\n\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t</ResponsiveHint>\n\t`,\n};\n","import { getMemberRoles } from 'humanresources.company-structure.api';\nimport { TagSelector } from 'ui.entity-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { DefaultHint } from '../responsive-hint/default-hint';\nimport {\n\tgetChatDialogEntity,\n\tgetChannelDialogEntity,\n\tgetChatRecentTabOptions,\n\tChatTypeDict,\n} from 'humanresources.company-structure.structure-components';\n\nexport const BindChat = {\n\tname: 'bindChat',\n\n\temits: ['applyData'],\n\n\tcomponents: {\n\t\tDefaultHint,\n\t\tBIcon,\n\t},\n\n\tprops: {\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\t// this boolean values are true by default but false if no heads specified\n\t\treturn {\n\t\t\tcreateDefaultChat: true,\n\t\t\tcreateDefaultChannel: true,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.chatSelector = this.getChatSelector();\n\t\tthis.channelSelector = this.getChannelSelector();\n\t\tthis.chats = [];\n\t\tthis.channels = [];\n\n\t\tif (!this.headsCreated)\n\t\t{\n\t\t\tthis.createDefaultChat = false;\n\t\t\tthis.createDefaultChannel = false;\n\t\t}\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.chatSelector.renderTo(this.$refs['chat-selector']);\n\t\tthis.channelSelector.renderTo(this.$refs['channel-selector']);\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetChatSelector(): TagSelector\n\t\t{\n\t\t\tconst options = {\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.chats.push(Number(tag.id.replace('chat', '')));\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tconst intId = Number(tag.id.replace('chat', ''));\n\t\t\t\t\t\tthis.chats = this.chats.filter((chat) => chat !== intId);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\trecentTabOptions: getChatRecentTabOptions(this.entityType, ChatTypeDict.chat),\n\t\t\t\t\tentities: [\n\t\t\t\t\t\tgetChatDialogEntity(),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn new TagSelector(options);\n\t\t},\n\t\tgetChannelSelector(): TagSelector\n\t\t{\n\t\t\tconst options = {\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.channels.push(Number(tag.id.replace('chat', '')));\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tconst intId = Number(tag.id.replace('chat', ''));\n\t\t\t\t\t\tthis.channels = this.channels.filter((chat) => chat !== intId);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\trecentTabOptions: getChatRecentTabOptions(this.entityType, ChatTypeDict.channel),\n\t\t\t\t\tentities: [\n\t\t\t\t\t\tgetChannelDialogEntity(),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn new TagSelector(options);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tchats: this.chats,\n\t\t\t\tchannels: this.channels,\n\t\t\t\tcreateDefaultChat: this.createDefaultChat,\n\t\t\t\tcreateDefaultChannel: this.createDefaultChannel,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t},\n\n\twatch: {\n\t\theadsCreated(value): void\n\t\t{\n\t\t\tthis.createDefaultChat = value;\n\t\t\tthis.createDefaultChannel = value;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tchatHintText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_HINT_MSGVER_1');\n\t\t},\n\t\tchannelHintText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_HINT_MSGVER_1');\n\t\t},\n\t\theadsCreated(): boolean\n\t\t{\n\t\t\tconst memberRoles = getMemberRoles(this.entityType);\n\n\t\t\treturn this.heads.some((item) => item.role === memberRoles.head);\n\t\t},\n\t\tset(): Set {\n\t\t\treturn Set;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\thints(): string[]\n\t\t{\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_3'),\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1_MSGVER_1'),\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2_MSGVER_1'),\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_3'),\n\t\t\t];\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__bind-chat\">\n\t\t\t<div class=\"chart-wizard__bind-chat__item\">\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint\" :class=\"{ '--team': isTeamEntity }\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_logo\" :class=\"{ '--team': isTeamEntity }\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_text\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"chart-wizard__bind-chat__item-hint_title\"\n\t\t\t\t\t\t\tv-html=\"\n\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_TITLE')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_TITLE')\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\t class=\"chart-wizard__bind-chat__item-hint_text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"chart-wizard__bind-chat__item-hint_text-item_icon\"\n\t\t\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__chat_selector\"\n\t\t\t\t\t\tref=\"chat-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__chat-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-checkbox_container\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"addChatCheckbox\"\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tclass=\"form-control\"\n\t\t\t\t\t\t\t:disabled=\"!headsCreated\"\n\t\t\t\t\t\t\tv-model=\"createDefaultChat\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__make-default-chat-checkbox\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label for=\"addChatCheckbox\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_LABEL')\n\t\t\t\t\t\t\t\t\t: loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_1')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<DefaultHint :content=\"chatHintText\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"!headsCreated\" class=\"chart-wizard__bind-chat__item-checkbox_warning\">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name=\"set.WARNING\"\n\t\t\t\t\t\t\tcolor=\"#FFA900\"\n\t\t\t\t\t\t\t:size=\"16\"\n\t\t\t\t\t\t></BIcon>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_WARNING')\n\t\t\t\t\t\t\t\t\t: loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_WARNING')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc(\n\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__channel_selector\"\n\t\t\t\t\t\tref=\"channel-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__channel-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-checkbox_container\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"addChannelCheckbox\"\n\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\tclass=\"form-control\"\n\t\t\t\t\t\t\t:disabled=\"!headsCreated\"\n\t\t\t\t\t\t\tv-model=\"createDefaultChannel\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__make-default-channel-checkbox\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label for=\"addChannelCheckbox\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_LABEL')\n\t\t\t\t\t\t\t\t\t: loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_1')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<DefaultHint :content=\"channelHintText\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"!headsCreated\" class=\"chart-wizard__bind-chat__item-checkbox_warning --bottom-space\">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name=\"set.WARNING\"\n\t\t\t\t\t\t\tcolor=\"#FFA900\"\n\t\t\t\t\t\t\t:size=\"16\"\n\t\t\t\t\t\t></BIcon>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_WARNING')\n\t\t\t\t\t\t\t\t\t: loc(\n\t\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_WARNING')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { Reflection } from 'main.core';\nimport { ResponsiveHint } from '../responsive-hint/responsive-hint';\n\nexport const Entities = {\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomponents: { ResponsiveHint },\n\n\tdata(): { selectedEntityType: string; }\n\t{\n\t\treturn {\n\t\t\tselectedEntityType: EntityTypes.department,\n\t\t};\n\t},\n\n\temits: ['applyData'],\n\n\tcreated(): void\n\t{\n\t\tthis.hint = null;\n\t\tthis.hintHideTimeout = null;\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tconst hasTeamCreatePermission = this.parentId === 0\n\t\t\t? permissionChecker.hasPermissionWithAnyNode(PermissionActions.teamCreate)\n\t\t\t: permissionChecker.hasPermission(PermissionActions.teamCreate, this.parentId)\n\t\t;\n\n\t\tconst hasDepartmentCreatePermission = this.parentId === 0\n\t\t\t? permissionChecker.hasPermissionWithAnyNode(PermissionActions.departmentCreate)\n\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCreate, this.parentId)\n\t\t;\n\n\t\tthis.entities = [\n\t\t\t{\n\t\t\t\ttype: EntityTypes.department,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_DESCR'),\n\t\t\t\tisEnabled: hasDepartmentCreatePermission,\n\t\t\t\thint: !hasDepartmentCreatePermission\n\t\t\t\t\t&& this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_NO_ACCESS_HINT'),\n\t\t\t\tisSoon: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: EntityTypes.team,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_TITLE_MSGVER_1'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_DESCR'),\n\t\t\t\tisEnabled: PermissionChecker.isTeamsAvailable && hasTeamCreatePermission,\n\t\t\t\thint: PermissionChecker.isTeamsAvailable\n\t\t\t\t\t&& !hasTeamCreatePermission\n\t\t\t\t\t&& this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_NO_ACCESS_HINT_MSGVER_1'),\n\t\t\t\tisSoon: !permissionChecker.isTeamsAvailable,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: EntityTypes.company,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_DESCR'),\n\t\t\t\tisEnabled: false,\n\t\t\t\tisSoon: true,\n\t\t\t},\n\t\t];\n\n\t\tfor (const entity of this.entities)\n\t\t{\n\t\t\tif (entity.isEnabled)\n\t\t\t{\n\t\t\t\tthis.selectedEntityType = entity.type;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.applyData(this.selectedEntityType);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData(this.selectedEntityType);\n\t},\n\n\tdeactivated(): void\n\t{\n\t\tthis.hint?.hide();\n\t\tclearTimeout(this.hintHideTimeout);\n\t\tthis.hintHideTimeout = null;\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(entityId: string): void\n\t\t{\n\t\t\tthis.selectedEntityType = entityId;\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tisValid: true,\n\t\t\t\tisDepartmentDataChanged: false,\n\t\t\t\tentityType: this.selectedEntityType,\n\t\t\t});\n\t\t},\n\t\tshowHint(text: string, $event: PointerEvent): void\n\t\t{\n\t\t\tif (this.hintHideTimeout)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst width = 300;\n\t\t\tthis.hint = Reflection.getClass('BX.UI.Hint').createInstance({\n\t\t\t\tpopupParameters: {\n\t\t\t\t\twidth,\n\t\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\t\toffsetLeft: 225,\n\t\t\t\t\toffsetTop: -23,\n\t\t\t\t\tangle: { offset: width / 2 - 33 / 2 },\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.hint.show($event.target, text);\n\n\t\t\tthis.hintHideTimeout = setTimeout(() => {\n\t\t\t\tthis.hint?.hide();\n\t\t\t\tthis.hintHideTimeout = null;\n\t\t\t}, 2000);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-for=\"entity in entities\"\n\t\t\tclass=\"chart-wizard__entity-wrapper\"\n\t\t>\n\t\t\t<span v-if=\"entity.hint\" @click=\"showHint(entity.hint, $event)\" class=\"ui-hint chart-wizard__entity_hint-layout\"></span>\n\t\t\t<div class=\"chart-wizard__entity\"\n\t\t\t\t :class=\"{ \n\t\t\t\t\t['--' + entity.type.toLowerCase()]: true, \n\t\t\t\t\t'--selected': entity.type === selectedEntityType, \n\t\t\t\t\t'--enabled': entity.isEnabled \n\t\t\t\t}\"\n\t\t\t\t@click=\"entity.isEnabled && applyData(entity.type)\"\n\t\t\t>\n\t\t\t\t<div class=\"chart-wizard__entity_summary\">\n\t\t\t\t\t<h2\n\t\t\t\t\t\tclass=\"chart-wizard__entity_title\"\n\t\t\t\t\t\t:data-title=\"entity.isSoon ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE') : null\"\n\t\t\t\t\t\t:class=\"{ '--disabled': !entity.isEnabled, '--soon': entity.isSoon }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{entity.title}}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<p class=\"chart-wizard__entity_description\" :class=\"{ '--disabled': !entity.isEnabled}\">\n\t\t\t\t\t\t{{entity.description}}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const AuthorityTypes: Record<string> = {\n\tdepartmentHead: 'HEAD',\n\tdepartmentDeputy: 'DEPUTY_HEAD',\n\tteamHead: 'TEAM_HEAD',\n\tteamDeputy: 'TEAM_DEPUTY',\n};\n\nexport const SettingsTypes: Record<string> = {\n\tbusinessProcAuthority: 'BUSINESS_PROC_AUTHORITY',\n\treportsAuthority: 'REPORTS_AUTHORITY',\n};\n","import { Text } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\nimport { AuthorityTypes, SettingsTypes } from '../../consts';\n\nexport const TeamRights = {\n\tname: 'teamRights',\n\n\temits: ['applyData'],\n\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type {Record<string, Set>} */\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.hints = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_2'),\n\t\t];\n\n\t\tthis.initBpValues = new Set();\n\t\tthis.businessProcSelector = this.getTagSelector(SettingsTypes.businessProcAuthority, false);\n\t\tthis.reportsSelector = this.getTagSelector(SettingsTypes.reportsAuthority, true);\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.businessProcSelector.renderTo(this.$refs['business-proc-selector']);\n\t\tthis.reportsSelector.renderTo(this.$refs['reports-selector']);\n\t},\n\n\twatch:\n\t{\n\t\tsettings:\n\t\t\t{\n\t\t\t\thandler(payload: Record<string, Set>): void\n\t\t\t\t{\n\t\t\t\t\tif (payload[SettingsTypes.businessProcAuthority])\n\t\t\t\t\t{\n\t\t\t\t\t\tconst businessProcPreselected = this.getTagItems(false)\n\t\t\t\t\t\t\t.filter((item) => payload[SettingsTypes.businessProcAuthority].has(item.id))\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tbusinessProcPreselected.forEach((businessProcPreselectedItem) => {\n\t\t\t\t\t\t\tconst item = this.businessProcSelector.dialog.getItem(['head-type', businessProcPreselectedItem.id]);\n\n\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.initBpValues.add(businessProcPreselectedItem.id);\n\t\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tsettings: this.settings,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\tgetTagSelector(settingType: string, locked: boolean): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.settings[settingType].add(tag.id);\n\n\t\t\t\t\t\tif (this.initBpValues.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initBpValues.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.settings[settingType].delete(tag.id);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tid: 'head-type-selector',\n\t\t\t\tlocked,\n\t\t\t\ttagFontWeight: '700',\n\t\t\t\tshowAddButton: !locked,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tid: 'head-type-selector',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onBeforeSelect': (event: BaseEvent) => {\n\t\t\t\t\t\t\tconst { item } = event.getData();\n\t\t\t\t\t\t\tif (!item.getCustomData()?.get('selectable'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 200,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tselectedItems: this.getTagItems(locked).filter(((item) => this.settings[settingType].has(item.id))),\n\t\t\t\t\titems: this.getTagItems(locked),\n\t\t\t\t\tundeselectedItems: [['head-type', AuthorityTypes.departmentHead]],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tgetTagItems(locked: boolean): Array\n\t\t{\n\t\t\tconst lockedTagOptions = {\n\t\t\t\tbgColor: '#BDC1C6',\n\t\t\t\ttextColor: '#525C69',\n\t\t\t};\n\t\t\tconst departmentTagOptions = {\n\t\t\t\tbgColor: '#ADE7E4',\n\t\t\t\ttextColor: '#207976',\n\t\t\t};\n\t\t\tconst teamTagOptions = {\n\t\t\t\tbgColor: '#CCE3FF',\n\t\t\t\ttextColor: '#3592FF',\n\t\t\t};\n\n\t\t\tconst soonItemOptions = {\n\t\t\t\tcustomData: { selectable: false },\n\t\t\t\ttextColor: '#C9CCD0',\n\t\t\t\tbadges: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_SOON_ITEM_BADGE'),\n\t\t\t\t\t\ttextColor: '#FFFFFF',\n\t\t\t\t\t\tbgColor: '#2FC6F6',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tbadgesOptions: {\n\t\t\t\t\tjustifyContent: 'right',\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.departmentHead,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_HEAD_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : departmentTagOptions,\n\t\t\t\t\tcustomData: { selectable: true },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.teamHead,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_HEAD_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : teamTagOptions,\n\t\t\t\t\tcustomData: { selectable: true },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.departmentDeputy,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_DEPUTY_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : departmentTagOptions,\n\t\t\t\t\t...soonItemOptions,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.teamDeputy,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_DEPUTY_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : teamTagOptions,\n\t\t\t\t\t...soonItemOptions,\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tgoToBPHelp(event): void\n\t\t{\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\ttop.BX.Helper.show('redirect=detail&code=25455744');\n\t\t\t}\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tbusinessDescription(): string\n\t\t{\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_DESCRIPTION', {\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.name),\n\t\t\t});\n\t\t},\n\t\treportsDescriptions(): string\n\t\t{\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_DESCRIPTION', {\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.name),\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__team-rights\">\n\t\t\t<div class=\"chart-wizard__team-rights__item\">\n\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint --team\">\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint_logo --team\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint_text\">\n\t\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint_title\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__team-rights__item-hint_text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"chart-wizard__team-rights__item-hint_text-item_icon --team\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__team-rights__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title\"\n\t\t\t\t\t\t :data-title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"ui-hint\" @click=\"goToBPHelp\">\n\t\t\t\t\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-description-container\">\n\t\t\t\t\t\t<span class=\"chart-wizard__team-rights__item-description-text\" v-html=\"businessDescription\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__team-rights__business-proc-selector\"\n\t\t\t\t\t\tref=\"business-proc-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure__team-rights__business-proc-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__team-rights__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title --soon\"\n\t\t\t\t\t\t :data-title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"chart-wizard__team-rights_ui-hint-disabled\">\n\t\t\t\t\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-description-container\">\n\t\t\t\t\t\t<span class=\"chart-wizard__team-rights__item-description-text --soon\" v-html=\"reportsDescriptions\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__team-rights__reports-selector\"\n\t\t\t\t\t\tref=\"reports-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure__team-rights__reports-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { postData } from 'humanresources.company-structure.api';\nimport { DepartmentUserIds } from './types';\n\nexport const WizardAPI = {\n\taddDepartment: (\n\t\tname: string,\n\t\tparentId: number,\n\t\tdescription: ?string,\n\t\tentityType: ?string,\n\t\tcolorName: ?string,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.add', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tentityType,\n\t\t\tcolorName,\n\t\t});\n\t},\n\tgetEmployees: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Employee.getIds', { nodeId });\n\t},\n\tupdateDepartment: (\n\t\tnodeId: number,\n\t\tparentId: number,\n\t\tname: string,\n\t\tdescription: ?string,\n\t\tcolorName: ?string,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tcolorName,\n\t\t});\n\t},\n\tsaveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.saveUserList', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tmoveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUserListToDepartment', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tcreateDefault: boolean[],\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tcreateDefault,\n\t\t});\n\t},\n\tcreateSettings: (\n\t\tnodeId: number,\n\t\tsettings: Record<string, {values: string[], replace: boolean}>,\n\t\tparentId: ?number,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.create', {\n\t\t\tsettings,\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t});\n\t},\n\tupdateSettings: (\n\t\tnodeId: number,\n\t\tsettings: Record<string, {values: string[], replace: boolean}>,\n\t\tparentId: ?number,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.update', {\n\t\t\tsettings,\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t});\n\t},\n\tgetSettings: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.get', { nodeId });\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport type { DepartmentData } from './types';\n\nexport const chartWizardActions = {\n\tcreateDepartment: (departmentData: DepartmentData): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst { id: departmentId, parentId } = departmentData;\n\t\tconst parent = departments.get(parentId);\n\t\tparent.children = [...parent.children ?? [], departmentId];\n\t\tdepartments.set(departmentId, {\n\t\t\t...departmentData,\n\t\t\tid: departmentId,\n\t\t\tchats: null,\n\t\t\tchannels: null,\n\t\t});\n\t},\n\teditDepartment: (departmentData: DepartmentData): void => {\n\t\tconst { id, parentId } = departmentData;\n\t\tconst { departments } = useChartStore();\n\t\tconst oldData = departments.get(id);\n\t\tdepartments.set(id, { ...oldData, ...departmentData });\n\t\tconst prevParent = [...departments.values()].find((department) => {\n\t\t\treturn department.children?.includes(id);\n\t\t});\n\t\tif (parentId !== 0 && prevParent.id !== parentId)\n\t\t{\n\t\t\tprevParent.children = prevParent.children.filter((childId) => childId !== id);\n\t\t\tconst newParent = departments.get(parentId);\n\t\t\tnewParent.children = [...(newParent.children ?? []), id];\n\t\t\tdepartments.set(id, { ...departmentData, prevParentId: prevParent.id });\n\t\t}\n\t},\n\tmoveUsersToRootDepartment: (removedUsers: number[], userMovedToRootIds: number[]): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst rootEmployees = removedUsers.filter((user) => userMovedToRootIds.includes(user.id));\n\t\tconst rootNode = [...departments.values()].find((department) => department.parentId === 0);\n\t\tdepartments.set(rootNode.id, {\n\t\t\t...rootNode,\n\t\t\temployees: [...(rootNode.employees || []), ...rootEmployees],\n\t\t\tuserCount: rootNode.userCount + rootEmployees.length,\n\t\t});\n\t},\n\trefreshDepartments: (ids: number[]): void => {\n\t\tconst store = useChartStore();\n\t\tstore.refreshDepartments(ids);\n\t},\n\ttryToAddCurrentDepartment(departmentData: DepartmentData, departmentId: number): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst { heads, employees } = departmentData;\n\t\tconst isCurrentUserAdd = [...heads, ...employees].some((user) => {\n\t\t\treturn user.id === store.userId;\n\t\t});\n\t\tif (isCurrentUserAdd)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(0, departmentId);\n\t\t}\n\t},\n};\n","import { UI } from 'ui.notification';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { mapState } from 'ui.vue3.pinia';\nimport { Event } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles, reportedErrorTypes } from 'humanresources.company-structure.api';\nimport { TreePreview } from './tree-preview/tree-preview';\nimport { Department } from './steps/department';\nimport { Employees } from './steps/employees';\nimport { BindChat } from './steps/bind-chat';\nimport { Entities } from './steps/entities';\nimport { TeamRights } from './steps/team-rights';\nimport { WizardAPI } from '../api';\nimport { chartWizardActions } from '../actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport type { WizardData, Step, DepartmentData, DepartmentUserIds } from '../types';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, NodeColorsSettingsDict } from 'humanresources.company-structure.utils';\nimport { AuthorityTypes, SettingsTypes } from '../consts';\nimport 'ui.buttons';\nimport 'ui.forms';\nimport '../style.css';\n\nconst SaveMode = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChartWizard = {\n\tname: 'chartWizard',\n\n\temits: ['modifyTree', 'close'],\n\n\tcomponents: { Department, Employees, BindChat, TreePreview, Entities, TeamRights },\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tshowEntitySelector: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tentity: {\n\t\t\ttype: String,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t},\n\t\trefToFocus: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): WizardData\n\t{\n\t\treturn {\n\t\t\tstepIndex: 0,\n\t\t\twaiting: false,\n\t\t\tisValidStep: false,\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tdepartmentData: {\n\t\t\t\tid: 0,\n\t\t\t\tparentId: 0,\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\theads: [],\n\t\t\t\temployees: [],\n\t\t\t\tchats: [],\n\t\t\t\tchannels: [],\n\t\t\t\tuserCount: 0,\n\t\t\t\tcreateDefaultChat: true,\n\t\t\t\tcreateDefaultChannel: true,\n\t\t\t\tteamColor: NodeColorsSettingsDict.blue,\n\t\t\t\tentityType: EntityTypes.department,\n\t\t\t\tsettings: {\n\t\t\t\t\t[SettingsTypes.businessProcAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t\t[SettingsTypes.reportsAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t},\n\t\t\t},\n\t\t\tremovedUsers: [],\n\t\t\temployeesIds: [],\n\t\t\tdepartmentSettings: {\n\t\t\t\t[SettingsTypes.businessProcAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t[SettingsTypes.reportsAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t},\n\t\t\tshouldErrorHighlight: false,\n\t\t\tvisibleSteps: [],\n\t\t\tsaveMode: SaveMode.moveUsers,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.init();\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'beforeunload', this.handleBeforeUnload);\n\t},\n\n\tcomputed: {\n\t\tstepTitle(): string\n\t\t{\n\t\t\tif (this.isFirstStep && !this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE');\n\t\t\t}\n\n\t\t\tconst currentStep = this.visibleSteps[0] === 'entities'\n\t\t\t\t? this.stepIndex\n\t\t\t\t: this.stepIndex + 1;\n\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_STEP_PROGRESS', {\n\t\t\t\t\t'#CURRENT_STEP#': currentStep,\n\t\t\t\t\t'#MAX_STEP#': this.steps.length - 1,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TITLE');\n\t\t},\n\t\tcloseConfirmTitle(): string\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_TEAM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_DEPARTMENT_TITLE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_DEPARTMENT_TITLE')\n\t\t\t;\n\t\t},\n\t\tcurrentStep(): Step\n\t\t{\n\t\t\tconst id = this.visibleSteps[this.stepIndex];\n\n\t\t\treturn this.steps.find((step) => id === step.id);\n\t\t},\n\t\tcomponentInfo(): { name: string, params?: Object }\n\t\t{\n\t\t\tconst {\n\t\t\t\tparentId,\n\t\t\t\tname,\n\t\t\t\tdescription,\n\t\t\t\theads,\n\t\t\t\tentityType,\n\t\t\t\tteamColor,\n\t\t\t} = this.departmentData;\n\n\t\t\tconst components = {\n\t\t\t\tdepartment: {\n\t\t\t\t\tname: 'Department',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\tteamColor,\n\t\t\t\t\t\trefToFocus: this.refToFocus,\n\t\t\t\t\t\tshouldErrorHighlight: this.shouldErrorHighlight,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\temployees: {\n\t\t\t\t\tname: 'Employees',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\theads,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\temployeesIds: this.employeesIds,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tbindChat: {\n\t\t\t\t\tname: 'BindChat',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\theads,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tteamRights: {\n\t\t\t\t\tname: 'TeamRights',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tsettings: this.departmentSettings,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tentities: {\n\t\t\t\t\tname: 'Entities',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst { id: stepId } = this.currentStep;\n\n\t\t\treturn components[stepId];\n\t\t},\n\t\tisFirstStep(): boolean\n\t\t{\n\t\t\treturn this.currentStep.id === 'entities';\n\t\t},\n\t\thasTreePreview(): boolean\n\t\t{\n\t\t\treturn !['entities', 'bindChat', 'teamRights'].includes(this.currentStep.id);\n\t\t},\n\t\tisChatStep(): boolean\n\t\t{\n\t\t\treturn this.currentStep.id === 'bindChat';\n\t\t},\n\t\tfilteredSteps(): string[]\n\t\t{\n\t\t\treturn this.visibleSteps.filter((step) => step !== 'entities');\n\t\t},\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn id;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team;\n\t\t},\n\t\tcreateButtonText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_BTN')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_BTN')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'userId', 'currentDepartments']),\n\t},\n\n\tmethods: {\n\t\thandleBeforeUnload(event: Event): void\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tasync init(): Promise<void>\n\t\t{\n\t\t\t// Important: we need to call createSteps as soon as we get entityType or determine a lack of it\n\n\t\t\tEvent.bind(window, 'beforeunload', this.handleBeforeUnload);\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tconst {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\tparentId,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor,\n\t\t\t\t\temployees = [],\n\t\t\t\t} = this.departments.get(this.nodeId);\n\n\t\t\t\tthis.getMemberRoles(entityType);\n\t\t\t\tthis.createSteps(entityType);\n\t\t\t\tthis.createVisibleSteps();\n\t\t\t\tthis.createDefaultSaveMode(entityType);\n\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\tid,\n\t\t\t\t\tparentId,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor,\n\t\t\t\t\tcreateDefaultChat: false,\n\t\t\t\t\tcreateDefaultChannel: false,\n\t\t\t\t};\n\t\t\t\tconst rawSettings = await WizardAPI.getSettings(this.nodeId);\n\t\t\t\tthis.departmentSettings = rawSettings.reduce((acc, { settingsType, settingsValue }) => {\n\t\t\t\t\tif (!Object.hasOwn(acc, settingsType))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[settingsType] = new Set();\n\t\t\t\t\t}\n\t\t\t\t\tacc[settingsType].add(settingsValue);\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, { ...this.departmentSettings });\n\n\t\t\t\tthis.employeesIds = await WizardAPI.getEmployees(this.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.entityType)\n\t\t\t{\n\t\t\t\tthis.departmentData.entityType = this.entityType;\n\t\t\t}\n\n\t\t\tthis.getMemberRoles(this.entityType);\n\t\t\tthis.createSteps(this.entityType);\n\t\t\tthis.createVisibleSteps();\n\t\t\tthis.createDefaultSaveMode(this.entityType);\n\n\t\t\tif (this.nodeId)\n\t\t\t{\n\t\t\t\tthis.departmentData.parentId = this.nodeId;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.departmentData.parentId = 0;\n\n\t\t\tanalyticsSendData({\n\t\t\t\ttool: 'structure',\n\t\t\t\tcategory: 'structure',\n\t\t\t\tevent: 'create_wizard',\n\t\t\t\tc_element: this.source,\n\t\t\t});\n\t\t},\n\t\tgetMemberRoles(entityType): void\n\t\t{\n\t\t\tthis.memberRoles = getMemberRoles(entityType);\n\t\t},\n\t\tcreateVisibleSteps(): void\n\t\t{\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tthis.visibleSteps = ['department'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tthis.visibleSteps = ['employees'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'teamRights':\n\t\t\t\t\tthis.visibleSteps = ['teamRights'];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.visibleSteps = this.showEntitySelector\n\t\t\t\t\t\t? this.steps.map((step) => step.id)\n\t\t\t\t\t\t: this.steps.filter((step) => step.id !== 'entities').map((step) => step.id);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tmove(buttonId: string = 'next'): void\n\t\t{\n\t\t\tif (buttonId === 'next' && !this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = buttonId === 'back' ? this.stepIndex - 1 : this.stepIndex + 1;\n\t\t\tthis.pickStepsAnalytics();\n\t\t},\n\t\tclose(sendEvent: boolean = false): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t\tif (sendEvent)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'cancel_wizard',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcloseWithConfirm(): void\n\t\t{\n\t\t\tif (!this.isDepartmentDataChanged)\n\t\t\t{\n\t\t\t\tthis.close(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst confirmPopup = new MessageBox({\n\t\t\t\ttitle: this.closeConfirmTitle,\n\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_MESSAGE'),\n\t\t\t\tyesCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_OK_CAPTION'),\n\t\t\t\tnoCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_NO_CAPTION'),\n\t\t\t\tonYes: () => {\n\t\t\t\t\tthis.close(true);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tminHeight: 155,\n\t\t\t\tbuttons: MessageBoxButtons.YES_NO,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tclassName: 'humanresources-chart-wizard__close-confirm-popup',\n\t\t\t\t},\n\t\t\t});\n\t\t\tconfirmPopup.getYesButton().setRound(true);\n\t\t\tconfirmPopup.getNoButton().setRound(true);\n\t\t\tconfirmPopup.show();\n\t\t},\n\t\tonApplyData(\n\t\t\tdata: {\n\t\t\t\tisValid?: boolean,\n\t\t\t\tisDepartmentDataChanged?: boolean,\n\t\t\t\tremovedUsers?: User, ...Partial<DepartmentData>\n\t\t\t},\n\t\t): void\n\t\t{\n\t\t\tconst prevEntityType = this.departmentData.entityType;\n\t\t\tconst { isValid = true, isDepartmentDataChanged = true, removedUsers = [], ...departmentData } = data;\n\t\t\tthis.isValidStep = isValid;\n\t\t\tthis.isDepartmentDataChanged = this.isDepartmentDataChanged || isDepartmentDataChanged;\n\t\t\tif (departmentData)\n\t\t\t{\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\t...departmentData,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.removedUsers = removedUsers;\n\t\t\tif (isValid)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = false;\n\t\t\t}\n\n\t\t\t// change steps and roles according to entityType\n\t\t\tif (prevEntityType !== this.departmentData.entityType)\n\t\t\t{\n\t\t\t\tthis.getMemberRoles(this.departmentData.entityType);\n\t\t\t\tthis.createSteps(this.departmentData.entityType);\n\t\t\t\tthis.createVisibleSteps();\n\t\t\t\tthis.createDefaultSaveMode(this.departmentData.entityType);\n\n\t\t\t\tconst prevMemberRoles = getMemberRoles(prevEntityType);\n\t\t\t\tconst rolesKeys = Object.keys(prevMemberRoles);\n\t\t\t\tthis.departmentData.heads = this.departmentData.heads.map((item) => {\n\t\t\t\t\tconst roleKey = rolesKeys.find((key) => prevMemberRoles[key] === item.role);\n\n\t\t\t\t\treturn { ...item, role: this.memberRoles[roleKey] };\n\t\t\t\t});\n\n\t\t\t\tthis.departmentData.employees = this.departmentData.employees\n\t\t\t\t\t.map((item) => ({ ...item, role: this.memberRoles.employee }))\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// change NodeColorsSettingsDict according to entityType\n\t\t\tthis.departmentData.teamColor = this.isTeamEntity\n\t\t\t\t? this.departmentData.teamColor ?? NodeColorsSettingsDict.blue\n\t\t\t\t: null\n\t\t\t;\n\t\t},\n\t\tcreateSteps(entityType: string = 'DEPARTMENT'): void\n\t\t{\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tthis.steps = [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'entities',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'employees',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_EMPLOYEES_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'bindChat',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'teamRights',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.steps = [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'entities',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'employees',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEES_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'bindChat',\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE_MSGVER_1'),\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t}\n\t\t},\n\t\tgetUsersPromise(departmentId: number): Promise<void>\n\t\t{\n\t\t\tconst ids = this.calculateEmployeeIds();\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = ids;\n\n\t\t\tconst departmentUserIds = {\n\t\t\t\t[this.memberRoles.head]: headsIds,\n\t\t\t\t[this.memberRoles.deputyHead]: deputiesIds,\n\t\t\t\t[this.memberRoles.employee]: employeesIds,\n\t\t\t};\n\n\t\t\treturn this.getUserMemberPromise(departmentId, departmentUserIds);\n\t\t},\n\t\tcalculateEmployeeIds(): Object\n\t\t{\n\t\t\tconst { heads, employees = [] } = this.departmentData;\n\n\t\t\treturn [...heads, ...employees].reduce((acc, user) => {\n\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = acc;\n\t\t\t\tif (user.role === this.memberRoles.head)\n\t\t\t\t{\n\t\t\t\t\theadsIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse if (user.role === this.memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdeputiesIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\temployeesIds.push(user.id);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {\n\t\t\t\theadsIds: [],\n\t\t\t\tdeputiesIds: [],\n\t\t\t\temployeesIds: [],\n\t\t\t});\n\t\t},\n\t\tgetUserMemberPromise(departmentId: number, ids: DepartmentUserIds, role: string): Promise<void>\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn WizardAPI.saveUsers(departmentId, ids);\n\t\t\t}\n\n\t\t\tconst hasUsers = Object.values(ids).some((userIds) => userIds.length > 0);\n\t\t\tif (!hasUsers)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tconst parentId = this.departmentData.parentId ?? null;\n\t\t\tif (this.saveMode === SaveMode.moveUsers)\n\t\t\t{\n\t\t\t\treturn WizardAPI.moveUsers(departmentId, ids, parentId);\n\t\t\t}\n\n\t\t\treturn WizardAPI.saveUsers(departmentId, ids, parentId);\n\t\t},\n\t\tasync create(): Promise<void>\n\t\t{\n\t\t\tconst {\n\t\t\t\tname,\n\t\t\t\tparentId,\n\t\t\t\tdescription,\n\t\t\t\tchats,\n\t\t\t\tchannels,\n\t\t\t\tcreateDefaultChat,\n\t\t\t\tcreateDefaultChannel,\n\t\t\t\tentityType,\n\t\t\t\tteamColor,\n\t\t\t\tsettings,\n\t\t\t} = this.departmentData;\n\n\t\t\tlet departmentId = 0;\n\t\t\tlet accessCode = '';\n\t\t\tthis.waiting = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [newDepartment] = await WizardAPI.addDepartment(\n\t\t\t\t\tname,\n\t\t\t\t\tparentId,\n\t\t\t\t\tdescription,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor?.name,\n\t\t\t\t);\n\t\t\t\tdepartmentId = newDepartment.id;\n\t\t\t\taccessCode = newDepartment.accessCode;\n\n\t\t\t\tconst data = await this.getUsersPromise(departmentId);\n\t\t\t\tif (data?.updatedDepartmentIds)\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.refreshDepartments(data.updatedDepartmentIds);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, departmentId);\n\t\t\t\t}\n\n\t\t\t\tawait WizardAPI.saveChats(\n\t\t\t\t\tdepartmentId,\n\t\t\t\t\t{ chat: [...chats], channel: [...channels] },\n\t\t\t\t\t{ chat: Number(createDefaultChat), channel: Number(createDefaultChannel) },\n\t\t\t\t);\n\n\t\t\t\tif (entityType === EntityTypes.team)\n\t\t\t\t{\n\t\t\t\t\tawait WizardAPI.createSettings(\n\t\t\t\t\t\tdepartmentId,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t[SettingsTypes.businessProcAuthority]: {\n\t\t\t\t\t\t\t\tvalues: [...settings[SettingsTypes.businessProcAuthority]],\n\t\t\t\t\t\t\t\treplace: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (!reportedErrorTypes.has(error.code))\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: error.message,\n\t\t\t\t\t\tautoHideDelay: 4000,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tchartWizardActions.createDepartment({ ...this.departmentData, id: departmentId, accessCode });\n\t\t\tthis.$emit('modifyTree', { id: departmentId, parentId, showConfetti: true });\n\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\n\t\t\tanalyticsSendData(\n\t\t\t\t{\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_dept',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.close();\n\t\t},\n\t\tasync save(): Promise<void>\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { id, parentId, name, description, teamColor, settings } = this.departmentData;\n\t\t\tconst currentNode = this.departments.get(id);\n\t\t\tconst targetNodeId = currentNode?.parentId === parentId ? null : parentId;\n\t\t\tthis.waiting = true;\n\t\t\tconst usersPromise = this.entity === 'employees'\n\t\t\t\t? this.getUsersPromise(id)\n\t\t\t\t: Promise.resolve();\n\t\t\tconst departmentPromise = this.entity === 'department'\n\t\t\t\t? WizardAPI.updateDepartment(id, targetNodeId, name, description, teamColor?.name)\n\t\t\t\t: Promise.resolve();\n\t\t\tconst settingsPromise = this.entity === 'teamRights'\n\t\t\t\t? WizardAPI.updateSettings(\n\t\t\t\t\tid,\n\t\t\t\t\t{\n\t\t\t\t\t\t[SettingsTypes.businessProcAuthority]: {\n\t\t\t\t\t\t\tvalues: [...settings[SettingsTypes.businessProcAuthority]],\n\t\t\t\t\t\t\treplace: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tparentId,\n\t\t\t\t)\n\t\t\t\t: Promise.resolve();\n\n\t\t\tthis.pickEditAnalytics(id, parentId);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [usersResponse] = await Promise.all([usersPromise, departmentPromise, settingsPromise]);\n\t\t\t\tlet userMovedToRootIds = [];\n\t\t\t\tif (this.removedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tuserMovedToRootIds = usersResponse?.userMovedToRootIds ?? [];\n\t\t\t\t\tif (userMovedToRootIds.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tchartWizardActions.moveUsersToRootDepartment(this.removedUsers, userMovedToRootIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst store = useChartStore();\n\t\t\t\tif (userMovedToRootIds.includes(this.userId))\n\t\t\t\t{\n\t\t\t\t\tstore.changeCurrentDepartment(id, this.rootId);\n\t\t\t\t}\n\t\t\t\telse if (this.removedUsers.some((user) => user.id === this.userId))\n\t\t\t\t{\n\t\t\t\t\tstore.changeCurrentDepartment(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, id);\n\t\t\t\t}\n\n\t\t\t\tchartWizardActions.editDepartment(this.departmentData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tthis.$emit('modifyTree', { id, parentId });\n\t\t\tthis.close();\n\t\t},\n\t\thandleSaveModeChanged(actionId: string): void\n\t\t{\n\t\t\tthis.saveMode = actionId;\n\t\t},\n\t\tcreateDefaultSaveMode(entityType: string = 'DEPARTMENT'): void\n\t\t{\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tthis.saveMode = SaveMode.addUsers;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.saveMode = SaveMode.moveUsers;\n\t\t\t}\n\t\t},\n\t\tpickEditAnalytics(departmentId: number, parentId: number): void\n\t\t{\n\t\t\tconst currentNode = this.departments.get(departmentId);\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_name',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp1: currentNode?.parentId === parentId ? 'editHead_N' : 'editHeadDept_Y',\n\t\t\t\t\t\tp2: currentNode?.name === name ? 'editName_N' : 'editName_Y',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t{\n\t\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_employee',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tpickStepsAnalytics(): void\n\t\t{\n\t\t\tlet event = null;\n\t\t\tswitch (this.currentStep.id)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tevent = 'create_dept_step1';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tevent = 'create_dept_step2';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bindChat':\n\t\t\t\t\tevent = 'create_dept_step3';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'teamRights':\n\t\t\t\t\tevent = 'create_dept_step4';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (event)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent,\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard\">\n\t\t\t<div class=\"chart-wizard__dialog\" :style=\"{ 'max-width': !isEditMode && isFirstStep ? '580px' : '843px' }\">\n\t\t\t\t<div class=\"chart-wizard__head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close\" @click=\"closeWithConfirm(true)\"></div>\n\t\t\t\t\t<p class=\"chart-wizard__head_title\">{{ stepTitle }}</p>\n\t\t\t\t\t<p class=\"chart-wizard__head_descr\" :class=\"{ '--first-step': isFirstStep, '--edit-mode': isEditMode }\">\n\t\t\t\t\t\t{{ currentStep.title }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class=\"chart-wizard__head_stages\" v-if=\"!isFirstStep && !isEditMode\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for=\"n in filteredSteps.length\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__head_stage\"\n\t\t\t\t\t\t\t:class=\"{ '--completed': stepIndex >= (this.showEntitySelector ? n : n - 1), '--team': isTeamEntity }\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__content\" :style=\"{ display: !isEditMode && isFirstStep ? 'block' : 'flex' }\">\n\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is=\"componentInfo.name\"\n\t\t\t\t\t\t\tv-bind=\"componentInfo.params\"\n\t\t\t\t\t\t\tv-on=\"{\n\t\t\t\t\t\t\t\tapplyData: onApplyData,\n\t\t\t\t\t\t\t\tsaveModeChanged: componentInfo.name === 'Employees' ? handleSaveModeChanged : undefined\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</component>\n\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t<div v-if=\"hasTreePreview\" class=\"chart-wizard__tree_container\">\n\t\t\t\t\t\t<TreePreview\n\t\t\t\t\t\t\t:parentId=\"departmentData.parentId\"\n\t\t\t\t\t\t\t:name=\"departmentData.name\"\n\t\t\t\t\t\t\t:heads=\"departmentData.heads\"\n\t\t\t\t\t\t\t:userCount=\"departmentData.userCount\"\n\t\t\t\t\t\t\t:entityType=\"departmentData.entityType\"\n\t\t\t\t\t\t\t:teamColor=\"departmentData.teamColor\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__footer\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"stepIndex > 0\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-light chart-wizard__button --back\"\n\t\t\t\t\t\t@click=\"move('back')\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__back-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --chevron-left\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__back-button-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BACK_BTN') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"stepIndex < visibleSteps.length - 1 && !isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --next\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-disabled': !isValidStep, 'ui-btn-light-border': isEditMode }\"\n\t\t\t\t\t\t@click=\"move()\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__next-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_NEXT_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --next\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-light-border': isEditMode }\"\n\t\t\t\t\t\t@click=\"close(true)\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__discard-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DISCARD_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"!isEditMode && stepIndex === visibleSteps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting }\"\n\t\t\t\t\t\t@click=\"create\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__create-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ createButtonText }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --save\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting, 'ui-btn-disabled': !isValidStep, }\"\n\t\t\t\t\t\t@click=\"save\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__save-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SAVE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__overlay\"></div>\n\t\t</div>\n\t`,\n};\n"],"names":["HeadUsers","name","components","UserListActionMenu","props","users","type","Array","required","showPlaceholder","Boolean","default","isTeamEntity","isExistingDepartment","userType","String","teamColor","Object","data","headsVisible","created","userTypes","head","deputy","computed","headItemsCount","defaultAvatar","placeholderAvatar","avatarImage","dropdownItems","map","user","workPosition","loc","titleBar","isDeputy","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","template","TreeNode","heads","userCount","Number","nodeId","entityType","EntityTypes","department","isShowLoader","memberRoles","getMemberRoles","departmentData","watch","newValue","$nextTick","loaderContainer","$refs","loader","Loader","size","show","isHeadsLoaded","loadHeads","departments","get","employeesCount","length","headUsers","filter","role","deputyUsers","deputyHead","showInfo","PermissionChecker","getInstance","hasPermission","PermissionActions","structureView","departmentId","team","dataTestIdSuffix","mapState","useChartStore","locPlural","count","getMessagePlural","departmentIds","store","formatDataTestId","prefix","TreePreview","parentId","rootId","parentNode","companyName","values","find","TeamColorPicker","BasePopup","modelValue","bindElement","HTMLElement","emits","popupConfig","popupWidth","pickerWidth","initialPopupOffset","angleWidth","width","height","borderRadius","contentNoPaddings","contentPadding","padding","offsetTop","offsetLeft","angleOffset","nodeColorsSettingsDict","NodeColorsSettingsDict","close","$emit","Department","description","shouldErrorHighlight","isEditMode","refToFocus","deniedError","showColorPicker","teamColorValue","recreateTagSelector","selectedParentDepartment","departmentName","departmentDescription","departmentSelectorCashe","MemoryCache","departmentsSelector","getOrCreateTagSelector","mounted","renderTo","activated","isDepartmentDataChanged","isValid","focus","title","innerHTML","createTagSelector","locked","preselectedItems","permissionChecker","permissionAction","teamCreate","departmentCreate","isTabEmpty","tab","getRootNode","getChildren","selector","TagSelector","events","onTagAdd","event","tag","id","onTagRemove","applyData","multiple","dialogOptions","dropdownMode","hideOnDeselect","entities","options","selectMode","restricted","includedNodeEntityTypes","includedNodeEntityTypesInDialog","useMultipleTabs","onLoad","dialog","getDialog","getTabs","forEach","setVisible","target","selectedItem","selectedItems","next","value","nodes","items","node","select","onLoadError","permissionCreateAction","permissionEditAction","teamEdit","departmentEdit","key","remember","namePlaceholder","descriptionPlaceholder","higherLevelDepartmentContainer","MenuOption","freeze","moveUsers","addUsers","ChangeSaveModeControl","RouteActionMenu","menuItems","getMenuItems","menuVisible","actionId","onActionMenuItemClick","bIcon","Main","PERSON_ARROW_LEFT_1","color","getColorCode","CRM","PERSON_PLUS_2","getControlButtonText","Employees","employeesIds","selectedUsers","Set","departmentHeads","departmentEmployees","removedUsers","headSelector","getUserSelector","memberRolesKeys","deputySelector","employeesSelector","employee","initialUsers","reduce","set","item","add","prevMemberRoles","rolesKeys","keys","roleKey","handler","payload","preselectedEmployees","employeeId","setPreselectedItems","load","getPreselectedItems","getData","onSelectorToggle","has","delete","popupOptions","onBeforeShow","setHeight","isLoaded","toggleUsers","onShow","container","getContainer","top","getBoundingClientRect","offset","offsetHeight","document","body","margin","setLink","intranetUsersOnly","inviteEmployeeLink","getItems","hidden","setHidden","getItem","userData","getUserDataBySelectorItem","isEmployee","rendered","parsedPreselected","flat","includes","employees","handleSaveModeChangedChanged","employeeTitle","ResponsiveHint","content","extraClasses","alignCenter","hint","parameters","bindOptions","position","offsetWidth","angle","Event","bind","Reflection","getClass","createInstance","popupParameters","hide","unmounted","DefaultHint","BindChat","BIcon","createDefaultChat","createDefaultChannel","chatSelector","getChatSelector","channelSelector","getChannelSelector","chats","channels","headsCreated","push","replace","intId","chat","enableSearch","recentTabOptions","getChatRecentTabOptions","ChatTypeDict","getChatDialogEntity","channel","getChannelDialogEntity","chatHintText","channelHintText","some","hints","Entities","selectedEntityType","hintHideTimeout","hasTeamCreatePermission","hasPermissionWithAnyNode","hasDepartmentCreatePermission","isEnabled","isSoon","isTeamsAvailable","company","entity","deactivated","clearTimeout","entityId","showHint","text","$event","setTimeout","AuthorityTypes","departmentHead","departmentDeputy","teamHead","teamDeputy","SettingsTypes","businessProcAuthority","reportsAuthority","TeamRights","settings","initBpValues","businessProcSelector","getTagSelector","reportsSelector","businessProcPreselected","getTagItems","businessProcPreselectedItem","settingType","tagFontWeight","showAddButton","getCustomData","preventDefault","showAvatars","undeselectedItems","lockedTagOptions","bgColor","textColor","departmentTagOptions","teamTagOptions","soonItemOptions","customData","selectable","badges","badgesOptions","justifyContent","tabs","tagOptions","goToBPHelp","BX","Helper","businessDescription","Text","encode","reportsDescriptions","WizardAPI","addDepartment","colorName","postData","getEmployees","updateDepartment","saveUsers","userIds","saveChats","ids","createDefault","createSettings","updateSettings","getSettings","chartWizardActions","createDepartment","parent","children","editDepartment","oldData","prevParent","childId","newParent","prevParentId","moveUsersToRootDepartment","userMovedToRootIds","rootEmployees","rootNode","refreshDepartments","tryToAddCurrentDepartment","isCurrentUserAdd","userId","changeCurrentDepartment","SaveMode","ChartWizard","showEntitySelector","source","stepIndex","waiting","isValidStep","blue","departmentSettings","visibleSteps","saveMode","init","beforeUnmount","unbind","window","handleBeforeUnload","stepTitle","isFirstStep","currentStep","steps","closeConfirmTitle","step","componentInfo","params","bindChat","teamRights","stepId","hasTreePreview","isChatStep","filteredSteps","createButtonText","createSteps","createVisibleSteps","createDefaultSaveMode","rawSettings","acc","settingsType","settingsValue","hasOwn","analyticsSendData","tool","category","c_element","move","buttonId","pickStepsAnalytics","sendEvent","closeWithConfirm","confirmPopup","MessageBox","message","yesCaption","noCaption","onYes","minHeight","buttons","MessageBoxButtons","YES_NO","closeIcon","className","getYesButton","setRound","getNoButton","onApplyData","prevEntityType","getUsersPromise","calculateEmployeeIds","headsIds","deputiesIds","departmentUserIds","getUserMemberPromise","hasUsers","Promise","resolve","create","accessCode","newDepartment","updatedDepartmentIds","error","reportedErrorTypes","code","UI","Notification","Center","notify","autoHideDelay","showConfetti","p2","p3","p4","save","currentNode","targetNodeId","usersPromise","departmentPromise","settingsPromise","pickEditAnalytics","usersResponse","all","e","console","handleSaveModeChanged","p1"],"mappings":";;;;;;CAGO,MAAMA,SAAS,GAAG;GACxBC,IAAI,EAAE,WAAW;GAEjBC,UAAU,EAAE;yBACXC;IACA;GAEDC,KAAK,EAAE;KACNC,KAAK,EAAE;OACNC,IAAI,EAAEC,KAAK;OACXC,QAAQ,EAAE;MACV;KACDC,eAAe,EAAE;OAChBH,IAAI,EAAEI,OAAO;OACbC,OAAO,EAAE;MACT;KACDC,YAAY,EAAE;OACbN,IAAI,EAAEI,OAAO;OACbC,OAAO,EAAE;MACT;KACDE,oBAAoB,EAAE;OACrBP,IAAI,EAAEI,OAAO;OACbC,OAAO,EAAE;MACT;KACDG,QAAQ,EAAE;OACTR,IAAI,EAAES,MAAM;OACZJ,OAAO,EAAE;MACT;KACDK,SAAS,EAAE;OACVV,IAAI,EAAE,CAACW,MAAM,EAAE,IAAI,CAAC;OACpBN,OAAO,EAAE;;IAEV;GAEDO,IAAI,GACJ;KACC,OAAO;OACNC,YAAY,EAAE;MACd;IACD;GAEDC,OAAO,GACP;KACC,IAAI,CAACC,SAAS,GAAG;OAChBC,IAAI,EAAE,MAAM;OACZC,MAAM,EAAE;MACR;IACD;GAEDC,QAAQ,EACR;KACCC,cAAc,GACd;OACC,OAAO,IAAI,CAACZ,oBAAoB,GAAG,CAAC,GAAG,CAAC;MACxC;KACDa,aAAa,GACb;OACC,OAAO,mFAAmF;MAC1F;KACDC,iBAAiB,GACjB;OACC,IAAI,CAAC,IAAI,CAACf,YAAY,IAAI,CAAC,IAAI,CAACI,SAAS,EACzC;SACC,OAAO,oHAAoH;;OAG5H,OAAQ,+FAA8F,IAAI,CAACA,SAAS,CAACY,WAAY,EAAC;MAClI;KACDC,aAAa,GACb;OACC,OAAO,IAAI,CAACxB,KAAK,CAACyB,GAAG,CAAEC,IAAc,IAAe;SACnD,MAAMC,YAAY,GAAGD,IAAI,CAACC,YAAY,IAAI,IAAI,CAACC,GAAG,CAAC,uDAAuD,CAAC;SAE3G,OAAO;WAAE,GAAGF,IAAI;WAAEC;UAAc;QAChC,CAAC;MACF;KACDE,QAAQ,GACR;OACC,OAAO,IAAI,CAACpB,QAAQ,KAAK,IAAI,CAACO,SAAS,CAACE,MAAM,GAC3C,IAAI,CAACU,GAAG,CAAC,+DAA+D,CAAC,GACzE,IAAI,CAACA,GAAG,CAAC,6DAA6D,CAAC;MAE1E;KACDE,QAAQ,GACR;OACC,OAAO,IAAI,CAACrB,QAAQ,KAAK,IAAI,CAACO,SAAS,CAACE,MAAM;;IAE/C;GAEDa,OAAO,EAAE;KACRH,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;;IAE7D;GAEDI,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAwEZ,CAAC;;CCjKM,MAAMC,QAAQ,GAAG;GACvB1C,IAAI,EAAE,UAAU;GAEhBC,UAAU,EAAE;KAAEF;IAAW;GAEzBI,KAAK,EAAE;KACNH,IAAI,EAAEc,MAAM;KACZ6B,KAAK,EAAErC,KAAK;KACZsC,SAAS,EAAEC,MAAM;KACjBC,MAAM,EAAED,MAAM;KACdE,UAAU,EAAE;OACX1C,IAAI,EAAES,MAAM;OACZJ,OAAO,EAAEsC,iDAAW,CAACC;MACrB;;KAEDlC,SAAS,EAAE;OACVV,IAAI,EAAE,CAACW,MAAM,EAAE,IAAI,CAAC;OACpBN,OAAO,EAAE;;IAEV;GAEDO,IAAI,GACJ;KACC,OAAO;OAAEiC,YAAY,EAAE;MAAO;IAC9B;GAED/B,OAAO,GACP;KACC,IAAI,CAACgC,WAAW,GAAGC,kDAAc,CAAC,IAAI,CAACC,cAAc,CAACN,UAAU,CAAC;IACjE;GAEDO,KAAK,EACL;KACCJ,YAAY,CAACK,QAAiB,EAC9B;OACC,IAAI,CAACA,QAAQ,EACb;SACC;;OAGD,IAAI,CAACC,SAAS,CAAC,MAAM;SACpB,MAAM;WAAEC;UAAiB,GAAG,IAAI,CAACC,KAAK;SACtC,MAAMC,MAAM,GAAG,IAAIC,kBAAM,CAAC;WAAEC,IAAI,EAAE;UAAI,CAAC;SACvCF,MAAM,CAACG,IAAI,CAACL,eAAe,CAAC;QAC5B,CAAC;;IAEH;GACDlC,QAAQ,EACR;KACC8B,cAAc,GACd;OACC,IAAI,IAAI,CAACzC,oBAAoB,EAC7B;SACC,IAAI,CAAC,IAAI,CAACmD,aAAa,EACvB;WACC,IAAI,CAACC,SAAS,CAAC,CAAC,IAAI,CAAClB,MAAM,CAAC,CAAC;;SAG9B,OAAO,IAAI,CAACmB,WAAW,CAACC,GAAG,CAAC,IAAI,CAACpB,MAAM,CAAC;;OAGzC,OAAO;SACN9C,IAAI,EAAE,IAAI,CAACA,IAAI;SACf2C,KAAK,EAAE,IAAI,CAACA,KAAK;SACjBC,SAAS,EAAE,IAAI,CAACA,SAAS;SACzBG,UAAU,EAAE,IAAI,CAACA;QACjB;MACD;KACDnC,oBAAoB,GACpB;OACC,OAAOH,OAAO,CAAC,IAAI,CAACqC,MAAM,CAAC;MAC3B;KACDqB,cAAc,GACd;OAAA;OACC,OAAO,CAAC,IAAI,CAACvB,SAAS,IAAI,CAAC,KAAK,oBAAI,CAACD,KAAK,qBAAV,YAAYyB,MAAM,KAAI,CAAC,CAAC;MACxD;KACDC,SAAS,GACT;OAAA;OACC,gCAAO,IAAI,CAAChB,cAAc,CAACV,KAAK,qBAAzB,sBAA2B2B,MAAM,CAAEjD,IAAI,IAAK;SAClD,OAAOA,IAAI,CAACkD,IAAI,KAAK,IAAI,CAACpB,WAAW,CAAC9B,IAAI;QAC1C,CAAC;MACF;KACDmD,WAAW,GACX;OAAA;OACC,iCAAO,IAAI,CAACnB,cAAc,CAACV,KAAK,qBAAzB,uBAA2B2B,MAAM,CAAEjD,IAAI,IAAK;SAClD,OAAOA,IAAI,CAACkD,IAAI,KAAK,IAAI,CAACpB,WAAW,CAACsB,UAAU;QAChD,CAAC;MACF;KACDC,QAAQ,GACR;OACC,OAAO,IAAI,CAAC5B,MAAM,GACf6B,mEAAiB,CAACC,WAAW,EAAE,CAACC,aAAa,CAACC,mEAAiB,CAACC,aAAa,EAAE,IAAI,CAACjC,MAAM,CAAC,GAC3F,IAAI;MACP;KACDiB,aAAa,CAACiB,YAAoB,EAClC;OACC,MAAM;SAAErC;QAAO,GAAG,IAAI,CAACsB,WAAW,CAACC,GAAG,CAAC,IAAI,CAACpB,MAAM,CAAC;OAEnD,OAAOrC,OAAO,CAACkC,KAAK,CAAC;MACrB;KACDhC,YAAY,GACZ;OACC,OAAO,IAAI,CAAC0C,cAAc,CAACN,UAAU,KAAKC,iDAAW,CAACiC,IAAI;MAC1D;KACDC,gBAAgB,GAChB;OACC,OAAO,IAAI,CAACtE,oBAAoB,GAAG,EAAE,GAAG,MAAM;MAC9C;KACD,GAAGuE,sBAAQ,CAACC,wDAAa,EAAE,CAAC,aAAa,CAAC;IAC1C;GAEDjD,OAAO,EAAE;KACRH,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDgD,SAAS,CAACjD,UAAkB,EAAEkD,KAAa,EAC3C;OACC,OAAO/C,aAAG,CAACgD,gBAAgB,CAACnD,UAAU,EAAEkD,KAAK,EAAE;SAAE,SAAS,EAAEA;QAAO,CAAC;MACpE;KACD,MAAMtB,SAAS,CAACwB,aAAuB,EACvC;OACC,MAAMC,KAAK,GAAGL,wDAAa,EAAE;OAC7B,IACA;SACC,IAAI,CAAClC,YAAY,GAAG,IAAI;SACxB,MAAMuC,KAAK,CAACzB,SAAS,CAACwB,aAAa,CAAC;QACpC,SAED;SACC,IAAI,CAACtC,YAAY,GAAG,KAAK;;MAE1B;KACDwC,gBAAgB,CAACC,MAAc,EAC/B;OACC,OAAOA,MAAM,GAAG,IAAI,CAACT,gBAAgB;;IAEtC;GAEDzC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAiFZ,CAAC;;CChOM,MAAMmD,WAAW,GAAG;GAC1B5F,IAAI,EAAE,aAAa;GAEnBC,UAAU,EAAE;KAAEyC;IAAU;GAExBvC,KAAK,EAAE;KACN0F,QAAQ,EAAE;OACTxF,IAAI,EAAE,CAACwC,MAAM,EAAE,IAAI,CAAC;OACpBtC,QAAQ,EAAE;MACV;KACDP,IAAI,EAAE;OACLK,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDoC,KAAK,EAAE;OACNtC,IAAI,EAAEC,KAAK;OACXC,QAAQ,EAAE;MACV;KACDqC,SAAS,EAAE;OACVvC,IAAI,EAAEwC,MAAM;OACZtC,QAAQ,EAAE;MACV;KACDwC,UAAU,EAAE;OACX1C,IAAI,EAAES,MAAM;OACZJ,OAAO,EAAEsC,iDAAW,CAACC;MACrB;;KAEDlC,SAAS,EAAE;OACVV,IAAI,EAAE,CAACW,MAAM,EAAE,IAAI,CAAC;OACpBN,OAAO,EAAE;;IAEV;GAEDa,QAAQ,EACR;KACCuE,MAAM,GACN;OACC,MAAMC,UAAU,GAAG,IAAI,CAAC9B,WAAW,CAACC,GAAG,CAAC,IAAI,CAAC2B,QAAQ,CAAC;OACtD,IAAIE,UAAU,EACd;SAAA;SACC,+BAAOA,UAAU,CAACF,QAAQ,mCAAI,CAAC;;OAGhC,OAAO,CAAC;MACR;KACDG,WAAW,GACX;OACC,MAAM;SAAEhG;QAAM,GAAG,CAAC,GAAG,IAAI,CAACiE,WAAW,CAACgC,MAAM,EAAE,CAAC,CAACC,IAAI,CAAEjD,UAAU,IAAK;SACpE,OAAOA,UAAU,CAAC4C,QAAQ,KAAK,CAAC;QAChC,CAAC;OAEF,OAAO7F,IAAI;MACX;KACDW,YAAY,GACZ;OACC,OAAO,IAAI,CAACoC,UAAU,KAAKC,iDAAW,CAACiC,IAAI;MAC3C;KACD,GAAGE,sBAAQ,CAACC,wDAAa,EAAE,CAAC,aAAa,CAAC;IAC1C;GAEDjD,OAAO,EAAE;KACRH,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;;IAE7D;GAEDI,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAkDZ,CAAC;;CCvHD;AACA,CAAO,MAAM0D,eAAe,GAAG;GAC9BnG,IAAI,EAAE,iBAAiB;GAEvBC,UAAU,EAAE;gBACXmG;IACA;GAEDjG,KAAK,EAAE;;KAENkG,UAAU,EAAE;OACXhG,IAAI,EAAEW,MAAM;OACZT,QAAQ,EAAE;MACV;KACD+F,WAAW,EAAE;OACZjG,IAAI,EAAEkG,WAAW;OACjBhG,QAAQ,EAAE;;IAEX;GAEDiG,KAAK,EAAE,CAAC,QAAQ,EAAE,OAAO,EAAE,mBAAmB,CAAC;GAE/CjF,QAAQ,EACR;KACCkF,WAAW,GACX;OACC,MAAMC,UAAU,GAAG,GAAG;OACtB,MAAMC,WAAW,GAAG,EAAE;OACtB,MAAMC,kBAAkB,GAAG,EAAE;OAC7B,MAAMC,UAAU,GAAG,EAAE;OAErB,OAAO;SACNC,KAAK,EAAEJ,UAAU;SACjBK,MAAM,EAAE,GAAG;SACXT,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BU,YAAY,EAAE,EAAE;SAChBC,iBAAiB,EAAE,IAAI;SACvBC,cAAc,EAAE,CAAC;SACjBC,OAAO,EAAE,CAAC;SACVC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAEV,WAAW,GAAG,CAAC,GAAGD,UAAU,GAAG,CAAC,GAAGE,kBAAkB;SACjEU,WAAW,EAAEZ,UAAU,GAAG,CAAC,GAAGG,UAAU,GAAG;QAC3C;MACD;KACDU,sBAAsB,GACtB;OACC,OAAOC,4DAAsB;;IAE9B;GAEDrF,OAAO,EACP;KACCsF,KAAK,GACL;OACC,IAAI,CAACC,KAAK,CAAC,OAAO,CAAC;;IAEpB;GAEDjF,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;CAuBZ,CAAC;;CCxED;AACA,CAAO,MAAMkF,UAAU,GAAG;GACzB3H,IAAI,EAAE,YAAY;GAElBC,UAAU,EAAE;KAAEkG;IAAiB;GAE/BhG,KAAK,EAAE;KACN0F,QAAQ,EAAE;OACTxF,IAAI,EAAE,CAACwC,MAAM,EAAE,IAAI,CAAC;OACpBtC,QAAQ,EAAE;MACV;KACDP,IAAI,EAAE;OACLK,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDqH,WAAW,EAAE;OACZvH,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDsH,oBAAoB,EAAE;OACrBxH,IAAI,EAAEI,OAAO;OACbF,QAAQ,EAAE;MACV;KACDuH,UAAU,EAAE;OACXzH,IAAI,EAAEI;MACN;KACDsC,UAAU,EAAE;OACX1C,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDQ,SAAS,EAAE;OACVV,IAAI,EAAE,CAACW,MAAM,EAAE,IAAI,CAAC;OACpBN,OAAO,EAAE;MACT;KACDqH,UAAU,EAAE;OACX1H,IAAI,EAAES,MAAM;OACZJ,OAAO,EAAE;;IAEV;GAED8F,KAAK,EAAE,CAAC,WAAW,CAAC;GAEpBvF,IAAI,GACJ;KACC,OAAO;OACN+G,WAAW,EAAE,KAAK;OAClBC,eAAe,EAAE,KAAK;OACtBC,cAAc,EAAE,IAAI,CAACnH;MACrB;IACD;GAEDuC,KAAK,EACL;KACC3C,YAAY,GACZ;;OAEC,IAAI,CAACwH,mBAAmB,EAAE;;IAE3B;GAEDhH,OAAO,GACP;KACC,IAAI,CAACiH,wBAAwB,GAAG,IAAI,CAACvC,QAAQ;KAC7C,IAAI,CAACwC,cAAc,GAAG,IAAI,CAACrI,IAAI;KAC/B,IAAI,CAACsI,qBAAqB,GAAG,IAAI,CAACV,WAAW;KAC7C,IAAI,CAACW,uBAAuB,GAAG,IAAIC,2BAAW,EAAE;KAChD,IAAI,CAACC,mBAAmB,GAAG,IAAI,CAACC,sBAAsB,EAAE;IACxD;GAEDC,OAAO,GACP;KACC,IAAI,CAACF,mBAAmB,CAACG,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,cAAc,CAAC,CAAC;IAC7D;GAEDmF,SAAS,GACT;KACC,IAAI,CAACX,cAAc,GAAG,IAAI,CAACnH,SAAS;KACpC,IAAI,CAAC2G,KAAK,CAAC,WAAW,EAAE;OACvBoB,uBAAuB,EAAE,KAAK;OAC9BC,OAAO,EACN,IAAI,CAACV,cAAc,KAAK,EAAE,IACvB,IAAI,CAACD,wBAAwB,KAAK,IAAI,IACtC,CAAC,IAAI,CAACJ;MAEV,CAAC;KAEF,IAAI,IAAI,CAACD,UAAU,IAAI,IAAI,CAACrE,KAAK,CAAC,IAAI,CAACqE,UAAU,CAAC,EAClD;OACC,IAAI,CAACrE,KAAK,CAAC,IAAI,CAACqE,UAAU,CAAC,CAACiB,KAAK,EAAE;MACnC,MAED;OACC,IAAI,CAACtF,KAAK,CAACuF,KAAK,CAACD,KAAK,EAAE;;IAEzB;GAED7G,OAAO,EACP;KACCgG,mBAAmB,GACnB;OACC,IAAI,CAACzE,KAAK,CAAC,cAAc,CAAC,CAACwF,SAAS,GAAG,EAAE;OACzC,IAAI,CAACT,mBAAmB,GAAG,IAAI,CAACC,sBAAsB,EAAE;OACxD,IAAI,CAACD,mBAAmB,CAACG,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,cAAc,CAAC,CAAC;MAC7D;KACDyF,iBAAiB,GACjB;OACC,MAAMC,MAAM,GAAG,IAAI,CAACvD,QAAQ,KAAK,CAAC,IAAI,IAAI,CAACiC,UAAU;OACrD,IAAIuB,gBAAgB,GAAG,IAAI,CAACxD,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,IAAI,CAACA,QAAQ,CAAC,CAAC,GAAG,EAAE;OAC/E,IAAI,CAAC,IAAI,CAACiC,UAAU,EACpB;SACC,MAAMwB,iBAAiB,GAAG3E,mEAAiB,CAACC,WAAW,EAAE;SACzD,MAAM2E,gBAAgB,GAAG,IAAI,CAAC5I,YAAY,GAAGmE,mEAAiB,CAAC0E,UAAU,GAAG1E,mEAAiB,CAAC2E,gBAAgB;SAC9G,IACCH,iBAAiB,IACd,CAACA,iBAAiB,CAACzE,aAAa,CAAC0E,gBAAgB,EAAE,IAAI,CAAC1D,QAAQ,CAAC,EAErE;WACCwD,gBAAgB,GAAG,CAAC,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;;;OAI5C,MAAMK,UAAU,GAAIC,GAAG,IAAKA,GAAG,CAACC,WAAW,EAAE,CAACC,WAAW,EAAE,CAACvE,KAAK,EAAE,KAAK,CAAC;OAEzE,MAAMwE,QAAQ,GAAG,IAAIC,6BAAW,CAAC;SAChCC,MAAM,EAAE;WACPC,QAAQ,EAAGC,KAAgB,IAAK;aAC/B,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACjJ,IAAI;aAC1B,IAAI,CAACmH,wBAAwB,GAAG+B,GAAG,CAACC,EAAE;YACtC;WACDC,WAAW,EAAE,MAAM;aAClB,IAAI,CAACjC,wBAAwB,GAAG,IAAI;aACpC,IAAI,CAACkC,SAAS,EAAE;;UAEjB;SACDC,QAAQ,EAAE,KAAK;SACfnB,MAAM;SACNoB,aAAa,EAAE;WACd1D,KAAK,EAAE,GAAG;WACVC,MAAM,EAAE,GAAG;WACX0D,YAAY,EAAE,IAAI;WAClBC,cAAc,EAAE,IAAI;WACpBC,QAAQ,EAAE,CACT;aACCP,EAAE,EAAE,gBAAgB;aACpBQ,OAAO,EAAE;eACRC,UAAU,EAAE,iBAAiB;eAC7BC,UAAU,EAAE,IAAI,CAAChD,UAAU,GAAG,QAAQ,GAAG,QAAQ;eACjDiD,uBAAuB,EAAE,IAAI,CAACC,+BAA+B;eAC7DC,eAAe,EAAE;;YAElB,CACD;WACD5B,gBAAgB;WAChBW,MAAM,EAAE;aACPkB,MAAM,EAAGhB,KAAK,IAAK;eAAA;eAClB,MAAMiB,MAAM,GAAGrB,QAAQ,CAACsB,SAAS,EAAE;eAEnCD,MAAM,CAACE,OAAO,EAAE,CACd/G,MAAM,CAAEqF,GAAG,IAAKD,UAAU,CAACC,GAAG,CAAC,CAAC,CAChC2B,OAAO,CAAE3B,GAAG,IAAKA,GAAG,CAAC4B,UAAU,CAAC,KAAK,CAAC,CAAC;eAGzC,IAAI,IAAI,CAACzD,UAAU,EACnB;iBACC;;eAGD,MAAMwB,iBAAiB,GAAG3E,mEAAiB,CAACC,WAAW,EAAE;eACzD,IAAI,CAAC0E,iBAAiB,EACtB;iBACC;;eAGD,MAAMkC,MAAM,GAAGtB,KAAK,CAACsB,MAAM;eAC3B,MAAMC,YAAY,4BAAGD,MAAM,CAACE,aAAa,+CAApB,sBAAsBzF,MAAM,EAAE,+CAA9B,uBAAgC0F,IAAI,EAAE,qBAAtC,uBAAwCC,KAAK;eAClE,MAAMC,KAAK,GAAGL,MAAM,CAACM,KAAK,CAAC5H,GAAG,CAAC,gBAAgB,CAAC;eAEhD,MAAMqF,gBAAgB,GAAG,IAAI,CAAC5I,YAAY,GACvCmE,mEAAiB,CAAC0E,UAAU,GAC5B1E,mEAAiB,CAAC2E,gBAAgB;eAGrC,KAAK,MAAM,GAAGsC,IAAI,CAAC,IAAIF,KAAK,EAC5B;iBAAA;iBACC,IACCvC,iBAAiB,CAACzE,aAAa,CAAC0E,gBAAgB,EAAEwC,IAAI,CAAC3B,EAAE,CAAC,IACvD,CAACd,iBAAiB,CAACzE,aAAa,CAAC0E,gBAAgB,sBAAEkC,YAAY,oBAAZA,YAAY,CAAErB,EAAE,+BAAI,CAAC,CAAC,EAE7E;mBACC2B,IAAI,CAACC,MAAM,EAAE;mBAEb;;;cAGF;aACDC,WAAW,EAAE,MAAM;eAClB,IAAI,CAAC7D,wBAAwB,GAAG,IAAI;eACpC,IAAI,CAACkC,SAAS,EAAE;cAChB;aACD,eAAe,EAAGJ,KAAgC,IAAK;eAAA;eACtD,IAAI,CAAClC,WAAW,GAAG,KAAK;eAExB,MAAMwD,MAAM,GAAGtB,KAAK,CAACsB,MAAM;eAC3B,MAAMC,YAAY,6BAAGD,MAAM,CAACE,aAAa,+CAApB,uBAAsBzF,MAAM,EAAE,+CAA9B,uBAAgC0F,IAAI,EAAE,qBAAtC,uBAAwCC,KAAK;eAElE,MAAMtC,iBAAiB,GAAG3E,mEAAiB,CAACC,WAAW,EAAE;eACzD,IAAI,CAAC0E,iBAAiB,EACtB;iBACC;;eAGD,MAAM4C,sBAAsB,GAAG,IAAI,CAACvL,YAAY,GAC7CmE,mEAAiB,CAAC0E,UAAU,GAC5B1E,mEAAiB,CAAC2E,gBAAgB;eAGrC,MAAM0C,oBAAoB,GAAG,IAAI,CAACxL,YAAY,GAC3CmE,mEAAiB,CAACsH,QAAQ,GAC1BtH,mEAAiB,CAACuH,cAAc;eAGnC,MAAM9C,gBAAgB,GAAG,IAAI,CAACzB,UAAU,GACrCqE,oBAAoB,GACpBD,sBAAsB;eAGzB,IAAI,CAAC5C,iBAAiB,CAACzE,aAAa,CAAC0E,gBAAgB,EAAEkC,YAAY,CAACrB,EAAE,CAAC,EACvE;iBACC,IAAI,CAACpC,WAAW,GAAG,IAAI;;eAGxB,IAAI,CAACsC,SAAS,EAAE;;;;QAInB,CAAC;OAEF,OAAOR,QAAQ;MACf;KACDpB,sBAAsB,GACtB;OACC,MAAM4D,GAAG,GAAGxL,MAAM,CAAC,IAAI,CAACH,YAAY,CAAC;OAErC,OAAO,IAAI,CAAC4H,uBAAuB,CAACgE,QAAQ,CAACD,GAAG,EAAE,MAAM,IAAI,CAACnD,iBAAiB,EAAE,CAAC;MACjF;KACDnH,GAAG,CAACI,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDiI,SAAS,GACT;OACC,IAAI,CAAC5C,KAAK,CAAC,WAAW,EAAE;SACvB1H,IAAI,EAAE,IAAI,CAACqI,cAAc;SACzBT,WAAW,EAAE,IAAI,CAACU,qBAAqB;SACvCzC,QAAQ,EAAE,IAAI,CAACuC,wBAAwB;SACvCrH,SAAS,EAAE,IAAI,CAACmH,cAAc;SAC9BY,uBAAuB,EAAE,IAAI;SAC7BC,OAAO,EACN,IAAI,CAACV,cAAc,KAAK,EAAE,IACvB,IAAI,CAACD,wBAAwB,KAAK,IAAI,IACtC,CAAC,IAAI,CAACJ;QAEV,CAAC;;IAEH;GAEDzG,QAAQ,EACR;KACCyJ,+BAA+B,GAC/B;OACC,OAAO,IAAI,CAACrK,YAAY,GAAG,CAAC,YAAY,EAAE,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC;MAClE;KACDA,YAAY,GACZ;OACC,OAAO,IAAI,CAACoC,UAAU,KAAKC,iDAAW,CAACiC,IAAI;MAC3C;KACDuH,eAAe,GACf;OACC,OAAO,IAAI,CAAC7L,YAAY,GACrB,IAAI,CAACqB,GAAG,CAAC,wEAAwE,CAAC,GAClF,IAAI,CAACA,GAAG,CAAC,qEAAqE,CAAC;MAClF;KACDyK,sBAAsB,GACtB;OACC,OAAO,IAAI,CAAC9L,YAAY,GACrB,IAAI,CAACqB,GAAG,CAAC,gEAAgE,CAAC,GAC1E,IAAI,CAACA,GAAG,CAAC,sEAAsE,CAAC;MACnF;KACD0K,8BAA8B,GAC9B;;;OAGC,OAAO,IAAI,CAAC/L,YAAY,GAAG,yCAAyC,GAAG,sCAAsC;;IAE9G;GAED8B,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAyHZ,CAAC;;CCxaD,MAAMkK,UAAU,GAAG3L,MAAM,CAAC4L,MAAM,CAAC;GAChCC,SAAS,EAAE,WAAW;GACtBC,QAAQ,EAAE;CACX,CAAC,CAAC;AAEF,CAAO,MAAMC,qBAAqB,GAAG;GACpC/M,IAAI,EAAE,uBAAuB;GAC7BwG,KAAK,EAAE,CAAC,iBAAiB,CAAC;GAE1BvG,UAAU,EAAE;sBACX+M;IACA;GAED7L,OAAO,GACP;KACC,IAAI,CAAC8L,SAAS,GAAG,IAAI,CAACC,YAAY,EAAE;IACpC;GAEDjM,IAAI,GACJ;KACC,OAAO;OACNkM,WAAW,EAAE,KAAK;OAClBC,QAAQ,EAAET,UAAU,CAACE;MACrB;IACD;GAED1K,OAAO,EAAE;KACRH,GAAG,CAACI,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDgL,qBAAqB,CAACD,QAAgB,EACtC;OACC,IAAI,CAACA,QAAQ,GAAGA,QAAQ;OACxB,IAAI,CAAC1F,KAAK,CAAC,iBAAiB,EAAE0F,QAAQ,CAAC;MACvC;KACDF,YAAY,GACZ;OACC,OAAO,CACN;SACC9C,EAAE,EAAEuC,UAAU,CAACE,SAAS;SACxB5D,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,6EAA6E,CAAC;SAC9F4F,WAAW,EAAE,IAAI,CAAC5F,GAAG,CAAC,mFAAmF,CAAC;SAC1GsL,KAAK,EAAE;WACNtN,IAAI,EAAEuN,wBAAI,CAACC,mBAAmB;WAC9B3J,IAAI,EAAE,EAAE;WACR4J,KAAK,EAAEC,kDAAY,CAAC,eAAe;;QAEpC,EACD;SACCtD,EAAE,EAAEuC,UAAU,CAACG,QAAQ;SACvB7D,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,4EAA4E,CAAC;SAC7F4F,WAAW,EAAE,IAAI,CAAC5F,GAAG,CAAC,kFAAkF,CAAC;SACzGsL,KAAK,EAAE;WACNtN,IAAI,EAAE2N,uBAAG,CAACC,aAAa;WACvB/J,IAAI,EAAE,EAAE;WACR4J,KAAK,EAAEC,kDAAY,CAAC,eAAe;;QAEpC,CACD;;IAEF;GAEDnM,QAAQ,EAAE;KACTsM,oBAAoB,GACpB;OACC,MAAMzL,UAAU,GAAG,IAAI,CAACgL,QAAQ,KAAKT,UAAU,CAACE,SAAS,GACtD,6EAA6E,GAC7E,4EAA4E;OAE/E,OAAO,IAAI,CAAC7K,GAAG,CAACI,UAAU,CAAC;;IAE5B;GAEDK,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;CAwBZ,CAAC;;CClGM,MAAMqL,SAAS,GAAG;GACxB9N,IAAI,EAAE,WAAW;GAEjBC,UAAU,EAAE;KAAE8M;IAAuB;GAErCvG,KAAK,EAAE,CAAC,WAAW,EAAE,iBAAiB,CAAC;GAEvCrG,KAAK,EAAE;KACNwC,KAAK,EAAE;OACNtC,IAAI,EAAEC,KAAK;OACXC,QAAQ,EAAE;MACV;KACDwN,YAAY,EAAE;OACb1N,IAAI,EAAEC,KAAK;OACXC,QAAQ,EAAE;MACV;KACDuH,UAAU,EAAE;OACXzH,IAAI,EAAEI,OAAO;OACbF,QAAQ,EAAE;MACV;KACDwC,UAAU,EAAE;OACX1C,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;;IAEX;GAEDY,OAAO,GACP;KACC,IAAI,CAACgC,WAAW,GAAGC,kDAAc,CAAC,IAAI,CAACL,UAAU,CAAC;KAClD,IAAI,CAACiL,aAAa,GAAG,IAAIC,GAAG,EAAE;KAC9B,IAAI,CAACC,eAAe,GAAG,EAAE;KACzB,IAAI,CAACC,mBAAmB,GAAG,EAAE;KAC7B,IAAI,CAACC,YAAY,GAAG,EAAE;KACtB,IAAI,CAACC,YAAY,GAAG,IAAI,CAACC,eAAe,CAACC,mDAAe,CAAClN,IAAI,CAAC;KAC9D,IAAI,CAACmN,cAAc,GAAG,IAAI,CAACF,eAAe,CAACC,mDAAe,CAAC9J,UAAU,CAAC;KACtE,IAAI,CAACgK,iBAAiB,GAAG,IAAI,CAACH,eAAe,CAACC,mDAAe,CAACG,QAAQ,CAAC;KACvE,IAAI,CAAC9L,SAAS,GAAG,CAAC;;;KAGlB,IAAI,CAAC+L,YAAY,GAAG,IAAI,CAAChM,KAAK,CAACiM,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAKD,GAAG,CAACE,GAAG,CAACD,IAAI,CAAC1E,EAAE,CAAC,EAAE,IAAI6D,GAAG,EAAE,CAAC;IACjF;GAEDtF,OAAO,GACP;KACC,IAAI,CAAC0F,YAAY,CAACzF,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,eAAe,CAAC,CAAC;KACvD,IAAI,CAAC8K,cAAc,CAAC5F,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,iBAAiB,CAAC,CAAC;KAC3D,IAAI,CAAC+K,iBAAiB,CAAC7F,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,oBAAoB,CAAC,CAAC;IACjE;GAEDJ,KAAK,EACL;KACCP,UAAU,CAACA,UAAkB,EAC7B;OACC,MAAMiM,eAAe,GAAG,IAAI,CAAC7L,WAAW;OACxC,MAAM8L,SAAS,GAAGjO,MAAM,CAACkO,IAAI,CAACF,eAAe,CAAC;OAC9C,IAAI,CAAC7L,WAAW,GAAGC,kDAAc,CAACL,UAAU,CAAC;OAE7C,IAAI,CAACmL,eAAe,GAAG,IAAI,CAACA,eAAe,CAACrM,GAAG,CAAEiN,IAAI,IAAK;SACzD,MAAMK,OAAO,GAAGF,SAAS,CAAC/I,IAAI,CAAEoG,GAAG,IAAK0C,eAAe,CAAC1C,GAAG,CAAC,KAAKwC,IAAI,CAACvK,IAAI,CAAC;SAE3E,OAAO;WAAE,GAAGuK,IAAI;WAAEvK,IAAI,EAAE,IAAI,CAACpB,WAAW,CAACgM,OAAO;UAAG;QACnD,CAAC;OAEF,IAAI,CAAChB,mBAAmB,GAAG,IAAI,CAACA,mBAAmB,CACjDtM,GAAG,CAAEiN,IAAI,KAAM;SAAE,GAAGA,IAAI;SAAEvK,IAAI,EAAE,IAAI,CAACpB,WAAW,CAACuL;QAAU,CAAC,CAAC;MAE/D;KACDX,YAAY,EACZ;OACCqB,OAAO,CAACC,OAAiB,EACzB;SACC,IAAI,CAACtB,YAAY,CAACzC,OAAO,CAAEwD,IAAI,IAAK,IAAI,CAACH,YAAY,CAACI,GAAG,CAACD,IAAI,CAAC,CAAC;SAChE,MAAMQ,oBAAoB,GAAGD,OAAO,CAACxN,GAAG,CAAE0N,UAAU,IAAK,CAAC,MAAM,EAAEA,UAAU,CAAC,CAAC;SAC9E,MAAM;WAAEpE;UAAQ,GAAG,IAAI,CAACsD,iBAAiB;SACzCtD,MAAM,CAACqE,mBAAmB,CAACF,oBAAoB,CAAC;SAChDnE,MAAM,CAACsE,IAAI,EAAE;;;IAGf;GAEDtN,OAAO,EACP;KACCuN,mBAAmB,CAACnL,IAAY,EAChC;OACC,IAAI,IAAI,CAACpB,WAAW,CAACuL,QAAQ,KAAKnK,IAAI,EACtC;SACC,OAAO,IAAI,CAACwJ,YAAY,CAAClM,GAAG,CAAE0N,UAAU,IAAK,CAAC,MAAM,EAAEA,UAAU,CAAC,CAAC;;OAGnE,OAAO,IAAI,CAAC5M,KAAK,CAAC2B,MAAM,CAAEjD,IAAI,IAAKA,IAAI,CAACkD,IAAI,KAAKA,IAAI,CAAC,CAAC1C,GAAG,CAAER,IAAI,IAAK;SACpE,OAAO,CAAC,MAAM,EAAEA,IAAI,CAAC+I,EAAE,CAAC;QACxB,CAAC;MACF;KACDkE,eAAe,CAACa,OAAe,EAC/B;OACC,MAAMrF,QAAQ,GAAG,IAAIC,6BAAW,CAAC;SAChCC,MAAM,EAAE;WACPC,QAAQ,EAAGC,KAAgB,IAAK;aAC/B,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,IAAI,CAAC3B,aAAa,CAACe,GAAG,CAAC5E,GAAG,CAACC,EAAE,CAAC;aAC9B,IAAI,CAACwF,gBAAgB,CAACzF,GAAG,EAAE,IAAI,CAAChH,WAAW,CAACgM,OAAO,CAAC,CAAC;aAErD,IAAI,IAAI,CAACR,YAAY,CAACkB,GAAG,CAAC1F,GAAG,CAACC,EAAE,CAAC,EACjC;eACC,IAAI,CAACuE,YAAY,CAACmB,MAAM,CAAC3F,GAAG,CAACC,EAAE,CAAC;cAChC,MAED;eACC,IAAI,CAACE,SAAS,EAAE;;YAEjB;WACDD,WAAW,EAAGH,KAAgB,IAAK;aAClC,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,IAAI,CAAC3B,aAAa,CAAC8B,MAAM,CAAC3F,GAAG,CAACC,EAAE,CAAC;aACjC,IAAI,CAACwF,gBAAgB,CAACzF,GAAG,EAAE,IAAI,CAAChH,WAAW,CAACgM,OAAO,CAAC,CAAC;aACrD,IAAI,CAAC7E,SAAS,EAAE;;UAEjB;SACDC,QAAQ,EAAE,IAAI;SACdC,aAAa,EAAE;WACdnB,gBAAgB,EAAE,IAAI,CAACqG,mBAAmB,CAAC,IAAI,CAACvM,WAAW,CAACgM,OAAO,CAAC,CAAC;WACrEY,YAAY,EAAE;aACb/F,MAAM,EAAE;eACPgG,YAAY,EAAE,MAAM;iBACnB7E,MAAM,CAAC8E,SAAS,CAAC,GAAG,CAAC;iBACrB,IAAI9E,MAAM,CAAC+E,QAAQ,EAAE,EACrB;mBACC,IAAI,CAACC,WAAW,CAAChF,MAAM,CAAC;;;;YAI3B;WACDnB,MAAM,EAAE;aACPoG,MAAM,EAAE,MAAM;eACb,MAAM;iBAAEjF;gBAAQ,GAAGrB,QAAQ;eAC3B,MAAMuG,SAAS,GAAGlF,MAAM,CAACmF,YAAY,EAAE;eACvC,MAAM;iBAAEC;gBAAK,GAAGF,SAAS,CAACG,qBAAqB,EAAE;eACjD,MAAMC,MAAM,GAAGF,GAAG,GAAGF,SAAS,CAACK,YAAY,GAAGC,QAAQ,CAACC,IAAI,CAACF,YAAY;eACxE,IAAID,MAAM,GAAG,CAAC,EACd;iBACC,MAAMI,MAAM,GAAG,CAAC;iBAChB1F,MAAM,CAAC8E,SAAS,CAACI,SAAS,CAACK,YAAY,GAAGD,MAAM,GAAGI,MAAM,CAAC;;cAE3D;aACD3F,MAAM,EAAGhB,KAAK,IAAK;eAClB,IAAI,CAACiG,WAAW,CAAChF,MAAM,CAAC;eACxB,MAAM/K,KAAK,GAAG8J,KAAK,CAACsB,MAAM,CAACM,KAAK,CAAC5H,GAAG,CAAC,MAAM,CAAC;eAE5C9D,KAAK,CAACkL,OAAO,CAAExJ,IAAI,IAAK;iBACvBA,IAAI,CAACgP,OAAO,CAAC,EAAE,CAAC;gBAChB,CAAC;cACF;aACD,kBAAkB,EAAE,MAAM;eACzB,IAAI,CAACX,WAAW,CAAChF,MAAM,CAAC;;YAEzB;WACDpE,MAAM,EAAE,GAAG;WACXD,KAAK,EAAE,GAAG;WACV6D,QAAQ,EAAE,CACT;aACCP,EAAE,EAAE,MAAM;aACVQ,OAAO,EAAE;eACRmG,iBAAiB,EAAE,IAAI;eACvBC,kBAAkB,EAAE;;YAErB,CACD;WACDvG,YAAY,EAAE,IAAI;WAClBC,cAAc,EAAE;;QAEjB,CAAC;OACF,MAAMS,MAAM,GAAGrB,QAAQ,CAACsB,SAAS,EAAE;OAEnC,OAAOtB,QAAQ;MACf;KACD9H,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACD8N,WAAW,CAAChF,MAAM,EAClB;OACC,MAAMW,KAAK,GAAGX,MAAM,CAAC8F,QAAQ,EAAE;OAC/BnF,KAAK,CAACR,OAAO,CAAEwD,IAAI,IAAK;SACvB,MAAMoC,MAAM,GAAG,IAAI,CAAClD,aAAa,CAAC6B,GAAG,CAACf,IAAI,CAAC1E,EAAE,CAAC,IAC1C,CAACe,MAAM,CAACO,aAAa,CAACmE,GAAG,CAACf,IAAI,CAAC;SACnCA,IAAI,CAACqC,SAAS,CAACD,MAAM,CAAC;QACtB,CAAC;MACF;KACDtB,gBAAgB,CAACzF,GAAgB,EAAE5F,IAAY,EAC/C;OACC,MAAMuK,IAAI,GAAG3E,GAAG,CAACL,QAAQ,CAACqB,MAAM,CAACiG,OAAO,CAAC,CAAC,MAAM,EAAEjH,GAAG,CAACC,EAAE,CAAC,CAAC;OAC1D,MAAMiH,QAAQ,GAAGC,+DAAyB,CAACxC,IAAI,EAAEvK,IAAI,CAAC;OAEtD,MAAMgN,UAAU,GAAGhN,IAAI,KAAK,IAAI,CAACpB,WAAW,CAACuL,QAAQ;OACrD,IAAI,CAACvE,GAAG,CAACqH,QAAQ,EACjB;SACC,IAAI,CAACpD,YAAY,GAAG,IAAI,CAACA,YAAY,CAAC9J,MAAM,CAAExC,IAAI,IAAKA,IAAI,CAACsI,EAAE,KAAKiH,QAAQ,CAACjH,EAAE,CAAC;SAC/E,IAAImH,UAAU,EACd;WACC,IAAI,CAACpD,mBAAmB,GAAG,CAAC,GAAG,IAAI,CAACA,mBAAmB,EAAE;aAAE,GAAGkD;YAAU,CAAC;UACzE,MAED;WACC,IAAI,CAACnD,eAAe,GAAG,CAAC,GAAG,IAAI,CAACA,eAAe,EAAE;aAAE,GAAGmD;YAAU,CAAC;;SAGlE,IAAI,CAACzO,SAAS,IAAI,CAAC;SAEnB;;OAGD,MAAM;SAAEyG,gBAAgB,GAAG;QAAI,GAAGc,GAAG,CAACL,QAAQ,CAACqB,MAAM;OACrD,MAAMsG,iBAAiB,GAAGpI,gBAAgB,CAACqI,IAAI,EAAE,CAACpN,MAAM,CAAEwK,IAAI,IAAKA,IAAI,KAAK,MAAM,CAAC;OACnF,IAAI2C,iBAAiB,CAACE,QAAQ,CAACN,QAAQ,CAACjH,EAAE,CAAC,EAC3C;SACC,IAAI,CAACgE,YAAY,GAAG,CAAC,GAAG,IAAI,CAACA,YAAY,EAAE;WAAE,GAAGiD,QAAQ;WAAE9M;UAAM,CAAC;;OAGlE,IAAIgN,UAAU,EACd;SACC,IAAI,CAACpD,mBAAmB,GAAG,IAAI,CAACA,mBAAmB,CAAC7J,MAAM,CAAEoK,QAAQ,IAAKA,QAAQ,CAACtE,EAAE,KAAKD,GAAG,CAACC,EAAE,CAAC;QAChG,MAED;SACC,IAAI,CAAC8D,eAAe,GAAG,IAAI,CAACA,eAAe,CAAC5J,MAAM,CAAEjD,IAAI,IAAKA,IAAI,CAAC+I,EAAE,KAAKD,GAAG,CAACC,EAAE,CAAC;;OAGjF,IAAI,CAACxH,SAAS,IAAI,CAAC;MACnB;KACD0H,SAAS,GACT;OACC,IAAI,CAAC5C,KAAK,CAAC,WAAW,EAAE;SACvB/E,KAAK,EAAE,IAAI,CAACuL,eAAe;SAC3B0D,SAAS,EAAE,IAAI,CAACzD,mBAAmB;SACnCC,YAAY,EAAE,IAAI,CAACA,YAAY;SAC/BxL,SAAS,EAAE,IAAI,CAACA,SAAS;SACzBkG,uBAAuB,EAAE;QACzB,CAAC;MACF;KACD+I,4BAA4B,CAACzE,QAAgB,EAC7C;OACC,IAAI,CAAC1F,KAAK,CAAC,iBAAiB,EAAE0F,QAAQ,CAAC;;IAExC;GAED7L,QAAQ,EACR;KACCZ,YAAY,GACZ;OACC,OAAO,IAAI,CAACoC,UAAU,KAAKC,iDAAW,CAACiC,IAAI;MAC3C;KACD6M,aAAa,GACb;OACC,OAAO,IAAI,CAACnR,YAAY,GACrB,IAAI,CAACqB,GAAG,CAAC,uEAAuE,CAAC,GACjF,IAAI,CAACA,GAAG,CAAC,kEAAkE,CAAC;;IAEhF;GAEDS,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmDZ,CAAC;;CCzTD;CACA;CACA;AACA,CAAO,MAAMsP,cAAc,GAAG;GAC7B/R,IAAI,EAAE,gBAAgB;GAEtBG,KAAK,EAAE;KACN6R,OAAO,EAAE;OACR3R,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDuG,KAAK,EAAE;OACNzG,IAAI,EAAEwC,MAAM;OACZnC,OAAO,EAAE;MACT;KACDuR,YAAY,EAAE;OACb5R,IAAI,EAAEW;MACN;KACDuP,GAAG,EAAE;OACJlQ,IAAI,EAAEI,OAAO;OACbC,OAAO,EAAE;MACT;KACDwR,WAAW,EAAE;OACZ7R,IAAI,EAAEI,OAAO;OACbC,OAAO,EAAE;;IAEV;GAEDS,OAAO,GACP;KACC,IAAI,CAACgR,IAAI,GAAG,IAAI;IAChB;GAEDxJ,OAAO,GACP;KACC,MAAM0H,SAAS,GAAG,IAAI,CAAC3M,KAAK,CAAC,gBAAgB,CAAC;KAC9C,MAAM0O,UAAU,GAAG;OAClBtL,KAAK,EAAE,IAAI,CAACA;MACZ;KAED,IAAI,IAAI,CAACyJ,GAAG,EACZ;OACC6B,UAAU,CAACC,WAAW,GAAG;SAAEC,QAAQ,EAAE;QAAO;;KAG7C,IAAI,IAAI,CAACJ,WAAW,EACpB;OACCE,UAAU,CAAC/K,UAAU,GAAIgJ,SAAS,CAACkC,WAAW,GAAG,CAAC,GAAI,IAAI,CAACzL,KAAK,GAAG,CAAC,GAAG,EAAE;OACzEsL,UAAU,CAACI,KAAK,GAAG;SAAE/B,MAAM,EAAE,IAAI,CAAC3J,KAAK,GAAG,CAAC,GAAG,EAAE,GAAG;QAAG;;KAGvD2L,eAAK,CAACC,IAAI,CAAC,IAAI,CAAChP,KAAK,CAAC,gBAAgB,CAAC,EAAE,YAAY,EAAE,MAAM;OAC5D,IAAI,CAACyO,IAAI,GAAGQ,oBAAU,CAACC,QAAQ,CAAC,YAAY,CAAC,CAACC,cAAc,CAAC;SAC5DC,eAAe,EAAE;WAAE,GAAGV;UAAY;QAClC,CAAC;;OACF,IAAI,CAACD,IAAI,CAACrO,IAAI,CAAC,IAAI,CAACJ,KAAK,CAAC,gBAAgB,CAAC,EAAE,IAAI,CAACsO,OAAO,CAAC;MAC1D,CAAC;KAEFS,eAAK,CAACC,IAAI,CAAC,IAAI,CAAChP,KAAK,CAAC,gBAAgB,CAAC,EAAE,YAAY,EAAE,MAAM;OAAA;OAC5D,kBAAI,CAACyO,IAAI,qBAAT,WAAWY,IAAI,EAAE,CAAC;MAClB,CAAC;IACF;;GAEDC,SAAS,GACT;KAAA;KACC,mBAAI,CAACb,IAAI,qBAAT,YAAWY,IAAI,EAAE;IACjB;GAEDtQ,QAAQ,EAAG;;;;;CAKZ,CAAC;;CCzED;AACA,CAAO,MAAMwQ,WAAW,GAAG;GAC1BjT,IAAI,EAAE,aAAa;GAEnBC,UAAU,EAAE;KAAE8R;IAAgB;GAE9B5R,KAAK,EAAE;KACN6R,OAAO,EAAE;OACR3R,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDuG,KAAK,EAAE;OACNzG,IAAI,EAAEwC,MAAM;OACZnC,OAAO,EAAE;;IAEV;GAED+B,QAAQ,EAAG;;;;;CAKZ,CAAC;;CCbM,MAAMyQ,QAAQ,GAAG;GACvBlT,IAAI,EAAE,UAAU;GAEhBwG,KAAK,EAAE,CAAC,WAAW,CAAC;GAEpBvG,UAAU,EAAE;KACXgT,WAAW;YACXE;IACA;GAEDhT,KAAK,EAAE;KACNwC,KAAK,EAAE;OACNtC,IAAI,EAAEC,KAAK;OACXC,QAAQ,EAAE;MACV;KACDP,IAAI,EAAE;OACLK,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;KACDwC,UAAU,EAAE;OACX1C,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;;IAEX;GAEDU,IAAI,GACJ;;KAEC,OAAO;OACNmS,iBAAiB,EAAE,IAAI;OACvBC,oBAAoB,EAAE;MACtB;IACD;GAEDlS,OAAO,GACP;KACC,IAAI,CAACmS,YAAY,GAAG,IAAI,CAACC,eAAe,EAAE;KAC1C,IAAI,CAACC,eAAe,GAAG,IAAI,CAACC,kBAAkB,EAAE;KAChD,IAAI,CAACC,KAAK,GAAG,EAAE;KACf,IAAI,CAACC,QAAQ,GAAG,EAAE;KAElB,IAAI,CAAC,IAAI,CAACC,YAAY,EACtB;OACC,IAAI,CAACR,iBAAiB,GAAG,KAAK;OAC9B,IAAI,CAACC,oBAAoB,GAAG,KAAK;;IAElC;GAED1K,OAAO,GACP;KACC,IAAI,CAAC2K,YAAY,CAAC1K,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,eAAe,CAAC,CAAC;KACvD,IAAI,CAAC8P,eAAe,CAAC5K,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,kBAAkB,CAAC,CAAC;IAC7D;GAEDvB,OAAO,EAAE;KACRH,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDkR,eAAe,GACf;OACC,MAAM3I,OAAO,GAAG;SACfL,QAAQ,EAAE,IAAI;SACdP,MAAM,EAAE;WACPC,QAAQ,EAAGC,KAAgB,IAAK;aAC/B,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,IAAI,CAAC+D,KAAK,CAACG,IAAI,CAAChR,MAAM,CAACsH,GAAG,CAACC,EAAE,CAAC0J,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;aACnD,IAAI,CAACxJ,SAAS,EAAE;YAChB;WACDD,WAAW,EAAGH,KAAgB,IAAK;aAClC,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,MAAMoE,KAAK,GAAGlR,MAAM,CAACsH,GAAG,CAACC,EAAE,CAAC0J,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;aAChD,IAAI,CAACJ,KAAK,GAAG,IAAI,CAACA,KAAK,CAACpP,MAAM,CAAE0P,IAAI,IAAKA,IAAI,KAAKD,KAAK,CAAC;aACxD,IAAI,CAACzJ,SAAS,EAAE;;UAEjB;SACDE,aAAa,EAAE;WACdyJ,YAAY,EAAE,IAAI;WAClBlN,MAAM,EAAE,GAAG;WACXD,KAAK,EAAE,GAAG;WACV2D,YAAY,EAAE,IAAI;WAClByJ,gBAAgB,EAAEC,2EAAuB,CAAC,IAAI,CAACpR,UAAU,EAAEqR,gEAAY,CAACJ,IAAI,CAAC;WAC7ErJ,QAAQ,EAAE,CACT0J,uEAAmB,EAAE;;QAGvB;OAED,OAAO,IAAItK,6BAAW,CAACa,OAAO,CAAC;MAC/B;KACD6I,kBAAkB,GAClB;OACC,MAAM7I,OAAO,GAAG;SACfL,QAAQ,EAAE,IAAI;SACdP,MAAM,EAAE;WACPC,QAAQ,EAAGC,KAAgB,IAAK;aAC/B,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,IAAI,CAACgE,QAAQ,CAACE,IAAI,CAAChR,MAAM,CAACsH,GAAG,CAACC,EAAE,CAAC0J,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;aACtD,IAAI,CAACxJ,SAAS,EAAE;YAChB;WACDD,WAAW,EAAGH,KAAgB,IAAK;aAClC,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,MAAMoE,KAAK,GAAGlR,MAAM,CAACsH,GAAG,CAACC,EAAE,CAAC0J,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;aAChD,IAAI,CAACH,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACrP,MAAM,CAAE0P,IAAI,IAAKA,IAAI,KAAKD,KAAK,CAAC;aAC9D,IAAI,CAACzJ,SAAS,EAAE;;UAEjB;SACDE,aAAa,EAAE;WACdyJ,YAAY,EAAE,IAAI;WAClBlN,MAAM,EAAE,GAAG;WACXD,KAAK,EAAE,GAAG;WACV2D,YAAY,EAAE,IAAI;WAClByJ,gBAAgB,EAAEC,2EAAuB,CAAC,IAAI,CAACpR,UAAU,EAAEqR,gEAAY,CAACE,OAAO,CAAC;WAChF3J,QAAQ,EAAE,CACT4J,0EAAsB,EAAE;;QAG1B;OAED,OAAO,IAAIxK,6BAAW,CAACa,OAAO,CAAC;MAC/B;KACDN,SAAS,GACT;OACC,IAAI,CAAC5C,KAAK,CAAC,WAAW,EAAE;SACvBgM,KAAK,EAAE,IAAI,CAACA,KAAK;SACjBC,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBP,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;SACzCC,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;SAC/CvK,uBAAuB,EAAE;QACzB,CAAC;;IAEH;GAEDxF,KAAK,EAAE;KACNsQ,YAAY,CAAChI,KAAK,EAClB;OACC,IAAI,CAACwH,iBAAiB,GAAGxH,KAAK;OAC9B,IAAI,CAACyH,oBAAoB,GAAGzH,KAAK;;IAElC;GAEDrK,QAAQ,EAAE;KACTiT,YAAY,GACZ;OACC,OAAO,IAAI,CAAC7T,YAAY,GACrB,IAAI,CAACqB,GAAG,CAAC,sFAAsF,CAAC,GAChG,IAAI,CAACA,GAAG,CAAC,0FAA0F,CAAC;MACvG;KACDyS,eAAe,GACf;OACC,OAAO,IAAI,CAAC9T,YAAY,GACrB,IAAI,CAACqB,GAAG,CAAC,yFAAyF,CAAC,GACnG,IAAI,CAACA,GAAG,CAAC,6FAA6F,CAAC;MAC1G;KACD4R,YAAY,GACZ;OACC,MAAMzQ,WAAW,GAAGC,kDAAc,CAAC,IAAI,CAACL,UAAU,CAAC;OAEnD,OAAO,IAAI,CAACJ,KAAK,CAAC+R,IAAI,CAAE5F,IAAI,IAAKA,IAAI,CAACvK,IAAI,KAAKpB,WAAW,CAAC9B,IAAI,CAAC;MAChE;KACDwN,GAAG,GAAQ;OACV,OAAOZ,sBAAG;MACV;KACDtN,YAAY,GACZ;OACC,OAAO,IAAI,CAACoC,UAAU,KAAKC,iDAAW,CAACiC,IAAI;MAC3C;KACD0P,KAAK,GACL;OACC,IAAI,IAAI,CAAChU,YAAY,EACrB;SACC,OAAO,CACN,IAAI,CAACqB,GAAG,CAAC,8DAA8D,CAAC,EACxE,IAAI,CAACA,GAAG,CAAC,8DAA8D,CAAC,EACxE,IAAI,CAACA,GAAG,CAAC,8DAA8D,CAAC,CACxE;;OAGF,OAAO,CACN,IAAI,CAACA,GAAG,CAAC,kEAAkE,CAAC,EAC5E,IAAI,CAACA,GAAG,CAAC,kEAAkE,CAAC,EAC5E,IAAI,CAACA,GAAG,CAAC,yDAAyD,CAAC,CACnE;;IAEF;GAEDS,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA8IZ,CAAC;;CC/UM,MAAMmS,QAAQ,GAAG;GACvBzU,KAAK,EAAE;KACN0F,QAAQ,EAAE;OACTxF,IAAI,EAAE,CAACwC,MAAM,EAAE,IAAI,CAAC;OACpBtC,QAAQ,EAAE;;IAEX;GAEDN,UAAU,EAAE;KAAE8R;IAAgB;GAE9B9Q,IAAI,GACJ;KACC,OAAO;OACN4T,kBAAkB,EAAE7R,iDAAW,CAACC;MAChC;IACD;GAEDuD,KAAK,EAAE,CAAC,WAAW,CAAC;GAEpBrF,OAAO,GACP;KACC,IAAI,CAACgR,IAAI,GAAG,IAAI;KAChB,IAAI,CAAC2C,eAAe,GAAG,IAAI;KAE3B,MAAMxL,iBAAiB,GAAG3E,mEAAiB,CAACC,WAAW,EAAE;KACzD,MAAMmQ,uBAAuB,GAAG,IAAI,CAAClP,QAAQ,KAAK,CAAC,GAChDyD,iBAAiB,CAAC0L,wBAAwB,CAAClQ,mEAAiB,CAAC0E,UAAU,CAAC,GACxEF,iBAAiB,CAACzE,aAAa,CAACC,mEAAiB,CAAC0E,UAAU,EAAE,IAAI,CAAC3D,QAAQ,CAAC;KAG/E,MAAMoP,6BAA6B,GAAG,IAAI,CAACpP,QAAQ,KAAK,CAAC,GACtDyD,iBAAiB,CAAC0L,wBAAwB,CAAClQ,mEAAiB,CAAC2E,gBAAgB,CAAC,GAC9EH,iBAAiB,CAACzE,aAAa,CAACC,mEAAiB,CAAC2E,gBAAgB,EAAE,IAAI,CAAC5D,QAAQ,CAAC;KAGrF,IAAI,CAAC8E,QAAQ,GAAG,CACf;OACCtK,IAAI,EAAE2C,iDAAW,CAACC,UAAU;OAC5BgG,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,iEAAiE,CAAC;OAClF4F,WAAW,EAAE,IAAI,CAAC5F,GAAG,CAAC,iEAAiE,CAAC;OACxFkT,SAAS,EAAED,6BAA6B;OACxC9C,IAAI,EAAE,CAAC8C,6BAA6B,IAChC,IAAI,CAACjT,GAAG,CAAC,0EAA0E,CAAC;OACxFmT,MAAM,EAAE;MACR,EACD;OACC9U,IAAI,EAAE2C,iDAAW,CAACiC,IAAI;OACtBgE,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,+EAA+E,CAAC;OAChG4F,WAAW,EAAE,IAAI,CAAC5F,GAAG,CAAC,sEAAsE,CAAC;OAC7FkT,SAAS,EAAEvQ,mEAAiB,CAACyQ,gBAAgB,IAAIL,uBAAuB;OACxE5C,IAAI,EAAExN,mEAAiB,CAACyQ,gBAAgB,IACpC,CAACL,uBAAuB,IACxB,IAAI,CAAC/S,GAAG,CAAC,wFAAwF,CAAC;OACtGmT,MAAM,EAAE,CAAC7L,iBAAiB,CAAC8L;MAC3B,EACD;OACC/U,IAAI,EAAE2C,iDAAW,CAACqS,OAAO;OACzBpM,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,8DAA8D,CAAC;OAC/E4F,WAAW,EAAE,IAAI,CAAC5F,GAAG,CAAC,8DAA8D,CAAC;OACrFkT,SAAS,EAAE,KAAK;OAChBC,MAAM,EAAE;MACR,CACD;KAED,KAAK,MAAMG,MAAM,IAAI,IAAI,CAAC3K,QAAQ,EAClC;OACC,IAAI2K,MAAM,CAACJ,SAAS,EACpB;SACC,IAAI,CAACL,kBAAkB,GAAGS,MAAM,CAACjV,IAAI;SACrC;;;KAGF,IAAI,CAACiK,SAAS,CAAC,IAAI,CAACuK,kBAAkB,CAAC;IACvC;GAEDhM,SAAS,GACT;KACC,IAAI,CAACyB,SAAS,CAAC,IAAI,CAACuK,kBAAkB,CAAC;IACvC;GAEDU,WAAW,GACX;KAAA;KACC,kBAAI,CAACpD,IAAI,qBAAT,WAAWY,IAAI,EAAE;KACjByC,YAAY,CAAC,IAAI,CAACV,eAAe,CAAC;KAClC,IAAI,CAACA,eAAe,GAAG,IAAI;IAC3B;GAED3S,OAAO,EACP;KACCH,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDiI,SAAS,CAACmL,QAAgB,EAC1B;OACC,IAAI,CAACZ,kBAAkB,GAAGY,QAAQ;OAClC,IAAI,CAAC/N,KAAK,CAAC,WAAW,EAAE;SACvBqB,OAAO,EAAE,IAAI;SACbD,uBAAuB,EAAE,KAAK;SAC9B/F,UAAU,EAAE,IAAI,CAAC8R;QACjB,CAAC;MACF;KACDa,QAAQ,CAACC,IAAY,EAAEC,MAAoB,EAC3C;OACC,IAAI,IAAI,CAACd,eAAe,EACxB;SACC;;OAGD,MAAMhO,KAAK,GAAG,GAAG;OACjB,IAAI,CAACqL,IAAI,GAAGQ,oBAAU,CAACC,QAAQ,CAAC,YAAY,CAAC,CAACC,cAAc,CAAC;SAC5DC,eAAe,EAAE;WAChBhM,KAAK;WACLuL,WAAW,EAAE;aAAEC,QAAQ,EAAE;YAAO;WAChCjL,UAAU,EAAE,GAAG;WACfD,SAAS,EAAE,CAAC,EAAE;WACdoL,KAAK,EAAE;aAAE/B,MAAM,EAAE3J,KAAK,GAAG,CAAC,GAAG,EAAE,GAAG;;;QAEnC,CAAC;OACF,IAAI,CAACqL,IAAI,CAACrO,IAAI,CAAC8R,MAAM,CAACpK,MAAM,EAAEmK,IAAI,CAAC;OAEnC,IAAI,CAACb,eAAe,GAAGe,UAAU,CAAC,MAAM;SAAA;SACvC,mBAAI,CAAC1D,IAAI,qBAAT,YAAWY,IAAI,EAAE;SACjB,IAAI,CAAC+B,eAAe,GAAG,IAAI;QAC3B,EAAE,IAAI,CAAC;;IAET;GAEDrS,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6BZ,CAAC;;CClKM,MAAMqT,cAA8B,GAAG;GAC7CC,cAAc,EAAE,MAAM;GACtBC,gBAAgB,EAAE,aAAa;GAC/BC,QAAQ,EAAE,WAAW;GACrBC,UAAU,EAAE;CACb,CAAC;AAED,CAAO,MAAMC,aAA6B,GAAG;GAC5CC,qBAAqB,EAAE,yBAAyB;GAChDC,gBAAgB,EAAE;CACnB,CAAC;;CCNM,MAAMC,UAAU,GAAG;GACzBtW,IAAI,EAAE,YAAY;GAElBwG,KAAK,EAAE,CAAC,WAAW,CAAC;GAEpBrG,KAAK,EAAE;KACNH,IAAI,EAAE;OACLK,IAAI,EAAES,MAAM;OACZP,QAAQ,EAAE;MACV;;KAEDgW,QAAQ,EAAE;OACTlW,IAAI,EAAEW,MAAM;OACZT,QAAQ,EAAE;;IAEX;GAEDY,OAAO,GACP;KACC,IAAI,CAACwT,KAAK,GAAG,CACZ,IAAI,CAAC3S,GAAG,CAAC,4DAA4D,CAAC,EACtE,IAAI,CAACA,GAAG,CAAC,4DAA4D,CAAC,CACtE;KAED,IAAI,CAACwU,YAAY,GAAG,IAAIvI,GAAG,EAAE;KAC7B,IAAI,CAACwI,oBAAoB,GAAG,IAAI,CAACC,cAAc,CAACP,aAAa,CAACC,qBAAqB,EAAE,KAAK,CAAC;KAC3F,IAAI,CAACO,eAAe,GAAG,IAAI,CAACD,cAAc,CAACP,aAAa,CAACE,gBAAgB,EAAE,IAAI,CAAC;IAChF;GAED1N,OAAO,GACP;KACC,IAAI,CAAC8N,oBAAoB,CAAC7N,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,wBAAwB,CAAC,CAAC;KACxE,IAAI,CAACiT,eAAe,CAAC/N,QAAQ,CAAC,IAAI,CAAClF,KAAK,CAAC,kBAAkB,CAAC,CAAC;IAC7D;GAEDJ,KAAK,EACL;KACCiT,QAAQ,EACP;OACCnH,OAAO,CAACC,OAA4B,EACpC;SACC,IAAIA,OAAO,CAAC8G,aAAa,CAACC,qBAAqB,CAAC,EAChD;WACC,MAAMQ,uBAAuB,GAAG,IAAI,CAACC,WAAW,CAAC,KAAK,CAAC,CACrDvS,MAAM,CAAEwK,IAAI,IAAKO,OAAO,CAAC8G,aAAa,CAACC,qBAAqB,CAAC,CAACvG,GAAG,CAACf,IAAI,CAAC1E,EAAE,CAAC,CAAC;WAG7EwM,uBAAuB,CAACtL,OAAO,CAAEwL,2BAA2B,IAAK;aAChE,MAAMhI,IAAI,GAAG,IAAI,CAAC2H,oBAAoB,CAACtL,MAAM,CAACiG,OAAO,CAAC,CAAC,WAAW,EAAE0F,2BAA2B,CAAC1M,EAAE,CAAC,CAAC;aAEpG,IAAI0E,IAAI,EACR;eACC,IAAI,CAAC0H,YAAY,CAACzH,GAAG,CAAC+H,2BAA2B,CAAC1M,EAAE,CAAC;eACrD0E,IAAI,CAAC9C,MAAM,EAAE;;YAEd,CAAC;;;;IAIN;GAED7J,OAAO,EACP;KACCH,GAAG,CAACI,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDiI,SAAS,GACT;OACC,IAAI,CAAC5C,KAAK,CAAC,WAAW,EAAE;SACvB6O,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBzN,uBAAuB,EAAE;QACzB,CAAC;MACF;KACD4N,cAAc,CAACK,WAAmB,EAAE3N,MAAe,EACnD;OACC,OAAO,IAAIW,6BAAW,CAAC;SACtBC,MAAM,EAAE;WACPC,QAAQ,EAAGC,KAAgB,IAAK;aAC/B,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,IAAI,CAAC4G,QAAQ,CAACQ,WAAW,CAAC,CAAChI,GAAG,CAAC5E,GAAG,CAACC,EAAE,CAAC;aAEtC,IAAI,IAAI,CAACoM,YAAY,CAAC3G,GAAG,CAAC1F,GAAG,CAACC,EAAE,CAAC,EACjC;eACC,IAAI,CAACoM,YAAY,CAAC1G,MAAM,CAAC3F,GAAG,CAACC,EAAE,CAAC;cAChC,MAED;eACC,IAAI,CAACE,SAAS,EAAE;;YAEjB;WACDD,WAAW,EAAGH,KAAgB,IAAK;aAClC,MAAM;eAAEC;cAAK,GAAGD,KAAK,CAACyF,OAAO,EAAE;aAC/B,IAAI,CAAC4G,QAAQ,CAACQ,WAAW,CAAC,CAACjH,MAAM,CAAC3F,GAAG,CAACC,EAAE,CAAC;aACzC,IAAI,CAACE,SAAS,EAAE;;UAEjB;SACDC,QAAQ,EAAE,IAAI;SACdH,EAAE,EAAE,oBAAoB;SACxBhB,MAAM;SACN4N,aAAa,EAAE,KAAK;SACpBC,aAAa,EAAE,CAAC7N,MAAM;SACtBoB,aAAa,EAAE;WACdJ,EAAE,EAAE,oBAAoB;WACxBJ,MAAM,EAAE;aACP,qBAAqB,EAAGE,KAAgB,IAAK;eAAA;eAC5C,MAAM;iBAAE4E;gBAAM,GAAG5E,KAAK,CAACyF,OAAO,EAAE;eAChC,IAAI,yBAACb,IAAI,CAACoI,aAAa,EAAE,aAApB,oBAAsBhT,GAAG,CAAC,YAAY,CAAC,GAC5C;iBACCgG,KAAK,CAACiN,cAAc,EAAE;;;YAGxB;WACDrQ,KAAK,EAAE,GAAG;WACVC,MAAM,EAAE,GAAG;WACX0D,YAAY,EAAE,IAAI;WAClB2M,WAAW,EAAE,KAAK;WAClB1L,aAAa,EAAE,IAAI,CAACmL,WAAW,CAACzN,MAAM,CAAC,CAAC9E,MAAM,CAAGwK,IAAI,IAAK,IAAI,CAACyH,QAAQ,CAACQ,WAAW,CAAC,CAAClH,GAAG,CAACf,IAAI,CAAC1E,EAAE,CAAC,CAAE;WACnG0B,KAAK,EAAE,IAAI,CAAC+K,WAAW,CAACzN,MAAM,CAAC;WAC/BiO,iBAAiB,EAAE,CAAC,CAAC,WAAW,EAAEvB,cAAc,CAACC,cAAc,CAAC;;QAEjE,CAAC;MACF;KACDc,WAAW,CAACzN,MAAe,EAC3B;OACC,MAAMkO,gBAAgB,GAAG;SACxBC,OAAO,EAAE,SAAS;SAClBC,SAAS,EAAE;QACX;OACD,MAAMC,oBAAoB,GAAG;SAC5BF,OAAO,EAAE,SAAS;SAClBC,SAAS,EAAE;QACX;OACD,MAAME,cAAc,GAAG;SACtBH,OAAO,EAAE,SAAS;SAClBC,SAAS,EAAE;QACX;OAED,MAAMG,eAAe,GAAG;SACvBC,UAAU,EAAE;WAAEC,UAAU,EAAE;UAAO;SACjCL,SAAS,EAAE,SAAS;SACpBM,MAAM,EAAE,CACP;WACC7O,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,qEAAqE,CAAC;WACtFwV,SAAS,EAAE,SAAS;WACpBD,OAAO,EAAE;UACT,CACD;SACDQ,aAAa,EAAE;WACdC,cAAc,EAAE;;QAEjB;OAED,OAAO,CACN;SACC5N,EAAE,EAAE0L,cAAc,CAACC,cAAc;SACjCN,QAAQ,EAAE,WAAW;SACrBwC,IAAI,EAAE,SAAS;SACfhP,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,0EAA0E,CAAC;SAC3FkW,UAAU,EAAE9O,MAAM,GAAGkO,gBAAgB,GAAGG,oBAAoB;SAC5DG,UAAU,EAAE;WAAEC,UAAU,EAAE;;QAC1B,EACD;SACCzN,EAAE,EAAE0L,cAAc,CAACG,QAAQ;SAC3BR,QAAQ,EAAE,WAAW;SACrBwC,IAAI,EAAE,SAAS;SACfhP,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,oEAAoE,CAAC;SACrFkW,UAAU,EAAE9O,MAAM,GAAGkO,gBAAgB,GAAGI,cAAc;SACtDE,UAAU,EAAE;WAAEC,UAAU,EAAE;;QAC1B,EACD;SACCzN,EAAE,EAAE0L,cAAc,CAACE,gBAAgB;SACnCP,QAAQ,EAAE,WAAW;SACrBwC,IAAI,EAAE,SAAS;SACfhP,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,4EAA4E,CAAC;SAC7FkW,UAAU,EAAE9O,MAAM,GAAGkO,gBAAgB,GAAGG,oBAAoB;SAC5D,GAAGE;QACH,EACD;SACCvN,EAAE,EAAE0L,cAAc,CAACI,UAAU;SAC7BT,QAAQ,EAAE,WAAW;SACrBwC,IAAI,EAAE,SAAS;SACfhP,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,sEAAsE,CAAC;SACvFkW,UAAU,EAAE9O,MAAM,GAAGkO,gBAAgB,GAAGI,cAAc;SACtD,GAAGC;QACH,CACD;MACD;KACDQ,UAAU,CAACjO,KAAK,EAChB;OACC,IAAIqG,GAAG,CAAC6H,EAAE,CAACC,MAAM,EACjB;SACCnO,KAAK,CAACiN,cAAc,EAAE;SACtB5G,GAAG,CAAC6H,EAAE,CAACC,MAAM,CAACvU,IAAI,CAAC,+BAA+B,CAAC;;;IAGrD;GAEDvC,QAAQ,EACR;KACC+W,mBAAmB,GACnB;OACC,OAAO,IAAI,CAACtW,GAAG,CAAC,+EAA+E,EAAE;SAChG,mBAAmB,EAAEuW,cAAI,CAACC,MAAM,CAAC,IAAI,CAACxY,IAAI;QAC1C,CAAC;MACF;KACDyY,mBAAmB,GACnB;OACC,OAAO,IAAI,CAACzW,GAAG,CAAC,yEAAyE,EAAE;SAC1F,mBAAmB,EAAEuW,cAAI,CAACC,MAAM,CAAC,IAAI,CAACxY,IAAI;QAC1C,CAAC;;IAEH;GAEDyC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgEZ,CAAC;;CCvRM,MAAMiW,SAAS,GAAG;GACxBC,aAAa,EAAE,CACd3Y,IAAY,EACZ6F,QAAgB,EAChB+B,WAAoB,EACpB7E,UAAmB,EACnB6V,SAAkB,KACC;KACnB,OAAOC,4CAAQ,CAAC,uCAAuC,EAAE;OACxD7Y,IAAI;OACJ6F,QAAQ;OACR+B,WAAW;OACX7E,UAAU;OACV6V;MACA,CAAC;IACF;GACDE,YAAY,EAAGhW,MAAc,IAA6B;KACzD,OAAO+V,4CAAQ,CAAC,0DAA0D,EAAE;OAAE/V;MAAQ,CAAC;IACvF;GACDiW,gBAAgB,EAAE,CACjBjW,MAAc,EACd+C,QAAgB,EAChB7F,IAAY,EACZ4H,WAAoB,EACpBgR,SAAkB,KACC;KACnB,OAAOC,4CAAQ,CAAC,0CAA0C,EAAE;OAC3D/V,MAAM;OACN9C,IAAI;OACJ6F,QAAQ;OACR+B,WAAW;OACXgR;MACA,CAAC;IACF;GACDI,SAAS,EAAE,CAAClW,MAAc,EAAEmW,OAA0B,EAAEpT,QAAiB,KAAqB;KAC7F,OAAOgT,4CAAQ,CAAC,uDAAuD,EAAE;OACxE/V,MAAM;OACNmW,OAAO;OACPpT;MACA,CAAC;IACF;GACDgH,SAAS,EAAE,CAAC/J,MAAc,EAAEmW,OAA0B,EAAEpT,QAAiB,KAAqB;KAC7F,OAAOgT,4CAAQ,CAAC,mEAAmE,EAAE;OACpF/V,MAAM;OACNmW,OAAO;OACPpT;MACA,CAAC;IACF;GACDqT,SAAS,EAAE,CACVpW,MAAc,EACdqW,GAAa,EACbC,aAAwB,KACL;KACnB,OAAOP,4CAAQ,CAAC,4DAA4D,EAAE;OAC7E/V,MAAM;OACNqW,GAAG;OACHC;MACA,CAAC;IACF;GACDC,cAAc,EAAE,CACfvW,MAAc,EACdyT,QAA8D,EAC9D1Q,QAAiB,KACE;KACnB,OAAOgT,4CAAQ,CAAC,uDAAuD,EAAE;OACxEtC,QAAQ;OACRzT,MAAM;OACN+C;MACA,CAAC;IACF;GACDyT,cAAc,EAAE,CACfxW,MAAc,EACdyT,QAA8D,EAC9D1Q,QAAiB,KACE;KACnB,OAAOgT,4CAAQ,CAAC,uDAAuD,EAAE;OACxEtC,QAAQ;OACRzT,MAAM;OACN+C;MACA,CAAC;IACF;GACD0T,WAAW,EAAGzW,MAAc,IAA6B;KACxD,OAAO+V,4CAAQ,CAAC,oDAAoD,EAAE;OAAE/V;MAAQ,CAAC;;CAEnF,CAAC;;CCpFM,MAAM0W,kBAAkB,GAAG;GACjCC,gBAAgB,EAAGpW,cAA8B,IAAW;KAAA;KAC3D,MAAM;OAAEY;MAAa,GAAGmB,wDAAa,EAAE;KACvC,MAAM;OAAEgF,EAAE,EAAEpF,YAAY;OAAEa;MAAU,GAAGxC,cAAc;KACrD,MAAMqW,MAAM,GAAGzV,WAAW,CAACC,GAAG,CAAC2B,QAAQ,CAAC;KACxC6T,MAAM,CAACC,QAAQ,GAAG,CAAC,wBAAGD,MAAM,CAACC,QAAQ,+BAAI,EAAE,GAAE3U,YAAY,CAAC;KAC1Df,WAAW,CAAC4K,GAAG,CAAC7J,YAAY,EAAE;OAC7B,GAAG3B,cAAc;OACjB+G,EAAE,EAAEpF,YAAY;OAChB0O,KAAK,EAAE,IAAI;OACXC,QAAQ,EAAE;MACV,CAAC;IACF;GACDiG,cAAc,EAAGvW,cAA8B,IAAW;KACzD,MAAM;OAAE+G,EAAE;OAAEvE;MAAU,GAAGxC,cAAc;KACvC,MAAM;OAAEY;MAAa,GAAGmB,wDAAa,EAAE;KACvC,MAAMyU,OAAO,GAAG5V,WAAW,CAACC,GAAG,CAACkG,EAAE,CAAC;KACnCnG,WAAW,CAAC4K,GAAG,CAACzE,EAAE,EAAE;OAAE,GAAGyP,OAAO;OAAE,GAAGxW;MAAgB,CAAC;KACtD,MAAMyW,UAAU,GAAG,CAAC,GAAG7V,WAAW,CAACgC,MAAM,EAAE,CAAC,CAACC,IAAI,CAAEjD,UAAU,IAAK;OAAA;OACjE,+BAAOA,UAAU,CAAC0W,QAAQ,qBAAnB,qBAAqBhI,QAAQ,CAACvH,EAAE,CAAC;MACxC,CAAC;KACF,IAAIvE,QAAQ,KAAK,CAAC,IAAIiU,UAAU,CAAC1P,EAAE,KAAKvE,QAAQ,EAChD;OAAA;OACCiU,UAAU,CAACH,QAAQ,GAAGG,UAAU,CAACH,QAAQ,CAACrV,MAAM,CAAEyV,OAAO,IAAKA,OAAO,KAAK3P,EAAE,CAAC;OAC7E,MAAM4P,SAAS,GAAG/V,WAAW,CAACC,GAAG,CAAC2B,QAAQ,CAAC;OAC3CmU,SAAS,CAACL,QAAQ,GAAG,CAAC,2BAAIK,SAAS,CAACL,QAAQ,kCAAI,EAAE,CAAC,EAAEvP,EAAE,CAAC;OACxDnG,WAAW,CAAC4K,GAAG,CAACzE,EAAE,EAAE;SAAE,GAAG/G,cAAc;SAAE4W,YAAY,EAAEH,UAAU,CAAC1P;QAAI,CAAC;;IAExE;GACD8P,yBAAyB,EAAE,CAAC9L,YAAsB,EAAE+L,kBAA4B,KAAW;KAC1F,MAAM;OAAElW;MAAa,GAAGmB,wDAAa,EAAE;KACvC,MAAMgV,aAAa,GAAGhM,YAAY,CAAC9J,MAAM,CAAExC,IAAI,IAAKqY,kBAAkB,CAACxI,QAAQ,CAAC7P,IAAI,CAACsI,EAAE,CAAC,CAAC;KACzF,MAAMiQ,QAAQ,GAAG,CAAC,GAAGpW,WAAW,CAACgC,MAAM,EAAE,CAAC,CAACC,IAAI,CAAEjD,UAAU,IAAKA,UAAU,CAAC4C,QAAQ,KAAK,CAAC,CAAC;KAC1F5B,WAAW,CAAC4K,GAAG,CAACwL,QAAQ,CAACjQ,EAAE,EAAE;OAC5B,GAAGiQ,QAAQ;OACXzI,SAAS,EAAE,CAAC,IAAIyI,QAAQ,CAACzI,SAAS,IAAI,EAAE,CAAC,EAAE,GAAGwI,aAAa,CAAC;OAC5DxX,SAAS,EAAEyX,QAAQ,CAACzX,SAAS,GAAGwX,aAAa,CAAChW;MAC9C,CAAC;IACF;GACDkW,kBAAkB,EAAGnB,GAAa,IAAW;KAC5C,MAAM1T,KAAK,GAAGL,wDAAa,EAAE;KAC7BK,KAAK,CAAC6U,kBAAkB,CAACnB,GAAG,CAAC;IAC7B;GACDoB,yBAAyB,CAAClX,cAA8B,EAAE2B,YAAoB,EAC9E;KACC,MAAMS,KAAK,GAAGL,wDAAa,EAAE;KAC7B,MAAM;OAAEzC,KAAK;OAAEiP;MAAW,GAAGvO,cAAc;KAC3C,MAAMmX,gBAAgB,GAAG,CAAC,GAAG7X,KAAK,EAAE,GAAGiP,SAAS,CAAC,CAAC8C,IAAI,CAAE5S,IAAI,IAAK;OAChE,OAAOA,IAAI,CAACsI,EAAE,KAAK3E,KAAK,CAACgV,MAAM;MAC/B,CAAC;KACF,IAAID,gBAAgB,EACpB;OACC/U,KAAK,CAACiV,uBAAuB,CAAC,CAAC,EAAE1V,YAAY,CAAC;;;CAGjD,CAAC;;CCnCD,MAAM2V,QAAQ,GAAG3Z,MAAM,CAAC4L,MAAM,CAAC;GAC9BC,SAAS,EAAE,WAAW;GACtBC,QAAQ,EAAE;CACX,CAAC,CAAC;AAEF,OAAa8N,WAAW,GAAG;GAC1B5a,IAAI,EAAE,aAAa;GAEnBwG,KAAK,EAAE,CAAC,YAAY,EAAE,OAAO,CAAC;GAE9BvG,UAAU,EAAE;KAAE0H,UAAU;KAAEmG,SAAS;KAAEoF,QAAQ;KAAEtN,WAAW;KAAEgP,QAAQ;KAAE0B;IAAY;GAElFnW,KAAK,EAAE;KACN2C,MAAM,EAAE;OACPzC,IAAI,EAAEwC,MAAM;OACZtC,QAAQ,EAAE;MACV;KACDuH,UAAU,EAAE;OACXzH,IAAI,EAAEI,OAAO;OACbF,QAAQ,EAAE;MACV;KACDsa,kBAAkB,EAAE;OACnBxa,IAAI,EAAEI,OAAO;OACbF,QAAQ,EAAE;MACV;KACD+U,MAAM,EAAE;OACPjV,IAAI,EAAES;MACN;KACDiC,UAAU,EAAE;OACX1C,IAAI,EAAES,MAAM;OACZJ,OAAO,EAAEsC,iDAAW,CAACC;MACrB;KACD6X,MAAM,EAAE;OACPza,IAAI,EAAES;MACN;KACDiH,UAAU,EAAE;OACX1H,IAAI,EAAES,MAAM;OACZJ,OAAO,EAAE;;IAEV;GAEDO,IAAI,GACJ;KACC,OAAO;OACN8Z,SAAS,EAAE,CAAC;OACZC,OAAO,EAAE,KAAK;OACdC,WAAW,EAAE,KAAK;OAClBnS,uBAAuB,EAAE,KAAK;OAC9BzF,cAAc,EAAE;SACf+G,EAAE,EAAE,CAAC;SACLvE,QAAQ,EAAE,CAAC;SACX7F,IAAI,EAAE,EAAE;SACR4H,WAAW,EAAE,EAAE;SACfjF,KAAK,EAAE,EAAE;SACTiP,SAAS,EAAE,EAAE;SACb8B,KAAK,EAAE,EAAE;SACTC,QAAQ,EAAE,EAAE;SACZ/Q,SAAS,EAAE,CAAC;SACZwQ,iBAAiB,EAAE,IAAI;SACvBC,oBAAoB,EAAE,IAAI;SAC1BtS,SAAS,EAAEyG,4DAAsB,CAAC0T,IAAI;SACtCnY,UAAU,EAAEC,iDAAW,CAACC,UAAU;SAClCsT,QAAQ,EAAE;WACT,CAACJ,aAAa,CAACC,qBAAqB,GAAG,IAAInI,GAAG,CAAC,CAAC6H,cAAc,CAACC,cAAc,CAAC,CAAC;WAC/E,CAACI,aAAa,CAACE,gBAAgB,GAAG,IAAIpI,GAAG,CAAC,CAAC6H,cAAc,CAACC,cAAc,CAAC;;QAE1E;OACD3H,YAAY,EAAE,EAAE;OAChBL,YAAY,EAAE,EAAE;OAChBoN,kBAAkB,EAAE;SACnB,CAAChF,aAAa,CAACC,qBAAqB,GAAG,IAAInI,GAAG,CAAC,CAAC6H,cAAc,CAACC,cAAc,CAAC,CAAC;SAC/E,CAACI,aAAa,CAACE,gBAAgB,GAAG,IAAIpI,GAAG,CAAC,CAAC6H,cAAc,CAACC,cAAc,CAAC;QACzE;OACDlO,oBAAoB,EAAE,KAAK;OAC3BuT,YAAY,EAAE,EAAE;OAChBC,QAAQ,EAAEV,QAAQ,CAAC9N;MACnB;IACD;GAED1L,OAAO,GACP;KACC,IAAI,CAACma,IAAI,EAAE;IACX;GAEDC,aAAa,GACb;KACC9I,eAAK,CAAC+I,MAAM,CAACC,MAAM,EAAE,cAAc,EAAE,IAAI,CAACC,kBAAkB,CAAC;IAC7D;GAEDna,QAAQ,EAAE;KACToa,SAAS,GACT;OAAA;OACC,IAAI,IAAI,CAACC,WAAW,IAAI,CAAC,IAAI,CAAC9T,UAAU,EACxC;SACC,OAAO,IAAI,CAAC9F,GAAG,CAAC,gDAAgD,CAAC;;OAGlE,MAAM6Z,WAAW,GAAG,IAAI,CAACT,YAAY,CAAC,CAAC,CAAC,KAAK,UAAU,GACpD,IAAI,CAACL,SAAS,GACd,IAAI,CAACA,SAAS,GAAG,CAAC;OAErB,IAAI,CAAC,IAAI,CAACjT,UAAU,EACpB;SACC,OAAO,IAAI,CAAC9F,GAAG,CAAC,uDAAuD,EAAE;WACxE,gBAAgB,EAAE6Z,WAAW;WAC7B,YAAY,EAAE,IAAI,CAACC,KAAK,CAAC1X,MAAM,GAAG;UAClC,CAAC;;OAGH,OAAO,6BAAI,CAACf,cAAc,qBAAnB,qBAAqBN,UAAU,MAAKC,iDAAW,CAACiC,IAAI,GACxD,IAAI,CAACjD,GAAG,CAAC,yDAAyD,CAAC,GACnE,IAAI,CAACA,GAAG,CAAC,oDAAoD,CAAC;MACjE;KACD+Z,iBAAiB,GACjB;OAAA;OACC,IAAI,IAAI,CAACjU,UAAU,EACnB;SAAA;SACC,OAAO,8BAAI,CAACzE,cAAc,qBAAnB,sBAAqBN,UAAU,MAAKC,iDAAW,CAACiC,IAAI,GACxD,IAAI,CAACjD,GAAG,CAAC,uEAAuE,CAAC,GACjF,IAAI,CAACA,GAAG,CAAC,6EAA6E,CAAC;;OAI3F,OAAO,8BAAI,CAACqB,cAAc,qBAAnB,sBAAqBN,UAAU,MAAKC,iDAAW,CAACiC,IAAI,GACxD,IAAI,CAACjD,GAAG,CAAC,yEAAyE,CAAC,GACnF,IAAI,CAACA,GAAG,CAAC,+EAA+E,CAAC;MAE5F;KACD6Z,WAAW,GACX;OACC,MAAMzR,EAAE,GAAG,IAAI,CAACgR,YAAY,CAAC,IAAI,CAACL,SAAS,CAAC;OAE5C,OAAO,IAAI,CAACe,KAAK,CAAC5V,IAAI,CAAE8V,IAAI,IAAK5R,EAAE,KAAK4R,IAAI,CAAC5R,EAAE,CAAC;MAChD;KACD6R,aAAa,GACb;OACC,MAAM;SACLpW,QAAQ;SACR7F,IAAI;SACJ4H,WAAW;SACXjF,KAAK;SACLI,UAAU;SACVhC;QACA,GAAG,IAAI,CAACsC,cAAc;OAEvB,MAAMpD,UAAU,GAAG;SAClBgD,UAAU,EAAE;WACXjD,IAAI,EAAE,YAAY;WAClBkc,MAAM,EAAE;aACPrW,QAAQ;aACR7F,IAAI;aACJ4H,WAAW;aACX7E,UAAU;aACVhC,SAAS;aACTgH,UAAU,EAAE,IAAI,CAACA,UAAU;aAC3BF,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;aAC/CC,UAAU,EAAE,IAAI,CAACA;;UAElB;SACD8J,SAAS,EAAE;WACV5R,IAAI,EAAE,WAAW;WACjBkc,MAAM,EAAE;aACPvZ,KAAK;aACLI,UAAU;aACVgL,YAAY,EAAE,IAAI,CAACA,YAAY;aAC/BjG,UAAU,EAAE,IAAI,CAACA;;UAElB;SACDqU,QAAQ,EAAE;WACTnc,IAAI,EAAE,UAAU;WAChBkc,MAAM,EAAE;aACPvZ,KAAK;aACL3C,IAAI;aACJ+C;;UAED;SACDqZ,UAAU,EAAE;WACXpc,IAAI,EAAE,YAAY;WAClBkc,MAAM,EAAE;aACPlc,IAAI;aACJuW,QAAQ,EAAE,IAAI,CAAC4E;;UAEhB;SACDxQ,QAAQ,EAAE;WACT3K,IAAI,EAAE,UAAU;WAChBkc,MAAM,EAAE;aACPrW;;;QAGF;OAED,MAAM;SAAEuE,EAAE,EAAEiS;QAAQ,GAAG,IAAI,CAACR,WAAW;OAEvC,OAAO5b,UAAU,CAACoc,MAAM,CAAC;MACzB;KACDT,WAAW,GACX;OACC,OAAO,IAAI,CAACC,WAAW,CAACzR,EAAE,KAAK,UAAU;MACzC;KACDkS,cAAc,GACd;OACC,OAAO,CAAC,CAAC,UAAU,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC3K,QAAQ,CAAC,IAAI,CAACkK,WAAW,CAACzR,EAAE,CAAC;MAC5E;KACDmS,UAAU,GACV;OACC,OAAO,IAAI,CAACV,WAAW,CAACzR,EAAE,KAAK,UAAU;MACzC;KACDoS,aAAa,GACb;OACC,OAAO,IAAI,CAACpB,YAAY,CAAC9W,MAAM,CAAE0X,IAAI,IAAKA,IAAI,KAAK,UAAU,CAAC;MAC9D;KACDlW,MAAM,GACN;OACC,MAAM;SAAEsE;QAAI,GAAG,CAAC,GAAG,IAAI,CAACnG,WAAW,CAACgC,MAAM,EAAE,CAAC,CAACC,IAAI,CAAEjD,UAAU,IAAK;SAClE,OAAOA,UAAU,CAAC4C,QAAQ,KAAK,CAAC;QAChC,CAAC;OAEF,OAAOuE,EAAE;MACT;KACDzJ,YAAY,GACZ;OAAA;OACC,OAAO,8BAAI,CAAC0C,cAAc,qBAAnB,sBAAqBN,UAAU,MAAKC,iDAAW,CAACiC,IAAI;MAC3D;KACDwX,gBAAgB,GAChB;OACC,OAAO,IAAI,CAAC9b,YAAY,GACrB,IAAI,CAACqB,GAAG,CAAC,yDAAyD,CAAC,GACnE,IAAI,CAACA,GAAG,CAAC,oDAAoD,CAAC;MAEjE;KACD,GAAGmD,sBAAQ,CAACC,wDAAa,EAAE,CAAC,aAAa,EAAE,QAAQ,EAAE,oBAAoB,CAAC;IAC1E;GAEDjD,OAAO,EAAE;KACRuZ,kBAAkB,CAACxR,KAAY,EAC/B;OACCA,KAAK,CAACiN,cAAc,EAAE;MACtB;KACDnV,GAAG,CAACI,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACD,MAAMiZ,IAAI,GACV;;;OAGC7I,eAAK,CAACC,IAAI,CAAC+I,MAAM,EAAE,cAAc,EAAE,IAAI,CAACC,kBAAkB,CAAC;OAC3D,IAAI,IAAI,CAAC5T,UAAU,EACnB;SACC,MAAM;WACLsC,EAAE;WACFpK,IAAI;WACJ4H,WAAW;WACX/B,QAAQ;WACRlD,KAAK;WACLC,SAAS;WACT+W,QAAQ;WACR5W,UAAU;WACVhC,SAAS;WACT6Q,SAAS,GAAG;UACZ,GAAG,IAAI,CAAC3N,WAAW,CAACC,GAAG,CAAC,IAAI,CAACpB,MAAM,CAAC;SAErC,IAAI,CAACM,cAAc,CAACL,UAAU,CAAC;SAC/B,IAAI,CAAC2Z,WAAW,CAAC3Z,UAAU,CAAC;SAC5B,IAAI,CAAC4Z,kBAAkB,EAAE;SACzB,IAAI,CAACC,qBAAqB,CAAC7Z,UAAU,CAAC;SAEtC,IAAI,CAACM,cAAc,GAAG;WACrB,GAAG,IAAI,CAACA,cAAc;WACtB+G,EAAE;WACFvE,QAAQ;WACR7F,IAAI;WACJ4H,WAAW;WACXjF,KAAK;WACLC,SAAS;WACT+W,QAAQ;WACR/H,SAAS;WACT7O,UAAU;WACVhC,SAAS;WACTqS,iBAAiB,EAAE,KAAK;WACxBC,oBAAoB,EAAE;UACtB;SACD,MAAMwJ,WAAW,GAAG,MAAMnE,SAAS,CAACa,WAAW,CAAC,IAAI,CAACzW,MAAM,CAAC;SAC5D,IAAI,CAACqY,kBAAkB,GAAG0B,WAAW,CAACjO,MAAM,CAAC,CAACkO,GAAG,EAAE;WAAEC,YAAY;WAAEC;UAAe,KAAK;WACtF,IAAI,CAAChc,MAAM,CAACic,MAAM,CAACH,GAAG,EAAEC,YAAY,CAAC,EACrC;aACCD,GAAG,CAACC,YAAY,CAAC,GAAG,IAAI9O,GAAG,EAAE;;WAE9B6O,GAAG,CAACC,YAAY,CAAC,CAAChO,GAAG,CAACiO,aAAa,CAAC;WAEpC,OAAOF,GAAG;UACV,EAAE;WAAE,GAAG,IAAI,CAAC3B;UAAoB,CAAC;SAElC,IAAI,CAACpN,YAAY,GAAG,MAAM2K,SAAS,CAACI,YAAY,CAAC,IAAI,CAAChW,MAAM,CAAC;SAE7D;;OAGD,IAAI,IAAI,CAACC,UAAU,EACnB;SACC,IAAI,CAACM,cAAc,CAACN,UAAU,GAAG,IAAI,CAACA,UAAU;;OAGjD,IAAI,CAACK,cAAc,CAAC,IAAI,CAACL,UAAU,CAAC;OACpC,IAAI,CAAC2Z,WAAW,CAAC,IAAI,CAAC3Z,UAAU,CAAC;OACjC,IAAI,CAAC4Z,kBAAkB,EAAE;OACzB,IAAI,CAACC,qBAAqB,CAAC,IAAI,CAAC7Z,UAAU,CAAC;OAE3C,IAAI,IAAI,CAACD,MAAM,EACf;SACC,IAAI,CAACO,cAAc,CAACwC,QAAQ,GAAG,IAAI,CAAC/C,MAAM;SAE1C;;OAGD,IAAI,CAACO,cAAc,CAACwC,QAAQ,GAAG,CAAC;OAEhCqX,qBAAiB,CAAC;SACjBC,IAAI,EAAE,WAAW;SACjBC,QAAQ,EAAE,WAAW;SACrBlT,KAAK,EAAE,eAAe;SACtBmT,SAAS,EAAE,IAAI,CAACvC;QAChB,CAAC;MACF;KACD1X,cAAc,CAACL,UAAU,EACzB;OACC,IAAI,CAACI,WAAW,GAAGC,kDAAc,CAACL,UAAU,CAAC;MAC7C;KACD4Z,kBAAkB,GAClB;OACC,QAAQ,IAAI,CAACrH,MAAM;SAElB,KAAK,YAAY;WAChB,IAAI,CAAC8F,YAAY,GAAG,CAAC,YAAY,CAAC;WAClC;SACD,KAAK,WAAW;WACf,IAAI,CAACA,YAAY,GAAG,CAAC,WAAW,CAAC;WACjC;SACD,KAAK,YAAY;WAChB,IAAI,CAACA,YAAY,GAAG,CAAC,YAAY,CAAC;WAClC;SACD;WACC,IAAI,CAACA,YAAY,GAAG,IAAI,CAACP,kBAAkB,GACxC,IAAI,CAACiB,KAAK,CAACja,GAAG,CAAEma,IAAI,IAAKA,IAAI,CAAC5R,EAAE,CAAC,GACjC,IAAI,CAAC0R,KAAK,CAACxX,MAAM,CAAE0X,IAAI,IAAKA,IAAI,CAAC5R,EAAE,KAAK,UAAU,CAAC,CAACvI,GAAG,CAAEma,IAAI,IAAKA,IAAI,CAAC5R,EAAE,CAAC;WAC7E;;MAEF;KACDkT,IAAI,CAACC,QAAgB,GAAG,MAAM,EAC9B;OACC,IAAIA,QAAQ,KAAK,MAAM,IAAI,CAAC,IAAI,CAACtC,WAAW,EAC5C;SACC,IAAI,CAACpT,oBAAoB,GAAG,IAAI;SAEhC;;OAGD,IAAI,CAACkT,SAAS,GAAGwC,QAAQ,KAAK,MAAM,GAAG,IAAI,CAACxC,SAAS,GAAG,CAAC,GAAG,IAAI,CAACA,SAAS,GAAG,CAAC;OAC9E,IAAI,CAACyC,kBAAkB,EAAE;MACzB;KACD/V,KAAK,CAACgW,SAAkB,GAAG,KAAK,EAChC;OACC,IAAI,CAAC/V,KAAK,CAAC,OAAO,CAAC;OACnB,IAAI+V,SAAS,EACb;SACCP,qBAAiB,CAAC;WACjBC,IAAI,EAAE,WAAW;WACjBC,QAAQ,EAAE,WAAW;WACrBlT,KAAK,EAAE,eAAe;WACtBmT,SAAS,EAAE,IAAI,CAACvC;UAChB,CAAC;;MAEH;KACD4C,gBAAgB,GAChB;OACC,IAAI,CAAC,IAAI,CAAC5U,uBAAuB,EACjC;SACC,IAAI,CAACrB,KAAK,CAAC,IAAI,CAAC;SAEhB;;OAGD,MAAMkW,YAAY,GAAG,IAAIC,gCAAU,CAAC;SACnC3U,KAAK,EAAE,IAAI,CAAC8S,iBAAiB;SAC7B8B,OAAO,EAAE,IAAI,CAAC7b,GAAG,CAAC,+DAA+D,CAAC;SAClF8b,UAAU,EAAE,IAAI,CAAC9b,GAAG,CAAC,kEAAkE,CAAC;SACxF+b,SAAS,EAAE,IAAI,CAAC/b,GAAG,CAAC,kEAAkE,CAAC;SACvFgc,KAAK,EAAE,MAAM;WACZ,IAAI,CAACvW,KAAK,CAAC,IAAI,CAAC;WAEhB,OAAO,IAAI;UACX;SACDwW,SAAS,EAAE,GAAG;SACdC,OAAO,EAAEC,uCAAiB,CAACC,MAAM;SACjCrO,YAAY,EAAE;WACbsO,SAAS,EAAE,IAAI;WACfC,SAAS,EAAE;;QAEZ,CAAC;OACFX,YAAY,CAACY,YAAY,EAAE,CAACC,QAAQ,CAAC,IAAI,CAAC;OAC1Cb,YAAY,CAACc,WAAW,EAAE,CAACD,QAAQ,CAAC,IAAI,CAAC;OACzCb,YAAY,CAAC7Z,IAAI,EAAE;MACnB;KACD4a,WAAW,CACVzd,IAIC,EAEF;OAAA;OACC,MAAM0d,cAAc,GAAG,IAAI,CAACtb,cAAc,CAACN,UAAU;OACrD,MAAM;SAAEgG,OAAO,GAAG,IAAI;SAAED,uBAAuB,GAAG,IAAI;SAAEsF,YAAY,GAAG,EAAE;SAAE,GAAG/K;QAAgB,GAAGpC,IAAI;OACrG,IAAI,CAACga,WAAW,GAAGlS,OAAO;OAC1B,IAAI,CAACD,uBAAuB,GAAG,IAAI,CAACA,uBAAuB,IAAIA,uBAAuB;OACtF,IAAIzF,cAAc,EAClB;SACC,IAAI,CAACA,cAAc,GAAG;WACrB,GAAG,IAAI,CAACA,cAAc;WACtB,GAAGA;UACH;;OAGF,IAAI,CAAC+K,YAAY,GAAGA,YAAY;OAChC,IAAIrF,OAAO,EACX;SACC,IAAI,CAAClB,oBAAoB,GAAG,KAAK;;;;OAIlC,IAAI8W,cAAc,KAAK,IAAI,CAACtb,cAAc,CAACN,UAAU,EACrD;SACC,IAAI,CAACK,cAAc,CAAC,IAAI,CAACC,cAAc,CAACN,UAAU,CAAC;SACnD,IAAI,CAAC2Z,WAAW,CAAC,IAAI,CAACrZ,cAAc,CAACN,UAAU,CAAC;SAChD,IAAI,CAAC4Z,kBAAkB,EAAE;SACzB,IAAI,CAACC,qBAAqB,CAAC,IAAI,CAACvZ,cAAc,CAACN,UAAU,CAAC;SAE1D,MAAMiM,eAAe,GAAG5L,kDAAc,CAACub,cAAc,CAAC;SACtD,MAAM1P,SAAS,GAAGjO,MAAM,CAACkO,IAAI,CAACF,eAAe,CAAC;SAC9C,IAAI,CAAC3L,cAAc,CAACV,KAAK,GAAG,IAAI,CAACU,cAAc,CAACV,KAAK,CAACd,GAAG,CAAEiN,IAAI,IAAK;WACnE,MAAMK,OAAO,GAAGF,SAAS,CAAC/I,IAAI,CAAEoG,GAAG,IAAK0C,eAAe,CAAC1C,GAAG,CAAC,KAAKwC,IAAI,CAACvK,IAAI,CAAC;WAE3E,OAAO;aAAE,GAAGuK,IAAI;aAAEvK,IAAI,EAAE,IAAI,CAACpB,WAAW,CAACgM,OAAO;YAAG;UACnD,CAAC;SAEF,IAAI,CAAC9L,cAAc,CAACuO,SAAS,GAAG,IAAI,CAACvO,cAAc,CAACuO,SAAS,CAC3D/P,GAAG,CAAEiN,IAAI,KAAM;WAAE,GAAGA,IAAI;WAAEvK,IAAI,EAAE,IAAI,CAACpB,WAAW,CAACuL;UAAU,CAAC,CAAC;;;;OAKhE,IAAI,CAACrL,cAAc,CAACtC,SAAS,GAAG,IAAI,CAACJ,YAAY,4BAC9C,IAAI,CAAC0C,cAAc,CAACtC,SAAS,oCAAIyG,4DAAsB,CAAC0T,IAAI,GAC5D,IAAI;MAEP;KACDwB,WAAW,CAAC3Z,UAAkB,GAAG,YAAY,EAC7C;OACC,IAAIA,UAAU,KAAKC,iDAAW,CAACiC,IAAI,EACnC;SACC,IAAI,CAAC6W,KAAK,GAAG,CACZ;WACC1R,EAAE,EAAE,UAAU;WACdnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,6DAA6D;UAC7E,EACD;WACCoI,EAAE,EAAE,YAAY;WAChBnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,oDAAoD;UACpE,EACD;WACCoI,EAAE,EAAE,WAAW;WACfnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,8DAA8D;UAC9E,EACD;WACCoI,EAAE,EAAE,UAAU;WACdnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,6DAA6D;UAC7E,EACD;WACCoI,EAAE,EAAE,YAAY;WAChBnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,2DAA2D;UAC3E,CACD;QACD,MAED;SACC,IAAI,CAAC8Z,KAAK,GAAG,CACZ;WACC1R,EAAE,EAAE,UAAU;WACdnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,6DAA6D;UAC7E,EACD;WACCoI,EAAE,EAAE,YAAY;WAChBnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,0DAA0D;UAC1E,EACD;WACCoI,EAAE,EAAE,WAAW;WACfnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,yDAAyD;UACzE,EACD;WACCoI,EAAE,EAAE,UAAU;WACdnB,KAAK,EAAE,IAAI,CAACjH,GAAG,CAAC,iEAAiE;UACjF,CACD;;MAEF;KACD4c,eAAe,CAAC5Z,YAAoB,EACpC;OACC,MAAMmU,GAAG,GAAG,IAAI,CAAC0F,oBAAoB,EAAE;OACvC,MAAM;SAAEC,QAAQ;SAAEC,WAAW;SAAEhR;QAAc,GAAGoL,GAAG;OAEnD,MAAM6F,iBAAiB,GAAG;SACzB,CAAC,IAAI,CAAC7b,WAAW,CAAC9B,IAAI,GAAGyd,QAAQ;SACjC,CAAC,IAAI,CAAC3b,WAAW,CAACsB,UAAU,GAAGsa,WAAW;SAC1C,CAAC,IAAI,CAAC5b,WAAW,CAACuL,QAAQ,GAAGX;QAC7B;OAED,OAAO,IAAI,CAACkR,oBAAoB,CAACja,YAAY,EAAEga,iBAAiB,CAAC;MACjE;KACDH,oBAAoB,GACpB;OACC,MAAM;SAAElc,KAAK;SAAEiP,SAAS,GAAG;QAAI,GAAG,IAAI,CAACvO,cAAc;OAErD,OAAO,CAAC,GAAGV,KAAK,EAAE,GAAGiP,SAAS,CAAC,CAAChD,MAAM,CAAC,CAACkO,GAAG,EAAEhb,IAAI,KAAK;SACrD,MAAM;WAAEgd,QAAQ;WAAEC,WAAW;WAAEhR;UAAc,GAAG+O,GAAG;SACnD,IAAIhb,IAAI,CAACyC,IAAI,KAAK,IAAI,CAACpB,WAAW,CAAC9B,IAAI,EACvC;WACCyd,QAAQ,CAACjL,IAAI,CAAC/R,IAAI,CAACsI,EAAE,CAAC;UACtB,MACI,IAAItI,IAAI,CAACyC,IAAI,KAAK,IAAI,CAACpB,WAAW,CAACsB,UAAU,EAClD;WACCsa,WAAW,CAAClL,IAAI,CAAC/R,IAAI,CAACsI,EAAE,CAAC;UACzB,MAED;WACC2D,YAAY,CAAC8F,IAAI,CAAC/R,IAAI,CAACsI,EAAE,CAAC;;SAG3B,OAAO0S,GAAG;QACV,EAAE;SACFgC,QAAQ,EAAE,EAAE;SACZC,WAAW,EAAE,EAAE;SACfhR,YAAY,EAAE;QACd,CAAC;MACF;KACDkR,oBAAoB,CAACja,YAAoB,EAAEmU,GAAsB,EAAE5U,IAAY,EAC/E;OAAA;OACC,IAAI,IAAI,CAACuD,UAAU,EACnB;SACC,OAAO4Q,SAAS,CAACM,SAAS,CAAChU,YAAY,EAAEmU,GAAG,CAAC;;OAG9C,MAAM+F,QAAQ,GAAGle,MAAM,CAACiF,MAAM,CAACkT,GAAG,CAAC,CAACzE,IAAI,CAAEuE,OAAO,IAAKA,OAAO,CAAC7U,MAAM,GAAG,CAAC,CAAC;OACzE,IAAI,CAAC8a,QAAQ,EACb;SACC,OAAOC,OAAO,CAACC,OAAO,EAAE;;OAGzB,MAAMvZ,QAAQ,6BAAG,IAAI,CAACxC,cAAc,CAACwC,QAAQ,qCAAI,IAAI;OACrD,IAAI,IAAI,CAACwV,QAAQ,KAAKV,QAAQ,CAAC9N,SAAS,EACxC;SACC,OAAO6L,SAAS,CAAC7L,SAAS,CAAC7H,YAAY,EAAEmU,GAAG,EAAEtT,QAAQ,CAAC;;OAGxD,OAAO6S,SAAS,CAACM,SAAS,CAAChU,YAAY,EAAEmU,GAAG,EAAEtT,QAAQ,CAAC;MACvD;KACD,MAAMwZ,MAAM,GACZ;OACC,MAAM;SACLrf,IAAI;SACJ6F,QAAQ;SACR+B,WAAW;SACX8L,KAAK;SACLC,QAAQ;SACRP,iBAAiB;SACjBC,oBAAoB;SACpBtQ,UAAU;SACVhC,SAAS;SACTwV;QACA,GAAG,IAAI,CAAClT,cAAc;OAEvB,IAAI2B,YAAY,GAAG,CAAC;OACpB,IAAIsa,UAAU,GAAG,EAAE;OACnB,IAAI,CAACtE,OAAO,GAAG,IAAI;OACnB,IACA;SACC,MAAM,CAACuE,aAAa,CAAC,GAAG,MAAM7G,SAAS,CAACC,aAAa,CACpD3Y,IAAI,EACJ6F,QAAQ,EACR+B,WAAW,EACX7E,UAAU,EACVhC,SAAS,oBAATA,SAAS,CAAEf,IAAI,CACf;SACDgF,YAAY,GAAGua,aAAa,CAACnV,EAAE;SAC/BkV,UAAU,GAAGC,aAAa,CAACD,UAAU;SAErC,MAAMre,IAAI,GAAG,MAAM,IAAI,CAAC2d,eAAe,CAAC5Z,YAAY,CAAC;SACrD,IAAI/D,IAAI,YAAJA,IAAI,CAAEue,oBAAoB,EAC9B;WACChG,kBAAkB,CAACc,kBAAkB,CAACrZ,IAAI,CAACue,oBAAoB,CAAC;UAChE,MAED;WACChG,kBAAkB,CAACe,yBAAyB,CAAC,IAAI,CAAClX,cAAc,EAAE2B,YAAY,CAAC;;SAGhF,MAAM0T,SAAS,CAACQ,SAAS,CACxBlU,YAAY,EACZ;WAAEgP,IAAI,EAAE,CAAC,GAAGN,KAAK,CAAC;WAAEY,OAAO,EAAE,CAAC,GAAGX,QAAQ;UAAG,EAC5C;WAAEK,IAAI,EAAEnR,MAAM,CAACuQ,iBAAiB,CAAC;WAAEkB,OAAO,EAAEzR,MAAM,CAACwQ,oBAAoB;UAAG,CAC1E;SAED,IAAItQ,UAAU,KAAKC,iDAAW,CAACiC,IAAI,EACnC;WACC,MAAMyT,SAAS,CAACW,cAAc,CAC7BrU,YAAY,EACZ;aACC,CAACmR,aAAa,CAACC,qBAAqB,GAAG;eACtCnQ,MAAM,EAAE,CAAC,GAAGsQ,QAAQ,CAACJ,aAAa,CAACC,qBAAqB,CAAC,CAAC;eAC1DtC,OAAO,EAAE;;YAEV,EACDjO,QAAQ,CACR;;QAEF,CACD,OAAO4Z,KAAK,EACZ;SACC,IAAI,CAACC,sDAAkB,CAAC7P,GAAG,CAAC4P,KAAK,CAACE,IAAI,CAAC,EACvC;WACCC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;aAC7B/N,OAAO,EAAEyN,KAAK,CAAC5B,OAAO;aACtBmC,aAAa,EAAE;YACf,CAAC;;SAGH;QACA,SAED;SACC,IAAI,CAAChF,OAAO,GAAG,KAAK;;OAGrBxB,kBAAkB,CAACC,gBAAgB,CAAC;SAAE,GAAG,IAAI,CAACpW,cAAc;SAAE+G,EAAE,EAAEpF,YAAY;SAAEsa;QAAY,CAAC;OAC7F,IAAI,CAAC5X,KAAK,CAAC,YAAY,EAAE;SAAE0C,EAAE,EAAEpF,YAAY;SAAEa,QAAQ;SAAEoa,YAAY,EAAE;QAAM,CAAC;OAE5E,MAAM;SAAEnB,QAAQ;SAAEC,WAAW;SAAEhR;QAAc,GAAG,IAAI,CAAC8Q,oBAAoB,EAAE;OAE3E3B,qBAAiB,CAChB;SACCC,IAAI,EAAE,WAAW;SACjBC,QAAQ,EAAE,WAAW;SACrBlT,KAAK,EAAE,aAAa;SACpBmT,SAAS,EAAE,IAAI,CAACvC,MAAM;SACtBoF,EAAE,EAAG,cAAapB,QAAQ,CAAC1a,MAAO,EAAC;SACnC+b,EAAE,EAAG,oBAAmBpB,WAAW,CAAC3a,MAAO,EAAC;SAC5Cgc,EAAE,EAAG,kBAAiBrS,YAAY,CAAC3J,MAAO;QAC1C,CACD;OACD,IAAI,CAACqD,KAAK,EAAE;MACZ;KACD,MAAM4Y,IAAI,GACV;OACC,IAAI,CAAC,IAAI,CAACpF,WAAW,EACrB;SACC,IAAI,CAACpT,oBAAoB,GAAG,IAAI;SAEhC;;OAGD,MAAM;SAAEuC,EAAE;SAAEvE,QAAQ;SAAE7F,IAAI;SAAE4H,WAAW;SAAE7G,SAAS;SAAEwV;QAAU,GAAG,IAAI,CAAClT,cAAc;OACpF,MAAMid,WAAW,GAAG,IAAI,CAACrc,WAAW,CAACC,GAAG,CAACkG,EAAE,CAAC;OAC5C,MAAMmW,YAAY,GAAG,CAAAD,WAAW,oBAAXA,WAAW,CAAEza,QAAQ,MAAKA,QAAQ,GAAG,IAAI,GAAGA,QAAQ;OACzE,IAAI,CAACmV,OAAO,GAAG,IAAI;OACnB,MAAMwF,YAAY,GAAG,IAAI,CAAClL,MAAM,KAAK,WAAW,GAC7C,IAAI,CAACsJ,eAAe,CAACxU,EAAE,CAAC,GACxB+U,OAAO,CAACC,OAAO,EAAE;OACpB,MAAMqB,iBAAiB,GAAG,IAAI,CAACnL,MAAM,KAAK,YAAY,GACnDoD,SAAS,CAACK,gBAAgB,CAAC3O,EAAE,EAAEmW,YAAY,EAAEvgB,IAAI,EAAE4H,WAAW,EAAE7G,SAAS,oBAATA,SAAS,CAAEf,IAAI,CAAC,GAChFmf,OAAO,CAACC,OAAO,EAAE;OACpB,MAAMsB,eAAe,GAAG,IAAI,CAACpL,MAAM,KAAK,YAAY,GACjDoD,SAAS,CAACY,cAAc,CACzBlP,EAAE,EACF;SACC,CAAC+L,aAAa,CAACC,qBAAqB,GAAG;WACtCnQ,MAAM,EAAE,CAAC,GAAGsQ,QAAQ,CAACJ,aAAa,CAACC,qBAAqB,CAAC,CAAC;WAC1DtC,OAAO,EAAE;;QAEV,EACDjO,QAAQ,CACR,GACCsZ,OAAO,CAACC,OAAO,EAAE;OAEpB,IAAI,CAACuB,iBAAiB,CAACvW,EAAE,EAAEvE,QAAQ,CAAC;OACpC,IACA;SACC,MAAM,CAAC+a,aAAa,CAAC,GAAG,MAAMzB,OAAO,CAAC0B,GAAG,CAAC,CAACL,YAAY,EAAEC,iBAAiB,EAAEC,eAAe,CAAC,CAAC;SAC7F,IAAIvG,kBAAkB,GAAG,EAAE;SAC3B,IAAI,IAAI,CAAC/L,YAAY,CAAChK,MAAM,GAAG,CAAC,EAChC;WAAA;WACC+V,kBAAkB,4BAAGyG,aAAa,oBAAbA,aAAa,CAAEzG,kBAAkB,oCAAI,EAAE;WAC5D,IAAIA,kBAAkB,CAAC/V,MAAM,GAAG,CAAC,EACjC;aACCoV,kBAAkB,CAACU,yBAAyB,CAAC,IAAI,CAAC9L,YAAY,EAAE+L,kBAAkB,CAAC;;;SAIrF,MAAM1U,KAAK,GAAGL,wDAAa,EAAE;SAC7B,IAAI+U,kBAAkB,CAACxI,QAAQ,CAAC,IAAI,CAAC8I,MAAM,CAAC,EAC5C;WACChV,KAAK,CAACiV,uBAAuB,CAACtQ,EAAE,EAAE,IAAI,CAACtE,MAAM,CAAC;UAC9C,MACI,IAAI,IAAI,CAACsI,YAAY,CAACsG,IAAI,CAAE5S,IAAI,IAAKA,IAAI,CAACsI,EAAE,KAAK,IAAI,CAACqQ,MAAM,CAAC,EAClE;WACChV,KAAK,CAACiV,uBAAuB,CAACtQ,EAAE,CAAC;UACjC,MAED;WACCoP,kBAAkB,CAACe,yBAAyB,CAAC,IAAI,CAAClX,cAAc,EAAE+G,EAAE,CAAC;;SAGtEoP,kBAAkB,CAACI,cAAc,CAAC,IAAI,CAACvW,cAAc,CAAC;QACtD,CACD,OAAOyd,CAAC,EACR;SACCC,OAAO,CAACtB,KAAK,CAACqB,CAAC,CAAC;SAEhB;QACA,SAED;SACC,IAAI,CAAC9F,OAAO,GAAG,KAAK;;OAGrB,IAAI,CAACtT,KAAK,CAAC,YAAY,EAAE;SAAE0C,EAAE;SAAEvE;QAAU,CAAC;OAC1C,IAAI,CAAC4B,KAAK,EAAE;MACZ;KACDuZ,qBAAqB,CAAC5T,QAAgB,EACtC;OACC,IAAI,CAACiO,QAAQ,GAAGjO,QAAQ;MACxB;KACDwP,qBAAqB,CAAC7Z,UAAkB,GAAG,YAAY,EACvD;OACC,IAAIA,UAAU,KAAKC,iDAAW,CAACiC,IAAI,EACnC;SACC,IAAI,CAACoW,QAAQ,GAAGV,QAAQ,CAAC7N,QAAQ;QACjC,MAED;SACC,IAAI,CAACuO,QAAQ,GAAGV,QAAQ,CAAC9N,SAAS;;MAEnC;KACD8T,iBAAiB,CAAC3b,YAAoB,EAAEa,QAAgB,EACxD;OACC,MAAMya,WAAW,GAAG,IAAI,CAACrc,WAAW,CAACC,GAAG,CAACc,YAAY,CAAC;OACtD,QAAQ,IAAI,CAACsQ,MAAM;SAElB,KAAK,YAAY;WAChB4H,qBAAiB,CAAC;aACjBC,IAAI,EAAE,WAAW;aACjBC,QAAQ,EAAE,WAAW;aACrBlT,KAAK,EAAE,gBAAgB;aACvBmT,SAAS,EAAE,IAAI,CAACvC,MAAM;aACtBmG,EAAE,EAAE,CAAAX,WAAW,oBAAXA,WAAW,CAAEza,QAAQ,MAAKA,QAAQ,GAAG,YAAY,GAAG,gBAAgB;aACxEqa,EAAE,EAAE,CAAAI,WAAW,oBAAXA,WAAW,CAAEtgB,IAAI,MAAKA,IAAI,GAAG,YAAY,GAAG;YAChD,CAAC;WACF;SACD,KAAK,WAAW;WAChB;aACC,MAAM;eAAE8e,QAAQ;eAAEC,WAAW;eAAEhR;cAAc,GAAG,IAAI,CAAC8Q,oBAAoB,EAAE;aAC3E3B,qBAAiB,CAAC;eACjBC,IAAI,EAAE,WAAW;eACjBC,QAAQ,EAAE,WAAW;eACrBlT,KAAK,EAAE,oBAAoB;eAC3BmT,SAAS,EAAE,IAAI,CAACvC,MAAM;eACtBoF,EAAE,EAAG,cAAapB,QAAQ,CAAC1a,MAAO,EAAC;eACnC+b,EAAE,EAAG,oBAAmBpB,WAAW,CAAC3a,MAAO,EAAC;eAC5Cgc,EAAE,EAAG,kBAAiBrS,YAAY,CAAC3J,MAAO;cAC1C,CAAC;aACF;;SAED;WACC;;MAEF;KACDoZ,kBAAkB,GAClB;OACC,IAAItT,KAAK,GAAG,IAAI;OAChB,QAAQ,IAAI,CAAC2R,WAAW,CAACzR,EAAE;SAE1B,KAAK,YAAY;WAChBF,KAAK,GAAG,mBAAmB;WAC3B;SACD,KAAK,WAAW;WACfA,KAAK,GAAG,mBAAmB;WAC3B;SACD,KAAK,UAAU;WACdA,KAAK,GAAG,mBAAmB;WAC3B;SACD,KAAK,YAAY;WAChBA,KAAK,GAAG,mBAAmB;WAC3B;SACD;WACC;;OAGF,IAAIA,KAAK,EACT;SACCgT,qBAAiB,CAAC;WACjBC,IAAI,EAAE,WAAW;WACjBC,QAAQ,EAAE,WAAW;WACrBlT,KAAK;WACLmT,SAAS,EAAE,IAAI,CAACvC;UAChB,CAAC;;;IAGJ;GAEDrY,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6FZ,CAAC;;;;;;;;"}