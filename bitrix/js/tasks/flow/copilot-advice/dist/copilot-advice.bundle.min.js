this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,t,a,i,o){"use strict";const l=()=>{const e=420;const s="/bitrix/js/tasks/flow/copilot-advice/images/copilot-advice-avatar.png";return{popupOptions:{fixed:true,width:e,bindElement:{left:window.innerWidth-e-85,top:50},cacheable:false,className:"tasks-flow__copilot-chat-popup",animation:{showClassName:"tasks-flow__copilot-chat-popup-show",closeClassName:"tasks-flow__copilot-chat-popup-close",closeAnimationType:"animation"}},loaderText:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_LOADER_TEXT"),header:{title:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_TITLE"),avatar:s,useCloseIcon:true},botOptions:{avatar:s,messageTitle:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_BOT_TITLE"),messageMenuItems:[]},useInput:false,useChatStatus:false,scrollToTheEndAfterFirstShow:false,showCopilotWarningMessage:true}};let r=e=>e,c;var n=babelHelpers.classPrivateFieldLooseKey("flowData");var d=babelHelpers.classPrivateFieldLooseKey("copilotChat");var _=babelHelpers.classPrivateFieldLooseKey("ifFirstShow");var P=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");var L=babelHelpers.classPrivateFieldLooseKey("getChatOptions");var b=babelHelpers.classPrivateFieldLooseKey("getContextMenuItemHtml");var p=babelHelpers.classPrivateFieldLooseKey("fetchAdvices");var h=babelHelpers.classPrivateFieldLooseKey("getFirstMessageByEfficiency");class v{constructor(e){Object.defineProperty(this,h,{value:T});Object.defineProperty(this,p,{value:S});Object.defineProperty(this,b,{value:u});Object.defineProperty(this,L,{value:O});Object.defineProperty(this,P,{value:E});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=new i.CopilotChat(babelHelpers.classPrivateFieldLooseBase(this,L)[L]());babelHelpers.classPrivateFieldLooseBase(this,_)[_]=true}show(){if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){babelHelpers.classPrivateFieldLooseBase(this,d)[d].showLoader();void babelHelpers.classPrivateFieldLooseBase(this,p)[p]();babelHelpers.classPrivateFieldLooseBase(this,_)[_]=false}babelHelpers.classPrivateFieldLooseBase(this,d)[d].show();void babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}hide(){babelHelpers.classPrivateFieldLooseBase(this,d)[d].hide()}}async function E(){const{sendData:e}=await o.Runtime.loadExtension("ui.analytics");e({tool:"tasks",category:"flows",event:"copilot_advice_view",c_section:"tasks",c_sub_section:"flows_grid"})}function O(){const e=l();e.botOptions.messageMenuItems=[{id:"create-task",text:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_CREATE_TASK"),html:babelHelpers.classPrivateFieldLooseBase(this,b)[b](o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_CREATE_TASK"),t.Main.TASKS),onclick:(e,s,t)=>{BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,n)[n].createTaskUrl,{requestMethod:"post",requestParams:{DESCRIPTION:`[QUOTE]${t.message.content}[/QUOTE]`},cacheable:false})}},{id:"create-meeting",html:babelHelpers.classPrivateFieldLooseBase(this,b)[b](o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_CREATE_MEETING"),t.Main.CALENDAR_1),onclick:(e,s,t)=>{const a=`[QUOTE]${t.message.content}[/QUOTE]`;const i=new BX.Calendar.SliderLoader("NEW",{entryDescription:a});i.show()}}];if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].canEditFlow){e.header.menu={items:[{id:"edit-flow",text:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_EDIT_FLOW"),onclick:(e,t)=>{t==null?void 0:t.menuWindow.close==null?void 0:t.menuWindow.close();s.EditForm.createInstance({isFeatureTrialable:babelHelpers.classPrivateFieldLooseBase(this,n)[n].isFeatureTrialable,flowId:babelHelpers.classPrivateFieldLooseBase(this,n)[n].flowId,context:"copilot_advice"})}}]}}return e}function u(e,s){return o.Tag.render(c||(c=r`
			<div class="tasks-flow__copilot-chat-context-menu-item">
				<span>${0}</span>
				<span class="ui-icon-set --${0}"></span>
			</div>
		`),e,s)}async function S(){var e,s,t,a;const i=await o.ajax.runAction("tasks.flow.Copilot.Advice.get",{data:{flowId:babelHelpers.classPrivateFieldLooseBase(this,n)[n].flowId}});if(i.status!=="success"){return}const l=(e=(s=i.data)==null?void 0:s.advices)!=null?e:[];const r=new Date((t=(a=i.data)==null?void 0:a.createDateTime)!=null?t:new Date);babelHelpers.classPrivateFieldLooseBase(this,d)[d].addBotMessage(babelHelpers.classPrivateFieldLooseBase(this,h)[h](babelHelpers.classPrivateFieldLooseBase(this,n)[n].flowEfficiency,r));l.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,d)[d].addBotMessage({content:e,status:"delivered",dateCreated:r.toString(),viewed:true})}));babelHelpers.classPrivateFieldLooseBase(this,d)[d].hideLoader()}function T(e,s){const t=e>80?o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_SUBTITLE_HIGH",{"#EFFICIENCY#":e}):o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_SUBTITLE_LOW",{"#EFFICIENCY#":e});const a=e>80?o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_HIGH"):o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_LOW");return{content:"",status:"delivered",type:i.CopilotChatMessageType.WELCOME_FLOWS,dateCreated:s.toString(),viewed:true,params:{title:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_TITLE"),subtitle:t,content:a}}}var C=babelHelpers.classPrivateFieldLooseKey("copilotChat");var F=babelHelpers.classPrivateFieldLooseKey("createCopilotChat");var g=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");class A{constructor(){Object.defineProperty(this,g,{value:w});Object.defineProperty(this,F,{value:I});Object.defineProperty(this,C,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}show(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].show();void babelHelpers.classPrivateFieldLooseBase(this,g)[g]()}hide(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].hide()}}function I(){const e=new i.CopilotChat(l());e.addBotMessage({content:"",status:"delivered",type:i.CopilotChatMessageType.WELCOME_FLOWS,dateCreated:(new Date).toString(),viewed:true,params:{title:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_TITLE"),subtitle:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_SUBTITLE_EXAMPLE"),content:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_SYSTEM_MESSAGE_EXAMPLE")}});e.addBotMessage({content:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_MESSAGE_EXAMPLE_1"),status:"delivered",dateCreated:(new Date).toString(),viewed:true});e.addBotMessage({content:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_MESSAGE_EXAMPLE_2"),status:"delivered",dateCreated:(new Date).toString(),viewed:true});e.addBotMessage({content:o.Loc.getMessage("TASKS_FLOW_COPILOT_ADVICE_POPUP_MESSAGE_EXAMPLE_3"),status:"delivered",dateCreated:(new Date).toString(),viewed:true});return e}async function w(){const{sendData:e}=await o.Runtime.loadExtension("ui.analytics");e({tool:"tasks",category:"flows",event:"copilot_example_view",c_section:"tasks",c_sub_section:"flows_grid"})}class M{static showExample(){if(M.currentChat){M.currentChat.hide()}M.currentChat=new A;M.currentChat.show()}static show(e){if(M.currentChat){M.currentChat.hide()}M.currentChat=new v(e);M.currentChat.show()}}M.currentChat=null;e.CopilotAdvice=M})(this.BX.Tasks.Flow=this.BX.Tasks.Flow||{},BX.Tasks.Flow,BX.UI.IconSet,BX,BX.AI.CopilotChat.UI,BX);
//# sourceMappingURL=copilot-advice.bundle.map.js