this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,t,i,a,l){"use strict";let r=e=>e,o;var n=babelHelpers.classPrivateFieldLooseKey("item");var d=babelHelpers.classPrivateFieldLooseKey("hintManager");var c=babelHelpers.classPrivateFieldLooseKey("getHtml");var b=babelHelpers.classPrivateFieldLooseKey("onSubMenuShow");var u=babelHelpers.classPrivateFieldLooseKey("bringHintToFront");class p{constructor(){Object.defineProperty(this,u,{value:E});Object.defineProperty(this,b,{value:h});Object.defineProperty(this,c,{value:v});this.ACCEPTED_ITEM_CLASS="menu-popup-item-accept";this.DISABLED_ITEM_CLASS="menu-popup-item-disabled";Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0})}getItem(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n])){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}if(t.Type.isUndefined(this.MENU_ID)||t.Type.isUndefined(this.HINT_ID)||t.Type.isUndefined(this.TITLE)){return null}babelHelpers.classPrivateFieldLooseBase(this,n)[n]={dataset:{id:this.MENU_ID},id:this.MENU_ID,html:babelHelpers.classPrivateFieldLooseBase(this,c)[c](),className:`menu-popup-item-none menu-popup-${this.TITLE}-deadline`,events:{onSubMenuShow:babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this)},items:this.getSubItems()};return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}onPromiseError(e){const i=e.errors;if(t.Type.isUndefined(i)){console.error(e);return}s.MessageBox.alert(t.Loc.getMessage("TASKS_DEADLINE_MENU_ERROR_DESCRIPTION"),t.Loc.getMessage("TASKS_DEADLINE_MENU_ERROR_TITLE"))}getSubItems(){return[]}refreshIcons(e,s){}}function v(){const e=t.Tag.render(o||(o=r`
			<div class="tasks-deadline-menu_${0}-deadline-item__text">
				${0}
			</div>
		`),this.TITLE,t.Loc.getMessage(`TASKS_DEADLINE_MENU_${this.TITLE.toUpperCase()}_ITEM_TITLE`));babelHelpers.classPrivateFieldLooseBase(this,d)[d]=BX.UI.Hint.createInstance({id:this.HINT_ID});const s=babelHelpers.classPrivateFieldLooseBase(this,d)[d].createNode(t.Loc.getMessage(`TASKS_DEADLINE_MENU_${this.TITLE.toUpperCase()}_ITEM_HINT`));t.Dom.append(s,e);return e}function h(e){const s=e.getTarget();const t=s.getSubMenu();const i=t.getMenuItems();this.refreshIcons(i,t);babelHelpers.classPrivateFieldLooseBase(this,u)[u](t)}function E(e){const s=e.getPopupWindow().getZIndexComponent();const t=babelHelpers.classPrivateFieldLooseBase(this,d)[d].popup;if(!t){return}const i=t.getZIndexComponent();i.setSort(s.getSort()+1);const a=i.getStack();a.sort()}var L=babelHelpers.classPrivateFieldLooseKey("PULL_EVENT");var _=babelHelpers.classPrivateFieldLooseKey("SECONDS_IN_DAY");var I=babelHelpers.classPrivateFieldLooseKey("SECONDS_IN_WEEK");var P=babelHelpers.classPrivateFieldLooseKey("SUBITEMS_CLASS_NAME");var T=babelHelpers.classPrivateFieldLooseKey("subMenu");var f=babelHelpers.classPrivateFieldLooseKey("subItems");var F=babelHelpers.classPrivateFieldLooseKey("defaultDeadline");var M=babelHelpers.classPrivateFieldLooseKey("isDeadlineNotificationAvailable");var N=babelHelpers.classPrivateFieldLooseKey("onMenuItemClick");var D=babelHelpers.classPrivateFieldLooseKey("subscribeToPull");var m=babelHelpers.classPrivateFieldLooseKey("onDefaultDeadlineChanged");class H extends p{constructor(e=true){super();Object.defineProperty(this,m,{value:A});Object.defineProperty(this,D,{value:y});Object.defineProperty(this,N,{value:S});this.MENU_ID="default-deadline-menu";this.HINT_ID="default-deadline-hint";this.TITLE="default";Object.defineProperty(this,L,{writable:true,value:"default_deadline_changed"});Object.defineProperty(this,_,{writable:true,value:86400});Object.defineProperty(this,I,{writable:true,value:7*babelHelpers.classPrivateFieldLooseBase(this,_)[_]});Object.defineProperty(this,P,{writable:true,value:"menu-popup-default-deadline-item"});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,M,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e;babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}getSubItems(){const e=babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this);const s=[new a.MenuItem({dataset:{id:`${this.MENU_ID}-day`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_1_DAY"),value:babelHelpers.classPrivateFieldLooseBase(this,_)[_],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-three-days`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_3_DAYS"),value:3*babelHelpers.classPrivateFieldLooseBase(this,_)[_],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-week`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_1_WEEK"),value:babelHelpers.classPrivateFieldLooseBase(this,I)[I],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-two-weeks`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_2_WEEKS"),value:2*babelHelpers.classPrivateFieldLooseBase(this,I)[I],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-empty`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_EMPTY"),value:0,isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e})];if(babelHelpers.classPrivateFieldLooseBase(this,M)[M]){s.push(new a.MenuItem({dataset:{id:`${this.MENU_ID}-custom`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_CUSTOM"),className:babelHelpers.classPrivateFieldLooseBase(this,P)[P]}))}return s}refreshIcons(e,s){const i=t.Type.isArrayFilled(e)||!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,f)[f]);const l=!t.Type.isUndefined(s)||!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,T)[T]);if(!i||!l){return}if(t.Type.isArrayFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e}if(!t.Type.isUndefined(s)){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=s}let r=false;let o=null;babelHelpers.classPrivateFieldLooseBase(this,f)[f].forEach((e=>{const s=e.getLayout().item;if(!t.Type.isElementNode(s)){return}const i=e.value;if(t.Type.isUndefined(i)){o=e}else if(i===this.defaultDeadline){t.Dom.addClass(s,this.ACCEPTED_ITEM_CLASS);r=true;return}t.Dom.removeClass(s,this.ACCEPTED_ITEM_CLASS)}));if(!t.Type.isNull(o)){const e=r?this.DISABLED_ITEM_CLASS:this.ACCEPTED_ITEM_CLASS;t.Dom.addClass(o.getLayout().item,e);return}if(r){return}o=new a.MenuItem({dataset:{id:`${this.MENU_ID}-custom`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_CUSTOM"),className:`${babelHelpers.classPrivateFieldLooseBase(this,P)[P]} ${this.ACCEPTED_ITEM_CLASS}`});babelHelpers.classPrivateFieldLooseBase(this,T)[T].addMenuItem(o)}get defaultDeadline(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,F)[F])){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}const e=t.Extension.getSettings("tasks.deadline.menu");babelHelpers.classPrivateFieldLooseBase(this,F)[F]=Number(e.get("defaultDeadline"));return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}}function S(e,s){const i=s.value;if(!t.Type.isNumber(i)){return}if(i===babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=i;const a=s.getMenuWindow();const l=a.getMenuItems();this.refreshIcons(l,a);t.ajax.runAction("tasks.deadline.Deadline.setDefault",{data:{deadlineData:{default:i,isExactTime:s.isExactTime?"Y":"N"}}}).catch((e=>this.onPromiseError(e)))}function y(){l.PULL.subscribe({moduleId:"tasks",command:babelHelpers.classPrivateFieldLooseBase(this,L)[L],callback:babelHelpers.classPrivateFieldLooseBase(this,m)[m].bind(this)})}function A(e){const s=e.deadline;if(!t.Type.isNumber(s)||babelHelpers.classPrivateFieldLooseBase(this,F)[F]===s){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s}var B=babelHelpers.classPrivateFieldLooseKey("PULL_EVENT");var g=babelHelpers.classPrivateFieldLooseKey("SUBITEMS_CLASS_NAME");var U=babelHelpers.classPrivateFieldLooseKey("subItems");var K=babelHelpers.classPrivateFieldLooseKey("skipPeriod");var C=babelHelpers.classPrivateFieldLooseKey("onMenuItemClick");var O=babelHelpers.classPrivateFieldLooseKey("subscribeToPull");var k=babelHelpers.classPrivateFieldLooseKey("onNotificationPeriodChanged");class w extends p{constructor(){super();Object.defineProperty(this,k,{value:$});Object.defineProperty(this,O,{value:j});Object.defineProperty(this,C,{value:x});this.MENU_ID="skip-deadline-notification-menu";this.HINT_ID="skip-deadline-notification-hint";this.TITLE="notification";Object.defineProperty(this,B,{writable:true,value:"skip_deadline_notification_period_changed"});Object.defineProperty(this,g,{writable:true,value:"menu-popup-skip-deadline-item"});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,K,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,O)[O]()}getSubItems(){const e=babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this);return[new a.MenuItem({text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_DELIMITER"),delimiter:true,className:babelHelpers.classPrivateFieldLooseBase(this,g)[g]}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-always`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_DONT_SKIP"),value:"",className:babelHelpers.classPrivateFieldLooseBase(this,g)[g],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-day`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOR_DAY"),value:"day",className:babelHelpers.classPrivateFieldLooseBase(this,g)[g],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-week`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOR_WEEK"),value:"week",className:babelHelpers.classPrivateFieldLooseBase(this,g)[g],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-month`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOR_MONTH"),value:"month",className:babelHelpers.classPrivateFieldLooseBase(this,g)[g],onclick:e}),new a.MenuItem({dataset:{id:`${this.MENU_ID}-forever`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOREVER"),value:"forever",className:babelHelpers.classPrivateFieldLooseBase(this,g)[g],onclick:e})]}refreshIcons(e,s){const i=t.Type.isArrayFilled(e)||!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,U)[U]);if(!i){return}if(t.Type.isArrayFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e}babelHelpers.classPrivateFieldLooseBase(this,U)[U].forEach((e=>{const s=e.getLayout().item;if(!t.Type.isElementNode(s)){return}const i=e.value;if(i===this.skipPeriod){t.Dom.addClass(s,this.ACCEPTED_ITEM_CLASS);return}t.Dom.removeClass(s,this.ACCEPTED_ITEM_CLASS)}))}get skipPeriod(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,K)[K])){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}const e=t.Extension.getSettings("tasks.deadline.menu");babelHelpers.classPrivateFieldLooseBase(this,K)[K]=String(e.get("skipDeadlineNotificationPeriod"));return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}}function x(e,s){const i=s.value;if(!t.Type.isString(i)){return}if(i===babelHelpers.classPrivateFieldLooseBase(this,K)[K]){return}babelHelpers.classPrivateFieldLooseBase(this,K)[K]=i;const a=s.getMenuWindow();const l=a.getMenuItems();this.refreshIcons(l,a);t.ajax.runAction("tasks.deadline.Notification.skip",{data:{notificationData:{skipPeriod:i}}}).catch((e=>this.onPromiseError(e)))}function j(){l.PULL.subscribe({moduleId:"tasks",command:babelHelpers.classPrivateFieldLooseBase(this,B)[B],callback:babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this)})}function $(e){const s=e.period;if(!t.Type.isString(s)||babelHelpers.classPrivateFieldLooseBase(this,K)[K]===s){return}babelHelpers.classPrivateFieldLooseBase(this,K)[K]=s}var R=babelHelpers.classPrivateFieldLooseKey("isDeadlineNotificationAvailable");class X{constructor(){Object.defineProperty(this,R,{writable:true,value:void 0})}get menuItems(){const e=new H(this.isDeadlineNotificationAvailable);const s=[e.getItem()];if(this.isDeadlineNotificationAvailable){const e=new w;s.push(e.getItem())}return s}get isDeadlineNotificationAvailable(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,R)[R])){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}const e=t.Extension.getSettings("tasks.deadline.menu");babelHelpers.classPrivateFieldLooseBase(this,R)[R]=Boolean(e.get("isDeadlineNotificationAvailable"));return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}}e.Menu=X})(this.BX.Tasks.Deadline=this.BX.Tasks.Deadline||{},BX.UI.Dialogs,BX,BX.Event,BX.Main,BX);
//# sourceMappingURL=menu.bundle.map.js