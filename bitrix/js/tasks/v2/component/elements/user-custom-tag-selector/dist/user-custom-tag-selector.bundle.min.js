this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,o,r,l,a,u,d,h){"use strict";const c={name:"UiUserCustomTagSelectorLoader",props:{options:{type:Object,default:null}},mounted(){this.loader=new h.Loader(this.getOptions());this.loader.render();this.loader.show()},beforeUnmount(){var t;(t=this.loader)==null?void 0:t.hide==null?void 0:t.hide();this.loader=null},methods:{getOptions(){return{...this.getDefaultOptions(),...this.options}},getDefaultOptions(){return{target:this.$refs.loader,type:"BULLET",size:"xs"}}},template:`\n\t\t<div class="b24-loader-container" ref="loader"></div>\n\t`};const m={name:"UiUserCustomTagSelector",components:{BIcon:n.BIcon,UserAvatar:a.UserAvatar,Loader:c,BMenu:i.BMenu},props:{dialogOptions:{type:Object,required:true},items:{type:Array,default:()=>[]},userInfo:{type:Object,default:null},withActionMenu:{type:Boolean,default:false},clickHandler:{type:Function,default:null},readonly:{type:Boolean,default:false}},emits:["freeze","unfreeze","select"],setup(){return{Outline:o.Outline}},data(){return{localContext:`${this.dialogOptions.context}-${this.$options.name}`,dialogId:`${this.dialogOptions.context}-${this.$options.name}-${e.Text.getRandom()}`,user:null,previousUser:null,loading:true,showAction:false,isMenuShown:false}},computed:{selected(){return Boolean(this.user)},userId(){var t,e;return parseInt((t=(e=this.user)==null?void 0:e.getId())!=null?t:0,10)},userName(){return this.user.getTitle()},userAvatar(){return this.user.getAvatar()},userType(){return this.user.getEntityType()},userProfileLink(){return d.userService.getUrl(this.userId)},testId(){return`${this.localContext}-${e.Text.getRandom()}`},menuOptions(){return{id:`${this.localContext}-${e.Text.getRandom()}-${this.userId}`,bindElement:this.$refs.user,offsetTop:8,items:this.menuItems,targetContainer:document.body}},menuItems(){return[{title:this.loc("UCTS_MENU_PROFILE"),icon:o.Outline.PERSON,dataset:{id:`MenuProfile-${this.testId}`},onClick:()=>BX.SidePanel.Instance.open(this.userProfileLink)},{title:this.loc("UCTS_MENU_EDIT"),icon:o.Outline.EDIT_L,dataset:{id:`MenuEdit-${this.testId}`},onClick:()=>this.showDialog()}]}},watch:{userInfo(){if(this.userInfo){this.user=this.mapUserInfoToItem(this.userInfo)}},items(){var t;if((t=this.dialog)!=null&&t.isLoaded()){this.user=this.dialog.getItemsByIds(this.items)[0]}}},created(){if(this.userInfo){this.user=this.mapUserInfoToItem(this.userInfo);this.$emit("select",this.mapItemToUserInfo(this.user));this.loading=false}else{var t;(t=this.dialog)!=null?t:this.dialog=this.createDialog()}},unmounted(){var t;(t=this.dialog)==null?void 0:t.destroy()},methods:{freeze(){this.$emit("freeze")},unfreeze(){var t;if((t=this.dialog)!=null&&t.isOpen()){return}this.$emit("unfreeze")},select(){var t;this.previousUser=this.user;const e=(t=this.dialog)==null?void 0:t.getSelectedItems()[0];this.user=e||this.previousUser;this.$emit("select",this.mapItemToUserInfo(this.user));this.loading=false},handleClick(){if(this.readonly){BX.SidePanel.Instance.open(this.userProfileLink);return}if(this.withActionMenu){this.showMenu()}else{void this.showDialog()}},async showDialog(){var t;if(this.clickHandler&&await this.clickHandler()===false){return}(t=this.dialog)!=null?t:this.dialog=this.createDialog();this.dialog.selectItemsByIds(this.items);this.dialog.showTo(this.$refs.container)},createDialog(){return new u.EntitySelectorDialog({id:this.dialogId,preselectedItems:this.items,events:{"Item:onSelect":this.select,"Item:onDeselect":this.select,onLoad:this.select,onShow:this.freeze,onHide:this.unfreeze},...this.dialogOptions})},showMenu(){this.isMenuShown=true},mapUserInfoToItem(t){var e,i;return new s.Item({id:t.id,entityId:"user",title:t.name,avatar:(e=t==null?void 0:t.image)!=null?e:"",entityType:(i=t==null?void 0:t.type)!=null?i:"employee"})},mapItemToUserInfo(t){return{id:t.getId(),name:t.getTitle(),image:t.getAvatar(),type:t.getEntityType()}}},template:`\n\t\t<div class="b24-user-selector" ref="container">\n\t\t\t<Loader v-if="loading"/>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tv-if="selected"\n\t\t\t\t\tclass="b24-user-selector-user"\n\t\t\t\t\t:class="'--' + userType"\n\t\t\t\t\t@mouseover="showAction = true"\n\t\t\t\t\t@mouseleave="showAction = false"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="user"\n\t\t\t\t\t\tclass="b24-user-selector-user-label"\n\t\t\t\t\t\t:data-id="'Label-' + testId"\n\t\t\t\t\t\t:bx-tooltip-user-id="userId"\n\t\t\t\t\t\tbx-tooltip-context="b24"\n\t\t\t\t\t\t@click="handleClick"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="b24-user-selector-user-image">\n\t\t\t\t\t\t\t<UserAvatar :src="userAvatar" :type="userType"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="b24-user-selector-user-name">{{ userName }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-show="!withActionMenu"\n\t\t\t\t\t\tclass="b24-user-selector-user-action"\n\t\t\t\t\t\t:class="{'--show': showAction}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="b24-user-selector-user-action-edit"\n\t\t\t\t\t\t\t:data-id="'Edit-' + testId"\n\t\t\t\t\t\t\t@click="showDialog"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon class="b24-user-selector-user-edit-icon" :name="Outline.EDIT_L"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-else\n\t\t\t\t\tclass="b24-user-selector-user-add"\n\t\t\t\t\t:data-id="'Add-' + testId"\n\t\t\t\t\t@click="showDialog"\n\t\t\t\t>\n\t\t\t\t\t<UserAvatar/>\n\t\t\t\t\t{{ loc('UCTS_ADD_BTN') }}\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t`};t.UserCustomTagSelector=m;t.Loader=c})(this.BX.Tasks.V2.Component.Elements=this.BX.Tasks.V2.Component.Elements||{},BX,BX.UI.EntitySelector,BX.UI.Vue3.Components,BX.UI.IconSet,BX.UI.IconSet,BX,BX.UI,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.UI);
//# sourceMappingURL=user-custom-tag-selector.bundle.map.js