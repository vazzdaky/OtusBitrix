this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,o,r,n,a,l,d,u,p,c,h,g,v,m,k,f,I,S,b,T,y){"use strict";const B=Object.freeze({id:"groupId",title:g.Loc.getMessage("TASKS_V2_GROUP_TITLE"),getTitle:t=>{var e;const s=k.Core.getStore().getters[`${f.Model.Groups}/getById`](t);return(e={[f.GroupType.Collab]:g.Loc.getMessage("TASKS_V2_GROUP_TITLE_COLLAB"),[f.GroupType.Scrum]:g.Loc.getMessage("TASKS_V2_GROUP_TITLE_SCRUM")}[s==null?void 0:s.type])!=null?e:g.Loc.getMessage("TASKS_V2_GROUP_TITLE")}});let P=t=>t,C;const O={components:{BIcon:r.BIcon,Loader:o.Loader,BMenu:s.BMenu},directives:{hint:a.hint},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:v.Outline}},data(){return{isMenuShown:false}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},group(){return this.$store.getters[`${f.Model.Groups}/getById`](this.task.groupId)},groupId(){return this.task.groupId},stage(){var t;return(t=this.$store.getters[`${f.Model.Stages}/getById`](this.task.stageId))!=null?t:null},menuOptions(){return()=>({id:"tasks-field-group-stage-menu",bindElement:this.$refs.stage,offsetTop:8,items:this.menuItems,maxHeight:window.innerHeight/2,targetContainer:document.body})},menuItems(){var t;const e=this.$store.getters[`${f.Model.Stages}/getByIds`]((t=this.group.stagesIds)!=null?t:[]);return e==null?void 0:e.map((t=>({title:t.title,svg:this.getStageSvg(new n.Color(t.color).limit(250).toRgb()),isSelected:t.id===this.stage.id,onClick:()=>this.setStage(t.id)})))},stageColor(){return`#${this.stage.color}`},backgroundColor(){return new n.Color(this.stage.color).setOpacity(.1).limit(250).toRgb()},isDarkColor(){return new n.Color(this.stage.color).isDark()},tooltip(){return()=>({text:this.loc("TASKS_V2_GROUP_STAGE_HINT"),timeout:500,popupOptions:{className:"tasks-field-group-hint",offsetTop:2,offsetLeft:this.$refs.stage.offsetWidth/2,background:"var(--ui-color-bg-content-inapp)",padding:6,angle:true,targetContainer:document.body}})},readonly(){return!this.task.rights.edit}},watch:{groupId(){void this.loadStagesForCreation()}},created(){void this.loadStagesForCreation()},methods:{getStageSvg(t){return g.Tag.render(C||(C=P`
				<div class="ui-icon-set --${0}" style="--ui-icon-set__icon-color: ${0}"></div>
			`),v.CRM.STAGE,t)},async handleClick(){if(this.readonly){return}if(!this.group.stagesIds){await p.groupService.getStages(this.groupId)}this.isMenuShown=true},setStage(t){void y.taskService.update(this.taskId,{stageId:t})},async loadStagesForCreation(){if(this.isEdit||this.group.stagesIds){return}await p.groupService.getStages(this.groupId);if(!this.task.stageId){this.setStage(this.group.stagesIds[0])}}},template:`\n\t\t<div\n\t\t\tv-if="stage"\n\t\t\tv-hint="tooltip"\n\t\t\tclass="tasks-field-group-stage"\n\t\t\t:class="{ '--dark': isDarkColor, '--readonly': readonly }"\n\t\t\t:style="{\n\t\t\t\t'--stage-color': stageColor,\n\t\t\t\t'--stage-background': backgroundColor,\n\t\t\t}"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="'stageId'"\n\t\t\t:data-task-field-value="task.stageId"\n\t\t\t:data-task-stage-title="stage?.title"\n\t\t\tref="stage"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<div class="tasks-field-group-stage-text-container">\n\t\t\t\t<div class="tasks-field-group-stage-text">{{ stage.title }}</div>\n\t\t\t</div>\n\t\t\t<div class="tasks-field-group-stage-arrow"></div>\n\t\t\t<BIcon v-if="!readonly" :name="Outline.CHEVRON_DOWN_S"/>\n\t\t</div>\n\t\t<div v-else class="tasks-field-group-stage-loader">\n\t\t\t<Loader/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions()" @close="isMenuShown = false"/>\n\t`};const _={components:{BIcon:r.BIcon},directives:{hint:a.hint},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:v.Outline}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},epic(){return this.$store.getters[`${f.Model.Epics}/getById`](this.task.epicId)},preselectedEpic(){return this.epic?[["epic-selector",this.epic.id]]:[]},epicColor(){if(!this.epic){return""}return new n.Color(this.epic.color).toRgb()},backgroundColor(){if(!this.epic){return""}return new n.Color(this.epic.color).setOpacity(.3).limit(250).toRgb()},isDarkColor(){if(!this.epic){return false}return new n.Color(this.epic.color).isDark()},tooltip(){return()=>({text:this.loc("TASKS_V2_GROUP_EPIC_HINT"),timeout:500,popupOptions:{className:"tasks-field-group-hint",offsetTop:2,offsetLeft:this.$el.offsetWidth/2,background:"var(--ui-color-bg-content-inapp)",padding:6,angle:true,targetContainer:document.body}})}},created(){this.handleEpicSelectedDebounced=g.Runtime.debounce(this.handleEpicSelected,10,this)},methods:{handleClick(){this.showDialog()},showDialog(){var t;(t=this.dialog)!=null?t:this.dialog=new h.EntitySelectorDialog({multiple:false,dropdownMode:true,enableSearch:true,compactView:true,hideOnDeselect:true,entities:[{id:f.EntitySelectorEntity.Epic,options:{groupId:this.task.groupId},dynamicLoad:true,dynamicSearch:true}],preselectedItems:this.preselectedEpic,events:{"Item:onSelect":this.handleEpicSelectedDebounced,"Item:onDeselect":this.handleEpicSelectedDebounced}});this.dialog.selectItemsByIds(this.preselectedEpic);this.dialog.showTo(this.$el)},handleEpicSelected(){var t;const e=this.dialog.getSelectedItems()[0];if(e){void this.$store.dispatch(`${f.Model.Epics}/insert`,{id:e.getId(),title:e.getTitle(),color:e.getAvatarOption("bgColor")})}void y.taskService.update(this.taskId,{epicId:(t=e==null?void 0:e.getId())!=null?t:0})}},template:`\n\t\t<div\n\t\t\tv-hint="tooltip"\n\t\t\tclass="tasks-field-group-scrum-epic"\n\t\t\t:class="{ '--dark': isDarkColor, '--filled': epic }"\n\t\t\t:style="{\n\t\t\t\t'--epic-color': epicColor,\n\t\t\t\t'--epic-background': backgroundColor,\n\t\t\t}"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<span class="tasks-field-group-scrum-epic-title">\n\t\t\t\t{{ epic?.title || loc('TASKS_V2_GROUP_EPIC_EMPTY') }}\n\t\t\t</span>\n\t\t\t<BIcon :name="Outline.CHEVRON_DOWN_S"/>\n\t\t</div>\n\t`};const E={directives:{hint:a.hint},props:{taskId:{type:[Number,String],required:true}},data(){return{isFocused:false}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},storyPoints(){var t;return(t=this.task.storyPoints)==null?void 0:t.trim()},tooltip(){return()=>({text:this.loc("TASKS_V2_GROUP_STORY_POINTS_HINT"),timeout:500,popupOptions:{className:"tasks-field-group-hint",offsetTop:2,offsetLeft:this.$refs.storyPoints.offsetWidth/2,background:"var(--ui-color-bg-content-inapp)",padding:6,angle:true,targetContainer:document.body}})}},methods:{async handleClick(){this.isFocused=true;await this.$nextTick();this.$refs.input.focus()},handleBlur(){this.isFocused=false;void y.taskService.update(this.taskId,{storyPoints:this.$refs.input.value.trim()})}},template:`\n\t\t<input\n\t\t\tv-if="isFocused"\n\t\t\tclass="tasks-field-group-scrum-story-points-input"\n\t\t\t:value="storyPoints"\n\t\t\tref="input"\n\t\t\t@blur="handleBlur"\n\t\t/>\n\t\t<div\n\t\t\tv-else\n\t\t\tv-hint="tooltip"\n\t\t\tclass="tasks-field-group-scrum-story-points"\n\t\t\t:class="{ '--filled': storyPoints }"\n\t\t\tref="storyPoints"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t{{ storyPoints || '-' }}\n\t\t</div>\n\t`};const L={components:{Epic:_,StoryPoints:E,Loader:o.Loader},props:{taskId:{type:[Number,String],required:true}},data(){return{hasScrumInfo:p.groupService.hasScrumInfo(this.taskId)}},async mounted(){await p.groupService.getScrumInfo(this.taskId);this.hasScrumInfo=p.groupService.hasScrumInfo(this.taskId)},template:`\n\t\t<div v-if="hasScrumInfo" class="tasks-field-group-scrum">\n\t\t\t<Epic :taskId="taskId"/>\n\t\t\t<StoryPoints :taskId="taskId"/>\n\t\t</div>\n\t\t<div v-else class="tasks-field-group-scrum-loader">\n\t\t\t<Loader/>\n\t\t</div>\n\t`};const w={components:{Popup:l.Popup,UiButton:d.Button},props:{taskId:{type:[Number,String],required:true},getBindElement:{type:Function,required:true}},emits:["close"],setup(){return{AirButtonStyle:d.AirButtonStyle,ButtonSize:d.ButtonSize}},data(){return{isPopupShown:false,groupInfo:{}}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},group(){return this.$store.getters[`${f.Model.Groups}/getById`](this.task.groupId)},bindElement(){return this.getBindElement()},popupId(){return"tasks-field-group-popup"},popupOptions(){return{bindElement:this.bindElement,padding:24,minWidth:260,maxWidth:400,offsetTop:8,targetContainer:document.body}},groupOwnerUrl(){return c.userService.getUrl(this.groupInfo.ownerId)},groupMembersCountFormatted(){return g.Loc.getMessagePlural("TASKS_V2_GROUP_COUNT_MEMBERS",this.groupInfo.numberOfMembers,{"#COUNT#":this.groupInfo.numberOfMembers})},groupAboutFormatted(){var t,e;return(t={[f.GroupType.Collab]:this.loc("TASKS_V2_GROUP_ABOUT_COLLAB"),[f.GroupType.Scrum]:this.loc("TASKS_V2_GROUP_ABOUT_SCRUM")}[(e=this.group)==null?void 0:e.type])!=null?t:this.loc("TASKS_V2_GROUP_ABOUT")}},mounted(){g.Event.bind(this.bindElement,"click",this.handleClick);g.Event.bind(this.bindElement,"mouseenter",this.handleMouseEnter);g.Event.bind(this.bindElement,"mouseleave",this.handleMouseLeave)},methods:{openGroup(){void u.openGroup(this.group.id,this.group.type)},handleClick(){this.clearTimeouts()},handleMouseEnter(){if(!this.group){return}this.groupInfoPromise=p.groupService.getGroupInfo(this.group.id);this.clearTimeouts();this.showTimeout=setTimeout((()=>this.showPopup()),400)},handleMouseLeave(){g.Event.unbind(document,"mouseover",this.updateHoverElement);g.Event.bind(document,"mouseover",this.updateHoverElement);this.clearTimeouts();this.closeTimeout=setTimeout((()=>{var t;if(!((t=this.$refs.container)!=null&&t.contains(this.hoverElement))&&!this.bindElement.contains(this.hoverElement)){this.closePopup()}}),100)},updateHoverElement(t){this.hoverElement=t.target},async showPopup(){if(this.groupInfoPromise){this.groupInfo=await this.groupInfoPromise}if(!this.group){return}this.clearTimeouts();this.isPopupShown=true;await this.$nextTick();this.$refs.popup.adjustPosition()},closePopup(){this.clearTimeouts();this.isPopupShown=false;g.Event.unbind(this.$refs.container,"mouseleave",this.handleMouseLeave);g.Event.unbind(document,"mouseover",this.updateHoverElement)},clearTimeouts(){clearTimeout(this.closeTimeout);clearTimeout(this.showTimeout)}},template:`\n\t\t<Popup\n\t\t\tv-if="isPopupShown"\n\t\t\t:id="popupId"\n\t\t\t:options="popupOptions"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="tasks-field-group-popup" ref="container">\n\t\t\t\t<div class="tasks-field-group-popup-header">\n\t\t\t\t\t<img class="tasks-field-group-popup-image" :src="group?.image" :alt="group?.name">\n\t\t\t\t\t<div class="tasks-field-group-popup-title-container">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-title" :title="group?.name">{{ group?.name }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-subtitle">{{ groupMembersCountFormatted }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-field-group-popup-button">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text="groupAboutFormatted"\n\t\t\t\t\t\t:style="AirButtonStyle.OUTLINE_ACCENT_2"\n\t\t\t\t\t\t:size="ButtonSize.SMALL"\n\t\t\t\t\t\t:wide="true"\n\t\t\t\t\t\t@click="openGroup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-field-group-popup-info">\n\t\t\t\t\t<div class="tasks-field-group-popup-field">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-title">{{ loc('TASKS_V2_GROUP_OWNER') }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-value">\n\t\t\t\t\t\t\t<a :href="groupOwnerUrl">{{ groupInfo.ownerName }}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-field-group-popup-field">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-title">{{ loc('TASKS_V2_GROUP_DATE_CREATE') }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-value">{{ groupInfo.dateCreate }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-field-group-popup-field">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-title">{{ loc('TASKS_V2_GROUP_SUBJECT') }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-value">{{ groupInfo.subjectTitle }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};var F=babelHelpers.classPrivateFieldLooseKey("taskId");var H=babelHelpers.classPrivateFieldLooseKey("dialog");var A=babelHelpers.classPrivateFieldLooseKey("onUpdateOnce");var M=babelHelpers.classPrivateFieldLooseKey("onUpdate");var $=babelHelpers.classPrivateFieldLooseKey("onHide");var G=babelHelpers.classPrivateFieldLooseKey("createDialog");var U=babelHelpers.classPrivateFieldLooseKey("upsertGroup");var V=babelHelpers.classPrivateFieldLooseKey("handleItemChange");var R=babelHelpers.classPrivateFieldLooseKey("items");var D=babelHelpers.classPrivateFieldLooseKey("task");var K=babelHelpers.classPrivateFieldLooseKey("updateGroup");var N=babelHelpers.classPrivateFieldLooseKey("clearOnUpdateOnce");class X{constructor(){Object.defineProperty(this,K,{value:Y});Object.defineProperty(this,D,{get:z,set:void 0});Object.defineProperty(this,R,{get:q,set:void 0});Object.defineProperty(this,V,{value:W});Object.defineProperty(this,U,{value:x});Object.defineProperty(this,G,{value:j});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A]=null}})}setTaskId(t){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=t;return this}async init(){var t,e;(e=(t=babelHelpers.classPrivateFieldLooseBase(this,H))[H])!=null?e:t[H]=babelHelpers.classPrivateFieldLooseBase(this,G)[G]()}showTo(t){this.init();babelHelpers.classPrivateFieldLooseBase(this,H)[H].selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,R)[R]);babelHelpers.classPrivateFieldLooseBase(this,H)[H].showTo(t)}onUpdateOnce(t){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=t}onUpdate(t){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=t}onHide(t){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=t}}function j(){const t=g.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,V)[V],10,this);return new h.EntitySelectorDialog({context:"tasks-card",multiple:false,hideOnDeselect:true,enableSearch:true,entities:[{id:f.EntitySelectorEntity.Project}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,R)[R],events:{"Item:onSelect":t,"Item:onDeselect":t,onHide:()=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$]();babelHelpers.classPrivateFieldLooseBase(this,N)[N]()},onDestroy:babelHelpers.classPrivateFieldLooseBase(this,N)[N],onLoad:async()=>{babelHelpers.classPrivateFieldLooseBase(this,U)[U]()}}})}async function x(){const t=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getSelectedItems()[0];if(t){await k.Core.getStore().dispatch(`${f.Model.Groups}/insert`,{id:t.getId(),name:t.getTitle(),image:t.getAvatar(),type:t.getEntityType()})}babelHelpers.classPrivateFieldLooseBase(this,K)[K](t==null?void 0:t.getId())}function W(){babelHelpers.classPrivateFieldLooseBase(this,U)[U]();babelHelpers.classPrivateFieldLooseBase(this,M)[M]()}function q(){return[[f.EntitySelectorEntity.Project,babelHelpers.classPrivateFieldLooseBase(this,D)[D].groupId]]}function z(){return k.Core.getStore().getters[`${f.Model.Tasks}/getById`](babelHelpers.classPrivateFieldLooseBase(this,F)[F])}function Y(t){var e,s;void y.taskService.update(babelHelpers.classPrivateFieldLooseBase(this,F)[F],{groupId:t,stageId:0});(e=(s=babelHelpers.classPrivateFieldLooseBase(this,A))[A])==null?void 0:e.call(s);babelHelpers.classPrivateFieldLooseBase(this,N)[N]()}const J=new X;const Q={components:{BIcon:r.BIcon,BMenu:s.BMenu,Stage:O,Scrum:L,Hint:S.Hint,GroupPopup:w},props:{taskId:{type:[Number,String],required:true}},setup(){return{groupMeta:B,Outline:v.Outline}},data(){return{isMenuShown:false,isHintShown:false}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},group(){return this.$store.getters[`${f.Model.Groups}/getById`](this.task.groupId)},isScrum(){var t;return((t=this.group)==null?void 0:t.type)===f.GroupType.Scrum},menuOptions(){return{id:"tasks-field-group-menu",bindElement:this.$refs.group,offsetTop:8,items:[{title:this.getAboutItemTitle(),icon:v.Outline.FOLDER,onClick:this.openGroup},{title:this.loc("TASKS_V2_GROUP_CHANGE"),icon:v.Outline.EDIT_L,onClick:this.showDialog},{design:s.MenuItemDesign.Alert,title:this.loc("TASKS_V2_GROUP_CLEAR"),icon:v.Outline.CROSS_L,onClick:this.clearField}],targetContainer:document.body}},groupName(){var t,e;return(t=(e=this.group)==null?void 0:e.name)!=null?t:this.loc("TASKS_V2_GROUP_HIDDEN")},groupImage(){var t;return(t=this.group)==null?void 0:t.image},hintText(){return this.loc("TASKS_V2_GROUP_CANT_CHANGE_FLOW")},isSecret(){return Boolean(this.task.groupId)&&!this.group},hasFlow(){return this.task.flowId>0},readonly(){return!this.task.rights.edit||this.hasFlow}},mounted(){e.heightTransition.animate(this.$refs.container)},updated(){e.heightTransition.animate(this.$refs.container)},methods:{getAboutItemTitle(){var t,e;return(t={[f.GroupType.Collab]:this.loc("TASKS_V2_GROUP_ABOUT_COLLAB"),[f.GroupType.Scrum]:this.loc("TASKS_V2_GROUP_ABOUT_SCRUM")}[(e=this.group)==null?void 0:e.type])!=null?t:this.loc("TASKS_V2_GROUP_ABOUT")},handleClick(){if(!this.isEdit&&this.hasFlow){this.isHintShown=true;return}if(this.readonly){if(!this.isSecret){void this.openGroup()}return}if(this.isEdit&&this.group){this.showMenu()}else{this.showDialog()}},showMenu(){this.isMenuShown=true},openGroup(){void u.openGroup(this.group.id,this.group.type)},showDialog(){J.setTaskId(this.taskId).showTo(this.$refs.group)},handleCrossClick(t){t.stopPropagation();this.clearField()},clearField(){void y.taskService.update(this.taskId,{groupId:0,stageId:0})}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-group"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="groupMeta.id"\n\t\t\t:data-task-field-value="task.groupId"\n\t\t\tref="container"\n\t\t>\n\t\t\t<div class="tasks-field-group-group" :class="{ '--secret': isSecret }" ref="group" @click="handleClick">\n\t\t\t\t<template v-if="task.groupId">\n\t\t\t\t\t<img v-if="groupImage" class="tasks-field-group-image" :src="groupImage" :alt="groupName"/>\n\t\t\t\t\t<BIcon v-else class="tasks-field-group-add-icon" :name="Outline.FOLDER"/>\n\t\t\t\t\t<div class="tasks-field-group-title">{{ groupName }}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if="!isEdit && (task.flowId ?? 0) <= 0"\n\t\t\t\t\t\tclass="tasks-field-group-cross"\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t@click.capture="handleCrossClick"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<BIcon class="tasks-field-group-add-icon" :name="Outline.FOLDER_PLUS"/>\n\t\t\t\t\t<div class="tasks-field-group-add-text">{{ loc('TASKS_V2_GROUP_ADD') }}</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<Stage v-if="isEdit && group && !task.flowId" :taskId="taskId"/>\n\t\t\t<Scrum v-if="isScrum && !task.flowId" :taskId="taskId"/>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if="isHintShown"\n\t\t\t:bindElement="$refs.container"\n\t\t\t@close="isHintShown = false"\n\t\t>\n\t\t\t{{ hintText }}\n\t\t</Hint>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t\t<GroupPopup :taskId="taskId" :getBindElement="() => $refs.group"/>\n\t`};const Z={components:{Chip:I.Chip,Hint:S.Hint,GroupPopup:w},inject:["analytics","cardType"],props:{taskId:{type:[Number,String],required:true},isAutonomous:{type:Boolean,default:false}},setup(){return{groupMeta:B}},data(){return{doShowHint:false}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},group(){return this.$store.getters[`${f.Model.Groups}/getById`](this.task.groupId)},design(){return{[!this.isAutonomous&&!this.isSelected]:I.ChipDesign.Shadow,[!this.isAutonomous&&this.isSelected]:I.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:I.ChipDesign.Outline,[this.isAutonomous&&this.isSelected]:I.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.task.groupId>0}return this.$store.getters[`${f.Model.Tasks}/wasFieldFilled`](this.taskId,B.id)},isFilled(){return Boolean(this.isAutonomous&&this.group)},isFlowFilled(){return this.task.flowId>0},text(){if(this.isFilled){var t,e;return(t=(e=this.group)==null?void 0:e.name)!=null?t:this.loc("TASKS_V2_GROUP_HIDDEN")}return B.title},icon(){if(this.isFilled){return null}return v.Outline.FOLDER},image(){var t,e;if(!this.isFilled){return null}return{src:(t=this.group)==null?void 0:t.image,alt:(e=this.group)==null?void 0:e.name}},canChange(){var t;return((t=this.task.flowId)!=null?t:0)<=0},hintText(){return this.loc("TASKS_V2_GROUP_CANT_CHANGE_FLOW")},readonly(){return!this.task.rights.edit},isLocked(){return!k.Core.getParams().limits.project}},created(){J.setTaskId(this.taskId).init()},methods:{handleClick(){if(this.isLocked){void g.Runtime.loadExtension("tasks.limit").then((t=>{const{Limit:e}=t;e.showInstance({featureId:k.Core.getParams().limits.projectFeatureId})}));return}if(!this.isAutonomous&&this.isSelected){this.highlightField();return}if(this.isFlowFilled){this.doShowHint=true;return}J.setTaskId(this.taskId).showTo(this.$refs.chip.$el);if(!this.isAutonomous){J.onUpdateOnce(this.highlightField)}J.onHide(this.handleFieldClose);J.onUpdate(this.handleUpdate)},highlightField(){void b.fieldHighlighter.setContainer(this.$root.$el).highlight(B.id)},handleClear(){void y.taskService.update(this.taskId,{groupId:0,stageId:0})},handleFieldClose(){if(this.isAutonomous){this.$refs.chip.focus()}},handleUpdate(){T.analytics.sendAddProject(this.analytics,{cardType:this.cardType,viewersCount:this.task.auditorsIds.length,coexecutorsCount:this.task.accomplicesIds.length})}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:icon="icon"\n\t\t\t:image="image"\n\t\t\t:text="text"\n\t\t\t:withClear="isFilled && !isFlowFilled"\n\t\t\t:lock="isLocked"\n\t\t\t:trimmable="isFilled"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="groupMeta.id"\n\t\t\t:data-task-chip-value="task.groupId"\n\t\t\tref="chip"\n\t\t\t@click="handleClick"\n\t\t\t@clear="handleClear"\n\t\t/>\n\t\t<Hint\n\t\t\tv-if="doShowHint"\n\t\t\t:bindElement="$refs.chip.$el"\n\t\t\t@close="doShowHint = false"\n\t\t>\n\t\t\t{{ hintText }}\n\t\t</Hint>\n\t\t<GroupPopup v-if="isAutonomous" :taskId="taskId" :getBindElement="() => $refs.chip.$el"/>\n\t`};t.Group=Q;t.Stage=O;t.GroupChip=Z;t.groupMeta=B})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Tasks.V2.Lib,BX.UI.Vue3.Components,BX,BX.Tasks.V2.Component.Elements,BX.UI.IconSet,BX.Tasks.V2.Lib,BX.Vue3.Directives,BX.UI.Vue3.Components,BX.Vue3.Components,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Lib,BX,BX.UI.IconSet,BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=group.bundle.map.js