{"version":3,"file":"flow.bundle.js","sources":["../src/flow-meta.js","../src/flow-dialog.js","../src/flow.js","../src/flow-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\n\nexport const flowMeta = Object.freeze({\n\tid: 'flowId',\n\ttitle: Loc.getMessage('TASKS_V2_FLOW_TITLE'),\n});\n","import { Extension, Runtime } from 'main.core';\nimport { EntitySelectorDialog, type ItemId } from 'tasks.v2.lib.entity-selector-dialog';\nimport { Core } from 'tasks.v2.core';\nimport { EntitySelectorEntity, Model } from 'tasks.v2.const';\nimport type { GroupModel } from 'tasks.v2.model.groups';\nimport { groupService } from 'tasks.v2.provider.service.group-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { FlowModel } from 'tasks.v2.model.flows';\nimport { EmptyStub, Footer } from 'tasks.flow.entity-selector';\n\nclass FlowDialog\n{\n\t#taskId: number | string;\n\t#dialog: EntitySelectorDialog;\n\t#onUpdateOnce: Function | null = null;\n\n\tsetTaskId(taskId: number | string): FlowDialog\n\t{\n\t\tthis.#taskId = taskId;\n\n\t\treturn this;\n\t}\n\n\tshowTo(targetNode: HTMLElement): void\n\t{\n\t\tthis.#dialog ??= this.#createDialog();\n\t\tthis.#dialog.selectItemsByIds(this.#items);\n\t\tthis.#dialog.showTo(targetNode);\n\t}\n\n\tonUpdateOnce(callback: Function): void\n\t{\n\t\tthis.#onUpdateOnce = callback;\n\t}\n\n\tisOpen(): boolean\n\t{\n\t\treturn this.#dialog?.isOpen() ?? false;\n\t}\n\n\t#createDialog(): EntitySelectorDialog\n\t{\n\t\tconst onItemChangeDebounced = Runtime.debounce(this.#onItemChange, 10, this);\n\n\t\tconst dialog = new EntitySelectorDialog({\n\t\t\tcontext: 'tasks-card',\n\t\t\twidth: 380,\n\t\t\theight: 370,\n\t\t\tmultiple: false,\n\t\t\thideOnDeselect: true,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: EntitySelectorEntity.Flow,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonlyActive: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tpreselectedItems: this.#items,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': onItemChangeDebounced,\n\t\t\t\t'Item:onDeselect': onItemChangeDebounced,\n\t\t\t\tonHide: this.#clearOnUpdateOnce,\n\t\t\t\tonDestroy: this.#clearOnUpdateOnce,\n\t\t\t},\n\t\t\trecentTabOptions: {\n\t\t\t\tstub: EmptyStub,\n\t\t\t\tstubOptions: {\n\t\t\t\t\tshowArrow: false,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst isFeatureTriable = Extension.getSettings('tasks.v2.component.fields.flow').get('isFeatureTriable');\n\t\tconst footer = new Footer(dialog, {\n\t\t\tisFeatureTriable,\n\t\t});\n\t\tdialog.setFooter(footer.render());\n\n\t\treturn dialog;\n\t}\n\n\tasync #onItemChange(): void\n\t{\n\t\tconst item = this.#dialog.getSelectedItems()[0];\n\t\tconst groupId = item?.getCustomData().get('groupId');\n\t\tif (item)\n\t\t{\n\t\t\tthis.#insertFlow({\n\t\t\t\tid: item.getId(),\n\t\t\t\tname: item.getTitle(),\n\t\t\t});\n\n\t\t\tconst group: GroupModel | undefined = Core.getStore().getters[`${Model.Groups}/getById`](groupId);\n\t\t\tif (!group)\n\t\t\t{\n\t\t\t\tawait groupService.getGroup(groupId);\n\t\t\t}\n\t\t}\n\n\t\tthis.#updateFlow(item?.getId() ?? 0, groupId ?? 0);\n\t}\n\n\tget #items(): ItemId[]\n\t{\n\t\treturn [[EntitySelectorEntity.Flow, this.#task.flowId]];\n\t}\n\n\tget #task(): TaskModel\n\t{\n\t\treturn Core.getStore().getters[`${Model.Tasks}/getById`](this.#taskId);\n\t}\n\n\t#insertFlow(flow: FlowModel): void\n\t{\n\t\tvoid Core.getStore().dispatch(`${Model.Flows}/insert`, flow);\n\t}\n\n\t#updateFlow(flowId: number, groupId: number): void\n\t{\n\t\tconst creatorId = Core.getStore().getters[`${Model.Interface}/currentUserId`];\n\t\tvoid taskService.update(\n\t\t\tthis.#taskId,\n\t\t\t{\n\t\t\t\tcreatorId,\n\t\t\t\tflowId,\n\t\t\t\tgroupId,\n\t\t\t\tstageId: 0,\n\t\t\t},\n\t\t);\n\n\t\tthis.#onUpdateOnce?.();\n\t\tthis.#clearOnUpdateOnce();\n\t}\n\n\t#clearOnUpdateOnce = (): void => {\n\t\tthis.#onUpdateOnce = null;\n\t};\n}\n\nexport const flowDialog = new FlowDialog();\n","import { SidePanel } from 'main.sidepanel';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BMenu, MenuItemDesign, type MenuOptions } from 'ui.vue3.components.menu';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { Stage } from 'tasks.v2.component.fields.group';\nimport { flowService } from 'tasks.v2.provider.service.flow-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { FlowModel } from 'tasks.v2.model.flows';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { flowMeta } from './flow-meta';\nimport { flowDialog } from './flow-dialog';\n\n// @vue/component\nexport const Flow = {\n\tname: 'TaskFlow',\n\tcomponents: {\n\t\tBIcon,\n\t\tBMenu,\n\t\tStage,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tflowMeta,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tflow(): FlowModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Flows}/getById`](this.task.flowId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Number.isInteger(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: 'tasks-field-flow-menu',\n\t\t\t\tbindElement: this.$refs.container,\n\t\t\t\toffsetTop: 8,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: this.loc('TASKS_V2_FLOW_ABOUT'),\n\t\t\t\t\t\ticon: Outline.BOTTLENECK,\n\t\t\t\t\t\tonClick: this.openFlow,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: this.loc('TASKS_V2_FLOW_CHANGE'),\n\t\t\t\t\t\ticon: Outline.EDIT_L,\n\t\t\t\t\t\tonClick: this.showDialog,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdesign: MenuItemDesign.Alert,\n\t\t\t\t\t\ttitle: this.loc('TASKS_V2_FLOW_DETACH'),\n\t\t\t\t\t\ticon: Outline.CROSS_L,\n\t\t\t\t\t\tonClick: this.clearField,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.flow && this.readonly)\n\t\t\t{\n\t\t\t\tthis.openFlow();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isEdit && this.flow)\n\t\t\t{\n\t\t\t\tthis.showMenu();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showDialog();\n\t\t\t}\n\t\t},\n\t\tshowMenu(): void\n\t\t{\n\t\t\tthis.isMenuShown = true;\n\t\t},\n\t\thandleCrossClick(event: MouseEvent): void\n\t\t{\n\t\t\tevent.stopPropagation();\n\n\t\t\tthis.clearField();\n\t\t},\n\t\topenFlow(): void\n\t\t{\n\t\t\tconst href = flowService.getUrl(this.flow.id, this.currentUserId);\n\n\t\t\tSidePanel.Instance.open(href);\n\t\t},\n\t\tclearField(): void\n\t\t{\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tflowId: 0,\n\t\t\t\t\tgroupId: 0,\n\t\t\t\t\tstageId: 0,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowDialog(): void\n\t\t{\n\t\t\tflowDialog.setTaskId(this.taskId).showTo(this.$refs.container);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-flow\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"flowMeta.id\"\n\t\t\t:data-task-field-value=\"task.flowId\"\n\t\t>\n\t\t\t<div class=\"tasks-field-flow-flow\" ref=\"container\" @click=\"handleClick\">\n\t\t\t\t<BIcon class=\"tasks-field-flow-image\" :name=\"Outline.BOTTLENECK\" color=\"var(--ui-color-accent-main-primary)\"/>\n\t\t\t\t<template v-if=\"flow\">\n\t\t\t\t\t<div class=\"tasks-field-flow-title\">\n\t\t\t\t\t\t{{ flow.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if=\"!isEdit\"\n\t\t\t\t\t\tclass=\"tasks-field-flow-cross\"\n\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\t@click.capture=\"handleCrossClick\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"tasks-field-flow-add-text\">{{ loc('TASKS_V2_FLOW_ADD') }}</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<Stage v-if=\"isEdit && flow\" :taskId=\"taskId\"/>\n\t\t</div>\n\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions\" @close=\"isMenuShown = false\"/>\n\t`,\n};\n","import { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { Chip, ChipDesign } from 'tasks.v2.component.elements.chip';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { FlowModel } from 'tasks.v2.model.flows';\n\nimport { flowMeta } from './flow-meta';\nimport { flowDialog } from './flow-dialog';\n\n// @vue/component\nexport const FlowChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tflowMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tflow(): FlowModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Flows}/getById`](this.task.flowId);\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn {\n\t\t\t\t[!this.isAutonomous && !this.isSelected]: ChipDesign.Shadow,\n\t\t\t\t[!this.isAutonomous && this.isSelected]: ChipDesign.ShadowAccent,\n\t\t\t\t[this.isAutonomous && !this.isSelected]: ChipDesign.Outline,\n\t\t\t\t[this.isAutonomous && this.isSelected]: ChipDesign.OutlineAccent,\n\t\t\t}.true;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\treturn this.task.flowId > 0;\n\t\t\t}\n\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, flowMeta.id);\n\t\t},\n\t\tisFilled(): boolean\n\t\t{\n\t\t\treturn this.isAutonomous && this.task.flowId > 0;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.isFilled)\n\t\t\t{\n\t\t\t\treturn this.flow.name;\n\t\t\t}\n\n\t\t\treturn flowMeta.title;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.isAutonomous && this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tflowDialog.setTaskId(this.taskId).showTo(this.$refs.chip.$el);\n\n\t\t\tif (!this.isAutonomous)\n\t\t\t{\n\t\t\t\tflowDialog.onUpdateOnce(this.highlightField);\n\t\t\t}\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(flowMeta.id);\n\t\t},\n\t\thandleClear(): void\n\t\t{\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{\n\t\t\t\t\tflowId: 0,\n\t\t\t\t\tgroupId: 0,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t},\n\t// TODO: remove title prop when flow popup added\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || !readonly\"\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"Outline.BOTTLENECK\"\n\t\t\t:text=\"text\"\n\t\t\t:withClear=\"isFilled\"\n\t\t\t:trimmable=\"isFilled\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"flowMeta.id\"\n\t\t\t:data-task-chip-value=\"task.flowId\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"handleClick\"\n\t\t\t@clear=\"handleClear\"\n\t\t\t:title=\"flow?.name ?? ''\"\n\t\t/>\n\t`,\n};\n"],"names":["flowMeta","Object","freeze","id","title","Loc","getMessage","FlowDialog","setTaskId","taskId","showTo","targetNode","selectItemsByIds","onUpdateOnce","callback","isOpen","onItemChangeDebounced","Runtime","debounce","dialog","EntitySelectorDialog","context","width","height","multiple","hideOnDeselect","enableSearch","entities","EntitySelectorEntity","Flow","options","onlyActive","preselectedItems","events","onHide","onDestroy","recentTabOptions","stub","EmptyStub","stubOptions","showArrow","isFeatureTriable","Extension","getSettings","get","footer","Footer","setFooter","render","item","getSelectedItems","groupId","getCustomData","getId","name","getTitle","group","Core","getStore","getters","Model","Groups","groupService","getGroup","flowId","Tasks","flow","dispatch","Flows","creatorId","Interface","taskService","update","stageId","flowDialog","components","BIcon","BMenu","Stage","props","type","Number","String","required","setup","Outline","data","isMenuShown","computed","mapGetters","currentUserId","task","$store","isEdit","isInteger","menuOptions","bindElement","$refs","container","offsetTop","items","loc","icon","BOTTLENECK","onClick","openFlow","EDIT_L","showDialog","design","MenuItemDesign","Alert","CROSS_L","clearField","targetContainer","document","body","readonly","rights","edit","methods","handleClick","showMenu","handleCrossClick","event","stopPropagation","href","flowService","getUrl","SidePanel","Instance","open","template","FlowChip","Chip","isAutonomous","Boolean","default","isSelected","ChipDesign","Shadow","ShadowAccent","OutlineAccent","true","isFilled","text","highlightField","chip","$el","fieldHighlighter","setContainer","$root","highlight","handleClear"],"mappings":"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"}