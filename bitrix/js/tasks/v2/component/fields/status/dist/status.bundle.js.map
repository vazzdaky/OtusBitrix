{"version":3,"file":"status.bundle.js","sources":["../src/status-popup/status-popup-content.js","../src/status-popup/status-popup.js","../src/status-meta.js","../src/status.js"],"sourcesContent":["import { DateTimeFormat } from 'main.date';\nimport { Model, TaskStatus } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport './status-popup.css';\n\n// @vue/component\nexport const StatusPopupContent = {\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tdateFormat: DateTimeFormat.getFormat('SHORT_DATE_FORMAT'),\n\t\t\ttimeFormat: DateTimeFormat.getFormat('SHORT_TIME_FORMAT'),\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tstatusFormatted(): string\n\t\t{\n\t\t\tconst statuses = {\n\t\t\t\t[TaskStatus.Pending]: 'TASKS_V2_STATUS_PENDING_FROM',\n\t\t\t\t[TaskStatus.InProgress]: 'TASKS_V2_STATUS_IN_PROGRESS_FROM',\n\t\t\t\t[TaskStatus.SupposedlyCompleted]: 'TASKS_V2_STATUS_SUPPOSEDLY_COMPLETED_FROM',\n\t\t\t\t[TaskStatus.Completed]: 'TASKS_V2_STATUS_COMPLETED_AT',\n\t\t\t\t[TaskStatus.Deferred]: 'TASKS_V2_STATUS_DEFERRED_AT',\n\t\t\t};\n\n\t\t\treturn this.loc(statuses[this.task.status], {\n\t\t\t\t'#DATE#': DateTimeFormat.format(this.dateFormat, this.task.statusChangedTs / 1000),\n\t\t\t\t'#TIME#': DateTimeFormat.format(this.timeFormat, this.task.statusChangedTs / 1000),\n\t\t\t});\n\t\t},\n\t\tcreatedAtFormatted(): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_STATUS_CREATED_AT', {\n\t\t\t\t'#DATE#': DateTimeFormat.format(this.dateFormat, this.task.createdTs / 1000),\n\t\t\t\t'#TIME#': DateTimeFormat.format(this.timeFormat, this.task.createdTs / 1000),\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-status-popup\">\n\t\t\t<div>{{ statusFormatted }}</div>\n\t\t\t<div>{{ createdAtFormatted }}</div>\n\t\t</div>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\nimport { Popup } from 'ui.vue3.components.popup';\n\nimport { StatusPopupContent } from './status-popup-content';\nimport './status-popup.css';\n\n// @vue/component\nexport const StatusPopup = {\n\tcomponents: {\n\t\tPopup,\n\t\tStatusPopupContent,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tpopupId(): string\n\t\t{\n\t\t\treturn 'tasks-field-status-popup';\n\t\t},\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tminWidth: 200,\n\t\t\t\toffsetTop: 10,\n\t\t\t\toffsetLeft: this.bindElement.offsetWidth / 2,\n\t\t\t\tbackground: 'var(--ui-color-bg-content-inapp)',\n\t\t\t\tpadding: 13,\n\t\t\t\tangle: true,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup\n\t\t\t:id=\"popupId\"\n\t\t\t:options=\"popupOptions\"\n\t\t>\n\t\t\t<StatusPopupContent :taskId=\"taskId\"/>\n\t\t</Popup>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const statusMeta = Object.freeze({\n\tid: 'status',\n\ttitle: Loc.getMessage('TASKS_V2_STATUS_TITLE'),\n});\n","import { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model, TaskStatus } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { StatusPopup } from './status-popup/status-popup';\nimport { statusMeta } from './status-meta';\nimport './status.css';\n\n// @vue/component\nexport const Status = {\n\tcomponents: {\n\t\tBIcon,\n\t\tStatusPopup,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tstatusMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tnowTs: Date.now(),\n\t\t\tisPopupShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tisExpired(): number\n\t\t{\n\t\t\treturn this.task.deadlineTs && this.nowTs > this.task.deadlineTs;\n\t\t},\n\t\ticon(): string\n\t\t{\n\t\t\tconst statuses = {\n\t\t\t\t[TaskStatus.Pending]: Outline.HOURGLASS,\n\t\t\t\t[TaskStatus.InProgress]: Outline.NEXT,\n\t\t\t\t[TaskStatus.SupposedlyCompleted]: Outline.REFRESH,\n\t\t\t\t[TaskStatus.Completed]: Outline.SENDED,\n\t\t\t\t[TaskStatus.Deferred]: Outline.PAUSE_L,\n\t\t\t};\n\n\t\t\treturn statuses[this.task.status] ?? Outline.HOURGLASS;\n\t\t},\n\t\tstatusFormatted(): string\n\t\t{\n\t\t\tconst statuses = {\n\t\t\t\t[TaskStatus.Pending]: this.loc('TASKS_V2_STATUS_PENDING'),\n\t\t\t\t[TaskStatus.InProgress]: this.loc('TASKS_V2_STATUS_IN_PROGRESS'),\n\t\t\t\t[TaskStatus.SupposedlyCompleted]: this.loc('TASKS_V2_STATUS_SUPPOSEDLY_COMPLETED'),\n\t\t\t\t[TaskStatus.Completed]: this.loc('TASKS_V2_STATUS_COMPLETED'),\n\t\t\t\t[TaskStatus.Deferred]: this.loc('TASKS_V2_STATUS_DEFERRED'),\n\t\t\t};\n\n\t\t\treturn statuses[this.task.status] ?? this.loc('TASKS_V2_STATUS_PENDING');\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.nowTsInterval = setInterval(() => {\n\t\t\tthis.nowTs = Date.now();\n\t\t}, 1000);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tclearInterval(this.nowTsInterval);\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tthis.clearTimeouts();\n\t\t\tif (this.isPopupShown)\n\t\t\t{\n\t\t\t\tthis.closePopup();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t},\n\t\thandleMouseEnter(): void\n\t\t{\n\t\t\tthis.clearTimeouts();\n\t\t\tthis.showTimeout = setTimeout(() => this.showPopup(), 100);\n\t\t},\n\t\thandleMouseLeave(): void\n\t\t{\n\t\t\tthis.clearTimeouts();\n\t\t\tthis.closePopup();\n\t\t},\n\t\tshowPopup(): void\n\t\t{\n\t\t\tthis.clearTimeouts();\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.clearTimeouts();\n\t\t\tthis.isPopupShown = false;\n\t\t},\n\t\tclearTimeouts(): void\n\t\t{\n\t\t\tclearTimeout(this.showTimeout);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-status\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"statusMeta.id\"\n\t\t\t:data-task-field-value=\"task.status\"\n\t\t\t:data-task-created-ts=\"task.createdTs\"\n\t\t\t:data-task-status-changes-ts=\"task.statusChangedTs\"\n\t\t\tref=\"container\"\n\t\t\t@click=\"handleClick\"\n\t\t\t@mouseenter=\"handleMouseEnter\"\n\t\t\t@mouseleave=\"handleMouseLeave\"\n\t\t>\n\t\t\t<BIcon class=\"tasks-field-status-icon\" :name=\"icon\"/>\n\t\t\t<div class=\"tasks-field-status-text\">{{ statusFormatted }}</div>\n\t\t</div>\n\t\t<StatusPopup\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:taskId=\"taskId\"\n\t\t\t:bindElement=\"$refs.container\"\n\t\t\t@close=\"closePopup\"\n\t\t/>\n\t`,\n};\n"],"names":["StatusPopupContent","props","taskId","type","Number","String","required","setup","dateFormat","DateTimeFormat","getFormat","timeFormat","computed","task","$store","getters","Model","Tasks","statusFormatted","statuses","TaskStatus","Pending","InProgress","SupposedlyCompleted","Completed","Deferred","loc","status","format","statusChangedTs","createdAtFormatted","createdTs","template","StatusPopup","components","Popup","bindElement","HTMLElement","popupId","popupOptions","minWidth","offsetTop","offsetLeft","offsetWidth","background","padding","angle","targetContainer","document","body","statusMeta","Object","freeze","id","title","Loc","getMessage","Status","BIcon","data","nowTs","Date","now","isPopupShown","isExpired","deadlineTs","icon","Outline","HOURGLASS","NEXT","REFRESH","SENDED","PAUSE_L","mounted","nowTsInterval","setInterval","beforeUnmount","clearInterval","methods","handleClick","clearTimeouts","closePopup","showPopup","handleMouseEnter","showTimeout","setTimeout","handleMouseLeave","clearTimeout"],"mappings":"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"}