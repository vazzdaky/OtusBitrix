{"version":3,"file":"add-task-button.bundle.js","sources":["../src/add-task-button.js"],"sourcesContent":["import { Event } from 'main.core';\n\nimport { Button as UiButton, ButtonSize } from 'ui.vue3.components.button';\n\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { Model } from 'tasks.v2.const';\nimport { titleMeta } from 'tasks.v2.component.fields.title';\nimport { filesMeta } from 'tasks.v2.component.fields.files';\nimport { checkListMeta } from 'tasks.v2.component.fields.check-list';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\n\nimport './add-task-button.css';\n\n// @vue/component\nexport const AddTaskButton = {\n\tname: 'AddTaskButton',\n\tcomponents: {\n\t\tUiButton,\n\t\tHint,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: String,\n\t\t\tdefault: ButtonSize.LARGE,\n\t\t},\n\t\thasError: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'addTask',\n\t\t'update:hasError',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfieldContainer: null,\n\t\t\tisPopupShown: false,\n\t\t\tisLoading: false,\n\t\t\terrorReason: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn fileService.get(this.taskId).isUploading();\n\t\t},\n\t\tisCheckListUploading(): boolean\n\t\t{\n\t\t\treturn this.task.checklist?.some((itemId) => fileService\n\t\t\t\t.get(itemId, EntityTypes.CheckListItem).isUploading());\n\t\t},\n\t\tisDisabled(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.task.title.trim() === ''\n\t\t\t\t|| this.isUploading\n\t\t\t\t|| this.isCheckListUploading\n\t\t\t\t|| this.isLoading\n\t\t\t);\n\t\t},\n\t},\n\twatch: {\n\t\thasError(value: boolean): void\n\t\t{\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tthis.isLoading = false;\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.isDisabled)\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.$emit('update:hasError', false);\n\t\t\t\tthis.$emit('addTask');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.task.title.trim() === '')\n\t\t\t{\n\t\t\t\tsetTimeout(() => this.highlightTitle());\n\t\t\t}\n\t\t\telse if (this.isUploading)\n\t\t\t{\n\t\t\t\tsetTimeout(() => this.highlightFiles());\n\t\t\t}\n\t\t\telse if (this.isCheckListUploading)\n\t\t\t{\n\t\t\t\tsetTimeout(() => this.highlightChecklist());\n\t\t\t}\n\t\t},\n\t\thighlightTitle(): void\n\t\t{\n\t\t\tthis.errorReason = this.loc('TASKS_V2_TITLE_IS_EMPTY');\n\n\t\t\tthis.fieldContainer = fieldHighlighter.setContainer(this.$root.$el).addHighlight(titleMeta.id);\n\n\t\t\tthis.fieldContainer.querySelector('textarea').focus();\n\n\t\t\tthis.showPopup();\n\t\t},\n\t\thighlightFiles(): void\n\t\t{\n\t\t\tthis.errorReason = this.loc('TASKS_V2_FILE_IS_UPLOADING');\n\n\t\t\tthis.fieldContainer = fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(filesMeta.id);\n\n\t\t\tthis.showPopup();\n\t\t},\n\t\thighlightChecklist(): void\n\t\t{\n\t\t\tthis.errorReason = this.loc('TASKS_V2_FILE_IS_UPLOADING');\n\n\t\t\tthis.fieldContainer = fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(checkListMeta.id);\n\n\t\t\tthis.showPopup();\n\t\t},\n\t\tshowPopup(): void\n\t\t{\n\t\t\tconst removeHighlight = () => {\n\t\t\t\tthis.isPopupShown = false;\n\t\t\t\tEvent.unbind(window, 'keydown', removeHighlight);\n\t\t\t};\n\t\t\tEvent.bind(window, 'keydown', removeHighlight);\n\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-add-task-button-container\"\n\t\t\t:class=\"{ '--disabled': isDisabled }\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\tdata-task-button-id=\"create\"\n\t\t\t@click=\"handleClick\"\n\t\t>\n\t\t\t<UiButton\n\t\t\t\tclass=\"tasks-add-task-button\"\n\t\t\t\t:text=\"loc('TASKS_V2_ADD_TASK')\"\n\t\t\t\t:size=\"size\"\n\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\t:loading=\"isLoading && !hasError\"\n\t\t\t/>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:bindElement=\"fieldContainer\"\n\t\t\t@close=\"isPopupShown = false\"\n\t\t>\n\t\t\t{{ errorReason }}\n\t\t</Hint>\n\t`,\n};\n"],"names":["AddTaskButton","name","components","UiButton","Hint","props","taskId","type","Number","String","required","size","default","ButtonSize","LARGE","hasError","Boolean","emits","data","fieldContainer","isPopupShown","isLoading","errorReason","computed","task","$store","getters","Model","Tasks","isUploading","fileService","get","isCheckListUploading","checklist","some","itemId","EntityTypes","CheckListItem","isDisabled","title","trim","watch","value","methods","handleClick","$emit","setTimeout","highlightTitle","highlightFiles","highlightChecklist","loc","fieldHighlighter","setContainer","$root","$el","addHighlight","titleMeta","id","querySelector","focus","showPopup","addChipHighlight","filesMeta","checkListMeta","removeHighlight","Event","unbind","window","bind","template"],"mappings":";;;;;;;CAeA;AACA,OAAaA,aAAa,GAAG;GAC5BC,IAAI,EAAE,eAAe;GACrBC,UAAU,EAAE;eACXC,gCAAQ;WACRC;IACA;GACDC,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDC,IAAI,EAAE;OACLJ,IAAI,EAAEE,MAAM;OACZG,OAAO,EAAEC,oCAAU,CAACC;MACpB;KACDC,QAAQ,EAAE;OACTR,IAAI,EAAES,OAAO;OACbJ,OAAO,EAAE;;IAEV;GACDK,KAAK,EAAE,CACN,SAAS,EACT,iBAAiB,CACjB;GACDC,IAAI,GACJ;KACC,OAAO;OACNC,cAAc,EAAE,IAAI;OACpBC,YAAY,EAAE,KAAK;OACnBC,SAAS,EAAE,KAAK;OAChBC,WAAW,EAAE;MACb;IACD;GACDC,QAAQ,EAAE;KACTC,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAC,IAAI,CAACtB,MAAM,CAAC;MACjE;KACDuB,WAAW,GACX;OACC,OAAOC,iDAAW,CAACC,GAAG,CAAC,IAAI,CAACzB,MAAM,CAAC,CAACuB,WAAW,EAAE;MACjD;KACDG,oBAAoB,GACpB;OAAA;OACC,+BAAO,IAAI,CAACR,IAAI,CAACS,SAAS,qBAAnB,qBAAqBC,IAAI,CAAEC,MAAM,IAAKL,iDAAW,CACtDC,GAAG,CAACI,MAAM,EAAEC,iDAAW,CAACC,aAAa,CAAC,CAACR,WAAW,EAAE,CAAC;MACvD;KACDS,UAAU,GACV;OACC,OACC,IAAI,CAACd,IAAI,CAACe,KAAK,CAACC,IAAI,EAAE,KAAK,EAAE,IAC1B,IAAI,CAACX,WAAW,IAChB,IAAI,CAACG,oBAAoB,IACzB,IAAI,CAACX,SAAS;;IAGnB;GACDoB,KAAK,EAAE;KACN1B,QAAQ,CAAC2B,KAAc,EACvB;OACC,IAAIA,KAAK,KAAK,IAAI,EAClB;SACC,IAAI,CAACrB,SAAS,GAAG,KAAK;;;IAGxB;GACDsB,OAAO,EAAE;KACRC,WAAW,GACX;OACC,IAAI,CAAC,IAAI,CAACN,UAAU,EACpB;SACC,IAAI,CAACjB,SAAS,GAAG,IAAI;SACrB,IAAI,CAACwB,KAAK,CAAC,iBAAiB,EAAE,KAAK,CAAC;SACpC,IAAI,CAACA,KAAK,CAAC,SAAS,CAAC;SAErB;;OAGD,IAAI,IAAI,CAACrB,IAAI,CAACe,KAAK,CAACC,IAAI,EAAE,KAAK,EAAE,EACjC;SACCM,UAAU,CAAC,MAAM,IAAI,CAACC,cAAc,EAAE,CAAC;QACvC,MACI,IAAI,IAAI,CAAClB,WAAW,EACzB;SACCiB,UAAU,CAAC,MAAM,IAAI,CAACE,cAAc,EAAE,CAAC;QACvC,MACI,IAAI,IAAI,CAAChB,oBAAoB,EAClC;SACCc,UAAU,CAAC,MAAM,IAAI,CAACG,kBAAkB,EAAE,CAAC;;MAE5C;KACDF,cAAc,GACd;OACC,IAAI,CAACzB,WAAW,GAAG,IAAI,CAAC4B,GAAG,CAAC,yBAAyB,CAAC;OAEtD,IAAI,CAAC/B,cAAc,GAAGgC,8CAAgB,CAACC,YAAY,CAAC,IAAI,CAACC,KAAK,CAACC,GAAG,CAAC,CAACC,YAAY,CAACC,yCAAS,CAACC,EAAE,CAAC;OAE9F,IAAI,CAACtC,cAAc,CAACuC,aAAa,CAAC,UAAU,CAAC,CAACC,KAAK,EAAE;OAErD,IAAI,CAACC,SAAS,EAAE;MAChB;KACDZ,cAAc,GACd;OACC,IAAI,CAAC1B,WAAW,GAAG,IAAI,CAAC4B,GAAG,CAAC,4BAA4B,CAAC;OAEzD,IAAI,CAAC/B,cAAc,GAAGgC,8CAAgB,CAACC,YAAY,CAAC,IAAI,CAACC,KAAK,CAACC,GAAG,CAAC,CAACO,gBAAgB,CAACC,yCAAS,CAACL,EAAE,CAAC;OAElG,IAAI,CAACG,SAAS,EAAE;MAChB;KACDX,kBAAkB,GAClB;OACC,IAAI,CAAC3B,WAAW,GAAG,IAAI,CAAC4B,GAAG,CAAC,4BAA4B,CAAC;OAEzD,IAAI,CAAC/B,cAAc,GAAGgC,8CAAgB,CAACC,YAAY,CAAC,IAAI,CAACC,KAAK,CAACC,GAAG,CAAC,CAACO,gBAAgB,CAACE,iDAAa,CAACN,EAAE,CAAC;OAEtG,IAAI,CAACG,SAAS,EAAE;MAChB;KACDA,SAAS,GACT;OACC,MAAMI,eAAe,GAAG,MAAM;SAC7B,IAAI,CAAC5C,YAAY,GAAG,KAAK;SACzB6C,eAAK,CAACC,MAAM,CAACC,MAAM,EAAE,SAAS,EAAEH,eAAe,CAAC;QAChD;OACDC,eAAK,CAACG,IAAI,CAACD,MAAM,EAAE,SAAS,EAAEH,eAAe,CAAC;OAE9C,IAAI,CAAC5C,YAAY,GAAG,IAAI;;IAEzB;GACDiD,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;CAwBZ,CAAC;;;;;;;;"}