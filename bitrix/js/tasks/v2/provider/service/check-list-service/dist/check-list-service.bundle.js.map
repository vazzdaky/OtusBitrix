{"version":3,"file":"check-list-service.bundle.js","sources":["../src/mappers.js","../src/check-list-service.js","../src/index.js"],"sourcesContent":["import type { CheckListModel } from 'tasks.v2.model.check-list';\nimport { UserTypes } from 'tasks.v2.model.users';\nimport { CheckListSliderData } from './types';\n\nexport function prepareCheckLists(checklist: CheckListModel[]): CheckListModel[]\n{\n\tconst parentNodeIdMap = new Map();\n\tchecklist.forEach((item: CheckListModel) => {\n\t\tparentNodeIdMap.set(item.id, item.nodeId);\n\t});\n\n\treturn checklist.map((item: CheckListModel) => {\n\t\tconst title = prepareTitle(item);\n\t\tconst parentNodeId = item.parentId ? parentNodeIdMap.get(item.parentId) : 0;\n\n\t\treturn { ...item, title, parentNodeId };\n\t});\n}\n\nexport function mapModelToSliderData(checkLists: CheckListModel[]): CheckListSliderData[]\n{\n\treturn Object.fromEntries(\n\t\tcheckLists.map((item) => {\n\t\t\tconst accomplices = item.accomplices?.map((accomplice) => ({\n\t\t\t\tID: accomplice.id,\n\t\t\t\tTYPE: 'A',\n\t\t\t\tNAME: accomplice.name,\n\t\t\t\tIMAGE: accomplice.image,\n\t\t\t\tIS_COLLABER: accomplice.type === UserTypes.Collaber ? 1 : '',\n\t\t\t}));\n\n\t\t\tconst auditors = item.auditors?.map((auditor) => ({\n\t\t\t\tID: auditor.id,\n\t\t\t\tTYPE: 'U',\n\t\t\t\tNAME: auditor.name,\n\t\t\t\tIMAGE: auditor.image,\n\t\t\t\tIS_COLLABER: auditor.type === UserTypes.Collaber ? 1 : '',\n\t\t\t}));\n\n\t\t\tconst attachments = Object.fromEntries(item.attachments?.map((key) => [key, key]));\n\t\t\tconst members = [...accomplices, ...auditors].reduce((acc, curr) => {\n\t\t\t\tacc[curr.ID] = curr;\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\n\t\t\tconst title = prepareTitle(item);\n\n\t\t\tconst node = Object.fromEntries(\n\t\t\t\tObject.entries({\n\t\t\t\t\tNODE_ID: item.nodeId,\n\t\t\t\t\tTITLE: title,\n\t\t\t\t\tCREATED_BY: item.creator?.id,\n\t\t\t\t\tTOGGLED_BY: item.toggledBy?.id,\n\t\t\t\t\tTOGGLED_DATE: item.toggledDate,\n\t\t\t\t\tMEMBERS: members,\n\t\t\t\t\tNEW_FILE_IDS: attachments,\n\t\t\t\t\tATTACHMENTS: attachments,\n\t\t\t\t\tIS_COMPLETE: item.isComplete,\n\t\t\t\t\tIS_IMPORTANT: item.isImportant,\n\t\t\t\t\tPARENT_ID: item.parentId,\n\t\t\t\t\tSORT_INDEX: item.sortIndex,\n\t\t\t\t\tACTIONS: {\n\t\t\t\t\t\tMODIFY: item.actions.modify,\n\t\t\t\t\t\tREMOVE: item.actions.remove,\n\t\t\t\t\t\tTOGGLE: item.actions.toggle,\n\t\t\t\t\t},\n\t\t\t\t}).filter(([, value]) => value !== null && value !== undefined),\n\t\t\t);\n\n\t\t\treturn [item.nodeId, node];\n\t\t}),\n\t);\n}\n\nexport function prepareTitle(item: CheckListModel): string\n{\n\tconst names = [\n\t\t...(item.accomplices ?? []).map((member) => member.name),\n\t\t...(item.auditors ?? []).map((member) => member.name),\n\t].join(' ');\n\n\tif (names)\n\t{\n\t\treturn `${item.title} ${names}`;\n\t}\n\n\treturn item.title;\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { ApiClient } from 'tasks.v2.lib.api-client';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { prepareCheckLists } from './mappers';\n\nclass CheckListService\n{\n\t#getPromises = {};\n\n\tasync load(taskId: number): Promise<void>\n\t{\n\t\t// eslint-disable-next-line no-async-promise-executor\n\t\tthis.#getPromises[taskId] ??= new Promise(async (resolve, reject) => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst data = await (new ApiClient()).post('CheckList.get', {\n\t\t\t\t\ttask: { id: taskId },\n\t\t\t\t});\n\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, data),\n\t\t\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tcontainsChecklist: data.length > 0,\n\t\t\t\t\t\t\tchecklist: data.map((item) => item.id),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t]);\n\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\n\t\treturn this.#getPromises[taskId];\n\t}\n\n\tasync save(taskId: number, checklists: CheckListModel[]): Promise<void>\n\t{\n\t\t// eslint-disable-next-line no-async-promise-executor\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst savedList = await (new ApiClient()).post('CheckList.save', {\n\t\t\t\t\ttask: {\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\tchecklist: prepareCheckLists(checklists),\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst oldIds = checklists.map((item: CheckListModel) => item.id);\n\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/deleteMany`, oldIds),\n\t\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, savedList),\n\t\t\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tcontainsChecklist: true,\n\t\t\t\t\t\t\tchecklist: savedList.map((item) => item.id),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t]);\n\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const checkListService = new CheckListService();\n","import { mapModelToSliderData } from './mappers';\n\nexport { checkListService } from './check-list-service';\n\nexport const CheckListMappers = { mapModelToSliderData };\n"],"names":["prepareCheckLists","checklist","parentNodeIdMap","Map","forEach","item","set","id","nodeId","map","title","prepareTitle","parentNodeId","parentId","get","mapModelToSliderData","checkLists","Object","fromEntries","accomplices","accomplice","ID","TYPE","NAME","name","IMAGE","image","IS_COLLABER","type","UserTypes","Collaber","auditors","auditor","attachments","key","members","reduce","acc","curr","node","entries","NODE_ID","TITLE","CREATED_BY","creator","TOGGLED_BY","toggledBy","TOGGLED_DATE","toggledDate","MEMBERS","NEW_FILE_IDS","ATTACHMENTS","IS_COMPLETE","isComplete","IS_IMPORTANT","isImportant","PARENT_ID","SORT_INDEX","sortIndex","ACTIONS","MODIFY","actions","modify","REMOVE","remove","TOGGLE","toggle","filter","value","undefined","names","member","join","CheckListService","load","taskId","Promise","resolve","reject","data","ApiClient","post","task","all","$store","dispatch","Model","CheckList","Tasks","fields","containsChecklist","length","error","save","checklists","savedList","oldIds","Core","getStore","checkListService","CheckListMappers"],"mappings":"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"}