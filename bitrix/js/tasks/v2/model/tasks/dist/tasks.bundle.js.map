{"version":3,"file":"tasks.bundle.js","sources":["../src/tasks.js"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { BuilderEntityModel, Store } from 'ui.vue3.vuex';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\n\nimport { Model } from 'tasks.v2.const';\n\nimport type { TaskModel, TasksModelState } from './types';\n\nexport class Tasks extends BuilderEntityModel<TasksModelState, TaskModel>\n{\n\tgetName(): string\n\t{\n\t\treturn Model.Tasks;\n\t}\n\n\tgetElementState(): TaskModel\n\t{\n\t\treturn {\n\t\t\tid: 0,\n\t\t\ttitle: '',\n\t\t\tisImportant: false,\n\t\t\tdescription: '',\n\t\t\tcreatorId: 0,\n\t\t\tcreatedTs: Date.now(),\n\t\t\tresponsibleId: 0,\n\t\t\tdeadlineTs: 0,\n\t\t\tfileIds: [],\n\t\t\tchecklist: [],\n\t\t\tcontainsChecklist: false,\n\t\t\tstoryPoints: '',\n\t\t\tepicId: 0,\n\t\t\taccomplicesIds: [],\n\t\t\tauditorsIds: [],\n\t\t\tstatus: 'pending',\n\t\t\tstatusChangedTs: Date.now(),\n\t\t\tneedsControl: false,\n\t\t\tfilledFields: {},\n\t\t\trights: {\n\t\t\t\tedit: true,\n\t\t\t\tdeadline: true,\n\t\t\t\tdelegate: true,\n\t\t\t},\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<TasksModelState>\n\t{\n\t\treturn {\n\t\t\t/** @function tasks/wasFieldFilled */\n\t\t\twasFieldFilled: (state: TasksModelState) => (id: number | string, fieldName: string): boolean => {\n\t\t\t\treturn state.collection[id].filledFields?.[fieldName] ?? false;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<TasksModelState>\n\t{\n\t\treturn {\n\t\t\t/** @function tasks/setFieldFilled */\n\t\t\tsetFieldFilled: (store: Store, { id, fieldName }: { id: number, fieldName: string }): void => {\n\t\t\t\tstore.commit('setFieldFilled', { id, fieldName });\n\t\t\t},\n\t\t\t/** @function tasks/clearFieldsFilled */\n\t\t\tclearFieldsFilled: (store: Store, id: number | string): void => {\n\t\t\t\tstore.commit('clearFieldsFilled', id);\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMutations(): MutationTree<TasksModelState>\n\t{\n\t\treturn {\n\t\t\tupsert: (state: TasksModelState, task: ?TaskModel): void => {\n\t\t\t\tBuilderEntityModel.defaultModel.getMutations(this).upsert(state, task);\n\n\t\t\t\tthis.setFieldsFilled(state, task);\n\t\t\t},\n\t\t\tupdate: (state: TasksModelState, { id, fields }: { id: number | string, fields: TaskModel }): void => {\n\t\t\t\tBuilderEntityModel.defaultModel.getMutations(this).update(state, { id, fields });\n\n\t\t\t\tthis.setFieldsFilled(state, { id, ...fields });\n\t\t\t},\n\t\t\tsetFieldFilled: (state: TasksModelState, { id, fieldName }: { id: number, fieldName: string }): void => {\n\t\t\t\t(state.collection[id].filledFields ??= {})[fieldName] = true;\n\t\t\t},\n\t\t\tclearFieldsFilled: (state: TasksModelState, id: number | string): void => {\n\t\t\t\tif (!state.collection[id])\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstate.collection[id].filledFields = {};\n\n\t\t\t\tthis.setFieldsFilled(state, state.collection[id]);\n\t\t\t},\n\t\t};\n\t}\n\n\tsetFieldsFilled(state: TasksModelState, fields: TaskModel): void\n\t{\n\t\tconst task = state.collection[fields.id];\n\t\tconst canEdit = task?.rights?.edit;\n\n\t\ttask.filledFields ??= {};\n\t\tObject.entries(fields).forEach(([fieldName: string, value: any]) => {\n\t\t\tconst isFilled = Boolean(value) && (!Array.isArray(value) || value.length > 0);\n\t\t\tif (isFilled)\n\t\t\t{\n\t\t\t\ttask.filledFields[fieldName] = true;\n\t\t\t}\n\n\t\t\tif (!isFilled && !canEdit)\n\t\t\t{\n\t\t\t\ttask.filledFields[fieldName] = false;\n\t\t\t}\n\t\t});\n\t}\n}\n"],"names":["Tasks","BuilderEntityModel","getName","Model","getElementState","id","title","isImportant","description","creatorId","createdTs","Date","now","responsibleId","deadlineTs","fileIds","checklist","containsChecklist","storyPoints","epicId","accomplicesIds","auditorsIds","status","statusChangedTs","needsControl","filledFields","rights","edit","deadline","delegate","getGetters","wasFieldFilled","state","fieldName","collection","getActions","setFieldFilled","store","commit","clearFieldsFilled","getMutations","upsert","task","defaultModel","setFieldsFilled","update","fields","canEdit","Object","entries","forEach","value","isFilled","Boolean","Array","isArray","length"],"mappings":"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"}