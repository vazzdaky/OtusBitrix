{"version":3,"file":"disk.onlyoffice-im-integration.bundle.js","sources":["../src/create-document.js"],"sourcesContent":["import {CreateDocumentOptions, CreateIframeDocumentOptions, IframeDocumentOptions} from \"./types\";\nimport {ajax as Ajax, Extension, Reflection, Runtime} from \"main.core\";\n\nexport default class CreateDocument\n{\n\toptions: CreateDocumentOptions;\n\n\tconstructor(options: CreateDocumentOptions)\n\t{\n\t\tthis.options = options;\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\twindow.addEventListener(\"message\", (event: MessageEvent) => {\n\t\t\tif (event.data.type === 'selectedTemplate')\n\t\t\t{\n\t\t\t\tthis.options.delegate.setMaxWidth(961);\n\t\t\t\tthis.options.delegate.onDocumentCreated();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetIframeUrlForCreate(options: CreateIframeDocumentOptions): Promise\n\t{\n\t\tthis.options.delegate.setMaxWidth(961);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst url = BX.util.add_url_param('/bitrix/services/main/ajax.php', {\n\t\t\t\taction: 'disk.api.integration.messengerCall.createDocumentInCall' ,\n\t\t\t\ttypeFile: options.typeFile,\n\t\t\t\tcallUuid: this.options.call.uuid,\n\t\t\t\tdialogId: this.options.dialog.id,\n\t\t\t});\n\n\t\t\tresolve(url);\n\t\t});\n\n\t}\n\n\tgetIframeUrl(options: IframeDocumentOptions): Promise\n\t{\n\t\tthis.options.delegate.setMaxWidth(961);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\toptions.viewerItem.enableEditInsteadPreview();\n\n\t\t\tconst queryParameters = options.viewerItem.getSliderQueryParameters();\n\t\t\tconst url = BX.util.add_url_param('/bitrix/services/main/ajax.php', queryParameters);\n\n\t\t\tresolve(url);\n\t\t});\n\n\t}\n\n\tgetIframeUrlForTemplates(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('disk.api.integration.messengerCall.selectTemplateOrOpenExisting', {\n\t\t\t\tdata: {\n\t\t\t\t\tcallUuid: this.options.call.uuid,\n\t\t\t\t\tdialogId: this.options.dialog.id,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.data.document && response.data.document.urlToEdit)\n\t\t\t\t{\n\t\t\t\t\tthis.options.delegate.setMaxWidth(961);\n\t\t\t\t\tresolve(response.data.document.urlToEdit);\n\t\t\t\t}\n\t\t\t\telse if (response.data.template && response.data.template.urlToSelect)\n\t\t\t\t{\n\t\t\t\t\tthis.options.delegate.setMaxWidth(328);\n\t\t\t\t\tresolve(response.data.template.urlToSelect);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tlistResumesInChat(chatId: number): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('disk.api.integration.messengerCall.listResumesInChat', {\n\t\t\t\tdata: {\n\t\t\t\t\tchatId: chatId,\n\t\t\t\t}\n\t\t\t}).then((response) => {\n\t\t\t\tif (response.data)\n\t\t\t\t{\n\t\t\t\t\tresolve(response.data.resumes);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tonCloseIframe(iframe: HTMLIFrameElement): boolean\n\t{\n\t\tiframe.contentWindow.postMessage('closeIframe', '*');\n\n\t\treturn true;\n\t}\n};"],"names":["CreateDocument","options","bindEvents","window","addEventListener","event","data","type","delegate","setMaxWidth","onDocumentCreated","Promise","resolve","reject","url","BX","util","add_url_param","action","typeFile","callUuid","call","uuid","dialogId","dialog","id","viewerItem","enableEditInsteadPreview","queryParameters","getSliderQueryParameters","Ajax","runAction","then","response","document","urlToEdit","template","urlToSelect","chatId","resumes","iframe","contentWindow","postMessage"],"mappings":"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"}