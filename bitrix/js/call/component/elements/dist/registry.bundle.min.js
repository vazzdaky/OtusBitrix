this.BX=this.BX||{};this.BX.Call=this.BX.Call||{};this.BX.Call.Component=this.BX.Call.Component||{};(function(t,e,n,i,o,s){"use strict";const a="#popup-window-content-";const l="10px";const r={name:"CallPopupContainer",props:{id:{type:String,required:true},config:{type:Object,required:false,default(){return{}}}},emits:["close","popup-instance-created"],data(){return{instance:null}},computed:{popupContainer(){return`${a}${this.id}`}},created(){if(this.instance){this.closePopup()}this.instance=this.getPopupInstance();this.instance.show()},mounted(){this.instance.adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position});this.$emit("popup-instance-created",this.instance)},beforeUnmount(){if(!this.instance){return}this.closePopup()},methods:{getPopupInstance(){if(!this.instance){var t;(t=e.PopupManager.getPopupById(this.id))==null?void 0:t.destroy();this.instance=new e.Popup(this.getPopupConfig())}return this.instance},getDefaultConfig(){return{id:this.id,bindOptions:{position:"bottom"},offsetTop:0,offsetLeft:0,className:"bx-call__scope",cacheable:false,closeIcon:false,autoHide:true,closeByEsc:true,animation:"fading",events:{onPopupClose:this.closePopup.bind(this),onPopupDestroy:this.closePopup.bind(this)},contentBorderRadius:l}},getPopupConfig(){const t=this.getDefaultConfig();const{className:e="",offsetTop:n=t.offsetTop,bindOptions:i={}}=this.config;const o=`${t.className} ${e}`.trim();const a=i.position==="top"&&s.Type.isNumber(n)?n-10:n;return{...t,...this.config,className:o,offsetTop:a}},closePopup(){this.$emit("close");this.instance.destroy();this.instance=null},enableAutoHide(){this.getPopupInstance().setAutoHide(true)},disableAutoHide(){this.getPopupInstance().setAutoHide(false)},adjustPosition(){this.getPopupInstance().adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})}},template:`\n\t\t<Teleport :to="popupContainer">\n\t\t\t<slot\n\t\t\t\t:adjustPosition="adjustPosition"\n\t\t\t\t:enableAutoHide="enableAutoHide"\n\t\t\t\t:disableAutoHide="disableAutoHide"\n\t\t\t></slot>\n\t\t</Teleport>\n\t`};const c="xs";const u="BULLET";const p={name:"CallLoader",props:{isLight:{type:Boolean,required:false,default:false}},computed:{loaderStyle(){return this.isLight?"rgba(255, 255, 255, 0.24)":""}},mounted(){this.loader=new n.Loader({target:this.$refs["call-loader"],type:u,size:c,color:this.loaderStyle});this.loader.render();this.loader.show()},beforeUnmount(){this.loader.hide();this.loader=null},template:`\n\t\t<div class="bx-call-elements-loader__container" ref="call-loader"></div>\n\t`};const d=[.5,.7,1,1.2,1.5,1.7,2];const h=i.BitrixVue.cloneComponent(o.AudioPlayer,{name:"AudioPlayer",components:{},props:{context:{required:false,default:window},playbackRateValues:{type:Array,required:false,default:()=>d},isShowPlaybackRateMenu:{type:Boolean,required:false,default:true},analyticsCallback:{type:Function,required:false,default:()=>{}}},data(){return{...this.parentData(),playbackRate:d[2],isSeeking:true}},computed:{progressPosition(){return{width:`${this.progressInPixel}px`}},seekPosition(){var t,e;const n=20;const i=(t=(e=this.$refs.seek)==null?void 0:e.offsetWidth)!=null?t:n;return this.progressInPixel?`left: ${this.progressInPixel-i/2}px;`:`left: ${this.progressInPixel-2}px`},playbackRateMenuItems(){return this.playbackRateValues.map((t=>this.createPlaybackRateMenuItem({text:this.getPlaybackRateOptionText(t),rate:t,isActive:t===this.playbackRate})))},formatTimeCurrent(){return this.formatTime(this.timeCurrent)},formatTimeTotal(){return this.formatTime(this.timeTotal)}},methods:{choosePlaybackTime(t){if(!this.source()){return}this.source().currentTime=t;this.audioEventRouter("timeupdate");if(this.state!==o.AudioPlayerState.play){this.clickToButton()}},startSeeking(t){this.isSeeking=true;const{clientX:e}=t;if(this.source()){this.source().pause();s.bind(this.context.document,"mouseup",this.finishSeeking);s.bind(this.context.document,"mousemove",this.seeking);this.setSeekByCursor(e)}},seeking(t){if(!this.isSeeking){return}const e=this.$refs.track;const{clientX:n}=t;const{left:i,right:o,width:a}=s.Dom.getPosition(e);this.seek=Math.max(0,Math.min(n-i,a-1));this.setPosition();t.preventDefault()},finishSeeking(){this.isSeeking=false;this.setPosition();if(this.source()){this.source().play();s.unbind(this.context.document,"mouseup",this.finishSeeking);s.unbind(this.context.document,"mousemove",this.seeking)}},setPosition(){if(!this.loaded){this.loadFile(true);return}const t=this.$refs.track.offsetWidth/100;this.setProgress(this.seek/t,this.seek);this.source().currentTime=this.timeTotal/100*this.progress},setProgress(t,e=-1){this.progress=Number.isNaN(t)?0:t;this.progressInPixel=e>0?e:Math.round(this.$refs.track.offsetWidth/100*t)},setSeekByCursor(t){const e=this.$refs.track;const{left:n,width:i}=s.Dom.getPosition(e);this.seek=Math.max(0,Math.min(t-n,i))},showPlaybackRateMenu(){if(this.menu&&this.menu.getPopupWindow().isShown()){return}const{BX:t}=this.context;const e=this.$refs.playbackRateButtonContainer;this.menu=new t.Main.Menu({id:`bx-call-audio-player-${this.id}`,className:"bx-call-audio-player__playback-speed-menu_scope",width:100,bindElement:e,events:{onPopupShow:()=>{const{width:t}=s.Dom.getPosition(e);const n=this.menu.getPopupWindow();n.setOffset({offsetLeft:t/2});n.adjustPosition()},onPopupClose:()=>{this.menu.destroy();this.menu=null}},angle:{position:"top"},offsetLeft:0,items:this.playbackRateMenuItems});this.menu.show()},getPlaybackRateOptionText(t){return s.Type.isFloat(t)?`${t}x`:`${t}.0x`},createPlaybackRateMenuItem({rate:t=1,text:e="",isActive:n=false}={}){return{text:e,className:`bx-call-audio-player__playback-speed-menu-item ${n?"menu-popup-item-accept-sm":""}`,onclick:(e,n)=>{this.changePlaybackRate(t);n.menuWindow.popupWindow.close();return true}}},changePlaybackRate(t){var e,n;this.playbackRate=t;if((e=this.$refs)!=null&&(n=e.source)!=null&&n.playbackRate){this.$refs.source.playbackRate=t}},onClickControlButton(){if(this.state!==o.AudioPlayerState.play){this.analyticsCallback()}this.clickToButton()}},template:`\n\t\t<div \n\t\t\tclass="bx-call-audio-player__container bx-call-audio-player__scope" \n\t\t\tref="body"\n\t\t>\n\t\t\t<div class="bx-call-audio-player__control-container">\n\t\t\t\t<button :class="['bx-call-audio-player__control-button', {\n\t\t\t\t\t'bx-call-audio-player__control-loader': loading,\n\t\t\t\t\t'bx-call-audio-player__control-play': !loading && state !== State.play,\n\t\t\t\t\t'bx-call-audio-player__control-pause': !loading && state === State.play,\n\t\t\t\t}]" @click="onClickControlButton"></button>\n\t\t\t</div>\n\t\t\t<div class="bx-call-audio-player__timeline-container">\n\t\t\t\t<div class="bx-call-audio-player__track-container" @mousedown="startSeeking" ref="track">\n\t\t\t\t\t<div class="bx-call-audio-player__track-mask">\n\t\t\t\t\t\t<div v-for="n in 7" :key="n" class="bx-call-audio-player__track-mask-separator"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-call-audio-player__track-mask --active" :style="progressPosition"></div>\n\t\t\t\t\t<div class="bx-call-audio-player__track-seek" @mousedown="startSeeking" :style="seekPosition">\n\t\t\t\t\t\t<div ref="seek" class="bx-call-audio-player__track-seek-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-call-audio-player__timer-container">\n\t\t\t\t\t<span>{{formatTimeCurrent}}</span>\n\t\t\t\t\t<span>{{formatTimeTotal}}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\t@click="showPlaybackRateMenu"\n\t\t\t\tref="playbackRateButtonContainer"\n\t\t\t\tclass="bx-call-audio-player__playback-speed-menu-container"\n\t\t\t\tstyle="user-select: none;"\n\t\t\t>\n\t\t\t\t{{ getPlaybackRateOptionText(playbackRate) }}\n\t\t\t</div>\n\t\t\t<audio \n\t\t\t\tv-if="src" \n\t\t\t\t:src="src" \n\t\t\t\tclass="bx-call-audio-player__audio-source" \n\t\t\t\tref="source" \n\t\t\t\t:preload="preload"\n\t\t\t\t@abort="audioEventRouter('abort', $event)"\n\t\t\t\t@error="audioEventRouter('error', $event)"\n\t\t\t\t@suspend="audioEventRouter('suspend', $event)"\n\t\t\t\t@canplay="audioEventRouter('canplay', $event)"\n\t\t\t\t@canplaythrough="audioEventRouter('canplaythrough', $event)"\n\t\t\t\t@durationchange="audioEventRouter('durationchange', $event)"\n\t\t\t\t@loadeddata="audioEventRouter('loadeddata', $event)"\n\t\t\t\t@loadedmetadata="audioEventRouter('loadedmetadata', $event)"\n\t\t\t\t@timeupdate="audioEventRouter('timeupdate', $event)"\n\t\t\t\t@play="audioEventRouter('play', $event)"\n\t\t\t\t@playing="audioEventRouter('playing', $event)"\n\t\t\t\t@pause="audioEventRouter('pause', $event)"\n\t\t\t></audio>\n\t\t</div>\n\t`});const m={name:"CallActionPopup",components:{CallPopupContainer:r},props:{titleText:{type:String,required:true},descriptionText:{type:String,required:true},okText:{type:String,required:true},cancelText:{type:String,required:false,default:s.Loc.getMessage("CALL_ACTION_POPUP_CANCEL_BUTTON")},okAction:{type:Function,required:true}},emits:["close"],data(){return{popupInstance:null}},computed:{getId(){return"call-action-popup"},config(){return{width:470,padding:0,overlay:false,autoHide:false,closeByEsc:false,angle:false,closeIcon:true,contentBorderRadius:"18px"}}},methods:{loc(t,e={}){return s.Loc.getMessage(t,e)},onOkButtonClick(){if(!this.okAction||!s.Type.isFunction(this.okAction)){return}this.okAction();this.popupInstance.destroy();this.$emit("close")},onCancelBtnClick(){this.popupInstance.destroy();this.$emit("close")},popupCreated(t){this.popupInstance=t}},template:`\n\t\t<CallPopupContainer\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="getId"\n\t\t\t@popup-instance-created="popupCreated($event)"\n\t\t>\n\t\t\t<div class='bx-call-action-popup__container bx-call-action-popup-scope'>\n\t\t\t\t<div class='bx-call-action-popup__title'>\n\t\t\t\t\t{{ titleText }}\n\t\t\t\t</div>\n\t\t\t\t<div class='bx-call-action-popup__body'>\n\t\t\t\t\t<div class='bx-call-action-popup__description'>{{ descriptionText }}</div>\n\t\t\t\t\t<div class='bx-call-action-popup__buttons-wrapper'>\n\t\t\t\t\t\t<div class='bx-call-action-popup__button --cancel' @click="onCancelBtnClick">{{ cancelText }}</div>\n\t\t\t\t\t\t<div class='bx-call-action-popup__button --ok' @click="onOkButtonClick">{{ okText }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</CallPopupContainer>\n\t`};t.CallPopupContainer=r;t.CallLoader=p;t.AudioPlayer=h;t.CallActionPopup=m})(this.BX.Call.Component.Elements=this.BX.Call.Component.Elements||{},BX.Main,BX.UI,BX.Vue3,BX.Vue3.Components,BX);
//# sourceMappingURL=registry.bundle.map.js