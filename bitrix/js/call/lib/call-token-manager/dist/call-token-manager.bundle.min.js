this.BX=this.BX||{};this.BX.Call=this.BX.Call||{};(function(e,s){"use strict";var l=babelHelpers.classPrivateFieldLooseKey("tokenList");var a=babelHelpers.classPrivateFieldLooseKey("pendingTokenList");var i=babelHelpers.classPrivateFieldLooseKey("queryParams");var t=babelHelpers.classPrivateFieldLooseKey("userToken");var r=babelHelpers.classPrivateFieldLooseKey("loadToken");class o{constructor(){Object.defineProperty(this,r,{value:b});Object.defineProperty(this,l,{writable:true,value:void 0});Object.defineProperty(this,a,{writable:true,value:void 0});Object.defineProperty(this,i,{writable:true,value:void 0});Object.defineProperty(this,t,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,l)[l]={};babelHelpers.classPrivateFieldLooseBase(this,a)[a]={};babelHelpers.classPrivateFieldLooseBase(this,i)[i]={};babelHelpers.classPrivateFieldLooseBase(this,t)[t]=s.Loc.getMessage("user_jwt")}setQueryParams(e){if(!s.Type.isPlainObject(e)){return}babelHelpers.classPrivateFieldLooseBase(this,i)[i]=e}getTokenCached(e){return babelHelpers.classPrivateFieldLooseBase(this,l)[l][e]}async getToken(e){const s=babelHelpers.classPrivateFieldLooseBase(this,l)[l][e];const i=babelHelpers.classPrivateFieldLooseBase(this,a)[a][e];if(s){return s}else if(i){return i}babelHelpers.classPrivateFieldLooseBase(this,a)[a][e]=new Promise((s=>{babelHelpers.classPrivateFieldLooseBase(this,r)[r](e).then((()=>{delete babelHelpers.classPrivateFieldLooseBase(this,a)[a][e];s(babelHelpers.classPrivateFieldLooseBase(this,l)[l][e])}))}));return babelHelpers.classPrivateFieldLooseBase(this,a)[a][e]}setToken(e,s){babelHelpers.classPrivateFieldLooseBase(this,l)[l][e]=s}async getUserToken(e){const s=babelHelpers.classPrivateFieldLooseBase(this,a)[a][e];if(babelHelpers.classPrivateFieldLooseBase(this,t)[t]){return babelHelpers.classPrivateFieldLooseBase(this,t)[t]}else if(s){return s}babelHelpers.classPrivateFieldLooseBase(this,a)[a][e]=new Promise((s=>{babelHelpers.classPrivateFieldLooseBase(this,r)[r](e).then((()=>{delete babelHelpers.classPrivateFieldLooseBase(this,a)[a][e];s(babelHelpers.classPrivateFieldLooseBase(this,t)[t])}))}));return babelHelpers.classPrivateFieldLooseBase(this,a)[a][e]}setUserToken(e){babelHelpers.classPrivateFieldLooseBase(this,t)[t]=e}clearTokenList(){babelHelpers.classPrivateFieldLooseBase(this,l)[l]={};babelHelpers.classPrivateFieldLooseBase(this,a)[a]={};babelHelpers.classPrivateFieldLooseBase(this,t)[t]=null}}async function b(e){try{var s,l;const a={chatId:e,...babelHelpers.classPrivateFieldLooseBase(this,i)[i]};const t=await BX.rest.callMethod("call.Call.getCallToken",a);const r=(s=t.data())==null?void 0:s.callToken;const o=(l=t.data())==null?void 0:l.userToken;if(r){this.setToken(e,r)}if(o){this.setUserToken(o)}}catch(e){console.error("Error during call token retrieving",e)}}const c=new o;e.CallTokenManager=c})(this.BX.Call.Lib=this.BX.Call.Lib||{},BX);
//# sourceMappingURL=call-token-manager.bundle.map.js