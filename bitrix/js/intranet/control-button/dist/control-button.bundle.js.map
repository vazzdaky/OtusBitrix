{"version":3,"file":"control-button.bundle.js","sources":["../src/control-button.js"],"sourcesContent":["import { Type, Tag, Loc, Dom, Text, ajax, Reflection } from 'main.core';\nimport { Menu, Popup } from 'main.popup';\nimport { Messenger } from 'im.public.iframe';\nimport 'pull.client';\n\nexport class ControlButton\n{\n\tconstructor(params = {})\n\t{\n\t\tthis.container = params.container;\n\n\t\tif (!Type.isDomNode(this.container))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.entityType = params.entityType || '';\n\t\tthis.entityId = params.entityId || '';\n\n\t\tif (!this.entityType || !this.entityId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = params.items || [];\n\t\tthis.mainItem = params.mainItem || 'videocall';\n\t\tthis.entityData = params.entityData || {};\n\t\tlet analyticsLabelParam = params.analyticsLabel || {};\n\n\t\tif (this.items.length === 0)\n\t\t{\n\t\t\tswitch (this.entityType)\n\t\t\t{\n\t\t\t\tcase 'task': {\n\t\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'calendar_event'];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'calendar_event': {\n\t\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task'];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'workgroup': {\n\t\t\t\t\tthis.items = ['chat', 'videocall'];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault: {\n\t\t\t\t\tthis.items = ['chat', 'videocall', 'blog_post', 'task', 'calendar_event'];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.contextBx = (window.top.BX || window.BX);\n\t\tthis.sliderId = `controlButton:${this.entityType + this.entityId}${Math.floor(Math.random() * 1000)}`;\n\t\tthis.isVideoCallEnabled = Reflection.getClass(`${this.contextBx}.Call.Util`)\n\t\t\t? this.contextBx.Call.Util.isWebRTCSupported() : true;\n\t\tthis.chatLockCounter = 0;\n\n\t\tif (!Type.isPlainObject(analyticsLabelParam))\n\t\t{\n\t\t\tanalyticsLabelParam = {};\n\t\t}\n\n\t\tthis.analyticsLabel = {\n\t\t\tentity: this.entityType,\n\t\t\t...analyticsLabelParam,\n\t\t};\n\n\t\tthis.analytics = params.analytics || {};\n\t\tif (!Type.isPlainObject(this.analytics))\n\t\t{\n\t\t\tthis.analytics = {};\n\t\t}\n\n\t\tthis.buttonClassName = params.buttonClassName || '';\n\t\tthis.airDesign = params.airDesign === true;\n\n\t\tthis.renderButton();\n\t\tthis.subscribeEvents();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('BX.Calendar:onEntrySave', this.onCalendarSave);\n\t\tthis.contextBx.Event.EventEmitter.unsubscribe('SidePanel.Slider:onMessage', this.onPostSave);\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tthis.contextBx.Event.EventEmitter.subscribe('BX.Calendar:onEntrySave', this.onCalendarSave.bind(this));\n\t\tthis.contextBx.Event.EventEmitter.subscribe('SidePanel.Slider:onMessage', this.onPostSave.bind(this));\n\t}\n\n\tonCalendarSave(event)\n\t{\n\t\tif (event instanceof this.contextBx.Event.BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.sliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData: this.entityData,\n\t\t\t\t\tentityType: 'CALENDAR_EVENT',\n\t\t\t\t\tentityId: data.responseData.entryId,\n\t\t\t\t};\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\tonPostSave(event)\n\t{\n\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\tif (sliderEvent.getEventId() === 'Socialnetwork.PostForm:onAdd')\n\t\t{\n\t\t\tconst data = sliderEvent.getData();\n\t\t\tif (data.originatorSliderId === this.sliderId)\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\tpostEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityType: this.entityType.toUpperCase(),\n\t\t\t\t\tsourceEntityId: this.entityId,\n\t\t\t\t\tsourceEntityData: this.entityData,\n\t\t\t\t\tentityType: 'BLOG_POST',\n\t\t\t\t\tentityId: data.successPostId,\n\t\t\t\t};\n\n\t\t\t\tthis.addEntityComment(params);\n\t\t\t}\n\t\t}\n\t}\n\n\trenderButton()\n\t{\n\t\tconst isChatButton = (!this.isVideoCallEnabled || this.mainItem === 'chat');\n\t\tconst onClickValue = (isChatButton ? this.openChat.bind(this) : this.startVideoCall.bind(this));\n\t\tconst buttonTitle = (\n\t\t\tisChatButton\n\t\t\t\t? Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT')\n\t\t\t\t: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_NAME_MSG_1')\n\t\t);\n\n\t\tlet buttonClass = '';\n\t\tif (this.airDesign)\n\t\t{\n\t\t\tbuttonClass = '--air ui-btn-no-caps ui-btn-sm ui-icon-set__scope --style-filled';\n\t\t\tif (isChatButton)\n\t\t\t{\n\t\t\t\tbuttonClass += ' --with-left-icon ui-btn-icon-chat';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tbuttonClass += ' --with-left-icon ui-btn-icon-camera';\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbuttonClass = isChatButton ? 'ui-btn-icon-chat-blue' : 'ui-btn-icon-camera-blue';\n\t\t\tbuttonClass += ` intranet-control-btn ui-btn-light-border ui-btn-icon-inline ${this.buttonClassName}`;\n\t\t}\n\n\t\tthis.button = (\n\t\t\tthis.items.length > 1\n\t\t\t\t? Tag.render`\n\t\t\t\t\t<div class=\"ui-btn-split ${buttonClass}\">\n\t\t\t\t\t\t<button class=\"ui-btn-main\" onclick=\"${onClickValue}\">\n\t\t\t\t\t\t\t<span class=\"ui-btn-text\">${buttonTitle}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class=\"ui-btn-menu\" onclick=\"${this.showMenu.bind(this)}\"></button> \n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t\t: Tag.render`\n\t\t\t\t\t<button class=\"ui-btn ${buttonClass}\" onclick=\"${onClickValue}\">\n\t\t\t\t\t\t<span class=\"ui-btn-text\">${buttonTitle}</span>\n\t\t\t\t\t</button>\n\t\t\t\t`\n\t\t);\n\n\t\tDom.append(this.button, this.container);\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.button, 'ui-btn-wait');\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.button, 'ui-btn-wait');\n\t}\n\n\tgetAvailableItems()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst availableItems = window.sessionStorage.getItem('b24-controlbutton-available-items');\n\t\t\tif (availableItems)\n\t\t\t{\n\t\t\t\tresolve(availableItems);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showLoader();\n\n\t\t\tajax.runAction('intranet.controlbutton.getAvailableItems', {\n\t\t\t\tdata: {},\n\t\t\t}).then((response) => {\n\t\t\t\twindow.sessionStorage.setItem('b24-controlbutton-available-items', response.data);\n\t\t\t\tthis.hideLoader();\n\t\t\t\tresolve(response.data);\n\t\t\t});\n\t\t});\n\t}\n\n\tshowMenu()\n\t{\n\t\tthis.getAvailableItems().then((availableItems) => {\n\t\t\tthis.items = this.items.filter((item) => {\n\t\t\t\treturn (item && (availableItems.includes(item)));\n\t\t\t});\n\n\t\t\tconst menuItems = [];\n\n\t\t\tthis.items.forEach((item) => {\n\t\t\t\t// eslint-disable-next-line default-case\n\t\t\t\tswitch (item)\n\t\t\t\t{\n\t\t\t\t\tcase 'videocall':\n\t\t\t\t\t\tif (this.isVideoCallEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_VIDEOCALL'),\n\t\t\t\t\t\t\t\tclassName: 'menu-popup-item-videocall',\n\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\tthis.startVideoCall();\n\t\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'chat':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_CHAT'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-chat',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openChat();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'task':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_TASK'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-task',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openTaskSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'calendar_event':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_MEETING'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-meeting',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openCalendarSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'blog_post':\n\t\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_CONTROL_BUTTON_POST'),\n\t\t\t\t\t\t\tclassName: 'menu-popup-item-post',\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.openPostSlider();\n\t\t\t\t\t\t\t\tthis.popupMenu.close();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.popupMenu = new Menu({\n\t\t\t\tbindElement: this.button,\n\t\t\t\titems: menuItems,\n\t\t\t\toffsetLeft: 80,\n\t\t\t\toffsetTop: 5,\n\t\t\t});\n\n\t\t\tthis.popupMenu.show();\n\t\t});\n\t}\n\n\topenChat()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openChat || {};\n\n\t\tajax.runAction('intranet.controlbutton.getChat', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tMessenger.openChat(`chat${parseInt(response.data, 10)}`);\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.openChat();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\tstartVideoCall(videoCallContext = null)\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.startVideoCall || {};\n\t\tif (\n\t\t\tType.isPlainObject(analytics)\n\t\t\t&& Type.isStringFilled(analytics.c_sub_section)\n\t\t\t&& videoCallContext\n\t\t)\n\t\t{\n\t\t\tanalytics.c_sub_section = videoCallContext;\n\t\t}\n\n\t\tajax.runAction('intranet.controlbutton.getVideoCallChat', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tMessenger.startVideoCall(`chat${response.data}`, true);\n\t\t\t}\n\n\t\t\tthis.chatLockCounter = 0;\n\t\t\tthis.hideLoader();\n\t\t}, (response) => {\n\t\t\tif (response.errors[0].code === 'lock_error' && this.chatLockCounter < 4)\n\t\t\t{\n\t\t\t\tthis.chatLockCounter++;\n\t\t\t\tthis.startVideoCall();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showHintPopup(response.errors[0].message);\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\t\t});\n\t}\n\n\taddEntityComment(params)\n\t{\n\t\tajax.runAction('socialnetwork.api.livefeed.createEntityComment', {\n\t\t\tdata: {\n\t\t\t\tparams,\n\t\t\t},\n\t\t});\n\t}\n\n\topenCalendarSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openCalendarSlider || {};\n\n\t\tajax.runAction('intranet.controlbutton.getCalendarLink', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tlet users = [];\n\n\t\t\tif (Type.isArrayLike(response.data.userIds))\n\t\t\t{\n\t\t\t\tusers = response.data.userIds.map((userId) => {\n\t\t\t\t\treturn { id: parseInt(userId, 10), entityId: 'user' };\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tnew (window.top.BX || window.BX).Calendar.SliderLoader(\n\t\t\t\t0,\n\t\t\t\t{\n\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\tparticipantsEntityList: users,\n\t\t\t\t\tentryName: response.data.name,\n\t\t\t\t\tentryDescription: response.data.desc,\n\t\t\t\t},\n\t\t\t).show();\n\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenTaskSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openTaskSlider || {};\n\n\t\tajax.runAction('intranet.controlbutton.getTaskLink', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tBX.SidePanel.Instance.open(response.data.link, {\n\t\t\t\trequestMethod: 'post',\n\t\t\t\trequestParams: response.data,\n\t\t\t});\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\topenPostSlider()\n\t{\n\t\tthis.showLoader();\n\n\t\tconst analytics = this.analytics.openPostSlider || {};\n\n\t\tajax.runAction('intranet.controlbutton.getPostLink', this.getAjaxConfig(analytics)).then((response) => {\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tresponse.data.link,\n\t\t\t\t{\n\t\t\t\t\trequestMethod: 'post',\n\t\t\t\t\trequestParams: {\n\t\t\t\t\t\tPOST_TITLE: response.data.title,\n\t\t\t\t\t\tPOST_MESSAGE: response.data.message,\n\t\t\t\t\t\tdestTo: response.data.destTo,\n\t\t\t\t\t},\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsliderId: this.sliderId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.hideLoader();\n\t\t});\n\t}\n\n\tgetAjaxConfig(analytics): Object\n\t{\n\t\tconst config = {\n\t\t\tdata: {\n\t\t\t\tentityType: this.entityType,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityData: this.entityData,\n\t\t\t},\n\t\t};\n\n\t\tif (\n\t\t\tType.isPlainObject(analytics)\n\t\t\t&& Type.isStringFilled(analytics.event)\n\t\t\t&& Type.isStringFilled(analytics.tool)\n\t\t)\n\t\t{\n\t\t\tconfig.analytics = analytics;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconfig.analyticsLabel = this.analyticsLabel;\n\t\t}\n\n\t\treturn config;\n\t}\n\n\tshowHintPopup(message)\n\t{\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnew Popup(`inviteHint${Text.getRandom(8)}`, this.button, {\n\t\t\tcontent: message,\n\t\t\tzIndex: 15000,\n\t\t\tangle: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 50,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tdarkMode: true,\n\t\t\toverlay: false,\n\t\t\tmaxWidth: 400,\n\t\t\tevents: {\n\t\t\t\tonAfterPopupShow() {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}, 5000);\n\t\t\t\t},\n\t\t\t},\n\t\t}).show();\n\t}\n}\n"],"names":["ControlButton","constructor","params","container","Type","isDomNode","entityType","entityId","items","mainItem","entityData","analyticsLabelParam","analyticsLabel","length","contextBx","window","top","BX","sliderId","Math","floor","random","isVideoCallEnabled","Reflection","getClass","Call","Util","isWebRTCSupported","chatLockCounter","isPlainObject","entity","analytics","buttonClassName","airDesign","renderButton","subscribeEvents","destroy","Event","EventEmitter","unsubscribe","onCalendarSave","onPostSave","subscribe","bind","event","BaseEvent","data","getData","postEntityType","toUpperCase","sourceEntityType","sourceEntityId","sourceEntityData","responseData","entryId","addEntityComment","sliderEvent","getCompatData","getEventId","originatorSliderId","successPostId","isChatButton","onClickValue","openChat","startVideoCall","buttonTitle","Loc","getMessage","buttonClass","button","Tag","render","showMenu","Dom","append","showLoader","addClass","hideLoader","removeClass","getAvailableItems","Promise","resolve","reject","availableItems","sessionStorage","getItem","ajax","runAction","then","response","setItem","filter","item","includes","menuItems","forEach","push","text","className","onclick","popupMenu","close","openTaskSlider","openCalendarSlider","openPostSlider","Menu","bindElement","offsetLeft","offsetTop","show","getAjaxConfig","Messenger","parseInt","errors","code","showHintPopup","message","videoCallContext","isStringFilled","c_sub_section","users","isArrayLike","userIds","map","userId","id","Calendar","SliderLoader","participantsEntityList","entryName","name","entryDescription","desc","SidePanel","Instance","open","link","requestMethod","requestParams","POST_TITLE","title","POST_MESSAGE","destTo","config","tool","Popup","Text","getRandom","content","zIndex","angle","closeIcon","autoHide","darkMode","overlay","maxWidth","events","onAfterPopupShow","setTimeout"],"mappings":";;;;;;;;AAAA,CAKO,MAAMA,aAAa,CAC1B;GACCC,WAAW,CAACC,MAAM,GAAG,EAAE,EACvB;KACC,IAAI,CAACC,SAAS,GAAGD,MAAM,CAACC,SAAS;KAEjC,IAAI,CAACC,cAAI,CAACC,SAAS,CAAC,IAAI,CAACF,SAAS,CAAC,EACnC;OACC;;KAGD,IAAI,CAACG,UAAU,GAAGJ,MAAM,CAACI,UAAU,IAAI,EAAE;KACzC,IAAI,CAACC,QAAQ,GAAGL,MAAM,CAACK,QAAQ,IAAI,EAAE;KAErC,IAAI,CAAC,IAAI,CAACD,UAAU,IAAI,CAAC,IAAI,CAACC,QAAQ,EACtC;OACC;;KAGD,IAAI,CAACC,KAAK,GAAGN,MAAM,CAACM,KAAK,IAAI,EAAE;KAC/B,IAAI,CAACC,QAAQ,GAAGP,MAAM,CAACO,QAAQ,IAAI,WAAW;KAC9C,IAAI,CAACC,UAAU,GAAGR,MAAM,CAACQ,UAAU,IAAI,EAAE;KACzC,IAAIC,mBAAmB,GAAGT,MAAM,CAACU,cAAc,IAAI,EAAE;KAErD,IAAI,IAAI,CAACJ,KAAK,CAACK,MAAM,KAAK,CAAC,EAC3B;OACC,QAAQ,IAAI,CAACP,UAAU;SAEtB,KAAK,MAAM;WAAE;aACZ,IAAI,CAACE,KAAK,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,gBAAgB,CAAC;aAEjE;;SAGD,KAAK,gBAAgB;WAAE;aACtB,IAAI,CAACA,KAAK,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,MAAM,CAAC;aAEvD;;SAGD,KAAK,WAAW;WAAE;aACjB,IAAI,CAACA,KAAK,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC;aAElC;;SAGD;WAAS;aACR,IAAI,CAACA,KAAK,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,MAAM,EAAE,gBAAgB,CAAC;;;;KAK5E,IAAI,CAACM,SAAS,GAAIC,MAAM,CAACC,GAAG,CAACC,EAAE,IAAIF,MAAM,CAACE,EAAG;KAC7C,IAAI,CAACC,QAAQ,GAAI,iBAAgB,IAAI,CAACZ,UAAU,GAAG,IAAI,CAACC,QAAS,GAAEY,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,GAAG,IAAI,CAAE,EAAC;KACrG,IAAI,CAACC,kBAAkB,GAAGC,oBAAU,CAACC,QAAQ,CAAE,GAAE,IAAI,CAACV,SAAU,YAAW,CAAC,GACzE,IAAI,CAACA,SAAS,CAACW,IAAI,CAACC,IAAI,CAACC,iBAAiB,EAAE,GAAG,IAAI;KACtD,IAAI,CAACC,eAAe,GAAG,CAAC;KAExB,IAAI,CAACxB,cAAI,CAACyB,aAAa,CAAClB,mBAAmB,CAAC,EAC5C;OACCA,mBAAmB,GAAG,EAAE;;KAGzB,IAAI,CAACC,cAAc,GAAG;OACrBkB,MAAM,EAAE,IAAI,CAACxB,UAAU;OACvB,GAAGK;MACH;KAED,IAAI,CAACoB,SAAS,GAAG7B,MAAM,CAAC6B,SAAS,IAAI,EAAE;KACvC,IAAI,CAAC3B,cAAI,CAACyB,aAAa,CAAC,IAAI,CAACE,SAAS,CAAC,EACvC;OACC,IAAI,CAACA,SAAS,GAAG,EAAE;;KAGpB,IAAI,CAACC,eAAe,GAAG9B,MAAM,CAAC8B,eAAe,IAAI,EAAE;KACnD,IAAI,CAACC,SAAS,GAAG/B,MAAM,CAAC+B,SAAS,KAAK,IAAI;KAE1C,IAAI,CAACC,YAAY,EAAE;KACnB,IAAI,CAACC,eAAe,EAAE;;GAGvBC,OAAO,GACP;KACC,IAAI,CAACtB,SAAS,CAACuB,KAAK,CAACC,YAAY,CAACC,WAAW,CAAC,yBAAyB,EAAE,IAAI,CAACC,cAAc,CAAC;KAC7F,IAAI,CAAC1B,SAAS,CAACuB,KAAK,CAACC,YAAY,CAACC,WAAW,CAAC,4BAA4B,EAAE,IAAI,CAACE,UAAU,CAAC;;GAG7FN,eAAe,GACf;KACC,IAAI,CAACrB,SAAS,CAACuB,KAAK,CAACC,YAAY,CAACI,SAAS,CAAC,yBAAyB,EAAE,IAAI,CAACF,cAAc,CAACG,IAAI,CAAC,IAAI,CAAC,CAAC;KACtG,IAAI,CAAC7B,SAAS,CAACuB,KAAK,CAACC,YAAY,CAACI,SAAS,CAAC,4BAA4B,EAAE,IAAI,CAACD,UAAU,CAACE,IAAI,CAAC,IAAI,CAAC,CAAC;;GAGtGH,cAAc,CAACI,KAAK,EACpB;KACC,IAAIA,KAAK,YAAY,IAAI,CAAC9B,SAAS,CAACuB,KAAK,CAACQ,SAAS,EACnD;OACC,MAAMC,IAAI,GAAGF,KAAK,CAACG,OAAO,EAAE;OAE5B,IAAID,IAAI,CAAC5B,QAAQ,KAAK,IAAI,CAACA,QAAQ,EACnC;SACC,MAAMhB,MAAM,GAAG;WACd8C,cAAc,EAAE,IAAI,CAAC1C,UAAU,CAAC2C,WAAW,EAAE;WAC7CC,gBAAgB,EAAE,IAAI,CAAC5C,UAAU,CAAC2C,WAAW,EAAE;WAC/CE,cAAc,EAAE,IAAI,CAAC5C,QAAQ;WAC7B6C,gBAAgB,EAAE,IAAI,CAAC1C,UAAU;WACjCJ,UAAU,EAAE,gBAAgB;WAC5BC,QAAQ,EAAEuC,IAAI,CAACO,YAAY,CAACC;UAC5B;SAED,IAAI,CAACC,gBAAgB,CAACrD,MAAM,CAAC;;;;GAKhCuC,UAAU,CAACG,KAAK,EAChB;KACC,MAAM,CAACY,WAAW,CAAC,GAAGZ,KAAK,CAACa,aAAa,EAAE;KAE3C,IAAID,WAAW,CAACE,UAAU,EAAE,KAAK,8BAA8B,EAC/D;OACC,MAAMZ,IAAI,GAAGU,WAAW,CAACT,OAAO,EAAE;OAClC,IAAID,IAAI,CAACa,kBAAkB,KAAK,IAAI,CAACzC,QAAQ,EAC7C;SACC,MAAMhB,MAAM,GAAG;WACd8C,cAAc,EAAE,IAAI,CAAC1C,UAAU,CAAC2C,WAAW,EAAE;WAC7CC,gBAAgB,EAAE,IAAI,CAAC5C,UAAU,CAAC2C,WAAW,EAAE;WAC/CE,cAAc,EAAE,IAAI,CAAC5C,QAAQ;WAC7B6C,gBAAgB,EAAE,IAAI,CAAC1C,UAAU;WACjCJ,UAAU,EAAE,WAAW;WACvBC,QAAQ,EAAEuC,IAAI,CAACc;UACf;SAED,IAAI,CAACL,gBAAgB,CAACrD,MAAM,CAAC;;;;GAKhCgC,YAAY,GACZ;KACC,MAAM2B,YAAY,GAAI,CAAC,IAAI,CAACvC,kBAAkB,IAAI,IAAI,CAACb,QAAQ,KAAK,MAAO;KAC3E,MAAMqD,YAAY,GAAID,YAAY,GAAG,IAAI,CAACE,QAAQ,CAACpB,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAACqB,cAAc,CAACrB,IAAI,CAAC,IAAI,CAAE;KAC/F,MAAMsB,WAAW,GAChBJ,YAAY,GACTK,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,GACjDD,aAAG,CAACC,UAAU,CAAC,uCAAuC,CACzD;KAED,IAAIC,WAAW,GAAG,EAAE;KACpB,IAAI,IAAI,CAACnC,SAAS,EAClB;OACCmC,WAAW,GAAG,kEAAkE;OAChF,IAAIP,YAAY,EAChB;SACCO,WAAW,IAAI,oCAAoC;QACnD,MAED;SACCA,WAAW,IAAI,sCAAsC;;MAEtD,MAED;OACCA,WAAW,GAAGP,YAAY,GAAG,uBAAuB,GAAG,yBAAyB;OAChFO,WAAW,IAAK,gEAA+D,IAAI,CAACpC,eAAgB,EAAC;;KAGtG,IAAI,CAACqC,MAAM,GACV,IAAI,CAAC7D,KAAK,CAACK,MAAM,GAAG,CAAC,GAClByD,aAAG,CAACC,MAAM,cAAC;gCACa,CAAc;6CACD,CAAe;mCACzB,CAAc;;6CAEJ,CAA2B;;KAElE,GAN4BH,WAAW,EACEN,YAAY,EACtBG,WAAW,EAED,IAAI,CAACO,QAAQ,CAAC7B,IAAI,CAAC,IAAI,CAAC,IAG/D2B,aAAG,CAACC,MAAM,gBAAC;6BACU,CAAc,cAAW,CAAe;kCACnC,CAAc;;KAE1C,GAHyBH,WAAW,EAAcN,YAAY,EAChCG,WAAW,CAG1C;KAEDQ,aAAG,CAACC,MAAM,CAAC,IAAI,CAACL,MAAM,EAAE,IAAI,CAAClE,SAAS,CAAC;;GAGxCwE,UAAU,GACV;KACCF,aAAG,CAACG,QAAQ,CAAC,IAAI,CAACP,MAAM,EAAE,aAAa,CAAC;;GAGzCQ,UAAU,GACV;KACCJ,aAAG,CAACK,WAAW,CAAC,IAAI,CAACT,MAAM,EAAE,aAAa,CAAC;;GAG5CU,iBAAiB,GACjB;KACC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;OACvC,MAAMC,cAAc,GAAGpE,MAAM,CAACqE,cAAc,CAACC,OAAO,CAAC,mCAAmC,CAAC;OACzF,IAAIF,cAAc,EAClB;SACCF,OAAO,CAACE,cAAc,CAAC;SAEvB;;OAGD,IAAI,CAACR,UAAU,EAAE;OAEjBW,cAAI,CAACC,SAAS,CAAC,0CAA0C,EAAE;SAC1DzC,IAAI,EAAE;QACN,CAAC,CAAC0C,IAAI,CAAEC,QAAQ,IAAK;SACrB1E,MAAM,CAACqE,cAAc,CAACM,OAAO,CAAC,mCAAmC,EAAED,QAAQ,CAAC3C,IAAI,CAAC;SACjF,IAAI,CAAC+B,UAAU,EAAE;SACjBI,OAAO,CAACQ,QAAQ,CAAC3C,IAAI,CAAC;QACtB,CAAC;MACF,CAAC;;GAGH0B,QAAQ,GACR;KACC,IAAI,CAACO,iBAAiB,EAAE,CAACS,IAAI,CAAEL,cAAc,IAAK;OACjD,IAAI,CAAC3E,KAAK,GAAG,IAAI,CAACA,KAAK,CAACmF,MAAM,CAAEC,IAAI,IAAK;SACxC,OAAQA,IAAI,IAAKT,cAAc,CAACU,QAAQ,CAACD,IAAI,CAAE;QAC/C,CAAC;OAEF,MAAME,SAAS,GAAG,EAAE;OAEpB,IAAI,CAACtF,KAAK,CAACuF,OAAO,CAAEH,IAAI,IAAK;;SAE5B,QAAQA,IAAI;WAEX,KAAK,WAAW;aACf,IAAI,IAAI,CAACtE,kBAAkB,EAC3B;eACCwE,SAAS,CAACE,IAAI,CAAC;iBACdC,IAAI,EAAE/B,aAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;iBAC5D+B,SAAS,EAAE,2BAA2B;iBACtCC,OAAO,EAAE,MAAM;mBACd,IAAI,CAACnC,cAAc,EAAE;mBACrB,IAAI,CAACoC,SAAS,CAACC,KAAK,EAAE;;gBAEvB,CAAC;;aAEH;WAED,KAAK,MAAM;aACVP,SAAS,CAACE,IAAI,CAAC;eACdC,IAAI,EAAE/B,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;eACvD+B,SAAS,EAAE,sBAAsB;eACjCC,OAAO,EAAE,MAAM;iBACd,IAAI,CAACpC,QAAQ,EAAE;iBACf,IAAI,CAACqC,SAAS,CAACC,KAAK,EAAE;;cAEvB,CAAC;aACF;WAED,KAAK,MAAM;aACVP,SAAS,CAACE,IAAI,CAAC;eACdC,IAAI,EAAE/B,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;eACvD+B,SAAS,EAAE,sBAAsB;eACjCC,OAAO,EAAE,MAAM;iBACd,IAAI,CAACG,cAAc,EAAE;iBACrB,IAAI,CAACF,SAAS,CAACC,KAAK,EAAE;;cAEvB,CAAC;aACF;WAED,KAAK,gBAAgB;aACpBP,SAAS,CAACE,IAAI,CAAC;eACdC,IAAI,EAAE/B,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;eAC1D+B,SAAS,EAAE,yBAAyB;eACpCC,OAAO,EAAE,MAAM;iBACd,IAAI,CAACI,kBAAkB,EAAE;iBACzB,IAAI,CAACH,SAAS,CAACC,KAAK,EAAE;;cAEvB,CAAC;aACF;WAED,KAAK,WAAW;aACfP,SAAS,CAACE,IAAI,CAAC;eACdC,IAAI,EAAE/B,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;eACvD+B,SAAS,EAAE,sBAAsB;eACjCC,OAAO,EAAE,MAAM;iBACd,IAAI,CAACK,cAAc,EAAE;iBACrB,IAAI,CAACJ,SAAS,CAACC,KAAK,EAAE;;cAEvB,CAAC;aACF;;QAEF,CAAC;OAEF,IAAI,CAACD,SAAS,GAAG,IAAIK,eAAI,CAAC;SACzBC,WAAW,EAAE,IAAI,CAACrC,MAAM;SACxB7D,KAAK,EAAEsF,SAAS;SAChBa,UAAU,EAAE,EAAE;SACdC,SAAS,EAAE;QACX,CAAC;OAEF,IAAI,CAACR,SAAS,CAACS,IAAI,EAAE;MACrB,CAAC;;GAGH9C,QAAQ,GACR;KACC,IAAI,CAACY,UAAU,EAAE;KAEjB,MAAM5C,SAAS,GAAG,IAAI,CAACA,SAAS,CAACgC,QAAQ,IAAI,EAAE;KAE/CuB,cAAI,CAACC,SAAS,CAAC,gCAAgC,EAAE,IAAI,CAACuB,aAAa,CAAC/E,SAAS,CAAC,CAAC,CAACyD,IAAI,CAAEC,QAAQ,IAAK;OAClG,IAAIA,QAAQ,CAAC3C,IAAI,EACjB;SACCiE,0BAAS,CAAChD,QAAQ,CAAE,OAAMiD,QAAQ,CAACvB,QAAQ,CAAC3C,IAAI,EAAE,EAAE,CAAE,EAAC,CAAC;;OAGzD,IAAI,CAAClB,eAAe,GAAG,CAAC;OACxB,IAAI,CAACiD,UAAU,EAAE;MACjB,EAAGY,QAAQ,IAAK;OAChB,IAAIA,QAAQ,CAACwB,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,KAAK,YAAY,IAAI,IAAI,CAACtF,eAAe,GAAG,CAAC,EACxE;SACC,IAAI,CAACA,eAAe,EAAE;SACtB,IAAI,CAACmC,QAAQ,EAAE;QACf,MAED;SACC,IAAI,CAACoD,aAAa,CAAC1B,QAAQ,CAACwB,MAAM,CAAC,CAAC,CAAC,CAACG,OAAO,CAAC;SAC9C,IAAI,CAACvC,UAAU,EAAE;;MAElB,CAAC;;GAGHb,cAAc,CAACqD,gBAAgB,GAAG,IAAI,EACtC;KACC,IAAI,CAAC1C,UAAU,EAAE;KAEjB,MAAM5C,SAAS,GAAG,IAAI,CAACA,SAAS,CAACiC,cAAc,IAAI,EAAE;KACrD,IACC5D,cAAI,CAACyB,aAAa,CAACE,SAAS,CAAC,IAC1B3B,cAAI,CAACkH,cAAc,CAACvF,SAAS,CAACwF,aAAa,CAAC,IAC5CF,gBAAgB,EAEpB;OACCtF,SAAS,CAACwF,aAAa,GAAGF,gBAAgB;;KAG3C/B,cAAI,CAACC,SAAS,CAAC,yCAAyC,EAAE,IAAI,CAACuB,aAAa,CAAC/E,SAAS,CAAC,CAAC,CAACyD,IAAI,CAAEC,QAAQ,IAAK;OAC3G,IAAIA,QAAQ,CAAC3C,IAAI,EACjB;SACCiE,0BAAS,CAAC/C,cAAc,CAAE,OAAMyB,QAAQ,CAAC3C,IAAK,EAAC,EAAE,IAAI,CAAC;;OAGvD,IAAI,CAAClB,eAAe,GAAG,CAAC;OACxB,IAAI,CAACiD,UAAU,EAAE;MACjB,EAAGY,QAAQ,IAAK;OAChB,IAAIA,QAAQ,CAACwB,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,KAAK,YAAY,IAAI,IAAI,CAACtF,eAAe,GAAG,CAAC,EACxE;SACC,IAAI,CAACA,eAAe,EAAE;SACtB,IAAI,CAACoC,cAAc,EAAE;QACrB,MAED;SACC,IAAI,CAACmD,aAAa,CAAC1B,QAAQ,CAACwB,MAAM,CAAC,CAAC,CAAC,CAACG,OAAO,CAAC;SAC9C,IAAI,CAACvC,UAAU,EAAE;;MAElB,CAAC;;GAGHtB,gBAAgB,CAACrD,MAAM,EACvB;KACCoF,cAAI,CAACC,SAAS,CAAC,gDAAgD,EAAE;OAChEzC,IAAI,EAAE;SACL5C;;MAED,CAAC;;GAGHqG,kBAAkB,GAClB;KACC,IAAI,CAAC5B,UAAU,EAAE;KAEjB,MAAM5C,SAAS,GAAG,IAAI,CAACA,SAAS,CAACwE,kBAAkB,IAAI,EAAE;KAEzDjB,cAAI,CAACC,SAAS,CAAC,wCAAwC,EAAE,IAAI,CAACuB,aAAa,CAAC/E,SAAS,CAAC,CAAC,CAACyD,IAAI,CAAEC,QAAQ,IAAK;OAC1G,IAAI+B,KAAK,GAAG,EAAE;OAEd,IAAIpH,cAAI,CAACqH,WAAW,CAAChC,QAAQ,CAAC3C,IAAI,CAAC4E,OAAO,CAAC,EAC3C;SACCF,KAAK,GAAG/B,QAAQ,CAAC3C,IAAI,CAAC4E,OAAO,CAACC,GAAG,CAAEC,MAAM,IAAK;WAC7C,OAAO;aAAEC,EAAE,EAAEb,QAAQ,CAACY,MAAM,EAAE,EAAE,CAAC;aAAErH,QAAQ,EAAE;YAAQ;UACrD,CAAC;;OAGH,IAAI,CAACQ,MAAM,CAACC,GAAG,CAACC,EAAE,IAAIF,MAAM,CAACE,EAAE,EAAE6G,QAAQ,CAACC,YAAY,CACrD,CAAC,EACD;SACC7G,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB8G,sBAAsB,EAAER,KAAK;SAC7BS,SAAS,EAAExC,QAAQ,CAAC3C,IAAI,CAACoF,IAAI;SAC7BC,gBAAgB,EAAE1C,QAAQ,CAAC3C,IAAI,CAACsF;QAChC,CACD,CAACvB,IAAI,EAAE;OAER,IAAI,CAAChC,UAAU,EAAE;MACjB,CAAC;;GAGHyB,cAAc,GACd;KACC,IAAI,CAAC3B,UAAU,EAAE;KAEjB,MAAM5C,SAAS,GAAG,IAAI,CAACA,SAAS,CAACuE,cAAc,IAAI,EAAE;KAErDhB,cAAI,CAACC,SAAS,CAAC,oCAAoC,EAAE,IAAI,CAACuB,aAAa,CAAC/E,SAAS,CAAC,CAAC,CAACyD,IAAI,CAAEC,QAAQ,IAAK;OACtGxE,EAAE,CAACoH,SAAS,CAACC,QAAQ,CAACC,IAAI,CAAC9C,QAAQ,CAAC3C,IAAI,CAAC0F,IAAI,EAAE;SAC9CC,aAAa,EAAE,MAAM;SACrBC,aAAa,EAAEjD,QAAQ,CAAC3C;QACxB,CAAC;OACF,IAAI,CAAC+B,UAAU,EAAE;MACjB,CAAC;;GAGH2B,cAAc,GACd;KACC,IAAI,CAAC7B,UAAU,EAAE;KAEjB,MAAM5C,SAAS,GAAG,IAAI,CAACA,SAAS,CAACyE,cAAc,IAAI,EAAE;KAErDlB,cAAI,CAACC,SAAS,CAAC,oCAAoC,EAAE,IAAI,CAACuB,aAAa,CAAC/E,SAAS,CAAC,CAAC,CAACyD,IAAI,CAAEC,QAAQ,IAAK;OACtGxE,EAAE,CAACoH,SAAS,CAACC,QAAQ,CAACC,IAAI,CACzB9C,QAAQ,CAAC3C,IAAI,CAAC0F,IAAI,EAClB;SACCC,aAAa,EAAE,MAAM;SACrBC,aAAa,EAAE;WACdC,UAAU,EAAElD,QAAQ,CAAC3C,IAAI,CAAC8F,KAAK;WAC/BC,YAAY,EAAEpD,QAAQ,CAAC3C,IAAI,CAACsE,OAAO;WACnC0B,MAAM,EAAErD,QAAQ,CAAC3C,IAAI,CAACgG;UACtB;SACDhG,IAAI,EAAE;WACL5B,QAAQ,EAAE,IAAI,CAACA;;QAEhB,CACD;OACD,IAAI,CAAC2D,UAAU,EAAE;MACjB,CAAC;;GAGHiC,aAAa,CAAC/E,SAAS,EACvB;KACC,MAAMgH,MAAM,GAAG;OACdjG,IAAI,EAAE;SACLxC,UAAU,EAAE,IAAI,CAACA,UAAU;SAC3BC,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBG,UAAU,EAAE,IAAI,CAACA;;MAElB;KAED,IACCN,cAAI,CAACyB,aAAa,CAACE,SAAS,CAAC,IAC1B3B,cAAI,CAACkH,cAAc,CAACvF,SAAS,CAACa,KAAK,CAAC,IACpCxC,cAAI,CAACkH,cAAc,CAACvF,SAAS,CAACiH,IAAI,CAAC,EAEvC;OACCD,MAAM,CAAChH,SAAS,GAAGA,SAAS;MAC5B,MAED;OACCgH,MAAM,CAACnI,cAAc,GAAG,IAAI,CAACA,cAAc;;KAG5C,OAAOmI,MAAM;;GAGd5B,aAAa,CAACC,OAAO,EACrB;KACC,IAAI,CAACA,OAAO,EACZ;OACC;;KAGD,IAAI6B,gBAAK,CAAE,aAAYC,cAAI,CAACC,SAAS,CAAC,CAAC,CAAE,EAAC,EAAE,IAAI,CAAC9E,MAAM,EAAE;OACxD+E,OAAO,EAAEhC,OAAO;OAChBiC,MAAM,EAAE,KAAK;OACbC,KAAK,EAAE,IAAI;OACX1C,SAAS,EAAE,CAAC;OACZD,UAAU,EAAE,EAAE;OACd4C,SAAS,EAAE,KAAK;OAChBC,QAAQ,EAAE,IAAI;OACdC,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE,KAAK;OACdC,QAAQ,EAAE,GAAG;OACbC,MAAM,EAAE;SACPC,gBAAgB,GAAG;WAClBC,UAAU,CAAC,MAAM;aAChB,IAAI,CAACzD,KAAK,EAAE;YACZ,EAAE,IAAI,CAAC;;;MAGV,CAAC,CAACQ,IAAI,EAAE;;CAEX;;;;;;;;"}