this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,s,r,i,a,o,n,l,d,c,T){"use strict";var _=babelHelpers.classPrivateFieldLooseKey("fieldId");var E=babelHelpers.classPrivateFieldLooseKey("gridId");class I{constructor(e){var t;Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e.fieldId;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=(t=e.gridId)!=null?t:null}getGridId(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}getFieldId(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}getGrid(){var e;let t=null;if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]){t=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldLooseBase(this,E)[E])}return(e=t)==null?void 0:e.instance}getFieldNode(){return document.getElementById(this.getFieldId())}appendToFieldNode(e){T.Dom.append(e,this.getFieldNode())}}class u extends I{render(e){var s;const r={size:40,userpicPath:e.photoUrl?e.photoUrl:null};let i=null;if(e.role==="collaber"){i=new t.AvatarRoundGuest(r)}else if(e.role==="extranet"){i=new t.AvatarRoundExtranet(r)}else{i=new t.AvatarRound(r)}(s=i)==null?void 0:s.renderTo(this.getFieldNode());T.Dom.addClass(this.getFieldNode(),"user-grid_user-photo")}}let g=e=>e,N,p,A,S,R,L,h;var C=babelHelpers.classPrivateFieldLooseKey("getFullNameLink");var O=babelHelpers.classPrivateFieldLooseKey("getInvitedLabelContainer");var U=babelHelpers.classPrivateFieldLooseKey("getWaitingConfirmationLabelContainer");var M=babelHelpers.classPrivateFieldLooseKey("getPositionLabelContainer");var P=babelHelpers.classPrivateFieldLooseKey("getIntegratorBalloonContainer");var v=babelHelpers.classPrivateFieldLooseKey("getAdminBalloonContainer");var b=babelHelpers.classPrivateFieldLooseKey("getExtranetBalloonContainer");var B=babelHelpers.classPrivateFieldLooseKey("getCollaberBalloonContainer");class f extends I{constructor(...e){super(...e);Object.defineProperty(this,B,{value:k});Object.defineProperty(this,b,{value:x});Object.defineProperty(this,v,{value:G});Object.defineProperty(this,P,{value:y});Object.defineProperty(this,M,{value:w});Object.defineProperty(this,U,{value:D});Object.defineProperty(this,O,{value:F});Object.defineProperty(this,C,{value:m})}render(e){const t=T.Tag.render(N||(N=g`
			<div class="user-grid_full-name-container">${0}</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,C)[C](e.fullName,e.profileLink));if(e.position){T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,M)[M](T.Text.encode(e.position)),t)}switch(e.role){case"integrator":T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,P)[P](),t);break;case"admin":T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,v)[v](),t);break;case"extranet":T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,b)[b](),t);break;case"collaber":T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,B)[B](),t);break;default:break}switch(e.inviteStatus){case"INVITE_AWAITING_APPROVE":T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,U)[U](),t);break;case"INVITED":T.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,O)[O](),t);break;default:break}this.appendToFieldNode(t)}}function m(e,t){return T.Tag.render(p||(p=g`
			<a class="user-grid_full-name-label" href="${0}">
				${0}
			</a>
		`),t,e)}function F(){const e=new s.Label({text:T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INVITATION_NOT_ACCEPTED"),color:s.LabelColor.LIGHT_BLUE,fill:true,size:s.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function D(){const e=new s.Label({text:T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_NOT_CONFIRMED"),color:s.LabelColor.YELLOW,fill:true,size:s.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function w(e){return T.Tag.render(A||(A=g`<div class="user-grid_position-label">${0}</div>`),e)}function y(){return T.Tag.render(S||(S=g`
			<span class="user-grid_role-label --integrator">
				${0}
			</span>
		`),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INTEGRATOR"))}function G(){return T.Tag.render(R||(R=g`
			<span class="user-grid_role-label --admin">
				${0}
			</span>
		`),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADMIN"))}function x(){return T.Tag.render(L||(L=g`
			<span class="user-grid_role-label --extranet">
				${0}
			</span>
		`),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_EXTRANET"))}function k(){return T.Tag.render(h||(h=g`
			<span class="user-grid_role-label --collaber">
				${0}
			</span>
		`),T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_COLLABER"))}let X=e=>e,j,H;class K extends I{render(e){const t=T.Text.getRandom(6);const s=T.Text.getRandom(6);this.appendToFieldNode(T.Tag.render(j||(j=X`<span id="${0}"></span>`),t));this.appendToFieldNode(T.Tag.render(H||(H=X`<span class="user-grid_full-name-wrapper" id="${0}"></span>`),s));new u({fieldId:t}).render(e);new f({fieldId:s}).render(e);T.Dom.addClass(this.getFieldNode(),"user-grid_employee-card-container")}}var Y=babelHelpers.classPrivateFieldLooseKey("grid");class V{constructor(e){var t;Object.defineProperty(this,Y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=(t=BX.Main.gridManager.getById(e))==null?void 0:t.instance}static getInstance(e){if(!this.instances[e]){this.instances[e]=new V(e)}return this.instances[e]}static setSort(e){var t;const s=(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance;if(T.Type.isObject(s)){s.tableFade();s.getUserOptions().setSort(e.sortBy,e.order,(()=>{s.reload()}))}}static setFilter(e){var t;const s=(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance;const r=BX.Main.filterManager.getById(e.gridId);if(T.Type.isObject(s)&&T.Type.isObject(r)){r.getApi().extendFilter(e.filter)}}static reinviteCloudAction(e){return BX.ajax.runAction("intranet.invite.reinviteWithChangeContact",{data:e}).then((e=>{if(e.data.result){const e=new BX.PopupWindow({content:`<p>${T.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS")}</p>`,autoHide:true});e.show()}return e}),(e=>{const t=e.errors.map((e=>e.message));r.ErrorCollection.showSystemError(t.join("<br>"));return e}))}static reinviteAction(e,t){return BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:e,extranet:t?"Y":"N"}}}).then((e=>{if(e.data.result){const e=new BX.PopupWindow({content:`<p>${T.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS")}</p>`,autoHide:true});e.show()}return e}))}getGrid(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}confirmAction(e){if(e.userId){this.confirmUser(e.isAccept?"confirm":"decline",(()=>{const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getRows().getById(e.userId);t==null?void 0:t.stateLoad();BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{data:{userId:e.userId,isAccept:e.isAccept?"Y":"N"}}).then((e=>{t==null?void 0:t.update()})).catch((s=>{t==null?void 0:t.stateUnload();if(!e.isAccept){this.activityAction({userId:e.userId,action:"deactivateInvited"})}}))}))}}activityAction(e){var t,s;const r=(t=e.userId)!=null?t:null;const i=(s=e.action)!=null?s:null;if(r){this.confirmUser(i,(()=>{const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getRows().getById(e.userId);t==null?void 0:t.stateLoad();if(i==="restore"||i==="fire"){BX.ajax.runAction(`intranet.user.${i}`,{data:{userId:r}}).then((()=>{t==null?void 0:t.update()}));return}BX.ajax.runComponentAction("bitrix:intranet.user.list","setActivity",{mode:"class",data:{params:{userId:r,action:i}}}).then((()=>{t==null?void 0:t.update()})).catch((e=>{t==null?void 0:t.stateUnload();if(BX.type.isNotEmptyObject(e)&&BX.type.isArray(e.errors)&&i==="delete"){return this.activityAction({action:"deactivateInvited",userId:r})}}))}))}}confirmUser(e,t){var s,r;l.MessageBox.show({title:(s=this.getConfirmTitle(e))!=null?s:"",message:(r=this.getConfirmMessage(e))!=null?r:"",buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:this.getConfirmButtonText(e),onYes:e=>{t();e.close()}})}getConfirmTitle(e){switch(e){case"restore":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_TITLE");case"confirm":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_TITLE");case"delete":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_TITLE");case"fire":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_TITLE");case"deactivateInvited":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_TITLE");case"decline":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_TITLE");default:return""}}getConfirmMessage(e){switch(e){case"restore":case"confirm":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_MESSAGE");case"delete":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_MESSAGE");case"fire":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_MESSAGE");case"deactivateInvited":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_MESSAGE");case"decline":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_MESSAGE");default:return""}}getConfirmButtonText(e){switch(e){case"restore":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_BUTTON");case"confirm":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_BUTTON");case"delete":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_BUTTON");case"fire":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_BUTTON");case"deactivateInvited":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON");case"decline":return T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_BUTTON");default:return null}}}V.instances=[];let W=e=>e,$;var z=babelHelpers.classPrivateFieldLooseKey("updateData");var J=babelHelpers.classPrivateFieldLooseKey("onClick");var q=babelHelpers.classPrivateFieldLooseKey("actionFactory");var Q=babelHelpers.classPrivateFieldLooseKey("inviteAction");var Z=babelHelpers.classPrivateFieldLooseKey("acceptAction");class ee extends I{constructor(...e){super(...e);Object.defineProperty(this,Z,{value:ae});Object.defineProperty(this,Q,{value:ie});Object.defineProperty(this,q,{value:re});Object.defineProperty(this,J,{value:se});Object.defineProperty(this,z,{value:te})}render(e){var t;let s="";let r="";switch((t=e.action)!=null?t:"invite"){case"accept":s=T.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_ACCEPT_ENTER");r=BX.UI.Button.Color.PRIMARY;break;case"invite":default:s=T.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_INVITE_AGAIN");r=BX.UI.Button.Color.LIGHT_BORDER;break}const i=T.Tag.render($||($=W`
			<div class="ui-counter user-grid_invitation-counter">
				<div class="ui-counter-inner">1</div>
			</div>
		`));T.Dom.append(i,this.getFieldNode());const a=new BX.UI.Button({text:s,color:r,noCaps:true,size:BX.UI.Button.Size.EXTRA_SMALL,tag:BX.UI.Button.Tag.INPUT,round:true,onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,J)[J](e,a)}});a.renderTo(this.getFieldNode())}}function te(e){var t;const s=(t=V.getInstance(this.gridId).getGrid())==null?void 0:t.getRows().getById(this.userId);s==null?void 0:s.stateLoad();V.reinviteCloudAction(e).then((e=>{s==null?void 0:s.update();s==null?void 0:s.stateUnload()}))}function se(e,t){if(!e.enabled){const e=BX.PopupWindowManager.create("intranet-user-grid-invitation-disabled",null,{darkMode:true,content:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_DISABLED"),closeByEsc:true,angle:true,offsetLeft:40,maxWidth:300,overlay:false,autoHide:true});e.setBindElement(t.getContainer());e.show()}else{babelHelpers.classPrivateFieldLooseBase(this,q)[q](e.action).call(this,e,t)}}function re(e){switch(e){case"accept":return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z];break;case"invite":return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q];default:return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q];break}}function ie(e,t){if(e.isCloud===true){var s,r;const i=new o.ReinvitePopup({userId:e.userId,transport:babelHelpers.classPrivateFieldLooseBase(this,z)[z].bind(e),formType:e.email?o.FormType.EMAIL:o.FormType.PHONE,bindElement:t.getContainer(),inputValue:(s=(r=e.email)!=null?r:e.phoneNumber)!=null?s:""});i.getPopup().setBindElement(t.getContainer());i.show()}else{t.setWaiting(true);V.reinviteAction(e.userId,e.isExtranet).then((()=>{t.setWaiting(false)}))}}function ae(e,t){V.getInstance(e.gridId).confirmAction({isAccept:true,userId:e.userId})}let oe=e=>e,ne,le,de;class ce extends I{render(e){T.Dom.addClass(this.getFieldNode(),"user-grid_department-container");if(e.departments.length===0&&e.canEdit){return;const e=()=>{const e=new c.Dialog({width:300,height:300,targetNode:t,compactView:true,multiple:false,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});e.show()};const t=T.Tag.render(ne||(ne=oe`
				<div class="user-grid_department-btn" onclick="${0}">
					<div class="user-grid_department-icon-container">
						<div class="ui-icon-set --plus-30" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: #2fc6f6;"></div>
					</div>
					<div class="user-grid_department-name-container">
						${0}
					</div>
				</div>
			`),e,T.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADD_DEPARTMENT"));this.appendToFieldNode(t)}else{Object.values(e.departments).forEach((t=>{const s=t.id===e.selectedDepartment;const r=()=>{V.setFilter({gridId:this.getGridId(),filter:{DEPARTMENT:s?"":t.id,DEPARTMENT_label:s?"":t.name}})};const i=T.Tag.render(le||(le=oe`
					<div
						class="user-grid_department-btn ${0}"
						onclick="${0}"
						>
						<div class="user-grid_department-name-container">
							${0}
						</div>
					</div>
				`),s?"--selected":"",r,t.name);if(s){T.Dom.append(T.Tag.render(de||(de=oe`
						<div class="user-grid_department-btn-remove ui-icon-set --cross-60"></div>
					`)),i)}this.appendToFieldNode(i)}))}}}class Te{static getActionId(){throw new Error("not implemented")}getAjaxMethod(){throw new Error("not implemented")}constructor(e){var t;this.grid=e.grid;this.userFilter=e.filter;this.selectedUsers=e.selectedUsers;this.showPopups=(t=e.showPopups)!=null?t:true;this.isCloud=e.isCloud}execute(){const e=this.showPopups?this.getConfirmationPopup():null;if(e){e.setOkCallback((()=>{this.sendActionRequest();e.close()}));e.show()}else{this.sendActionRequest()}}getConfirmationPopup(){return null}sendActionRequest(){var e;this.grid.tableFade();const t=(e=this.selectedUsers)!=null?e:this.grid.getRows().getSelectedIds();const s=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:t,isSelectedAllRows:s,filter:this.userFilter}}}).then((e=>this.handleSuccess(e))).catch((e=>this.handleError(e)))}handleSuccess(e){this.grid.reload();if(this.showPopups){const{skippedActiveUsers:t,skippedFiredUsers:s}=e.data;if(t&&Object.keys(t).length>0){this.showActiveUsersPopup(t)}else if(s&&Object.keys(s).length>0){this.showFiredUsersPopup(s)}}}handleError(e){this.grid.tableUnfade();this.unselectRows(this.grid);console.error(e);if(this.showPopups&&e.errors&&e.errors.length>0){const t=e.errors.map((e=>e.message)).join(", ");l.MessageBox.show({message:t,buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}}showActiveUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage(this.getSkippedUsersTitleCode()),message:this.getMessageWithProfileNames(this.getSkippedUsersMessageCode(),e),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}showFiredUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE",e),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getMessageWithProfileNames(e,t){const s=5;const r=Object.values(t);const i=r.slice(0,s).map((e=>e.fullName));const a=r.length-s;const o=i.join(", ");if(i.length<2&&a<1){return T.Loc.getMessage(`${e}_SINGLE`,{"#USER#":o})}if(a>0){return T.Loc.getMessage(`${e}_REMAINING`,{"#USER_LIST#":o,"#USER_REMAINING#":a})}return T.Loc.getMessage(e,{"#USER_LIST#":o})}getSkippedUsersTitleCode(){return""}getSkippedUsersMessageCode(){return""}unselectRows(e){e.getRows().unselectAll();e.updateCounterDisplayed();e.updateCounterSelected();e.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}}class _e extends Te{static getActionId(){return"fire"}getConfirmationPopup(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_BUTTON")})}getAjaxMethod(){return"intranet.controller.user.userlist.groupFire"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"}}class Ee extends Te{static getActionId(){return"delete"}getAjaxMethod(){return"intranet.controller.user.userlist.groupDelete"}getConfirmationPopup(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_BUTTON")})}showActiveUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",e),buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:t=>{t.close();new _e({selectedUsers:Object.keys(e),grid:this.grid,filter:this.userFilter,showPopups:false}).execute()},onNo:()=>{this.grid.reload()}})}showFiredUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_MESSAGE",e),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE"}}class Ie extends Te{static getActionId(){return"confirm"}getConfirmationPopup(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON")})}handleSuccess(e){this.grid.reload();if(this.showPopups){const{skippedFiredUsers:t}=e.data;if(t&&Object.keys(t).length>0){this.showFiredUsersPopup(t)}}}showFiredUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",e),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getAjaxMethod(){return"intranet.controller.user.userlist.groupConfirm"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}class ue extends Te{static getActionId(){return"decline"}getConfirmationPopup(){return new l.MessageBox({message:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE"),title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_TITLE"),buttons:l.MessageBoxButtons.OK_CANCEL,okCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_BUTTON")})}showActiveUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",e),buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:t=>{t.close();new _e({selectedUsers:Object.keys(e),grid:this.grid,filter:this.userFilter,showPopups:false}).execute()}})}getAjaxMethod(){return"intranet.controller.user.userlist.groupDecline"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}class ge extends Te{static getActionId(){return"reInvite"}getAjaxMethod(){return"intranet.controller.user.userlist.groupReInvite"}handleSuccess(e){this.grid.tableUnfade();const{skippedActiveUsers:t,skippedFiredUsers:s,skippedWaitingUsers:r}=e.data;if(t&&Object.keys(t).length>0){this.showActiveUsersPopup(t)}else if(r&&Object.keys(r).length>0){this.showWaitingUsersPopup(r)}else if(s&&Object.keys(s).length>0){this.showFiredUsersPopup(s)}else{var i,a;BX.UI.Notification.Center.notify({content:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_REINVITE_SUCCESS"),autoHide:true,position:"bottom-right",category:"menu-self-item-popup",autoHideDelay:3e3});(i=BX.Bitrix24)==null?void 0:(a=i.EmailConfirmation)==null?void 0:a.showPopupDispatched()}this.unselectRows(this.grid)}showWaitingUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_MESSAGE",e),buttons:l.MessageBoxButtons.YES_CANCEL,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON"),onYes:t=>{t.close();new Ie({grid:this.grid,filter:this.userFilter,selectedUsers:Object.keys(e),showPopups:false}).execute()}})}showFiredUsersPopup(e){l.MessageBox.show({title:T.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",e),buttons:l.MessageBoxButtons.YES,yesCaption:T.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}class Ne extends Te{static getActionId(){return"createChat"}getAjaxMethod(){return"intranet.controller.user.userlist.createChat"}handleSuccess(e){this.grid.tableUnfade();const t=e.data;d.Messenger.openChat(`chat${t}`);this.unselectRows(this.grid)}}let pe=e=>e,Ae;class Se extends Te{static getActionId(){return"changeDepartment"}getAjaxMethod(){return"intranet.controller.user.userlist.groupChangeDepartment"}execute(){const e=new BX.UI.SaveButton({onclick:()=>{const e=r.getSelectedItems().map((e=>e.id));r.hide();if(e.length>0){this.sendChangeDepartmentRequest(e)}else{this.unselectRows(this.grid)}},size:BX.UI.Button.Size.SMALL});const t=new BX.UI.CancelButton({onclick:()=>{r.hide()},size:BX.UI.Button.Size.SMALL});const s=T.Tag.render(Ae||(Ae=pe`<span></span>`));e.renderTo(s);t.renderTo(s);const r=new c.Dialog({dropdownMode:true,enableSearch:true,compactView:true,multiple:true,footer:s,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});r.show()}sendChangeDepartmentRequest(e){var t;this.grid.tableFade();const s=(t=this.selectedUsers)!=null?t:this.grid.getRows().getSelectedIds();const r=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:s,isSelectedAllRows:r,filter:this.userFilter,departmentIds:e}}}).then((e=>this.handleSuccess(e))).catch((e=>this.handleError(e)))}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_TITLE"}getSkippedUsersMessageCode(){return this.isCloud?"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE_CLOUD":"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE"}}const Re=[Ee,_e,Ie,ue,ge,Ne,Se];class Le{static createAction(e,t){const s=Re.find((t=>t.getActionId()===e));if(!s){throw new Error(`Unknown actionId: ${e}`)}return new s(t)}}class he{static executeAction(e){try{var t;const s=Le.createAction(e.actionId,{grid:(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance,filter:e.filter,isCloud:e.isCloud});s.execute()}catch(e){console.error("Error executing action:",e)}}}e.BaseField=I;e.PhotoField=u;e.FullNameField=f;e.EmployeeField=K;e.ActivityField=ee;e.DepartmentField=ce;e.GridManager=V;e.Panel=he})(this.BX.Intranet.UserList=this.BX.Intranet.UserList||{},BX.UI,BX.UI,BX.UI.FormElements,BX.Main,BX.UI,BX.Intranet.Reinvite,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.UI.EntitySelector,BX);
//# sourceMappingURL=grid.bundle.map.js