this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,i,a,s,n,l,o,r,c,d,p,u,_,v,h){"use strict";const g={itemClick:"crm:copilot:call-assessment:breadcrumb-item-click"};const T={props:{activeTabId:{type:String}},data(){return{tabs:this.getTabsData()}},methods:{itemTitleClassList(t,e){return["crm-copilot__call-assessment_breadcrumbs-item-title",{"--active":t===this.activeTabId},{"--soon":e}]},getTab(t){return this.getTabsData().find((e=>e.id===t))},getTabsData(){return[{id:"about",title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT")},{id:"client",title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT")},{id:"settings",title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS")},{id:"control",title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL")}]},emitClickEvent(t){const e=this.getTab(t);if(!e.soon){this.$Bitrix.eventEmitter.emit(g.itemClick,{itemId:t})}}},computed:{soonTitle(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_BREADCRUMBS_SOON")}},template:`\n\t\t<div class="crm-copilot__call-assessment_breadcrumbs-wrapper">\n\t\t\t<div\n\t\t\t\tv-for="(tab, index) in tabs"\n\t\t\t\t@click="emitClickEvent(tab.id)"\n\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-item"\n\t\t\t>\n\t\t\t\t<span v-if="tab.soon" class="crm-copilot__call-assessment_breadcrumbs-soon">\n\t\t\t\t\t{{ soonTitle }}\n\t\t\t\t</span>\n\t\t\t\t<span :class="itemTitleClassList(tab.id, tab.soon)">\n\t\t\t\t\t{{ tab.title }}\n\t\t\t\t</span>\n\t\t\t\t<span \n\t\t\t\t\tv-if="index+1 < tabs.length"\n\t\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-divider"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t</div>\n\t`};const m={click:"crm:copilot:call-assessment:navigation-button-click"};const y={props:{id:{type:String,required:true},isEnabled:{type:Boolean,default:true}},mounted(){this.initButton()},watch:{isEnabled(t){this.button.setState(t?a.ButtonState.ACTIVE:a.ButtonState.DISABLED)}},methods:{initButton(){this.button=new a.Button({text:h.Loc.getMessage(`CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_BUTTON_${this.id.toUpperCase()}`),color:this.buttonColor,round:true,size:BX.UI.Button.Size.LARGE,onclick:()=>{this.emitClickEvent()}});if(this.isEnabled!==true){this.button.setState(a.ButtonState.DISABLED)}this.button.setDataSet({id:`crm-copilot-call-assessment-buttons-${this.id.toLowerCase()}`});if(this.$refs.button){this.button.renderTo(this.$refs.button)}},emitClickEvent(){if(this.isEnabled){this.$Bitrix.eventEmitter.emit(m.click,{id:this.id})}}},computed:{buttonColor(){if(this.id==="continue"||this.id==="submit"||this.id==="close"){return a.Button.Color.SUCCESS}if(this.id==="update"){return a.Button.Color.LIGHT_BORDER}return a.Button.Color.LIGHT}},template:`\n\t\t<div ref="button" class="crm-copilot-call-assessment-button"></div>\n\t`};const E="23240682";const S={components:{Button:y},props:{activeTabId:{type:String},isEnabled:{type:Boolean},readOnly:{type:Boolean,default:false},showSaveButton:{type:Boolean,default:false}},data(){return{firstPage:"about",lastPage:"control"}},computed:{help(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_HELP")},buttons(){return["cancel","back","continue","submit","close","update"]}},methods:{showArticle(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${E}`)}},template:`\n\t\t<div class="crm-copilot__call-assessment_navigation-container">\n\t\t\t<div class="crm-copilot__call-assessment_navigation-buttons-wrapper">\n\t\t\t\t<Button v-if="activeTabId !== lastPage" id="continue" :is-enabled="isEnabled" />\n\t\t\t\t<Button v-if="activeTabId === lastPage && !readOnly" id="submit" />\n\t\t\t\t<Button v-if="activeTabId === lastPage && readOnly" id="close" />\n\t\t\t\t<Button v-if="activeTabId === firstPage" id="cancel" />\n\t\t\t\t<Button v-if="activeTabId !== firstPage" id="back" />\n\t\t\t</div>\n\t\t\t<div v-if="showSaveButton && activeTabId !== lastPage">\n\t\t\t\t<Button id="update" :is-enabled="isEnabled" />\n\t\t\t</div>\n\t\t\t<div v-else class="crm-copilot__call-assessment_article" @click="showArticle">\n\t\t\t\t<span class="ui-icon-set --help"></span>\n\t\t\t\t{{ help }}\n\t\t\t</div>\n\t\t</div>\n\t`};const C={components:{TextEditorComponent:n.TextEditorComponent},emits:["change"],props:{textEditor:n.TextEditor},data(){return{textEditorEvents:{onChange:this.emitChangeData}}},mounted(){this.setTextEditorHeight();this.windowResizeHandler=this.windowResizeHandler.bind(this);h.Event.bind(window,"resize",this.windowResizeHandler)},unmounted(){h.Event.unbind(window,"resize",this.windowResizeHandler)},methods:{emitChangeData(){if(!h.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=h.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("change",{prompt:this.textEditor.getText()})},windowResizeHandler(){this.setTextEditorHeight()},setTextEditorHeight(){var t,e,i;const a=this.$el.parentNode.offsetTop;const s=".crm-copilot__call-assessment_navigation-container";const n=(t=(e=document.querySelector(s))==null?void 0:e.offsetTop)!=null?t:0;const l=20;const o=n-a-l;const r=Math.round(o*.5);const c=Math.round(o*.8);if(r<200){var d;(d=this.textEditor)==null?void 0:d.setMinHeight(c)}else{var p;(p=this.textEditor)==null?void 0:p.setMinHeight(r)}(i=this.textEditor)==null?void 0:i.setMaxHeight(c)}},template:`\n\t\t<TextEditorComponent \n\t\t\t:events="textEditorEvents"\n\t\t\t:editor-instance="textEditor"\n\t\t/>\n\t`};const L={MIN:100,MAX:5e3};var b=babelHelpers.classPrivateFieldLooseKey("errorMessage");class P{constructor(){Object.defineProperty(this,b,{writable:true,value:null})}validate(t){if(t.length<L.MIN){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MIN_ERROR",{"#MIN_VALUE#":L.MIN});return false}if(t.length>L.MAX){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MAX_ERROR",{"#MAX_VALUE#":L.MAX});return false}babelHelpers.classPrivateFieldLooseBase(this,b)[b]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}}const A={methods:{showLimitCopilotOffSlider(){var t,e;(t=top.BX.UI)==null?void 0:(e=t.InfoHelper)==null?void 0:e.show("limit_v2_crm_copilot_call_assessment_off")}},computed:{message(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AI_DISABLED")}},template:`\n\t\t<div class="crm-copilot__call-assessment-ai-disabled">\n\t\t\t<span v-html="message"></span>\n\t\t\t<span\n\t\t\t\t@click="showLimitCopilotOffSlider"\n\t\t\t\tclass="ui-icon-set --help"\n\t\t\t></span>\n\t\t</div>\n\t`};const I={components:{Breadcrumbs:T,AiDisabledInSettings:A},props:{readOnly:{type:Boolean,default:false},isEnabled:{type:Boolean,default:true},isActive:{type:Boolean},data:{type:Object,default:{}},settings:{type:Object,default:{}}},data(){return{id:null}},methods:{getId(){return this.id},getData(){return{}},isReadyToMoveOn(){return this.validate()},validate(){return true},onValidationFailed(){o.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_VALIDATION_ERROR"),autoHideDelay:3e3})},emitChangeData(){if(!h.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=h.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("onChange",{id:this.id,data:this.getData()})},getBodyFieldClassList(t=[]){return["crm-copilot__call-assessment_page-section-body-field",...t,{"--read-only":this.isEnabled!==true}]}}};const O={extends:I,components:{TextEditorComponent:n.TextEditorComponent,TextEditorWrapperComponent:C},props:{textEditor:n.TextEditor},data(){return{id:"about",parser:new s.BBCodeParser,promptLengthValidator:new P,promptLengthError:null}},methods:{getData(){return{prompt:this.textEditor.getText()}},isReadyToMoveOn(){return h.Type.isStringFilled(this.textEditor.getText())},validate(){return this.promptLengthValidator.validate(this.getPlainPromptText())},onValidationFailed(){this.promptLengthError=this.promptLengthValidator.getError()},onChange(){this.promptLengthError=null;I.methods.onChange.call(this)},getPlainPromptText(){return this.parser.parse(this.textEditor.getText()).toPlainText().trim()}},computed:{pageTitle(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_TITLE")},pageDescription(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList()">\n\t\t\t\t\t\t<TextEditorWrapperComponent\n\t\t\t\t\t\t\t:textEditor="textEditor"\n\t\t\t\t\t\t\t@change="onChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div v-if="promptLengthError" class="crm-copilot__call-assessment_page-section-body-field-error">\n\t\t\t\t\t\t\t{{ promptLengthError }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const f=Object.freeze({new:1,inWork:2,return:3,repeated:4});const M={extends:I,data(){var t;return{id:"client",activeClientTypeIds:(t=this.data.activeClientTypeIds)!=null?t:[]}},methods:{getData(){return{clientTypeIds:[...this.activeClientTypeIds]}},getClientTypeClassList(t){const e=this.clientTypes.find((e=>e.id===t));return["crm-copilot__call-assessment_page-section-body-field-client-type",`--client-${e.id}`,{"--active":this.activeClientTypeIds.includes(t)},{"--readonly":this.readOnly}]},onClientTypeSelect(t){if(this.readOnly){return}if(this.activeClientTypeIds.includes(t)){const e=this.activeClientTypeIds.indexOf(t);this.activeClientTypeIds.splice(e,1)}else{this.activeClientTypeIds.push(t)}this.emitChangeData()},onCheckboxClick(){return!this.readOnly},validate(){return h.Type.isArrayFilled(this.activeClientTypeIds)}},computed:{pageTitle(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TITLE")},pageDescription(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_DESCRIPTION")},clientTypes(){return[{id:f.new,title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_TITLE"),description:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_DESCRIPTION")},{id:f.inWork,title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_TITLE"),description:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_DESCRIPTION")},{id:f.return,title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_TITLE"),description:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_DESCRIPTION")},{id:f.repeated,title:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_TITLE"),description:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_DESCRIPTION")}]}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList()">\n\t\t\t\t\t\t<div v-for="(clientType, index) in clientTypes">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t:class=getClientTypeClassList(clientType.id)\n\t\t\t\t\t\t\t\t@click="onClientTypeSelect(clientType.id)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-avatar">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-info">\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-title">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.title }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-description">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.description }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t:class="(readOnly ? 'readonly' : '')"\n\t\t\t\t\t\t\t\t\t:onclick="onCheckboxClick"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tv-model="activeClientTypeIds"\n\t\t\t\t\t\t\t\t\t:value="clientType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<hr\n\t\t\t\t\t\t\t\tv-if="index + 1 < clientTypes.length"\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-client-type-divider"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var D=babelHelpers.classPrivateFieldLooseKey("errorMessage");class B{constructor(){Object.defineProperty(this,D,{writable:true,value:null})}validate(t,e){if(e<t){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_VALIDATION_ERROR");return false}babelHelpers.classPrivateFieldLooseBase(this,D)[D]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,D)[D]}}const R=10;const N={emits:["change"],props:{value:{type:Number,required:true},additionalClass:{type:String}},data(){return{currentValue:this.value}},methods:{onInlineValueKeyDown(t){const{key:e,code:i,ctrlKey:a,metaKey:s}=t;if(s||a){const e=["KeyA","KeyZ","KeyC","KeyV","KeyR","KeyX"];if(!e.includes(i)){t.preventDefault();return false}return true}const n=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Backspace","Delete"];if(n.includes(i)){return true}if(e===" "||Number.isNaN(Number(e))){t.preventDefault();return false}return true},onInlineValueChange(t){const e=Number(this.$refs.input.innerText);this.executeValueChange(e);this.$nextTick((()=>{const t=document.createRange();const e=window.getSelection();t.selectNodeContents(this.$refs.input);t.collapse(false);e.removeAllRanges();e.addRange(t);this.$refs.input.focus()}))},onInlineValueBlur(){const t=this.$refs.input.innerText.replaceAll(/\D/g,"");if(t===""){this.executeValueChange(0)}},changeValue(t){let e=t==="plus"?this.value+R:this.value-R;if(e%R>0){e=Math.ceil(e/R)*10}this.executeValueChange(e)},executeValueChange(t,e=null){this.currentValue=t;this.$refs.input.innerText=t===0?0:this.$refs.input.innerText.replace(/^0+/,"");h.Runtime.debounce((()=>{this.$emit("change",this.currentValue)}),300,this)()}},computed:{title(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PILL_TITLE")},classList(){return["crm-copilot__call-assessment-pill",this.additionalClass]},minusButtonClassList(){return["crm-copilot__call-assessment-pill-minus",{"--disabled":this.currentValue<=0}]},plusButtonClassList(){return["crm-copilot__call-assessment-pill-plus",{"--disabled":this.currentValue>=100}]}},watch:{currentValue(t){if(t<=0){this.currentValue=0}if(t>=100){this.currentValue=100}if(Number.isNaN(t)){this.currentValue=0}this.$refs.input.innerText=this.currentValue}},template:`\n\t\t<div :class="classList">\n\t\t\t<div class="crm-copilot__call-assessment-pill-title" v-html="title">\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-pill-control">\n\t\t\t\t<div\n\t\t\t\t\t:class="minusButtonClassList"\n\t\t\t\t\t@click="changeValue('minus')"\n\t\t\t\t\tref="minus"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-copilot__call-assessment-pill-value-container">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="crm-copilot__call-assessment-pill-value"\n\t\t\t\t\t\tcontenteditable="true"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t@keydown="onInlineValueKeyDown"\n\t\t\t\t\t\t@input="onInlineValueChange"\n\t\t\t\t\t\t@blur="onInlineValueBlur"\n\t\t\t\t\t\tref="input"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ currentValue }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment-pill-percent">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\t:class="plusButtonClassList"\n\t\t\t\t\t@click="changeValue('plus')"\n\t\t\t\t\tref="plus"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const w={props:{articleCode:{type:String,required:true}},methods:{onClick(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${this.articleCode}`)}},template:`\n\t\t<span class="crm-copilot__call-assessment-help-link" ref="container" @click="onClick">\n\t\t\t${h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_HELP")}\n\t\t</span>\n\t`};const x={components:{HelpLink:w},props:{id:{type:String,required:true},content:{type:String,required:true},dialogTargetId:{type:String,required:false,default:null},articleCode:{type:String,required:true},value:{type:Number},items:{type:Array},tabs:{type:Array},selectedItems:{type:Array}},data(){var t,e;return{status:(t=this.isChecked)!=null?t:false,currentValue:(e=this.value)!=null?e:null}},mounted(){this.initDialog()},updated(){this.initDialog()},watch:{currentValue(t){this.emitSelectItem(t)}},methods:{initDialog(){var t,e,i;if(this.dialogTargetId===null){return}const a=document.getElementById(this.dialogTargetId);this.clientSelectorDialog=new r.Dialog({targetNode:a,context:`CRM_COPILOT_CALL_ASSESSMENT_DIALOG_${this.id}`,multiple:false,dropdownMode:true,showAvatars:false,enableSearch:false,width:450,zIndex:2500,items:(t=this.items)!=null?t:[],tabs:(e=this.tabs)!=null?e:[],selectedItems:(i=this.selectedItems)!=null?i:[],events:{"Item:onSelect":t=>{const{item:{id:e}}=t.getData();this.currentValue=e}}});h.Event.bind(a,"click",(()=>{this.clientSelectorDialog.show()}))},emitSelectItem(t){this.$emit("onSelectItem",t)}},template:`\n\t\t<div>\n\t\t\t<span\n\t\t\t\tclass="crm-copilot__call-assessment_call_count"\n\t\t\t\tv-html="content"\n\t\t\t></span>\n\t\t\t<HelpLink :articleCode="articleCode" />\n\t\t</div>\n\t`};const k={extends:I,components:{TextWithDialog:x,Pill:N},data(){return{id:"control",lowBorder:this.data.lowBorder,highBorder:this.data.highBorder,validator:new B}},methods:{getData(){return{lowBorder:this.lowBorder,highBorder:this.highBorder}},setLowBorder(t){this.lowBorder=t},setHighBorder(t){this.highBorder=t},validate(){return this.validator.validate(this.lowBorder,this.highBorder)},onValidationFailed(){o.UI.Notification.Center.notify({content:this.validator.getError(),autoHideDelay:3e3})}},computed:{pageTitle(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_TITLE")},pageDescription(){return h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id"/>\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-container">\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-title --low-icon">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-content">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-subtitle"\n\t\t\t\t\t\t\t\tv-html="this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_DESCRIPTION')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Pill\n\t\t\t\t\t\t\t\tadditionalClass="--low"\n\t\t\t\t\t\t\t\t:value="lowBorder"\n\t\t\t\t\t\t\t\t@change="setLowBorder"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-additional">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_ADDITIONAL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-container">\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-title --high-icon">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-content">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-subtitle"\n\t\t\t\t\t\t\t\tv-html="this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_DESCRIPTION')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Pill\n\t\t\t\t\t\t\t\tadditionalClass="--high"\n\t\t\t\t\t\t\t\t:value="highBorder"\n\t\t\t\t\t\t\t\t@change="setHighBorder"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-additional">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_ADDITIONAL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const H={props:{action:{type:String,required:true},index:{type:Number,required:true}},computed:{classList(){return{"crm-copilot__call-assessment-availability-selector-button":true,"--add":this.action==="add","--remove":this.action!=="add"}}},methods:{onClick(){const{action:t,index:e}=this;this.$emit("button-click",{index:e,action:t})}},template:`\n\t\t<div :class="classList" @click="onClick"></div>\n\t`};const F={props:{isExpanded:{type:Boolean,default:false}},computed:{classList(){return{"crm-copilot__call-assessment-availability-selector-chevron":true,"--expanded":this.isExpanded}}},template:`\n\t\t<div :class="classList"></div>\n\t`};const G={components:{Chevron:F},props:{startPoint:{type:String,required:true},endPoint:{type:String,required:true},modelValue:{type:Object,default:{}}},emits:["update:modelValue"],data(){return{currentStartPoint:this.startPoint,currentEndPoint:this.endPoint,isExpanded:false}},created(){this.datePicker=new v.DatePicker({rangeStartInput:this.$refs.start,rangeEndInput:this.$refs.end,selectionMode:"range",defaultTime:"08:00",dateFormat:u.DatetimeConverter.getSiteDateTimeFormat(true),timeFormat:u.DatetimeConverter.getSiteShortTimeFormat(),selectedDates:[this.currentStartPoint,this.currentEndPoint],enableTime:true,events:{onSelectChange:t=>{const e=t.getTarget().getSelectedDates().map((e=>t.getTarget().formatDate(e,u.DatetimeConverter.getSiteDateTimeFormat(true))));if(e[0]){this.currentStartPoint=e[0]}if(e[1]){this.currentEndPoint=e[1]}this.$emit("update:modelValue",{startPoint:this.currentStartPoint,endPoint:this.currentEndPoint})},onShow:()=>{this.isExpanded=true},onHide:()=>{this.isExpanded=false}}})},mounted(){this.datePicker.setTargetNode(this.$refs.wrapper);this.datePicker.selectRange(this.currentStartPoint,this.currentEndPoint)},beforeUnmount(){this.datePicker.destroy()},methods:{showPicker(t){t.preventDefault();t.stopPropagation();this.datePicker.show()}},template:`\n\t\t<div\n\t\t\tclass="crm-copilot__call-assessment-availability-selector-row"\n\t\t\tref="wrapper"\n\t\t>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-row-wrapper">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="start"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="currentStartPoint"\n\t\t\t\t>\n\t\t\t\t<Chevron \n\t\t\t\t\t:isExpanded="isExpanded"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-delimiter"></div>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-row-wrapper">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="end"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="currentEndPoint"\n\t\t\t\t>\n\t\t\t\t<Chevron \n\t\t\t\t\t:isExpanded="isExpanded"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const $=Object.freeze({monday:"monday",tuesday:"tuesday",wednesday:"wednesday",thursday:"thursday",friday:"friday",saturday:"saturday",sunday:"sunday",working:"working",weekends:"weekends"});var V=babelHelpers.classPrivateFieldLooseKey("errorMessage");class U{constructor(){Object.defineProperty(this,V,{writable:true,value:null})}validate(t,e){const i=t=>{const[,e]=t.split(" ");const[i,a]=e.split(":").map(Number);return new Date(9999,11,31,i,a)};const a=i(t);const s=i(e);if(Number.isNaN(a)||Number.isNaN(s)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_VALIDATION_TIME_ERROR_1");return false}if(a.getTime()>=s.getTime()){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_VALIDATION_TIME_ERROR_2");return false}babelHelpers.classPrivateFieldLooseBase(this,V)[V]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}}const X={components:{Chevron:F},props:{weekdayType:{type:String,required:true},startPoint:{type:String,required:true},endPoint:{type:String,required:true},modelValue:{type:Object,default:{}}},emits:["update:modelValue"],data(){var t;return{currentWeekdayType:(t=this.weekdayType)!=null?t:$.working,currentStartPoint:this.startPoint,currentEndPoint:this.endPoint,isExpandedStartPoint:false,isExpandedEndPoint:false,timePeriodValidator:new U}},created(){this.datePicker=new v.DatePicker({type:"time",dateFormat:u.DatetimeConverter.getSiteDateTimeFormat(true),timeFormat:u.DatetimeConverter.getSiteShortTimeFormat(),minuteStep:5,events:{onSelectChange:t=>{const e=t.getTarget().getInputField().parentNode;if(!h.Type.isDomNode(e)){return}const i=t.getTarget().getSelectedDates().map((e=>t.getTarget().formatDate(e,u.DatetimeConverter.getSiteDateTimeFormat(true))));if(!i[0]){return}if((e==null?void 0:e.getAttribute("id"))==="start-point-selector"){this.currentStartPoint=i[0]}else if((e==null?void 0:e.getAttribute("id"))==="end-point-selector"){this.currentEndPoint=i[0]}const a=this.timePeriodValidator.validate(this.currentStartPoint,this.currentEndPoint);if(a){h.Dom.removeClass(this.$refs.start,"--invalid");h.Dom.removeClass(this.$refs.end,"--invalid")}else{h.Dom.addClass(this.$refs.start,"--invalid");h.Dom.addClass(this.$refs.end,"--invalid")}this.$emit("update:modelValue",{weekdayType:this.currentWeekdayType,startPoint:this.currentStartPoint,endPoint:this.currentEndPoint})},onHide:()=>{this.isExpandedStartPoint=false;this.isExpandedEndPoint=false}}})},beforeUnmount(){this.datePicker.destroy()},computed:{weekdayTypeList(){return[{value:$.monday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_MONDAY")},{value:$.tuesday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_TUESDAY")},{value:$.wednesday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_WEDNESDAY")},{value:$.thursday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_THURSDAY")},{value:$.friday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_FRIDAY")},{value:$.saturday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_SATURDAY")},{value:$.sunday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_SUNDAY")},{value:$.working,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_WORKING_DAYS")},{value:$.weekends,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_WEEKENDS")}]},startTimeString(){return this.currentStartPoint.split(" ")[1]},endTimeString(){return this.currentEndPoint.split(" ")[1]}},watch:{currentWeekdayType(t){this.currentWeekdayType=t;this.$emit("update:modelValue",{weekdayType:this.currentWeekdayType,startPoint:this.currentStartPoint,endPoint:this.currentEndPoint})}},methods:{showPicker(t){t.preventDefault();t.stopPropagation();const e=t.target.parentNode;if(!h.Type.isDomNode(e)){return}this.datePicker.setTargetNode(e);if((e==null?void 0:e.getAttribute("id"))==="start-point-selector"){this.datePicker.setInputField(this.$refs.start);this.datePicker.selectDate(this.currentStartPoint);this.isExpandedStartPoint=true}else if((e==null?void 0:e.getAttribute("id"))==="end-point-selector"){this.datePicker.setInputField(this.$refs.end);this.datePicker.selectDate(this.currentEndPoint);this.isExpandedEndPoint=true}this.datePicker.show()}},template:`\n\t\t<div class="crm-copilot__call-assessment-availability-selector-row">\n\t\t\t<div \n\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-row-wrapper"\n\t\t\t\tstyle="padding-right: 15px;"\n\t\t\t>\n\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass="ui-ctl-element crm-copilot__call-assessment-availability-selector-input  --weekday-type"\n\t\t\t\t\t\tv-model="currentWeekdayType"\n\t\t\t\t\t\t:value="currentWeekdayType"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for="typeItem in weekdayTypeList"\n\t\t\t\t\t\t\t:value="typeItem.value"\n\t\t\t\t\t\t\t:disabled="currentWeekdayType === typeItem.value"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{typeItem.title}}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tid="start-point-selector"\n\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-row-wrapper"\n\t\t\t>\n\t\t\t\t<input \n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="start"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input --time"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="startTimeString"\n\t\t\t\t>\n\t\t\t\t<Chevron\n\t\t\t\t\t:isExpanded="isExpandedStartPoint"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-delimiter"></div>\n\t\t\t<div\n\t\t\t\tid="end-point-selector"\n\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-row-wrapper"\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="end"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input --time"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="endTimeString"\n\t\t\t\t>\n\t\t\t\t<Chevron\n\t\t\t\t\t:isExpanded="isExpandedEndPoint"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const K=Object.freeze({always_active:"always_active",inactive:"inactive",period:"period",custom:"custom"});const Y={components:{Button:H,PeriodRow:G,CustomRow:X},props:{availabilityType:{type:String,required:true},readOnly:{type:Boolean}},data(){return{currentAvailabilityType:this.availabilityType,availabilityTypeData:{}}},beforeCreate(){this.availabilityTypeList=K;this.dateTimeFormat=u.DatetimeConverter.getSiteDateTimeFormat(true)},computed:{typeList(){return[{value:K.always_active,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_ALWAYS_ACTIVE")},{value:K.period,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_PERIOD")},{value:K.custom,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_CUSTOM")},{value:K.inactive,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_INACTIVE")}]},hasRows(){return h.Type.isArrayFilled(this.availabilityTypeData[this.currentAvailabilityType])},rowsForCurrentType(){var t;return(t=this.availabilityTypeData[this.currentAvailabilityType])!=null?t:[]},isExtendedAvailabilityType(){return this.currentAvailabilityType!==K.always_active&&this.currentAvailabilityType!==K.inactive}},watch:{currentAvailabilityType(t){this.$emit("type-change",{availabilityType:t})}},methods:{onActionButtonClick({action:t,index:e}){if(this.currentAvailabilityType===K.always_active||this.currentAvailabilityType===K.inactive){return}if(t==="add"){const t=this.currentAvailabilityType===K.period?this.getDefaultDatePeriodItem():this.getDefaultCustomItem();this.rowsForCurrentType.push(t)}else{this.rowsForCurrentType.splice(e,1)}},onUpdateCustomRow(t){this.$emit("data-change",{availabilityType:this.currentAvailabilityType,availabilityTypeData:this.getAvailabilityData(),updatedRow:t})},getDefaultDatePeriodItem(){const t=this.getRoundedToNearestMinuteDate(new Date,15);const e=this.getRoundedToNearestMinuteDate(new Date,15);e.setDate(e.getDate()+7);return{startPoint:p.DateTimeFormat.format(this.dateTimeFormat,t),endPoint:p.DateTimeFormat.format(this.dateTimeFormat,e)}},getDefaultCustomItem(){const t=Math.round((new Date).setHours(8,0,0,0)/1e3);const e=Math.round((new Date).setHours(18,0,0,0)/1e3);return{weekdayType:$.working,startPoint:p.DateTimeFormat.format(this.dateTimeFormat,t),endPoint:p.DateTimeFormat.format(this.dateTimeFormat,e)}},getRoundedToNearestMinuteDate(t,e){const i=t.getTime();const a=e*60*1e3;const s=Math.round(i/a)*a;return new Date(s)},getAvailabilityData(){var t;return(t=this.availabilityTypeData[this.currentAvailabilityType])!=null?t:[]},setAvailabilityData(t){if(h.Type.isArrayFilled(t)){this.availabilityTypeData[this.currentAvailabilityType]=t;if(this.currentAvailabilityType===this.availabilityTypeList.period){this.availabilityTypeData[this.availabilityTypeList.custom]=[this.getDefaultCustomItem()]}else if(this.currentAvailabilityType===this.availabilityTypeList.custom){this.availabilityTypeData[this.availabilityTypeList.period]=[this.getDefaultDatePeriodItem()]}return}this.availabilityTypeData={[this.availabilityTypeList.period]:[this.getDefaultDatePeriodItem()],[this.availabilityTypeList.custom]:[this.getDefaultCustomItem()]}}},template:`\n\t\t<div class="crm-copilot__call-assessment-availability-selector">\n\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t<select\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\tv-model="currentAvailabilityType"\n\t\t\t\t\t:value="currentAvailabilityType"\n\t\t\t\t>\n\t\t\t\t\t<option\n\t\t\t\t\t\tv-for="typeItem in typeList"\n\t\t\t\t\t\t:value="typeItem.value"\n\t\t\t\t\t\t:disabled="readOnly && currentAvailabilityType !== typeItem.value"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{typeItem.title}}\n\t\t\t\t\t</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="crm-copilot__call-assessment-availability-rows"\n\t\t\t\tv-if="isExtendedAvailabilityType"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-row"\n\t\t\t\t\tv-if="currentAvailabilityType === availabilityTypeList.period"\n\t\t\t\t\tv-for="(row, index) in rowsForCurrentType"\n\t\t\t\t>\n\t\t\t\t\t<PeriodRow\n\t\t\t\t\t\t:start-point="row.startPoint"\n\t\t\t\t\t\t:end-point="row.endPoint"\n\t\t\t\t\t\tv-model="availabilityTypeData[availabilityTypeList.period][index]"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:action="(index < rowsForCurrentType.length - 1 ? 'remove' : 'add')"\n\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t@button-click="onActionButtonClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-row"\n\t\t\t\t\tv-if="currentAvailabilityType === availabilityTypeList.custom"\n\t\t\t\t\tv-for="(row, index) in rowsForCurrentType"\n\t\t\t\t>\n\t\t\t\t\t<CustomRow\n\t\t\t\t\t\t:weekday-type="row.weekdayType"\n\t\t\t\t\t\t:start-point="row.startPoint"\n\t\t\t\t\t\t:end-point="row.endPoint"\n\t\t\t\t\t\tv-model="availabilityTypeData[availabilityTypeList.custom][index]"\n\t\t\t\t\t\tv-on:update:modelValue="onUpdateCustomRow"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:action="(index < rowsForCurrentType.length - 1 ? 'remove' : 'add')"\n\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t@button-click="onActionButtonClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const W={extends:I,components:{TypeSelector:Y},data(){var t,e,i,a;let s=0;if((t=this.settings.baas)!=null&&t.hasPackage){var n;s=(n=this.data.autoCheckTypeId)!=null?n:1}return{id:"settings",callTypeId:(e=this.data.callTypeId)!=null?e:1,autoCheckTypeId:s,availabilityType:(i=this.data.availabilityType)!=null?i:K.always_active,availabilityData:(a=this.data.availabilityData)!=null?a:[],timePeriodValidator:new U,timePeriodError:null}},methods:{getData(){var t,e;return{callTypeId:this.callTypeId,autoCheckTypeId:this.autoCheckTypeId,availabilityType:this.availabilityType,availabilityData:(t=(e=this.$refs.typeSelector)==null?void 0:e.getAvailabilityData())!=null?t:[]}},onAutoCheckTypeIdChange(t){if(this.isBaasHasPackage){return}const{value:e}=t.target;if(e!==0){if(this.packageEmptySliderCode){c.InfoHelper.show(this.packageEmptySliderCode)}void this.$nextTick((()=>{this.autoCheckTypeId=0}))}},onAvailabilityTypeChange(t){this.availabilityType=t.availabilityType;this.timePeriodError=null},onAvailabilityDataChange(t){this.validate();this.onValidationFailed()},validate(){if(this.availabilityType===K.custom){var t,e;const i=(t=(e=this.$refs.typeSelector)==null?void 0:e.getAvailabilityData())!=null?t:[];const a=i.filter((t=>!this.timePeriodValidator.validate(t.startPoint,t.endPoint)));return a.length===0}return true},onValidationFailed(){this.timePeriodError=this.timePeriodValidator.getError()}},mounted(){var t;(t=this.$refs.typeSelector)==null?void 0:t.setAvailabilityData(this.availabilityData)},computed:{pageTitle(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_TITLE")},pageDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_DESCRIPTION")},pageSectionSettingsCallType(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE")},pageSectionSettingsCallTypeDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_DESCRIPTION")},pageSectionSettingsCheck(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK")},pageSectionSettingsCheckDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DESCRIPTION")},callTypes(){return[{id:1,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_ALL")},{id:2,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_INCOMING")},{id:3,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_OUTGOING")}]},checkTypes(){return[{value:1,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_FIRST_INCOMING")},{value:2,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_INCOMING")},{value:3,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_OUTGOING")},{value:4,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL")},{value:0,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DISABLED")}]},isBaasAvailable(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.isAvailable)!=null?t:false},isBaasHasPackage(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.hasPackage)!=null?t:false},packageEmptySliderCode(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.aiPackagesEmptySliderCode)!=null?t:null},pageSectionSettingsAvailability(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_AVAILABILITY")},pageSectionSettingsAvailabilityDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_AVAILABILITY_DESCRIPTION")},isCallAssessmentAvailabilityEnabled(){return h.Extension.getSettings("crm.copilot.call-assessment").get("callAssessmentAvailabilityEnabled")}},template:`\n\t\t<div v-show="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList(['ui-ctl', 'ui-ctl-after-icon', 'ui-ctl-dropdown', 'ui-ctl-w100'])">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCallType }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element" v-model="callTypeId">\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="callType in callTypes"\n\t\t\t\t\t\t\t\t\t:value="callType.id"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && callTypeId !== callType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{callType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCallTypeDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div \n\t\t\t\t\tv-if="isBaasAvailable"\n\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body"\n\t\t\t\t>\n\t\t\t\t\t<div :class="this.getBodyFieldClassList(['ui-ctl', 'ui-ctl-after-icon', 'ui-ctl-dropdown', 'ui-ctl-w100'])">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCheck }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select \n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\tv-model="autoCheckTypeId"\n\t\t\t\t\t\t\t\t@change="onAutoCheckTypeIdChange"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="checkType in checkTypes"\n\t\t\t\t\t\t\t\t\t:value="checkType.value"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && autoCheckTypeId !== checkType.value"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{checkType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCheckDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if="isCallAssessmentAvailabilityEnabled"\n\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body"\n\t\t\t\t>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsAvailability }}</label>\n\t\t\t\t\t\t<TypeSelector\n\t\t\t\t\t\t\tref="typeSelector"\n\t\t\t\t\t\t\t:availabilityType="availabilityType"\n\t\t\t\t\t\t\t:readOnly="readOnly"\n\t\t\t\t\t\t\t@typeChange="onAvailabilityTypeChange"\n\t\t\t\t\t\t\t@dataChange="onAvailabilityDataChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsAvailabilityDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="timePeriodError" class="crm-copilot__call-assessment_page-section-body-field-error">\n\t\t\t\t\t\t\t{{ timePeriodError }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const j={components:{AboutPage:O,ClientPage:M,SettingsPage:W,ControlPage:k,Navigation:S},props:{settings:{type:Object,default:{}},params:{type:Object,default:{}},textEditor:n.TextEditor},data(){var t;const{data:e}=this.params;let i=null;if(this.settings.isCopy){i=null}else{var a;i=(a=e==null?void 0:e.id)!=null?a:null}return{id:i,pagesData:this.initPagesData(e),activePageId:"about",title:(t=e.title)!=null?t:null,canShowNextPage:false}},watch:{activePageId(t){this.onPageDataChange({id:t,data:this.getPageData(t)})}},methods:{initPagesData(t){var e,i,a,s;return{client:{data:{activeClientTypeIds:t==null?void 0:t.clientTypeIds}},settings:{data:{callTypeId:t==null?void 0:t.callTypeId,autoCheckTypeId:t==null?void 0:t.autoCheckTypeId,availabilityType:(e=t==null?void 0:t.availabilityType)!=null?e:K.always_active,availabilityData:(i=t==null?void 0:t.availabilityData)!=null?i:[]}},control:{data:{lowBorder:(a=t==null?void 0:t.lowBorder)!=null?a:0,highBorder:(s=t==null?void 0:t.highBorder)!=null?s:100}}}},onNavigationButtonClick({data:t}){const{id:e}=t;if(e==="cancel"||e==="close"){this.closeSlider();return}if(e==="back"){const t=this.pagesList.indexOf(this.activePageId);if(t>0){this.activePageId=this.pagesList[t-1]}return}if(!this.isActivePageValid()){this.onActivePageValidationFailed();return}if(e==="continue"){const t=this.pagesList.indexOf(this.activePageId);if(t<this.pagesList.length-1){this.activePageId=this.pagesList[t+1]}return}if(e==="submit"||e==="update"){this.sendData()}},sendData(){let t={title:this.title};this.pagesList.forEach((e=>{var i;t={...t,...(i=this.$refs[e])==null?void 0:i.getData()}}));const e={id:this.id,data:t,eventId:i.QueueManager.registerRandomEventId("crm-copilot-call-assessment")};top.BX.Event.EventEmitter.emit("crm:copilot:callAssessment:beforeSave",e);h.ajax.runAction("crm.copilot.callassessment.save",{data:e}).then((t=>{top.BX.Event.EventEmitter.emit("crm:copilot:callAssessment:save",{...e,status:t==null?void 0:t.status});if((t==null?void 0:t.status)!=="success"){o.UI.Notification.Center.notify({content:h.Text.encode(t.errors[0].message),autoHideDelay:6e3});return}this.onSaveCallback();this.closeSlider()}),(t=>{var e;const i=((e=t.errors[0])==null?void 0:e.code)==="AI_NOT_AVAILABLE"?"CRM_COPILOT_CALL_ASSESSMENT_PAGE_COPILOT_ERROR":"CRM_COPILOT_CALL_ASSESSMENT_PAGE_SAVE_ERROR";o.UI.Notification.Center.notify({content:h.Loc.getMessage(i),autoHideDelay:6e3})})).catch((t=>{o.UI.Notification.Center.notify({content:h.Text.encode(t.errors[0].message),autoHideDelay:6e3});throw t}))},closeSlider(){top.BX.SidePanel.Instance.getSliderByWindow(window).close()},onSaveCallback(){var t,e;if(h.Type.isFunction((t=this.params)==null?void 0:(e=t.events)==null?void 0:e.onSave)){this.params.events.onSave()}},setActivePageId({data:t}){const e=t.itemId;const i=this.pagesList.indexOf(this.activePageId);const a=this.pagesList.indexOf(e);if(i===a){return}if(a>i&&!this.isActivePageValid()){this.onActivePageValidationFailed();return}this.activePageId=e},isPageActive(t){return this.activePageId===t},onPageDataChange({id:t,data:e}){this.pagesData[t]=e;this.canShowNextPage=this.isActivePageReadyToMoveOn()},getPageData(t){if(h.Type.isObjectLike(this.pagesData[t])){return this.pagesData[t].data}return{}},getPageSettings(t){if(t==="settings"){var e;return{baas:(e=this.settings.baas)!=null?e:{}}}return{}},setTitle(t){this.title=t},isActivePageValid(){return this.getActivePage().validate()},onActivePageValidationFailed(){return this.getActivePage().onValidationFailed()},isActivePageReadyToMoveOn(){return this.getActivePage().isReadyToMoveOn()},getActivePage(){return this.$refs[this.activePageId]}},computed:{pagesList(){return["about","client","settings","control"]},isNew(){var t;return((t=this.params.data)==null?void 0:t.id)<=0},readOnly(){return this.settings.readOnly},isEnabled(){return this.settings.isEnabled}},mounted(){this.canShowNextPage=this.isActivePageReadyToMoveOn();this.$Bitrix.eventEmitter.subscribe(g.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.subscribe(m.click,this.onNavigationButtonClick)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(g.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.unsubscribe(m.click,this.onNavigationButtonClick)},template:`\n\t\t<div class="crm-copilot__call-assessment_container">\n\t\t\t<div class="crm-copilot__call-assessment_page-wrapper">\n\t\t\t\t<AboutPage \n\t\t\t\t\t:is-active="isPageActive('about')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('about')"\n\t\t\t\t\t:text-editor="textEditor"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="about"\n\t\t\t\t/>\n\t\t\t\t<ClientPage \n\t\t\t\t\t:is-active="isPageActive('client')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('client')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="client"\n\t\t\t\t/>\n\t\t\t\t<SettingsPage\n\t\t\t\t\t:is-active="isPageActive('settings')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('settings')"\n\t\t\t\t\t:settings="getPageSettings('settings')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="settings"\n\t\t\t\t/>\n\t\t\t\t<ControlPage\n\t\t\t\t\t:is-active="isPageActive('control')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('control')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="control"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<Navigation \n\t\t\t\t:active-tab-id="activePageId"\n\t\t\t\t:is-enabled="canShowNextPage"\n\t\t\t\t:read-only="readOnly"\n\t\t\t\t:show-save-button="!isNew && !readOnly"\n\t\t\t/>\n\t\t</div>\n\t`};var q=babelHelpers.classPrivateFieldLooseKey("container");var z=babelHelpers.classPrivateFieldLooseKey("app");var Q=babelHelpers.classPrivateFieldLooseKey("layoutComponent");var Z=babelHelpers.classPrivateFieldLooseKey("title");var J=babelHelpers.classPrivateFieldLooseKey("textEditor");var tt=babelHelpers.classPrivateFieldLooseKey("isReadOnly");var et=babelHelpers.classPrivateFieldLooseKey("isEnabled");var it=babelHelpers.classPrivateFieldLooseKey("initTitleInlineEditing");var at=babelHelpers.classPrivateFieldLooseKey("getTextEditor");class st{constructor(t,i={}){var a,s,n,l,o,r,c,d,p;Object.defineProperty(this,at,{value:lt});Object.defineProperty(this,it,{value:nt});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,Q,{writable:true,value:null});Object.defineProperty(this,Z,{writable:true,value:null});Object.defineProperty(this,J,{writable:true,value:null});Object.defineProperty(this,tt,{writable:true,value:true});Object.defineProperty(this,et,{writable:true,value:true});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=document.getElementById(t);if(!h.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,q)[q])){throw new Error("container not found")}babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=(a=(s=i.config)==null?void 0:s.readOnly)!=null?a:true;babelHelpers.classPrivateFieldLooseBase(this,et)[et]=(n=(l=i.config)==null?void 0:l.isEnabled)!=null?n:true;babelHelpers.classPrivateFieldLooseBase(this,it)[it](i);babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.BitrixVue.createApp(j,{textEditor:babelHelpers.classPrivateFieldLooseBase(this,at)[at](i.data,(o=i.config)!=null?o:{}),settings:{readOnly:babelHelpers.classPrivateFieldLooseBase(this,tt)[tt],isEnabled:babelHelpers.classPrivateFieldLooseBase(this,et)[et],isCopy:(r=(c=i.config)==null?void 0:c.isCopy)!=null?r:false,baas:(d=(p=i.config)==null?void 0:p.baasSettings)!=null?d:false},params:{data:i.data,events:i.events}});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=babelHelpers.classPrivateFieldLooseBase(this,z)[z].mount(babelHelpers.classPrivateFieldLooseBase(this,q)[q])}}function nt(t){if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]){return}const e=h.Reflection.getClass("BX.UI.ToolbarManager");const i=e==null?void 0:e.getDefaultToolbar();if(i){const t=h.Reflection.getClass("BX.UI.ToolbarEvents");i.subscribe(t.finishEditing,(({data:t})=>{const{updatedTitle:e}=t;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].setTitle(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])}))}const{data:a}=t;if(h.Type.isString(a==null?void 0:a.title)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=a.title}}function lt({prompt:t},{copilotSettings:e}){if(babelHelpers.classPrivateFieldLooseBase(this,J)[J]!==null){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}const i=babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]?[]:["bold","italic","underline","strikethrough","|","numbered-list","bulleted-list","copilot"];babelHelpers.classPrivateFieldLooseBase(this,J)[J]=new n.BasicEditor({editable:!babelHelpers.classPrivateFieldLooseBase(this,tt)[tt],removePlugins:["BlockToolbar"],minHeight:250,maxHeight:400,content:t,placeholder:h.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER"),paragraphPlaceholder:h.Loc.getMessage(h.Type.isPlainObject(e)?"CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER_WITH_COPILOT":null),toolbar:i,floatingToolbar:[],collapsingMode:false,copilot:{copilotOptions:h.Type.isPlainObject(e)?e:null,triggerBySpace:true}});return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}t.CallAssessment=st})(this.BX.Crm.Copilot=this.BX.Crm.Copilot||{},BX.Vue3,BX.Pull,BX.UI,BX.UI.BBCode,BX.UI.TextEditor,BX,BX,BX.UI.EntitySelector,BX.UI,BX,BX.Main,BX.Crm.Timeline,BX.Event,BX.UI.DatePicker,BX);
//# sourceMappingURL=call-assessment.bundle.map.js