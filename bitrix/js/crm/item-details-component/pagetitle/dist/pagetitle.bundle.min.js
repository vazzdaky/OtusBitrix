this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.ItemDetailsComponent=this.BX.Crm.ItemDetailsComponent||{};(function(e,s,a,t,l,i,r){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("prefix");var n=babelHelpers.classPrivateFieldLooseKey("format");class c{constructor(e){Object.defineProperty(this,n,{value:b});Object.defineProperty(this,o,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e}warn(e,...s){console.warn(babelHelpers.classPrivateFieldLooseBase(this,n)[n](e),...s)}error(e,...s){console.error(babelHelpers.classPrivateFieldLooseBase(this,n)[n](e),...s)}}function b(e){return`${babelHelpers.classPrivateFieldLooseBase(this,o)[o]}: ${e}`}const d=new c("crm.item-details-component.pagetitle");let v=e=>e,p;var h=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var P=babelHelpers.classPrivateFieldLooseKey("id");var u=babelHelpers.classPrivateFieldLooseKey("categoryId");var g=babelHelpers.classPrivateFieldLooseKey("categories");var L=babelHelpers.classPrivateFieldLooseKey("editorGuid");var y=babelHelpers.classPrivateFieldLooseKey("labelTemplate");var H=babelHelpers.classPrivateFieldLooseKey("logger");var F=babelHelpers.classPrivateFieldLooseKey("isProgress");var B=babelHelpers.classPrivateFieldLooseKey("onCategorySelectorClick");var f=babelHelpers.classPrivateFieldLooseKey("onCategorySelect");var C=babelHelpers.classPrivateFieldLooseKey("changeCategory");var m=babelHelpers.classPrivateFieldLooseKey("reloadPageWhenCategoryChanged");var O=babelHelpers.classPrivateFieldLooseKey("changeCategoryViaAjax");var E=babelHelpers.classPrivateFieldLooseKey("showUnsavedChangesDialog");var T=babelHelpers.classPrivateFieldLooseKey("startProgress");var I=babelHelpers.classPrivateFieldLooseKey("stopProgress");var _=babelHelpers.classPrivateFieldLooseKey("isEditorChanged");var w=babelHelpers.classPrivateFieldLooseKey("getEditor");var j=babelHelpers.classPrivateFieldLooseKey("isNew");var K=babelHelpers.classPrivateFieldLooseKey("getCurrentCategory");var M=babelHelpers.classPrivateFieldLooseKey("getAllCategoriesExceptCurrent");class A{constructor({entityTypeId:e,entityId:s,categoryId:l,categories:i,editorGuid:r,labelTemplate:o}){Object.defineProperty(this,M,{value:q});Object.defineProperty(this,K,{value:Q});Object.defineProperty(this,j,{value:U});Object.defineProperty(this,w,{value:Y});Object.defineProperty(this,_,{value:$});Object.defineProperty(this,I,{value:k});Object.defineProperty(this,T,{value:x});Object.defineProperty(this,E,{value:S});Object.defineProperty(this,O,{value:N});Object.defineProperty(this,m,{value:D});Object.defineProperty(this,C,{value:R});Object.defineProperty(this,f,{value:X});Object.defineProperty(this,B,{value:G});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=s;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=l;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=i;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=r;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=a.Type.isStringFilled(o)?o:"#CATEGORY#";babelHelpers.classPrivateFieldLooseBase(this,H)[H]=d;t.EventEmitter.makeObservable(this,"BX.Crm.ItemDetailsComponent.CategoryChanger")}static renderToTarget(e,t){const l=new A({...t,categories:t.categories.map((e=>new s.CategoryModel(e)))});const i=a.Type.isDomNode(e)?e:document.querySelector(e);if(!i){d.warn("target not found, skip rendering");return null}a.Dom.append(l.render(),i);return l}render(){const e=babelHelpers.classPrivateFieldLooseBase(this,K)[K]();if(!e){babelHelpers.classPrivateFieldLooseBase(this,H)[H].warn("current category not found, skip rendering");return null}const s=babelHelpers.classPrivateFieldLooseBase(this,y)[y].replace("#CATEGORY#",e.getName());const t=a.Tag.render(p||(p=v`
			<div class="crm-details-pagetitle-legend-container">
				<a href="#" onclick="${0}">
					${0}
				</a>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this),a.Text.encode(s));if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]()){a.Dom.addClass(t,"--new")}return t}}function G(e){const s=[];for(const e of babelHelpers.classPrivateFieldLooseBase(this,M)[M]()){s.push({text:e.getName(),onclick:babelHelpers.classPrivateFieldLooseBase(this,f)[f].bind(this,e.getId())})}l.MenuManager.show({id:`item-category-changer-${babelHelpers.classPrivateFieldLooseBase(this,h)[h]}-${babelHelpers.classPrivateFieldLooseBase(this,P)[P]}`,bindElement:e.target,items:s})}function X(e){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]()){babelHelpers.classPrivateFieldLooseBase(this,E)[E](babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this,e))}else{babelHelpers.classPrivateFieldLooseBase(this,C)[C](e)}}function R(e){babelHelpers.classPrivateFieldLooseBase(this,T)[T]();if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]()){babelHelpers.classPrivateFieldLooseBase(this,m)[m](e)}else{babelHelpers.classPrivateFieldLooseBase(this,O)[O](e)}}function D(e){const s=new a.Uri(window.location.href);s.setQueryParam("categoryId",e);s.setQueryParam("category_id",e);setTimeout((()=>{window.location.href=s.toString();babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}))}function N(e){a.ajax.runAction("crm.controller.item.update",{analyticsLabel:"crmItemDetailsChangeCategory",data:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],id:babelHelpers.classPrivateFieldLooseBase(this,P)[P],fields:{categoryId:e}}}).then((()=>{setTimeout((()=>{window.location.reload();babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}))})).catch((e=>{var s,a;babelHelpers.classPrivateFieldLooseBase(this,H)[H].warn("error changing category via ajax",e);const t=(e==null?void 0:(s=e.errors)==null?void 0:(a=s[0])==null?void 0:a.message)||"Something went wrong";BX.UI.Notification.Center.notify({content:t,position:"top-right",autoHideDelay:3e3});babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}))}function S(e){var s;const t=(s=BX.CrmEntityType)==null?void 0:s.resolveName(babelHelpers.classPrivateFieldLooseBase(this,h)[h]);const l=a.Loc.getMessage(`CRM_ITEM_PAGETITLE_CATEGORY_CHANGER_CONFIRM_DIALOG_MESSAGE_${t}`)||a.Loc.getMessage("CRM_ITEM_PAGETITLE_CATEGORY_CHANGER_CONFIRM_DIALOG_MESSAGE");r.MessageBox.show({modal:true,title:a.Loc.getMessage("CRM_ITEM_PAGETITLE_CATEGORY_CHANGER_CONFIRM_DIALOG_TITLE"),message:l,minHeight:100,buttons:r.MessageBoxButtons.OK_CANCEL,okCaption:a.Loc.getMessage("CRM_ITEM_PAGETITLE_CATEGORY_CHANGER_CONFIRM_DIALOG_OK_BTN"),onOk:s=>{s.close();e()},onCancel:e=>e.close()})}function x(){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=true;this.emit("onProgressStart")}function k(){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=false;this.emit("onProgressStop")}function $(){const e=babelHelpers.classPrivateFieldLooseBase(this,w)[w]();return Boolean((e==null?void 0:e.hasChangedControls())||(e==null?void 0:e.hasChangedControllers()))}function Y(){var e,s;if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]){var a,t;return(a=BX.Crm)==null?void 0:(t=a.EntityEditor)==null?void 0:t.get(babelHelpers.classPrivateFieldLooseBase(this,L)[L])}return(e=BX.Crm)==null?void 0:(s=e.EntityEditor)==null?void 0:s.getDefault()}function U(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P]<=0}function Q(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g].find((e=>e.getId()===babelHelpers.classPrivateFieldLooseBase(this,u)[u]))}function q(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g].filter((e=>e.getId()!==babelHelpers.classPrivateFieldLooseBase(this,u)[u]))}e.CategoryChanger=A})(this.BX.Crm.ItemDetailsComponent.PageTitle=this.BX.Crm.ItemDetailsComponent.PageTitle||{},BX.Crm.Models,BX,BX.Event,BX.Main,BX,BX.UI.Dialogs);
//# sourceMappingURL=pagetitle.bundle.map.js