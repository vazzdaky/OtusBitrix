{"version":3,"file":"stafftrack-check-in.bundle.js","sources":["../src/stafftrack-check-in.js"],"sourcesContent":["import { Event, Extension, Loc, Tag, Type } from 'main.core';\nimport { Actions, Outline } from 'ui.icon-set.api.core';\nimport { UserStatisticsLink as CheckInQrAuthPopup } from 'stafftrack.user-statistics-link';\nimport { sendData } from 'ui.analytics';\nimport './style.css';\nimport 'ui.counter';\n\ntype Params = {\n\tcontainer: HTMLElement,\n};\n\ntype Counter = {\n\tCLASS: string,\n\tVALUE: string,\n};\n\nexport class StafftrackCheckIn\n{\n\t// eslint-disable-next-line no-unused-private-class-members\n\t#params: Params;\n\t#data: ?Counter;\n\t#layout: {\n\t\tcounter: HTMLElement,\n\t};\n\t#isAirTemplate: boolean;\n\n\tconstructor(params: Params)\n\t{\n\t\tconst settings = Extension.getSettings('timeman.stafftrack-check-in');\n\t\tif (!settings.get('isCheckinEnabled'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#data = settings.get('counter');\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\t\tthis.#isAirTemplate = settings.get('isAirTemplate');\n\n\t\tconst pwtContainer = params.container.querySelector('#timeman-pwt-container');\n\t\tif (pwtContainer)\n\t\t{\n\t\t\tpwtContainer.before(this.#render());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.container.append(this.#render());\n\t\t}\n\n\t\tthis.onDataReceived = this.#onDataReceived.bind(this);\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tBX.addCustomEvent('onTimeManDataRecieved', this.onDataReceived);\n\t\tBX.addCustomEvent('onTimeManNeedRebuild', this.onDataReceived);\n\t}\n\n\t#onDataReceived(data: { CHECKIN_COUNTER: any })\n\t{\n\t\tthis.#data = data.CHECKIN_COUNTER;\n\t\tthis.#renderCounter();\n\t}\n\n\t#render(): HTMLElement\n\t{\n\t\tconst iconOutlineName = (this.#isAirTemplate ? Outline.PLAY_L : Actions.PLAY);\n\n\t\tconst wrap = Tag.render`\n\t\t\t<div class=\"timeman-stafftrack-check-in\">\n\t\t\t\t<div class=\"ui-icon-set --${iconOutlineName}\"></div>\n\t\t\t\t<div class=\"timeman-stafftrack-check-in-text\">\n\t\t\t\t\t${Loc.getMessage('TIMEMAN_STAFFTRACK_CHECK_IN')}\n\t\t\t\t</div>\n\t\t\t\t${this.#renderCounter()}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(wrap, 'click', this.#onClickHandler.bind(this));\n\n\t\treturn wrap;\n\t}\n\n\t#onClickHandler(): void\n\t{\n\t\tif (!CheckInQrAuthPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnew CheckInQrAuthPopup({ intent: 'check-in' }).show();\n\n\t\tsendData({\n\t\t\ttool: 'checkin',\n\t\t\tcategory: 'shift',\n\t\t\tevent: 'popup_open',\n\t\t\tc_section: 'timeman',\n\t\t});\n\t}\n\n\t#renderCounter(): HTMLElement | string\n\t{\n\t\tconst display = Type.isStringFilled(this.#data.VALUE) ? '' : 'none';\n\n\t\tconst counter = Tag.render`\n\t\t\t<div class=\"timeman-stafftrack-check-in-counter\" style=\"display: ${display};\">\n\t\t\t\t<span class=\"ui-counter ${this.#data.CLASS} ui-counter-sm\">\n\t\t\t\t\t<span class=\"ui-counter-inner\">\n\t\t\t\t\t\t${this.#data.VALUE}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#layout.counter?.replaceWith(counter);\n\t\tthis.#layout.counter = counter\n\n\t\treturn this.#layout.counter;\n\t}\n}\n"],"names":["StafftrackCheckIn","constructor","params","settings","Extension","getSettings","get","pwtContainer","container","querySelector","before","append","onDataReceived","bind","BX","addCustomEvent","data","CHECKIN_COUNTER","iconOutlineName","Outline","PLAY_L","Actions","PLAY","wrap","Tag","render","Loc","getMessage","Event","CheckInQrAuthPopup","intent","show","sendData","tool","category","event","c_section","display","Type","isStringFilled","VALUE","counter","CLASS","replaceWith"],"mappings":";;;;;;;;AAAA,CAKoB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAWpB,CAAO,MAAMA,iBAAiB,CAC9B;;;GASCC,WAAW,CAACC,MAAc,EAC1B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,MAAMC,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,6BAA6B,CAAC;KACrE,IAAI,CAACF,QAAQ,CAACG,GAAG,CAAC,kBAAkB,CAAC,EACrC;OACC;;KAGD,4CAAI,kBAASH,QAAQ,CAACG,GAAG,CAAC,SAAS,CAAC;KACpC,4CAAI,sBAAWJ,MAAM;KACrB,4CAAI,sBAAW,EAAE;KACjB,4CAAI,oCAAkBC,QAAQ,CAACG,GAAG,CAAC,eAAe,CAAC;KAEnD,MAAMC,YAAY,GAAGL,MAAM,CAACM,SAAS,CAACC,aAAa,CAAC,wBAAwB,CAAC;KAC7E,IAAIF,YAAY,EAChB;OACCA,YAAY,CAACG,MAAM,yCAAC,IAAI,sBAAW;MACnC,MAED;OACCR,MAAM,CAACM,SAAS,CAACG,MAAM,yCAAC,IAAI,sBAAW;;KAGxC,IAAI,CAACC,cAAc,GAAG,4CAAI,oCAAiBC,IAAI,CAAC,IAAI,CAAC;KAErD,4CAAI;;CAsEN;CAAC,wBAlEA;GACCC,EAAE,CAACC,cAAc,CAAC,uBAAuB,EAAE,IAAI,CAACH,cAAc,CAAC;GAC/DE,EAAE,CAACC,cAAc,CAAC,sBAAsB,EAAE,IAAI,CAACH,cAAc,CAAC;CAC/D;CAAC,0BAEeI,IAA8B,EAC9C;GACC,4CAAI,kBAASA,IAAI,CAACC,eAAe;GACjC,4CAAI;CACL;CAAC,oBAGD;GACC,MAAMC,eAAe,GAAI,4CAAI,oCAAkBC,2BAAO,CAACC,MAAM,GAAGC,2BAAO,CAACC,IAAK;GAE7E,MAAMC,IAAI,GAAGC,aAAG,CAACC,MAAM,cAAC;;gCAEI,CAAkB;;OAE3C,CAAgD;;MAEjD,CAAwB;;GAE1B,GAN8BP,eAAe,EAExCQ,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,0CAE9C,IAAI,oCAEP;GAEDC,eAAK,CAACf,IAAI,CAACU,IAAI,EAAE,OAAO,EAAE,4CAAI,oCAAiBV,IAAI,CAAC,IAAI,CAAC,CAAC;GAE1D,OAAOU,IAAI;CACZ;CAAC,4BAGD;GACC,IAAI,CAACM,gDAAkB,EACvB;KACC;;GAGD,IAAIA,gDAAkB,CAAC;KAAEC,MAAM,EAAE;IAAY,CAAC,CAACC,IAAI,EAAE;GAErDC,qBAAQ,CAAC;KACRC,IAAI,EAAE,SAAS;KACfC,QAAQ,EAAE,OAAO;KACjBC,KAAK,EAAE,YAAY;KACnBC,SAAS,EAAE;IACX,CAAC;CACH;CAAC,2BAGD;GAAA;GACC,MAAMC,OAAO,GAAGC,cAAI,CAACC,cAAc,CAAC,4CAAI,gBAAOC,KAAK,CAAC,GAAG,EAAE,GAAG,MAAM;GAEnE,MAAMC,OAAO,GAAGjB,aAAG,CAACC,MAAM,gBAAC;sEACuC,CAAU;8BAClD,CAAmB;;QAEzC,CAAmB;;;;GAIvB,GAPoEY,OAAO,EAC/C,4CAAI,gBAAOK,KAAK,EAEtC,4CAAI,gBAAOF,KAAK,CAIrB;GAED,qEAAI,oBAASC,OAAO,qBAApB,sBAAsBE,WAAW,CAACF,OAAO,CAAC;GAC1C,4CAAI,oBAASA,OAAO,GAAGA,OAAO;GAE9B,OAAO,4CAAI,oBAASA,OAAO;CAC5B;;;;;;;;"}